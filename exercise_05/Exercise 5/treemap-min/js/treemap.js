!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs")):"function"==typeof define&&define.amd?define(["rxjs"],t):"object"==typeof exports?exports.treemap=t(require("rxjs")):e.treemap=t(e.rxjs)}(window,function(e){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}({"../node_modules/base64-arraybuffer/lib/base64-arraybuffer.js":function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),i=0;i<e.length;i++)r[e.charCodeAt(i)]=i;t.encode=function(t){var r,i=new Uint8Array(t),n=i.length,o="";for(r=0;r<n;r+=3)o+=e[i[r]>>2],o+=e[(3&i[r])<<4|i[r+1]>>4],o+=e[(15&i[r+1])<<2|i[r+2]>>6],o+=e[63&i[r+2]];return n%3==2?o=o.substring(0,o.length-1)+"=":n%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,i,n,o,a,s=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),f=new Uint8Array(l);for(t=0;t<u;t+=4)i=r[e.charCodeAt(t)],n=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],a=r[e.charCodeAt(t+3)],f[c++]=i<<2|n>>4,f[c++]=(15&n)<<4|o>>2,f[c++]=(3&o)<<6|63&a;return l}}()},"../node_modules/webgl-operate/lib/webgl-operate.js":function(e,t,r){e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=79)}([function(e,t,r){"use strict";var i,n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i},o=r(3);!function(e){var t,r=2;e.logVerbosity=function(e){return void 0!==e&&(r=Math.max(-1,e)),r},function(e){e[e.Debug=3]="Debug",e[e.Info=2]="Info",e[e.Warning=1]="Warning",e[e.Error=0]="Error"}(t=e.LogLevel||(e.LogLevel={}));var i=function(e,t){if(!e)throw new EvalError(t)},a=function(e,t){};function s(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];e>r||console.log.apply(console,n(["["+e+"]"],t))}function u(t){var r=t+"-start";e.assert(0===performance.getEntriesByName(t).length,"expected mark identifier to not already exists, given "+t),e.assert(0===performance.getEntriesByName(r).length,"expected mark identifier to not already exists, given "+r),performance.mark(r)}function c(r,i,n){void 0===n&&(n=0);var o=r+"-start",a=r+"-end";e.assert(0===performance.getEntriesByName(r).length,"expected mark identifier to not already exists, given "+r),e.assert(0===performance.getEntriesByName(a).length,"expected mark identifier to not already exists, given "+a),performance.mark(a),performance.measure(r,o,a);var u=performance.getEntriesByName(r)[0];performance.clearMarks(o),performance.clearMarks(a),performance.clearMeasures(r);var c=void 0===i||0===i.length?0:2,l=Math.max(c,n-r.length-(i?i.length:0)-1),f=d(u.duration);s(t.Debug,""+r+" ".repeat(l)+(i||"")+" | "+f)}e.assert=i,e.assertions=function(t){return void 0!==t&&(e.assert=t?i:a),e.assert!==a},e.log=s,e.logIf=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];e&&s.apply(void 0,n([t],r))},e.logPerformanceStart=u,e.logPerformanceStartIf=function(e,t){e&&u(t)},e.logPerformanceStop=c,e.logPerformanceStopIf=function(e,t,r,i){void 0===i&&(i=0),e&&c(t,r,i)},e.rand=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=1),Math.random()*(t-e)+e},e.isPowerOfTwo=function(e){return Number.isInteger(e)&&Number.isInteger(Math.log2(e))},e.upperPowerOfTwo=function(e){return--e,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e};var l=["","Ki","Mi","Gi","Ti","Pi","Ei","Zi","Yi"];e.prettyPrintBytes=function(e){var t=e>0?Math.floor(Math.log(e)/Math.log(1024)):0,r=e/Math.pow(1024,t);return""+(t>0?r.toFixed(3):r)+l[t]+"B"};var f=["ms","ns","Î¼s","ms","s"],h=[0,1e6,1e3,1,.001];function d(e){var t=e>0?Math.max(1,Math.floor(Math.log(10*e)/Math.log(1e3))+3):0;return t=o.clamp(t,0,4),""+(e*h[t]).toFixed(3)+f[t]}e.prettyPrintMilliseconds=d,e.bitInBitfield=function(e,t){return void 0!==t&&(e&t)===t},e.RAD2DEG=57.29577951308232,e.DEG2RAD=.017453292519943295,e.GETsearch=function(){return window.location.search},e.GETparameter=function(e){var t=new RegExp(e+"=([^&]+)"),r=window.location.search.match(t);if(r)return r[1]},e.PATH_SEPARATOR="/",e.dirname=function(t){return!1===t.includes(e.PATH_SEPARATOR)?"":t.substr(0,t.lastIndexOf(e.PATH_SEPARATOR)).trimLeft()},e.basename=function(t){return!1===t.includes(e.PATH_SEPARATOR)?t:t.substr(t.lastIndexOf(e.PATH_SEPARATOR)+1).trimRight()}}(i||(i={})),e.exports=i},function(e,t,r){"use strict";r.r(t),r.d(t,"glMatrix",function(){return i}),r.d(t,"mat2",function(){return n}),r.d(t,"mat2d",function(){return o}),r.d(t,"mat3",function(){return a}),r.d(t,"mat4",function(){return s}),r.d(t,"quat",function(){return l}),r.d(t,"quat2",function(){return f}),r.d(t,"vec2",function(){return h}),r.d(t,"vec3",function(){return u}),r.d(t,"vec4",function(){return c});var i={};r.r(i),r.d(i,"EPSILON",function(){return d}),r.d(i,"ARRAY_TYPE",function(){return p}),r.d(i,"RANDOM",function(){return _}),r.d(i,"setMatrixArrayType",function(){return v}),r.d(i,"toRadian",function(){return b}),r.d(i,"equals",function(){return g});var n={};r.r(n),r.d(n,"create",function(){return y}),r.d(n,"clone",function(){return E}),r.d(n,"copy",function(){return x}),r.d(n,"identity",function(){return T}),r.d(n,"fromValues",function(){return O}),r.d(n,"set",function(){return P}),r.d(n,"transpose",function(){return A}),r.d(n,"invert",function(){return L}),r.d(n,"adjoint",function(){return w}),r.d(n,"determinant",function(){return S}),r.d(n,"multiply",function(){return R}),r.d(n,"rotate",function(){return M}),r.d(n,"scale",function(){return I}),r.d(n,"fromRotation",function(){return N}),r.d(n,"fromScaling",function(){return C}),r.d(n,"str",function(){return F}),r.d(n,"frob",function(){return B}),r.d(n,"LDU",function(){return j}),r.d(n,"add",function(){return D}),r.d(n,"subtract",function(){return z}),r.d(n,"exactEquals",function(){return G}),r.d(n,"equals",function(){return U}),r.d(n,"multiplyScalar",function(){return k}),r.d(n,"multiplyScalarAndAdd",function(){return V}),r.d(n,"mul",function(){return H}),r.d(n,"sub",function(){return W});var o={};r.r(o),r.d(o,"create",function(){return X}),r.d(o,"clone",function(){return q}),r.d(o,"copy",function(){return Y}),r.d(o,"identity",function(){return Z}),r.d(o,"fromValues",function(){return K}),r.d(o,"set",function(){return $}),r.d(o,"invert",function(){return Q}),r.d(o,"determinant",function(){return J}),r.d(o,"multiply",function(){return ee}),r.d(o,"rotate",function(){return te}),r.d(o,"scale",function(){return re}),r.d(o,"translate",function(){return ie}),r.d(o,"fromRotation",function(){return ne}),r.d(o,"fromScaling",function(){return oe}),r.d(o,"fromTranslation",function(){return ae}),r.d(o,"str",function(){return se}),r.d(o,"frob",function(){return ue}),r.d(o,"add",function(){return ce}),r.d(o,"subtract",function(){return le}),r.d(o,"multiplyScalar",function(){return fe}),r.d(o,"multiplyScalarAndAdd",function(){return he}),r.d(o,"exactEquals",function(){return de}),r.d(o,"equals",function(){return pe}),r.d(o,"mul",function(){return _e}),r.d(o,"sub",function(){return ve});var a={};r.r(a),r.d(a,"create",function(){return me}),r.d(a,"fromMat4",function(){return be}),r.d(a,"clone",function(){return ge}),r.d(a,"copy",function(){return ye}),r.d(a,"fromValues",function(){return Ee}),r.d(a,"set",function(){return xe}),r.d(a,"identity",function(){return Te}),r.d(a,"transpose",function(){return Oe}),r.d(a,"invert",function(){return Pe}),r.d(a,"adjoint",function(){return Ae}),r.d(a,"determinant",function(){return Le}),r.d(a,"multiply",function(){return we}),r.d(a,"translate",function(){return Se}),r.d(a,"rotate",function(){return Re}),r.d(a,"scale",function(){return Me}),r.d(a,"fromTranslation",function(){return Ie}),r.d(a,"fromRotation",function(){return Ne}),r.d(a,"fromScaling",function(){return Ce}),r.d(a,"fromMat2d",function(){return Fe}),r.d(a,"fromQuat",function(){return Be}),r.d(a,"normalFromMat4",function(){return je}),r.d(a,"projection",function(){return De}),r.d(a,"str",function(){return ze}),r.d(a,"frob",function(){return Ge}),r.d(a,"add",function(){return Ue}),r.d(a,"subtract",function(){return ke}),r.d(a,"multiplyScalar",function(){return Ve}),r.d(a,"multiplyScalarAndAdd",function(){return He}),r.d(a,"exactEquals",function(){return We}),r.d(a,"equals",function(){return Xe}),r.d(a,"mul",function(){return qe}),r.d(a,"sub",function(){return Ye});var s={};r.r(s),r.d(s,"create",function(){return Ze}),r.d(s,"clone",function(){return Ke}),r.d(s,"copy",function(){return $e}),r.d(s,"fromValues",function(){return Qe}),r.d(s,"set",function(){return Je}),r.d(s,"identity",function(){return et}),r.d(s,"transpose",function(){return tt}),r.d(s,"invert",function(){return rt}),r.d(s,"adjoint",function(){return it}),r.d(s,"determinant",function(){return nt}),r.d(s,"multiply",function(){return ot}),r.d(s,"translate",function(){return at}),r.d(s,"scale",function(){return st}),r.d(s,"rotate",function(){return ut}),r.d(s,"rotateX",function(){return ct}),r.d(s,"rotateY",function(){return lt}),r.d(s,"rotateZ",function(){return ft}),r.d(s,"fromTranslation",function(){return ht}),r.d(s,"fromScaling",function(){return dt}),r.d(s,"fromRotation",function(){return pt}),r.d(s,"fromXRotation",function(){return _t}),r.d(s,"fromYRotation",function(){return vt}),r.d(s,"fromZRotation",function(){return mt}),r.d(s,"fromRotationTranslation",function(){return bt}),r.d(s,"fromQuat2",function(){return gt}),r.d(s,"getTranslation",function(){return yt}),r.d(s,"getScaling",function(){return Et}),r.d(s,"getRotation",function(){return xt}),r.d(s,"fromRotationTranslationScale",function(){return Tt}),r.d(s,"fromRotationTranslationScaleOrigin",function(){return Ot}),r.d(s,"fromQuat",function(){return Pt}),r.d(s,"frustum",function(){return At}),r.d(s,"perspective",function(){return Lt}),r.d(s,"perspectiveFromFieldOfView",function(){return wt}),r.d(s,"ortho",function(){return St}),r.d(s,"lookAt",function(){return Rt}),r.d(s,"targetTo",function(){return Mt}),r.d(s,"str",function(){return It}),r.d(s,"frob",function(){return Nt}),r.d(s,"add",function(){return Ct}),r.d(s,"subtract",function(){return Ft}),r.d(s,"multiplyScalar",function(){return Bt}),r.d(s,"multiplyScalarAndAdd",function(){return jt}),r.d(s,"exactEquals",function(){return Dt}),r.d(s,"equals",function(){return zt}),r.d(s,"mul",function(){return Gt}),r.d(s,"sub",function(){return Ut});var u={};r.r(u),r.d(u,"create",function(){return kt}),r.d(u,"clone",function(){return Vt}),r.d(u,"length",function(){return Ht}),r.d(u,"fromValues",function(){return Wt}),r.d(u,"copy",function(){return Xt}),r.d(u,"set",function(){return qt}),r.d(u,"add",function(){return Yt}),r.d(u,"subtract",function(){return Zt}),r.d(u,"multiply",function(){return Kt}),r.d(u,"divide",function(){return $t}),r.d(u,"ceil",function(){return Qt}),r.d(u,"floor",function(){return Jt}),r.d(u,"min",function(){return er}),r.d(u,"max",function(){return tr}),r.d(u,"round",function(){return rr}),r.d(u,"scale",function(){return ir}),r.d(u,"scaleAndAdd",function(){return nr}),r.d(u,"distance",function(){return or}),r.d(u,"squaredDistance",function(){return ar}),r.d(u,"squaredLength",function(){return sr}),r.d(u,"negate",function(){return ur}),r.d(u,"inverse",function(){return cr}),r.d(u,"normalize",function(){return lr}),r.d(u,"dot",function(){return fr}),r.d(u,"cross",function(){return hr}),r.d(u,"lerp",function(){return dr}),r.d(u,"hermite",function(){return pr}),r.d(u,"bezier",function(){return _r}),r.d(u,"random",function(){return vr}),r.d(u,"transformMat4",function(){return mr}),r.d(u,"transformMat3",function(){return br}),r.d(u,"transformQuat",function(){return gr}),r.d(u,"rotateX",function(){return yr}),r.d(u,"rotateY",function(){return Er}),r.d(u,"rotateZ",function(){return xr}),r.d(u,"angle",function(){return Tr}),r.d(u,"zero",function(){return Or}),r.d(u,"str",function(){return Pr}),r.d(u,"exactEquals",function(){return Ar}),r.d(u,"equals",function(){return Lr}),r.d(u,"sub",function(){return Sr}),r.d(u,"mul",function(){return Rr}),r.d(u,"div",function(){return Mr}),r.d(u,"dist",function(){return Ir}),r.d(u,"sqrDist",function(){return Nr}),r.d(u,"len",function(){return Cr}),r.d(u,"sqrLen",function(){return Fr}),r.d(u,"forEach",function(){return Br});var c={};r.r(c),r.d(c,"create",function(){return jr}),r.d(c,"clone",function(){return Dr}),r.d(c,"fromValues",function(){return zr}),r.d(c,"copy",function(){return Gr}),r.d(c,"set",function(){return Ur}),r.d(c,"add",function(){return kr}),r.d(c,"subtract",function(){return Vr}),r.d(c,"multiply",function(){return Hr}),r.d(c,"divide",function(){return Wr}),r.d(c,"ceil",function(){return Xr}),r.d(c,"floor",function(){return qr}),r.d(c,"min",function(){return Yr}),r.d(c,"max",function(){return Zr}),r.d(c,"round",function(){return Kr}),r.d(c,"scale",function(){return $r}),r.d(c,"scaleAndAdd",function(){return Qr}),r.d(c,"distance",function(){return Jr}),r.d(c,"squaredDistance",function(){return ei}),r.d(c,"length",function(){return ti}),r.d(c,"squaredLength",function(){return ri}),r.d(c,"negate",function(){return ii}),r.d(c,"inverse",function(){return ni}),r.d(c,"normalize",function(){return oi}),r.d(c,"dot",function(){return ai}),r.d(c,"cross",function(){return si}),r.d(c,"lerp",function(){return ui}),r.d(c,"random",function(){return ci}),r.d(c,"transformMat4",function(){return li}),r.d(c,"transformQuat",function(){return fi}),r.d(c,"zero",function(){return hi}),r.d(c,"str",function(){return di}),r.d(c,"exactEquals",function(){return pi}),r.d(c,"equals",function(){return _i}),r.d(c,"sub",function(){return vi}),r.d(c,"mul",function(){return mi}),r.d(c,"div",function(){return bi}),r.d(c,"dist",function(){return gi}),r.d(c,"sqrDist",function(){return yi}),r.d(c,"len",function(){return Ei}),r.d(c,"sqrLen",function(){return xi}),r.d(c,"forEach",function(){return Ti});var l={};r.r(l),r.d(l,"create",function(){return Oi}),r.d(l,"identity",function(){return Pi}),r.d(l,"setAxisAngle",function(){return Ai}),r.d(l,"getAxisAngle",function(){return Li}),r.d(l,"getAngle",function(){return wi}),r.d(l,"multiply",function(){return Si}),r.d(l,"rotateX",function(){return Ri}),r.d(l,"rotateY",function(){return Mi}),r.d(l,"rotateZ",function(){return Ii}),r.d(l,"calculateW",function(){return Ni}),r.d(l,"exp",function(){return Ci}),r.d(l,"ln",function(){return Fi}),r.d(l,"pow",function(){return Bi}),r.d(l,"slerp",function(){return ji}),r.d(l,"random",function(){return Di}),r.d(l,"invert",function(){return zi}),r.d(l,"conjugate",function(){return Gi}),r.d(l,"fromMat3",function(){return Ui}),r.d(l,"fromEuler",function(){return ki}),r.d(l,"str",function(){return Vi}),r.d(l,"clone",function(){return Ki}),r.d(l,"fromValues",function(){return $i}),r.d(l,"copy",function(){return Qi}),r.d(l,"set",function(){return Ji}),r.d(l,"add",function(){return en}),r.d(l,"mul",function(){return tn}),r.d(l,"scale",function(){return rn}),r.d(l,"dot",function(){return nn}),r.d(l,"lerp",function(){return on}),r.d(l,"length",function(){return an}),r.d(l,"len",function(){return sn}),r.d(l,"squaredLength",function(){return un}),r.d(l,"sqrLen",function(){return cn}),r.d(l,"normalize",function(){return ln}),r.d(l,"exactEquals",function(){return fn}),r.d(l,"equals",function(){return hn}),r.d(l,"rotationTo",function(){return dn}),r.d(l,"sqlerp",function(){return pn}),r.d(l,"setAxes",function(){return _n});var f={};r.r(f),r.d(f,"create",function(){return vn}),r.d(f,"clone",function(){return mn}),r.d(f,"fromValues",function(){return bn}),r.d(f,"fromRotationTranslationValues",function(){return gn}),r.d(f,"fromRotationTranslation",function(){return yn}),r.d(f,"fromTranslation",function(){return En}),r.d(f,"fromRotation",function(){return xn}),r.d(f,"fromMat4",function(){return Tn}),r.d(f,"copy",function(){return On}),r.d(f,"identity",function(){return Pn}),r.d(f,"set",function(){return An}),r.d(f,"getReal",function(){return Ln}),r.d(f,"getDual",function(){return wn}),r.d(f,"setReal",function(){return Sn}),r.d(f,"setDual",function(){return Rn}),r.d(f,"getTranslation",function(){return Mn}),r.d(f,"translate",function(){return In}),r.d(f,"rotateX",function(){return Nn}),r.d(f,"rotateY",function(){return Cn}),r.d(f,"rotateZ",function(){return Fn}),r.d(f,"rotateByQuatAppend",function(){return Bn}),r.d(f,"rotateByQuatPrepend",function(){return jn}),r.d(f,"rotateAroundAxis",function(){return Dn}),r.d(f,"add",function(){return zn}),r.d(f,"multiply",function(){return Gn}),r.d(f,"mul",function(){return Un}),r.d(f,"scale",function(){return kn}),r.d(f,"dot",function(){return Vn}),r.d(f,"lerp",function(){return Hn}),r.d(f,"invert",function(){return Wn}),r.d(f,"conjugate",function(){return Xn}),r.d(f,"length",function(){return qn}),r.d(f,"len",function(){return Yn}),r.d(f,"squaredLength",function(){return Zn}),r.d(f,"sqrLen",function(){return Kn}),r.d(f,"normalize",function(){return $n}),r.d(f,"str",function(){return Qn}),r.d(f,"exactEquals",function(){return Jn}),r.d(f,"equals",function(){return eo});var h={};r.r(h),r.d(h,"create",function(){return to}),r.d(h,"clone",function(){return ro}),r.d(h,"fromValues",function(){return io}),r.d(h,"copy",function(){return no}),r.d(h,"set",function(){return oo}),r.d(h,"add",function(){return ao}),r.d(h,"subtract",function(){return so}),r.d(h,"multiply",function(){return uo}),r.d(h,"divide",function(){return co}),r.d(h,"ceil",function(){return lo}),r.d(h,"floor",function(){return fo}),r.d(h,"min",function(){return ho}),r.d(h,"max",function(){return po}),r.d(h,"round",function(){return _o}),r.d(h,"scale",function(){return vo}),r.d(h,"scaleAndAdd",function(){return mo}),r.d(h,"distance",function(){return bo}),r.d(h,"squaredDistance",function(){return go}),r.d(h,"length",function(){return yo}),r.d(h,"squaredLength",function(){return Eo}),r.d(h,"negate",function(){return xo}),r.d(h,"inverse",function(){return To}),r.d(h,"normalize",function(){return Oo}),r.d(h,"dot",function(){return Po}),r.d(h,"cross",function(){return Ao}),r.d(h,"lerp",function(){return Lo}),r.d(h,"random",function(){return wo}),r.d(h,"transformMat2",function(){return So}),r.d(h,"transformMat2d",function(){return Ro}),r.d(h,"transformMat3",function(){return Mo}),r.d(h,"transformMat4",function(){return Io}),r.d(h,"rotate",function(){return No}),r.d(h,"angle",function(){return Co}),r.d(h,"zero",function(){return Fo}),r.d(h,"str",function(){return Bo}),r.d(h,"exactEquals",function(){return jo}),r.d(h,"equals",function(){return Do}),r.d(h,"len",function(){return zo}),r.d(h,"sub",function(){return Go}),r.d(h,"mul",function(){return Uo}),r.d(h,"div",function(){return ko}),r.d(h,"dist",function(){return Vo}),r.d(h,"sqrDist",function(){return Ho}),r.d(h,"sqrLen",function(){return Wo}),r.d(h,"forEach",function(){return Xo});var d=1e-6,p="undefined"!=typeof Float32Array?Float32Array:Array,_=Math.random;function v(e){p=e}var m=Math.PI/180;function b(e){return e*m}function g(e,t){return Math.abs(e-t)<=d*Math.max(1,Math.abs(e),Math.abs(t))}function y(){var e=new p(4);return p!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function E(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function x(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function T(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function O(e,t,r,i){var n=new p(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function P(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function A(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function L(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*o-n*i;return a?(a=1/a,e[0]=o*a,e[1]=-i*a,e[2]=-n*a,e[3]=r*a,e):null}function w(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e}function S(e){return e[0]*e[3]-e[2]*e[1]}function R(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1],c=r[2],l=r[3];return e[0]=i*s+o*u,e[1]=n*s+a*u,e[2]=i*c+o*l,e[3]=n*c+a*l,e}function M(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u+o*s,e[1]=n*u+a*s,e[2]=i*-s+o*u,e[3]=n*-s+a*u,e}function I(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1];return e[0]=i*s,e[1]=n*s,e[2]=o*u,e[3]=a*u,e}function N(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e}function C(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function F(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function B(e){return Math.hypot(e[0],e[1],e[2],e[3])}function j(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]}function D(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function z(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function U(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=t[0],s=t[1],u=t[2],c=t[3];return Math.abs(r-a)<=d*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=d*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-c)<=d*Math.max(1,Math.abs(o),Math.abs(c))}function k(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function V(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var H=R,W=z;function X(){var e=new p(6);return p!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function q(e){var t=new p(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Y(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Z(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function K(e,t,r,i,n,o){var a=new p(6);return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=n,a[5]=o,a}function $(e,t,r,i,n,o,a){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e}function Q(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=r*o-i*n;return u?(u=1/u,e[0]=o*u,e[1]=-i*u,e[2]=-n*u,e[3]=r*u,e[4]=(n*s-o*a)*u,e[5]=(i*a-r*s)*u,e):null}function J(e){return e[0]*e[3]-e[1]*e[2]}function ee(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=r[0],l=r[1],f=r[2],h=r[3],d=r[4],p=r[5];return e[0]=i*c+o*l,e[1]=n*c+a*l,e[2]=i*f+o*h,e[3]=n*f+a*h,e[4]=i*d+o*p+s,e[5]=n*d+a*p+u,e}function te(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*c,e[1]=n*l+a*c,e[2]=i*-c+o*l,e[3]=n*-c+a*l,e[4]=s,e[5]=u,e}function re(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=r[0],l=r[1];return e[0]=i*c,e[1]=n*c,e[2]=o*l,e[3]=a*l,e[4]=s,e[5]=u,e}function ie(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=r[0],l=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=i*c+o*l+s,e[5]=n*c+a*l+u,e}function ne(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function oe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function ae(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function se(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function ue(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function ce(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function le(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function fe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function he(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function de(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function pe(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=t[0],c=t[1],l=t[2],f=t[3],h=t[4],p=t[5];return Math.abs(r-u)<=d*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=d*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-l)<=d*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-f)<=d*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-h)<=d*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(s-p)<=d*Math.max(1,Math.abs(s),Math.abs(p))}var _e=ee,ve=le;function me(){var e=new p(9);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function ge(e){var t=new p(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function ye(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ee(e,t,r,i,n,o,a,s,u){var c=new p(9);return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=o,c[6]=a,c[7]=s,c[8]=u,c}function xe(e,t,r,i,n,o,a,s,u,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e}function Te(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Oe(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Pe(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=l*a-s*c,h=-l*o+s*u,d=c*o-a*u,p=r*f+i*h+n*d;return p?(p=1/p,e[0]=f*p,e[1]=(-l*i+n*c)*p,e[2]=(s*i-n*a)*p,e[3]=h*p,e[4]=(l*r-n*u)*p,e[5]=(-s*r+n*o)*p,e[6]=d*p,e[7]=(-c*r+i*u)*p,e[8]=(a*r-i*o)*p,e):null}function Ae(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8];return e[0]=a*l-s*c,e[1]=n*c-i*l,e[2]=i*s-n*a,e[3]=s*u-o*l,e[4]=r*l-n*u,e[5]=n*o-r*s,e[6]=o*c-a*u,e[7]=i*u-r*c,e[8]=r*a-i*o,e}function Le(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8];return t*(c*o-a*u)+r*(-c*n+a*s)+i*(u*n-o*s)}function we(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=r[0],d=r[1],p=r[2],_=r[3],v=r[4],m=r[5],b=r[6],g=r[7],y=r[8];return e[0]=h*i+d*a+p*c,e[1]=h*n+d*s+p*l,e[2]=h*o+d*u+p*f,e[3]=_*i+v*a+m*c,e[4]=_*n+v*s+m*l,e[5]=_*o+v*u+m*f,e[6]=b*i+g*a+y*c,e[7]=b*n+g*s+y*l,e[8]=b*o+g*u+y*f,e}function Se(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=r[0],d=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=h*i+d*a+c,e[7]=h*n+d*s+l,e[8]=h*o+d*u+f,e}function Re(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=Math.sin(r),d=Math.cos(r);return e[0]=d*i+h*a,e[1]=d*n+h*s,e[2]=d*o+h*u,e[3]=d*a-h*i,e[4]=d*s-h*n,e[5]=d*u-h*o,e[6]=c,e[7]=l,e[8]=f,e}function Me(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ie(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Ne(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ce(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Fe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Be(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r+r,s=i+i,u=n+n,c=r*a,l=i*a,f=i*s,h=n*a,d=n*s,p=n*u,_=o*a,v=o*s,m=o*u;return e[0]=1-f-p,e[3]=l-m,e[6]=h+v,e[1]=l+m,e[4]=1-c-p,e[7]=d-_,e[2]=h-v,e[5]=d+_,e[8]=1-c-f,e}function je(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],_=t[13],v=t[14],m=t[15],b=r*s-i*a,g=r*u-n*a,y=r*c-o*a,E=i*u-n*s,x=i*c-o*s,T=n*c-o*u,O=l*_-f*p,P=l*v-h*p,A=l*m-d*p,L=f*v-h*_,w=f*m-d*_,S=h*m-d*v,R=b*S-g*w+y*L+E*A-x*P+T*O;return R?(R=1/R,e[0]=(s*S-u*w+c*L)*R,e[1]=(u*A-a*S-c*P)*R,e[2]=(a*w-s*A+c*O)*R,e[3]=(n*w-i*S-o*L)*R,e[4]=(r*S-n*A+o*P)*R,e[5]=(i*A-r*w-o*O)*R,e[6]=(_*T-v*x+m*E)*R,e[7]=(v*y-p*T-m*g)*R,e[8]=(p*x-_*y+m*b)*R,e):null}function De(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function ze(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ge(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function Ue(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function ke(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function Ve(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function He(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function We(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Xe(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=t[0],h=t[1],p=t[2],_=t[3],v=t[4],m=t[5],b=t[6],g=t[7],y=t[8];return Math.abs(r-f)<=d*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-h)<=d*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-p)<=d*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-_)<=d*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(a-v)<=d*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=d*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-b)<=d*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(c-g)<=d*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(l-y)<=d*Math.max(1,Math.abs(l),Math.abs(y))}var qe=we,Ye=ke;function Ze(){var e=new p(16);return p!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ke(e){var t=new p(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function $e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Qe(e,t,r,i,n,o,a,s,u,c,l,f,h,d,_,v){var m=new p(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=c,m[10]=l,m[11]=f,m[12]=h,m[13]=d,m[14]=_,m[15]=v,m}function Je(e,t,r,i,n,o,a,s,u,c,l,f,h,d,p,_,v){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=h,e[12]=d,e[13]=p,e[14]=_,e[15]=v,e}function et(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tt(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=n,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function rt(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],_=t[13],v=t[14],m=t[15],b=r*s-i*a,g=r*u-n*a,y=r*c-o*a,E=i*u-n*s,x=i*c-o*s,T=n*c-o*u,O=l*_-f*p,P=l*v-h*p,A=l*m-d*p,L=f*v-h*_,w=f*m-d*_,S=h*m-d*v,R=b*S-g*w+y*L+E*A-x*P+T*O;return R?(R=1/R,e[0]=(s*S-u*w+c*L)*R,e[1]=(n*w-i*S-o*L)*R,e[2]=(_*T-v*x+m*E)*R,e[3]=(h*x-f*T-d*E)*R,e[4]=(u*A-a*S-c*P)*R,e[5]=(r*S-n*A+o*P)*R,e[6]=(v*y-p*T-m*g)*R,e[7]=(l*T-h*y+d*g)*R,e[8]=(a*w-s*A+c*O)*R,e[9]=(i*A-r*w-o*O)*R,e[10]=(p*x-_*y+m*b)*R,e[11]=(f*y-l*x-d*b)*R,e[12]=(s*P-a*L-u*O)*R,e[13]=(r*L-i*P+n*O)*R,e[14]=(_*g-p*E-v*b)*R,e[15]=(l*E-f*g+h*b)*R,e):null}function it(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],h=t[10],d=t[11],p=t[12],_=t[13],v=t[14],m=t[15];return e[0]=s*(h*m-d*v)-f*(u*m-c*v)+_*(u*d-c*h),e[1]=-(i*(h*m-d*v)-f*(n*m-o*v)+_*(n*d-o*h)),e[2]=i*(u*m-c*v)-s*(n*m-o*v)+_*(n*c-o*u),e[3]=-(i*(u*d-c*h)-s*(n*d-o*h)+f*(n*c-o*u)),e[4]=-(a*(h*m-d*v)-l*(u*m-c*v)+p*(u*d-c*h)),e[5]=r*(h*m-d*v)-l*(n*m-o*v)+p*(n*d-o*h),e[6]=-(r*(u*m-c*v)-a*(n*m-o*v)+p*(n*c-o*u)),e[7]=r*(u*d-c*h)-a*(n*d-o*h)+l*(n*c-o*u),e[8]=a*(f*m-d*_)-l*(s*m-c*_)+p*(s*d-c*f),e[9]=-(r*(f*m-d*_)-l*(i*m-o*_)+p*(i*d-o*f)),e[10]=r*(s*m-c*_)-a*(i*m-o*_)+p*(i*c-o*s),e[11]=-(r*(s*d-c*f)-a*(i*d-o*f)+l*(i*c-o*s)),e[12]=-(a*(f*v-h*_)-l*(s*v-u*_)+p*(s*h-u*f)),e[13]=r*(f*v-h*_)-l*(i*v-n*_)+p*(i*h-n*f),e[14]=-(r*(s*v-u*_)-a*(i*v-n*_)+p*(i*u-n*s)),e[15]=r*(s*h-u*f)-a*(i*h-n*f)+l*(i*u-n*s),e}function nt(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],h=e[11],d=e[12],p=e[13],_=e[14],v=e[15];return(t*a-r*o)*(f*v-h*_)-(t*s-i*o)*(l*v-h*p)+(t*u-n*o)*(l*_-f*p)+(r*s-i*a)*(c*v-h*d)-(r*u-n*a)*(c*_-f*d)+(i*u-n*s)*(c*p-l*d)}function ot(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],_=t[12],v=t[13],m=t[14],b=t[15],g=r[0],y=r[1],E=r[2],x=r[3];return e[0]=g*i+y*s+E*f+x*_,e[1]=g*n+y*u+E*h+x*v,e[2]=g*o+y*c+E*d+x*m,e[3]=g*a+y*l+E*p+x*b,g=r[4],y=r[5],E=r[6],x=r[7],e[4]=g*i+y*s+E*f+x*_,e[5]=g*n+y*u+E*h+x*v,e[6]=g*o+y*c+E*d+x*m,e[7]=g*a+y*l+E*p+x*b,g=r[8],y=r[9],E=r[10],x=r[11],e[8]=g*i+y*s+E*f+x*_,e[9]=g*n+y*u+E*h+x*v,e[10]=g*o+y*c+E*d+x*m,e[11]=g*a+y*l+E*p+x*b,g=r[12],y=r[13],E=r[14],x=r[15],e[12]=g*i+y*s+E*f+x*_,e[13]=g*n+y*u+E*h+x*v,e[14]=g*o+y*c+E*d+x*m,e[15]=g*a+y*l+E*p+x*b,e}function at(e,t,r){var i,n,o,a,s,u,c,l,f,h,d,p,_=r[0],v=r[1],m=r[2];return t===e?(e[12]=t[0]*_+t[4]*v+t[8]*m+t[12],e[13]=t[1]*_+t[5]*v+t[9]*m+t[13],e[14]=t[2]*_+t[6]*v+t[10]*m+t[14],e[15]=t[3]*_+t[7]*v+t[11]*m+t[15]):(i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=t[9],d=t[10],p=t[11],e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=f,e[9]=h,e[10]=d,e[11]=p,e[12]=i*_+s*v+f*m+t[12],e[13]=n*_+u*v+h*m+t[13],e[14]=o*_+c*v+d*m+t[14],e[15]=a*_+l*v+p*m+t[15]),e}function st(e,t,r){var i=r[0],n=r[1],o=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ut(e,t,r,i){var n,o,a,s,u,c,l,f,h,p,_,v,m,b,g,y,E,x,T,O,P,A,L,w,S=i[0],R=i[1],M=i[2],I=Math.hypot(S,R,M);return I<d?null:(S*=I=1/I,R*=I,M*=I,n=Math.sin(r),a=1-(o=Math.cos(r)),s=t[0],u=t[1],c=t[2],l=t[3],f=t[4],h=t[5],p=t[6],_=t[7],v=t[8],m=t[9],b=t[10],g=t[11],y=S*S*a+o,E=R*S*a+M*n,x=M*S*a-R*n,T=S*R*a-M*n,O=R*R*a+o,P=M*R*a+S*n,A=S*M*a+R*n,L=R*M*a-S*n,w=M*M*a+o,e[0]=s*y+f*E+v*x,e[1]=u*y+h*E+m*x,e[2]=c*y+p*E+b*x,e[3]=l*y+_*E+g*x,e[4]=s*T+f*O+v*P,e[5]=u*T+h*O+m*P,e[6]=c*T+p*O+b*P,e[7]=l*T+_*O+g*P,e[8]=s*A+f*L+v*w,e[9]=u*A+h*L+m*w,e[10]=c*A+p*L+b*w,e[11]=l*A+_*L+g*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ct(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*n+c*i,e[5]=a*n+l*i,e[6]=s*n+f*i,e[7]=u*n+h*i,e[8]=c*n-o*i,e[9]=l*n-a*i,e[10]=f*n-s*i,e[11]=h*n-u*i,e}function lt(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n-c*i,e[1]=a*n-l*i,e[2]=s*n-f*i,e[3]=u*n-h*i,e[8]=o*i+c*n,e[9]=a*i+l*n,e[10]=s*i+f*n,e[11]=u*i+h*n,e}function ft(e,t,r){var i=Math.sin(r),n=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*n+c*i,e[1]=a*n+l*i,e[2]=s*n+f*i,e[3]=u*n+h*i,e[4]=c*n-o*i,e[5]=l*n-a*i,e[6]=f*n-s*i,e[7]=h*n-u*i,e}function ht(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function dt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pt(e,t,r){var i,n,o,a=r[0],s=r[1],u=r[2],c=Math.hypot(a,s,u);return c<d?null:(a*=c=1/c,s*=c,u*=c,i=Math.sin(t),o=1-(n=Math.cos(t)),e[0]=a*a*o+n,e[1]=s*a*o+u*i,e[2]=u*a*o-s*i,e[3]=0,e[4]=a*s*o-u*i,e[5]=s*s*o+n,e[6]=u*s*o+a*i,e[7]=0,e[8]=a*u*o+s*i,e[9]=s*u*o-a*i,e[10]=u*u*o+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function _t(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vt(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mt(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bt(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=i+i,u=n+n,c=o+o,l=i*s,f=i*u,h=i*c,d=n*u,p=n*c,_=o*c,v=a*s,m=a*u,b=a*c;return e[0]=1-(d+_),e[1]=f+b,e[2]=h-m,e[3]=0,e[4]=f-b,e[5]=1-(l+_),e[6]=p+v,e[7]=0,e[8]=h+m,e[9]=p-v,e[10]=1-(l+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function gt(e,t){var r=new p(3),i=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=i*i+n*n+o*o+a*a;return f>0?(r[0]=2*(s*a+l*i+u*o-c*n)/f,r[1]=2*(u*a+l*n+c*i-s*o)/f,r[2]=2*(c*a+l*o+s*n-u*i)/f):(r[0]=2*(s*a+l*i+u*o-c*n),r[1]=2*(u*a+l*n+c*i-s*o),r[2]=2*(c*a+l*o+s*n-u*i)),bt(e,t,r),e}function yt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function Et(e,t){var r=t[0],i=t[1],n=t[2],o=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.hypot(r,i,n),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,c,l),e}function xt(e,t){var r=new p(3);Et(r,t);var i=1/r[0],n=1/r[1],o=1/r[2],a=t[0]*i,s=t[1]*n,u=t[2]*o,c=t[4]*i,l=t[5]*n,f=t[6]*o,h=t[8]*i,d=t[9]*n,_=t[10]*o,v=a+l+_,m=0;return v>0?(m=2*Math.sqrt(v+1),e[3]=.25*m,e[0]=(f-d)/m,e[1]=(h-u)/m,e[2]=(s-c)/m):a>l&&a>_?(m=2*Math.sqrt(1+a-l-_),e[3]=(f-d)/m,e[0]=.25*m,e[1]=(s+c)/m,e[2]=(h+u)/m):l>_?(m=2*Math.sqrt(1+l-a-_),e[3]=(h-u)/m,e[0]=(s+c)/m,e[1]=.25*m,e[2]=(f+d)/m):(m=2*Math.sqrt(1+_-a-l),e[3]=(s-c)/m,e[0]=(h+u)/m,e[1]=(f+d)/m,e[2]=.25*m),e}function Tt(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3],u=n+n,c=o+o,l=a+a,f=n*u,h=n*c,d=n*l,p=o*c,_=o*l,v=a*l,m=s*u,b=s*c,g=s*l,y=i[0],E=i[1],x=i[2];return e[0]=(1-(p+v))*y,e[1]=(h+g)*y,e[2]=(d-b)*y,e[3]=0,e[4]=(h-g)*E,e[5]=(1-(f+v))*E,e[6]=(_+m)*E,e[7]=0,e[8]=(d+b)*x,e[9]=(_-m)*x,e[10]=(1-(f+p))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Ot(e,t,r,i,n){var o=t[0],a=t[1],s=t[2],u=t[3],c=o+o,l=a+a,f=s+s,h=o*c,d=o*l,p=o*f,_=a*l,v=a*f,m=s*f,b=u*c,g=u*l,y=u*f,E=i[0],x=i[1],T=i[2],O=n[0],P=n[1],A=n[2],L=(1-(_+m))*E,w=(d+y)*E,S=(p-g)*E,R=(d-y)*x,M=(1-(h+m))*x,I=(v+b)*x,N=(p+g)*T,C=(v-b)*T,F=(1-(h+_))*T;return e[0]=L,e[1]=w,e[2]=S,e[3]=0,e[4]=R,e[5]=M,e[6]=I,e[7]=0,e[8]=N,e[9]=C,e[10]=F,e[11]=0,e[12]=r[0]+O-(L*O+R*P+N*A),e[13]=r[1]+P-(w*O+M*P+C*A),e[14]=r[2]+A-(S*O+I*P+F*A),e[15]=1,e}function Pt(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r+r,s=i+i,u=n+n,c=r*a,l=i*a,f=i*s,h=n*a,d=n*s,p=n*u,_=o*a,v=o*s,m=o*u;return e[0]=1-f-p,e[1]=l+m,e[2]=h-v,e[3]=0,e[4]=l-m,e[5]=1-c-p,e[6]=d+_,e[7]=0,e[8]=h+v,e[9]=d-_,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function At(e,t,r,i,n,o,a){var s=1/(r-t),u=1/(n-i),c=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*u,e[10]=(a+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*c,e[15]=0,e}function Lt(e,t,r,i,n){var o,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(o=1/(i-n),e[10]=(n+i)*o,e[14]=2*n*i*o):(e[10]=-1,e[14]=-2*i),e}function wt(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(n+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(n-o)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function St(e,t,r,i,n,o,a){var s=1/(t-r),u=1/(i-n),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*u,e[14]=(a+o)*c,e[15]=1,e}function Rt(e,t,r,i){var n,o,a,s,u,c,l,f,h,p,_=t[0],v=t[1],m=t[2],b=i[0],g=i[1],y=i[2],E=r[0],x=r[1],T=r[2];return Math.abs(_-E)<d&&Math.abs(v-x)<d&&Math.abs(m-T)<d?et(e):(l=_-E,f=v-x,h=m-T,n=g*(h*=p=1/Math.hypot(l,f,h))-y*(f*=p),o=y*(l*=p)-b*h,a=b*f-g*l,(p=Math.hypot(n,o,a))?(n*=p=1/p,o*=p,a*=p):(n=0,o=0,a=0),s=f*a-h*o,u=h*n-l*a,c=l*o-f*n,(p=Math.hypot(s,u,c))?(s*=p=1/p,u*=p,c*=p):(s=0,u=0,c=0),e[0]=n,e[1]=s,e[2]=l,e[3]=0,e[4]=o,e[5]=u,e[6]=f,e[7]=0,e[8]=a,e[9]=c,e[10]=h,e[11]=0,e[12]=-(n*_+o*v+a*m),e[13]=-(s*_+u*v+c*m),e[14]=-(l*_+f*v+h*m),e[15]=1,e)}function Mt(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=i[0],u=i[1],c=i[2],l=n-r[0],f=o-r[1],h=a-r[2],d=l*l+f*f+h*h;d>0&&(l*=d=1/Math.sqrt(d),f*=d,h*=d);var p=u*h-c*f,_=c*l-s*h,v=s*f-u*l;return(d=p*p+_*_+v*v)>0&&(p*=d=1/Math.sqrt(d),_*=d,v*=d),e[0]=p,e[1]=_,e[2]=v,e[3]=0,e[4]=f*v-h*_,e[5]=h*p-l*v,e[6]=l*_-f*p,e[7]=0,e[8]=l,e[9]=f,e[10]=h,e[11]=0,e[12]=n,e[13]=o,e[14]=a,e[15]=1,e}function It(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Nt(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ct(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function Ft(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Bt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function jt(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function Dt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function zt(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],h=e[10],p=e[11],_=e[12],v=e[13],m=e[14],b=e[15],g=t[0],y=t[1],E=t[2],x=t[3],T=t[4],O=t[5],P=t[6],A=t[7],L=t[8],w=t[9],S=t[10],R=t[11],M=t[12],I=t[13],N=t[14],C=t[15];return Math.abs(r-g)<=d*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(i-y)<=d*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(n-E)<=d*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(o-x)<=d*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-T)<=d*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-O)<=d*Math.max(1,Math.abs(s),Math.abs(O))&&Math.abs(u-P)<=d*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(c-A)<=d*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-L)<=d*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(f-w)<=d*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(h-S)<=d*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(p-R)<=d*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(_-M)<=d*Math.max(1,Math.abs(_),Math.abs(M))&&Math.abs(v-I)<=d*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(m-N)<=d*Math.max(1,Math.abs(m),Math.abs(N))&&Math.abs(b-C)<=d*Math.max(1,Math.abs(b),Math.abs(C))}var Gt=ot,Ut=Ft;function kt(){var e=new p(3);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Vt(e){var t=new p(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ht(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function Wt(e,t,r){var i=new p(3);return i[0]=e,i[1]=t,i[2]=r,i}function Xt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function qt(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Yt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Zt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Kt(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function $t(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Qt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Jt(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function er(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function tr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function rr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function ir(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function nr(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function or(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function ar(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function sr(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function ur(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function cr(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function lr(e,t){var r=t[0],i=t[1],n=t[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function fr(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function hr(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],u=r[2];return e[0]=n*u-o*s,e[1]=o*a-i*u,e[2]=i*s-n*a,e}function dr(e,t,r,i){var n=t[0],o=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=a+i*(r[2]-a),e}function pr(e,t,r,i,n,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return e[0]=t[0]*s+r[0]*u+i[0]*c+n[0]*l,e[1]=t[1]*s+r[1]*u+i[1]*c+n[1]*l,e[2]=t[2]*s+r[2]*u+i[2]*c+n[2]*l,e}function _r(e,t,r,i,n,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,f=3*u*a,h=u*o;return e[0]=t[0]*c+r[0]*l+i[0]*f+n[0]*h,e[1]=t[1]*c+r[1]*l+i[1]*f+n[1]*h,e[2]=t[2]*c+r[2]*l+i[2]*f+n[2]*h,e}function vr(e,t){t=t||1;var r=2*_()*Math.PI,i=2*_()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function mr(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,e}function br(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=i*r[0]+n*r[3]+o*r[6],e[1]=i*r[1]+n*r[4]+o*r[7],e[2]=i*r[2]+n*r[5]+o*r[8],e}function gr(e,t,r){var i=r[0],n=r[1],o=r[2],a=r[3],s=t[0],u=t[1],c=t[2],l=n*c-o*u,f=o*s-i*c,h=i*u-n*s,d=n*h-o*f,p=o*l-i*h,_=i*f-n*l,v=2*a;return l*=v,f*=v,h*=v,d*=2,p*=2,_*=2,e[0]=s+l+d,e[1]=u+f+p,e[2]=c+h+_,e}function yr(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Er(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function xr(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Tr(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(r*r+i*i+n*n)*Math.sqrt(o*o+a*a+s*s),c=u&&fr(e,t)/u;return Math.acos(Math.min(Math.max(c,-1),1))}function Or(e){return e[0]=0,e[1]=0,e[2]=0,e}function Pr(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ar(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Lr(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(r-o)<=d*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=d*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=d*Math.max(1,Math.abs(n),Math.abs(s))}var wr,Sr=Zt,Rr=Kt,Mr=$t,Ir=or,Nr=ar,Cr=Ht,Fr=sr,Br=(wr=kt(),function(e,t,r,i,n,o){var a,s;for(t||(t=3),r||(r=0),s=i?Math.min(i*t+r,e.length):e.length,a=r;a<s;a+=t)wr[0]=e[a],wr[1]=e[a+1],wr[2]=e[a+2],n(wr,wr,o),e[a]=wr[0],e[a+1]=wr[1],e[a+2]=wr[2];return e});function jr(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Dr(e){var t=new p(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function zr(e,t,r,i){var n=new p(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Gr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ur(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function kr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Vr(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Hr(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Wr(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function Xr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function qr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function Yr(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function Zr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function Kr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function $r(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Qr(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function Jr(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return Math.hypot(r,i,n,o)}function ei(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return r*r+i*i+n*n+o*o}function ti(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function ri(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function ii(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function ni(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function oi(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=o*a,e}function ai(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function si(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],s=r[1]*i[2]-r[2]*i[1],u=r[1]*i[3]-r[3]*i[1],c=r[2]*i[3]-r[3]*i[2],l=t[0],f=t[1],h=t[2],d=t[3];return e[0]=f*c-h*u+d*s,e[1]=-l*c+h*a-d*o,e[2]=l*u-f*a+d*n,e[3]=-l*s+f*o-h*n,e}function ui(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=a+i*(r[2]-a),e[3]=s+i*(r[3]-s),e}function ci(e,t){var r,i,n,o,a,s;t=t||1;do{a=(r=2*_()-1)*r+(i=2*_()-1)*i}while(a>=1);do{s=(n=2*_()-1)*n+(o=2*_()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return e[0]=t*r,e[1]=t*i,e[2]=t*n*u,e[3]=t*o*u,e}function li(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,e}function fi(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],u=r[2],c=r[3],l=c*i+s*o-u*n,f=c*n+u*i-a*o,h=c*o+a*n-s*i,d=-a*i-s*n-u*o;return e[0]=l*c+d*-a+f*-u-h*-s,e[1]=f*c+d*-s+h*-a-l*-u,e[2]=h*c+d*-u+l*-s-f*-a,e[3]=t[3],e}function hi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function di(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function pi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function _i(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=t[0],s=t[1],u=t[2],c=t[3];return Math.abs(r-a)<=d*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=d*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=d*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-c)<=d*Math.max(1,Math.abs(o),Math.abs(c))}var vi=Vr,mi=Hr,bi=Wr,gi=Jr,yi=ei,Ei=ti,xi=ri,Ti=function(){var e=jr();return function(t,r,i,n,o,a){var s,u;for(r||(r=4),i||(i=0),u=n?Math.min(n*r+i,t.length):t.length,s=i;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function Oi(){var e=new p(4);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Pi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ai(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function Li(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>d?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function wi(e,t){var r=nn(e,t);return Math.acos(2*r*r-1)}function Si(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1],c=r[2],l=r[3];return e[0]=i*l+a*s+n*c-o*u,e[1]=n*l+a*u+o*s-i*c,e[2]=o*l+a*c+i*u-n*s,e[3]=a*l-i*s-n*u-o*c,e}function Ri(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u+a*s,e[1]=n*u+o*s,e[2]=o*u-n*s,e[3]=a*u-i*s,e}function Mi(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u-o*s,e[1]=n*u+a*s,e[2]=o*u+i*s,e[3]=a*u-n*s,e}function Ii(e,t,r){r*=.5;var i=t[0],n=t[1],o=t[2],a=t[3],s=Math.sin(r),u=Math.cos(r);return e[0]=i*u+n*s,e[1]=n*u-i*s,e[2]=o*u+a*s,e[3]=a*u-o*s,e}function Ni(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e}function Ci(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=Math.sqrt(r*r+i*i+n*n),s=Math.exp(o),u=a>0?s*Math.sin(a)/a:0;return e[0]=r*u,e[1]=i*u,e[2]=n*u,e[3]=s*Math.cos(a),e}function Fi(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=Math.sqrt(r*r+i*i+n*n),s=a>0?Math.atan2(a,o)/a:0;return e[0]=r*s,e[1]=i*s,e[2]=n*s,e[3]=.5*Math.log(r*r+i*i+n*n+o*o),e}function Bi(e,t,r){return Fi(e,t),rn(e,e,r),Ci(e,e),e}function ji(e,t,r,i){var n,o,a,s,u,c=t[0],l=t[1],f=t[2],h=t[3],p=r[0],_=r[1],v=r[2],m=r[3];return(o=c*p+l*_+f*v+h*m)<0&&(o=-o,p=-p,_=-_,v=-v,m=-m),1-o>d?(n=Math.acos(o),a=Math.sin(n),s=Math.sin((1-i)*n)/a,u=Math.sin(i*n)/a):(s=1-i,u=i),e[0]=s*c+u*p,e[1]=s*l+u*_,e[2]=s*f+u*v,e[3]=s*h+u*m,e}function Di(e){var t=_(),r=_(),i=_(),n=Math.sqrt(1-t),o=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*r),e[1]=n*Math.cos(2*Math.PI*r),e[2]=o*Math.sin(2*Math.PI*i),e[3]=o*Math.cos(2*Math.PI*i),e}function zi(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*r+i*i+n*n+o*o,s=a?1/a:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-n*s,e[3]=o*s,e}function Gi(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Ui(e,t){var r,i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var o=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[3*n+n]-t[3*o+o]-t[3*a+a]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*o+a]-t[3*a+o])*r,e[o]=(t[3*o+n]+t[3*n+o])*r,e[a]=(t[3*a+n]+t[3*n+a])*r}return e}function ki(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var o=Math.sin(t),a=Math.cos(t),s=Math.sin(r),u=Math.cos(r),c=Math.sin(i),l=Math.cos(i);return e[0]=o*u*l-a*s*c,e[1]=a*s*l+o*u*c,e[2]=a*u*c-o*s*l,e[3]=a*u*l+o*s*c,e}function Vi(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Hi,Wi,Xi,qi,Yi,Zi,Ki=Dr,$i=zr,Qi=Gr,Ji=Ur,en=kr,tn=Si,rn=$r,nn=ai,on=ui,an=ti,sn=an,un=ri,cn=un,ln=oi,fn=pi,hn=_i,dn=(Hi=kt(),Wi=Wt(1,0,0),Xi=Wt(0,1,0),function(e,t,r){var i=fr(t,r);return i<-.999999?(hr(Hi,Wi,t),Cr(Hi)<1e-6&&hr(Hi,Xi,t),lr(Hi,Hi),Ai(e,Hi,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(hr(Hi,t,r),e[0]=Hi[0],e[1]=Hi[1],e[2]=Hi[2],e[3]=1+i,ln(e,e))}),pn=(qi=Oi(),Yi=Oi(),function(e,t,r,i,n,o){return ji(qi,t,n,o),ji(Yi,r,i,o),ji(e,qi,Yi,2*o*(1-o)),e}),_n=(Zi=me(),function(e,t,r,i){return Zi[0]=r[0],Zi[3]=r[1],Zi[6]=r[2],Zi[1]=i[0],Zi[4]=i[1],Zi[7]=i[2],Zi[2]=-t[0],Zi[5]=-t[1],Zi[8]=-t[2],ln(e,Ui(e,Zi))});function vn(){var e=new p(8);return p!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function mn(e){var t=new p(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function bn(e,t,r,i,n,o,a,s){var u=new p(8);return u[0]=e,u[1]=t,u[2]=r,u[3]=i,u[4]=n,u[5]=o,u[6]=a,u[7]=s,u}function gn(e,t,r,i,n,o,a){var s=new p(8);s[0]=e,s[1]=t,s[2]=r,s[3]=i;var u=.5*n,c=.5*o,l=.5*a;return s[4]=u*i+c*r-l*t,s[5]=c*i+l*e-u*r,s[6]=l*i+u*t-c*e,s[7]=-u*e-c*t-l*r,s}function yn(e,t,r){var i=.5*r[0],n=.5*r[1],o=.5*r[2],a=t[0],s=t[1],u=t[2],c=t[3];return e[0]=a,e[1]=s,e[2]=u,e[3]=c,e[4]=i*c+n*u-o*s,e[5]=n*c+o*a-i*u,e[6]=o*c+i*s-n*a,e[7]=-i*a-n*s-o*u,e}function En(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function xn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Tn(e,t){var r=Oi();xt(r,t);var i=new p(3);return yt(i,t),yn(e,r,i),e}function On(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Pn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function An(e,t,r,i,n,o,a,s,u){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e}var Ln=Qi;function wn(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var Sn=Qi;function Rn(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Mn(e,t){var r=t[4],i=t[5],n=t[6],o=t[7],a=-t[0],s=-t[1],u=-t[2],c=t[3];return e[0]=2*(r*c+o*a+i*u-n*s),e[1]=2*(i*c+o*s+n*a-r*u),e[2]=2*(n*c+o*u+r*s-i*a),e}function In(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=.5*r[0],u=.5*r[1],c=.5*r[2],l=t[4],f=t[5],h=t[6],d=t[7];return e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=a*s+n*c-o*u+l,e[5]=a*u+o*s-i*c+f,e[6]=a*c+i*u-n*s+h,e[7]=-i*s-n*u-o*c+d,e}function Nn(e,t,r){var i=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=s*a+l*i+u*o-c*n,h=u*a+l*n+c*i-s*o,d=c*a+l*o+s*n-u*i,p=l*a-s*i-u*n-c*o;return Ri(e,t,r),i=e[0],n=e[1],o=e[2],a=e[3],e[4]=f*a+p*i+h*o-d*n,e[5]=h*a+p*n+d*i-f*o,e[6]=d*a+p*o+f*n-h*i,e[7]=p*a-f*i-h*n-d*o,e}function Cn(e,t,r){var i=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=s*a+l*i+u*o-c*n,h=u*a+l*n+c*i-s*o,d=c*a+l*o+s*n-u*i,p=l*a-s*i-u*n-c*o;return Mi(e,t,r),i=e[0],n=e[1],o=e[2],a=e[3],e[4]=f*a+p*i+h*o-d*n,e[5]=h*a+p*n+d*i-f*o,e[6]=d*a+p*o+f*n-h*i,e[7]=p*a-f*i-h*n-d*o,e}function Fn(e,t,r){var i=-t[0],n=-t[1],o=-t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=s*a+l*i+u*o-c*n,h=u*a+l*n+c*i-s*o,d=c*a+l*o+s*n-u*i,p=l*a-s*i-u*n-c*o;return Ii(e,t,r),i=e[0],n=e[1],o=e[2],a=e[3],e[4]=f*a+p*i+h*o-d*n,e[5]=h*a+p*n+d*i-f*o,e[6]=d*a+p*o+f*n-h*i,e[7]=p*a-f*i-h*n-d*o,e}function Bn(e,t,r){var i=r[0],n=r[1],o=r[2],a=r[3],s=t[0],u=t[1],c=t[2],l=t[3];return e[0]=s*a+l*i+u*o-c*n,e[1]=u*a+l*n+c*i-s*o,e[2]=c*a+l*o+s*n-u*i,e[3]=l*a-s*i-u*n-c*o,s=t[4],u=t[5],c=t[6],l=t[7],e[4]=s*a+l*i+u*o-c*n,e[5]=u*a+l*n+c*i-s*o,e[6]=c*a+l*o+s*n-u*i,e[7]=l*a-s*i-u*n-c*o,e}function jn(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[0],u=r[1],c=r[2],l=r[3];return e[0]=i*l+a*s+n*c-o*u,e[1]=n*l+a*u+o*s-i*c,e[2]=o*l+a*c+i*u-n*s,e[3]=a*l-i*s-n*u-o*c,s=r[4],u=r[5],c=r[6],l=r[7],e[4]=i*l+a*s+n*c-o*u,e[5]=n*l+a*u+o*s-i*c,e[6]=o*l+a*c+i*u-n*s,e[7]=a*l-i*s-n*u-o*c,e}function Dn(e,t,r,i){if(Math.abs(i)<d)return On(e,t);var n=Math.hypot(r[0],r[1],r[2]);i*=.5;var o=Math.sin(i),a=o*r[0]/n,s=o*r[1]/n,u=o*r[2]/n,c=Math.cos(i),l=t[0],f=t[1],h=t[2],p=t[3];e[0]=l*c+p*a+f*u-h*s,e[1]=f*c+p*s+h*a-l*u,e[2]=h*c+p*u+l*s-f*a,e[3]=p*c-l*a-f*s-h*u;var _=t[4],v=t[5],m=t[6],b=t[7];return e[4]=_*c+b*a+v*u-m*s,e[5]=v*c+b*s+m*a-_*u,e[6]=m*c+b*u+_*s-v*a,e[7]=b*c-_*a-v*s-m*u,e}function zn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e}function Gn(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=r[4],u=r[5],c=r[6],l=r[7],f=t[4],h=t[5],d=t[6],p=t[7],_=r[0],v=r[1],m=r[2],b=r[3];return e[0]=i*b+a*_+n*m-o*v,e[1]=n*b+a*v+o*_-i*m,e[2]=o*b+a*m+i*v-n*_,e[3]=a*b-i*_-n*v-o*m,e[4]=i*l+a*s+n*c-o*u+f*b+p*_+h*m-d*v,e[5]=n*l+a*u+o*s-i*c+h*b+p*v+d*_-f*m,e[6]=o*l+a*c+i*u-n*s+d*b+p*m+f*v-h*_,e[7]=a*l-i*s-n*u-o*c+p*b-f*_-h*v-d*m,e}var Un=Gn;function kn(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e}var Vn=nn;function Hn(e,t,r,i){var n=1-i;return Vn(t,r)<0&&(i=-i),e[0]=t[0]*n+r[0]*i,e[1]=t[1]*n+r[1]*i,e[2]=t[2]*n+r[2]*i,e[3]=t[3]*n+r[3]*i,e[4]=t[4]*n+r[4]*i,e[5]=t[5]*n+r[5]*i,e[6]=t[6]*n+r[6]*i,e[7]=t[7]*n+r[7]*i,e}function Wn(e,t){var r=Zn(t);return e[0]=-t[0]/r,e[1]=-t[1]/r,e[2]=-t[2]/r,e[3]=t[3]/r,e[4]=-t[4]/r,e[5]=-t[5]/r,e[6]=-t[6]/r,e[7]=t[7]/r,e}function Xn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var qn=an,Yn=qn,Zn=un,Kn=Zn;function $n(e,t){var r=Zn(t);if(r>0){r=Math.sqrt(r);var i=t[0]/r,n=t[1]/r,o=t[2]/r,a=t[3]/r,s=t[4],u=t[5],c=t[6],l=t[7],f=i*s+n*u+o*c+a*l;e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=(s-i*f)/r,e[5]=(u-n*f)/r,e[6]=(c-o*f)/r,e[7]=(l-a*f)/r}return e}function Qn(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Jn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function eo(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=t[0],f=t[1],h=t[2],p=t[3],_=t[4],v=t[5],m=t[6],b=t[7];return Math.abs(r-l)<=d*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-f)<=d*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-h)<=d*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-p)<=d*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-_)<=d*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-v)<=d*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-m)<=d*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(c-b)<=d*Math.max(1,Math.abs(c),Math.abs(b))}function to(){var e=new p(2);return p!=Float32Array&&(e[0]=0,e[1]=0),e}function ro(e){var t=new p(2);return t[0]=e[0],t[1]=e[1],t}function io(e,t){var r=new p(2);return r[0]=e,r[1]=t,r}function no(e,t){return e[0]=t[0],e[1]=t[1],e}function oo(e,t,r){return e[0]=t,e[1]=r,e}function ao(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function so(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function uo(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function co(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function lo(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function fo(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function ho(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function po(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function _o(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function vo(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function mo(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function bo(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function go(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function yo(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function Eo(e){var t=e[0],r=e[1];return t*t+r*r}function xo(e,t){return e[0]=-t[0],e[1]=-t[1],e}function To(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Oo(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function Po(e,t){return e[0]*t[0]+e[1]*t[1]}function Ao(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function Lo(e,t,r,i){var n=t[0],o=t[1];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e}function wo(e,t){t=t||1;var r=2*_()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function So(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function Ro(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function Mo(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function Io(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function No(e,t,r,i){var n=t[0]-r[0],o=t[1]-r[1],a=Math.sin(i),s=Math.cos(i);return e[0]=n*s-o*a+r[0],e[1]=n*a+o*s+r[1],e}function Co(e,t){var r=e[0],i=e[1],n=t[0],o=t[1],a=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o),s=a&&(r*n+i*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}function Fo(e){return e[0]=0,e[1]=0,e}function Bo(e){return"vec2("+e[0]+", "+e[1]+")"}function jo(e,t){return e[0]===t[0]&&e[1]===t[1]}function Do(e,t){var r=e[0],i=e[1],n=t[0],o=t[1];return Math.abs(r-n)<=d*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=d*Math.max(1,Math.abs(i),Math.abs(o))}var zo=yo,Go=so,Uo=uo,ko=co,Vo=bo,Ho=go,Wo=Eo,Xo=function(){var e=to();return function(t,r,i,n,o,a){var s,u;for(r||(r=2),i||(i=0),u=n?Math.min(n*r+i,t.length):t.length,s=i;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){var t=this;this._initialized=!1,this.assertInitialized=function(){return e.assertInitializedFalse(t)},this.assertUninitialized=function(){}}return e.initialize=function(){return function(t,r,n){var o=n.value;return n.value=function(){var t=this;return i.assert(!1===this._initialized,"re-initialization of initialized object not anticipated"),this._initialized=o.apply(this,arguments),this._initialized?(this.assertInitialized=function(){},this.assertUninitialized=function(){return e.assertUninitializedFalse(t)}):(this.assertUninitialized=function(){},this.assertInitialized=function(){return e.assertInitializedFalse(t)}),this._initialized},n}},e.uninitialize=function(){return function(t,r,n){var o=n.value;return n.value=function(){var t=this;i.assert(!0===this._initialized,"expected object to be initialized in order to uninitialize"),o.apply(this),this._initialized=!1,this.assertUninitialized=function(){},this.assertInitialized=function(){return e.assertInitializedFalse(t)}},n}},e.discard=function(){return function(t,r,n){var o=n.value;return n.value=function(){var t=this;i.assert(!0===this._initialized,"expected object to be initialized in order to uninitialize"),o.apply(this),this._initialized=!1,this.assertUninitialized=function(){},this.assertInitialized=function(){return e.assertInitializedFalse(t)}},n}},e.assert_initialized=function(){return function(e,t,r){var i=r.value;return r.value=function(){return this.assertInitialized(),i.apply(this,arguments)},r}},e.assert_uninitialized=function(){return function(e,t,r){var i=r.value;return r.value=function(){this.assertUninitialized(),i.apply(this,arguments)},r}},Object.defineProperty(e.prototype,"initialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),e.assertInitializedFalse=function(e){return i.assert(!1,"instance of "+e.constructor.name+" expected to be initialized")},e.assertUninitializedFalse=function(e){return i.assert(!1,"instance of "+e.constructor.name+" not expected to be initialized")},e}();t.Initializable=n},function(e,t,r){"use strict";var i,n=r(1);!function(e){function t(e){return e>0?e-Math.floor(e):e-Math.ceil(e)}e.sign=function(e){return e>0?1:e<0?-1:0},e.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},e.fract=t,e.v2=function(){return n.vec2.create()},e.clamp2=function(e,t,r,i){return e[0]=Math.max(r[0],Math.min(i[0],t[0])),e[1]=Math.max(r[1],Math.min(i[1],t[1])),e},e.abs2=function(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e},e.v3=function(){return n.vec3.create()},e.clamp3=function(e,t,r,i){return e[0]=Math.max(r[0],Math.min(i[0],t[0])),e[1]=Math.max(r[1],Math.min(i[1],t[1])),e[2]=Math.max(r[2],Math.min(i[2],t[2])),e},e.abs3=function(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e},e.encode_float24x1_to_uint8x3=function(e,r){return e[0]=Math.floor(256*r),e[1]=Math.floor(256*t(256*r)),e[2]=Math.floor(256*t(65536*r)),e},e.decode_float24x1_from_uint8x3=function(e){return(e[0]+(e[1]+e[2]*(1/256))*(1/256))*(1/256)},e.encode_uint24_to_rgb8=function(e,t){return e[0]=t>>0&255,e[1]=t>>8&255,e[2]=t>>16&255,e},e.encode_uint32_to_rgba8=function(e,t){return e[0]=t>>0&255,e[1]=t>>8&255,e[2]=t>>16&255,e[3]=t>>24&255,e},e.decode_uint24_from_rgb8=function(e){return e[0]+(e[1]<<8)+(e[2]<<16)},e.decode_uint32_from_rgba8=function(e){return e[0]+(e[1]<<8)+(e[2]<<16)+(e[3]<<24)},e.fromVec4=function(e){return 0===e[3]?n.vec3.fromValues(e[0],e[1],e[2]):n.vec3.fromValues(e[0]/e[3],e[1]/e[3],e[2]/e[3])},e.v4=function(){return n.vec4.create()},e.clamp4=function(e,t,r,i){return e[0]=Math.max(r[0],Math.min(i[0],t[0])),e[1]=Math.max(r[1],Math.min(i[1],t[1])),e[2]=Math.max(r[2],Math.min(i[2],t[2])),e[3]=Math.max(r[3],Math.min(i[3],t[3])),e},e.abs4=function(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e[3]=Math.abs(t[3]),e},e.fromVec3=function(e){return n.vec4.fromValues(e[0],e[1],e[2],1)},e.parseVec2=function(e){if(void 0!==e&&""!==e){var t=[];try{t=JSON.parse("["+e+"]")}catch(e){return}return 2!==t.length||isNaN(t[0])||isNaN(t[1])?void 0:n.vec2.clone(t)}},e.parseVec3=function(e){if(void 0!==e&&""!==e){var t=[];try{t=JSON.parse("["+e+"]")}catch(e){return}return 3!==t.length||isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?void 0:n.vec3.clone(t)}},e.parseVec4=function(e){if(void 0!==e&&""!==e){var t=[];try{t=JSON.parse("["+e+"]")}catch(e){return}return 4!==t.length||isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?void 0:n.vec4.clone(t)}},e.mix=function(e,t,r){return e*(1-r)+t*r},e.m2=function(){return n.mat2.create()},e.m3=function(){return n.mat3.create()},e.m4=function(){return n.mat4.create()}}(i||(i={})),e.exports=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(20),u=r(2),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._width=0,t._height=0,t._internalFormat=0,t._format=0,t._type=0,t._mipmap=!1,t._anisotropy=void 0,t}return n(t,e),t.prototype.create=function(e,r,i,n,o){a.assert(e>0&&r>0,"texture requires valid width and height of greater than zero");var s=this._context.gl,u=this._context.gl2facade;if(this._object=s.createTexture(),this._width=e,this._height=r,this._internalFormat=i,this._format=n,this._type=o,s.bindTexture(s.TEXTURE_2D,this._object),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),void 0===t.MAX_ANISOTROPY)if(this._context.supportsTextureFilterAnisotropic){var c=this._context.textureFilterAnisotropic;t.MAX_ANISOTROPY=s.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else t.MAX_ANISOTROPY=0;return u.texImage2D(s.TEXTURE_2D,0,this._internalFormat,this._width,this._height,0,this._format,this._type),s.bindTexture(s.TEXTURE_2D,t.DEFAULT_TEXTURE),this._valid=s.isTexture(this._object),this.reallocate(),this._object},t.prototype.delete=function(){a.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._width=0,this._height=0},t.prototype.reallocate=function(){var e=this.context.gl,t=this._context.gl2facade,r=this._width*this._height*s.byteSizeOfFormat(this.context,this._internalFormat);this._type===t.HALF_FLOAT&&this._internalFormat!==e.RGBA16F?r*=2:this._type===e.FLOAT&&this._internalFormat!==e.RGBA16F&&(r*=4),this.context.allocationRegister.reallocate(this._identifier,r)},t.prototype.bind=function(e){var t=this.context.gl;e&&t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,this._object)},t.prototype.unbind=function(e){var r=this.context.gl;e&&r.activeTexture(e),r.bindTexture(r.TEXTURE_2D,t.DEFAULT_TEXTURE)},t.prototype.fetch=function(e,t,r){var i=this;void 0===t&&(t=!1),void 0===r&&(r=!1);var n=this.context.gl;return new Promise(function(o,s){var u=new Image;u.onerror=function(){a.log(a.LogLevel.Error,"loading image from '"+u.src+"' failed"),s()},u.onload=function(){i.resize(u.width,u.height),r||n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),i.data(u),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),o()},t&&(u.crossOrigin="anonymous"),u.src=e})},t.prototype.data=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var i=this.context.gl,n=this._context.gl2facade;t&&this.bind(),n.texImage2D(i.TEXTURE_2D,0,this._internalFormat,this._width,this._height,0,this._format,this._type,e),void 0!==this._anisotropy&&this._anisotropy>0?this.maxAnisotropy(this._anisotropy,!1,!1):this._mipmap&&this.generateMipMap(!1,!1),r&&this.unbind(),this.reallocate()},t.prototype.filter=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),a.logIf(e===n.LINEAR_MIPMAP_LINEAR||e===n.LINEAR_MIPMAP_NEAREST,a.LogLevel.Debug,"magnification does not utilize a MipMap (refer to LINEAR and NEAREST only)"),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,t),this._mipmap=t===n.LINEAR_MIPMAP_LINEAR||t===n.LINEAR_MIPMAP_NEAREST,this._mipmap&&n.generateMipmap(n.TEXTURE_2D),i&&this.unbind()},t.prototype.wrap=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),i&&this.unbind()},t.prototype.reformat=function(e,t,r,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),(e!==this._internalFormat||void 0!==t&&t!==this._format||void 0!==r&&r!==this._type)&&(a.assert(void 0!==e,"valid internal format expected"),this._internalFormat=e,t&&(this._format=t),r&&(this._type=r),this.data(void 0,i,n))},t.prototype.resize=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),e===this._width&&t===this._height||(this._width=e,this._height=t,this.data(void 0,r,i))},t.prototype.generateMipMap=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0);var r=this.context.gl;e&&this.bind(),r.generateMipmap(r.TEXTURE_2D),t&&this.unbind(),this._mipmap=!0},t.prototype.maxAnisotropy=function(e,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),!1!==this._context.supportsTextureFilterAnisotropic){var n=this.context.gl,o=this._context.textureFilterAnisotropic;return this._anisotropy=void 0===e?void 0:Math.max(0,Math.min(t.MAX_ANISOTROPY,e)),a.logIf(e!==this._anisotropy,a.LogLevel.Debug,"value clamped to max supported anisotropy of "+t.MAX_ANISOTROPY+", given "+e),r&&this.bind(),n.texParameterf(n.TEXTURE_2D,o.TEXTURE_MAX_ANISOTROPY_EXT,void 0===this._anisotropy?0:this._anisotropy),this.generateMipMap(!1,i),this._anisotropy}a.log(a.LogLevel.Debug,"setting anisotropy not supported (EXT_texture_filter_anisotropic missing)")},Object.defineProperty(t.prototype,"bytes",{get:function(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"internalFormat",{get:function(){return this.assertInitialized(),this._internalFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this.assertInitialized(),this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.assertInitialized(),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.assertInitialized(),this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.assertInitialized(),this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.assertInitialized(),[this._width,this._height]},enumerable:!0,configurable:!0}),t.DEFAULT_TEXTURE=void 0,t.MAX_ANISOTROPY=void 0,o([u.Initializable.assert_initialized()],t.prototype,"bind",null),o([u.Initializable.assert_initialized()],t.prototype,"unbind",null),o([u.Initializable.assert_initialized()],t.prototype,"fetch",null),o([u.Initializable.assert_initialized()],t.prototype,"data",null),o([u.Initializable.assert_initialized()],t.prototype,"filter",null),o([u.Initializable.assert_initialized()],t.prototype,"wrap",null),o([u.Initializable.assert_initialized()],t.prototype,"reformat",null),o([u.Initializable.assert_initialized()],t.prototype,"resize",null),t}(r(8).AbstractObject);t.Texture2D=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(2),u=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._target=t.DEFAULT_BUFFER,r}return n(t,e),t.prototype.create=function(e){var t=this._context.gl;return this._object=t.createBuffer(),this._valid=this._object instanceof WebGLBuffer,this._valid&&(a.assert(e===t.ARRAY_BUFFER||e===t.ELEMENT_ARRAY_BUFFER,"either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER expected as buffer target"),this._target=e),this._object},t.prototype.delete=function(){a.assert(this._object instanceof WebGLBuffer,"expected WebGLBuffer object"),this._context.gl.deleteBuffer(this._object),this._object=void 0,this._valid=!1,this._target=t.DEFAULT_BUFFER},t.prototype.bind=function(){a.assert(this._target===this._context.gl.ARRAY_BUFFER||this._target===this._context.gl.ELEMENT_ARRAY_BUFFER,"expected either ARRAY_BUFFER or ELEMENT_ARRAY_BUFFER as buffer target"),this._context.gl.bindBuffer(this._target,this._object)},t.prototype.unbind=function(){this.context.gl.bindBuffer(this._target,t.DEFAULT_BUFFER)},t.prototype.data=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),n.bufferData(this._target,e,t),i&&this.unbind(),this._valid=n.isBuffer(this._object)&&n.getError()===n.NO_ERROR;var o="number"==typeof e?e:e.byteLength,a=this._valid?o:0;this.context.allocationRegister.reallocate(this._identifier,a)},t.prototype.subData=function(e,t,r,i,n,o){void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=!0),void 0===o&&(o=!0);var a=this.context.gl;n&&this.bind(),this.context.gl2facade.bufferSubData(this._target,e,t,r,i),o&&this.unbind(),this._valid=a.getError()===a.NO_ERROR},t.prototype.attribEnable=function(e,t,r,i,n,o,a,s){void 0===i&&(i=!1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=!0),void 0===s&&(s=!0);var u=this.context.gl;a&&this.bind(),u.vertexAttribPointer(e,t,r,i,n,o),u.enableVertexAttribArray(e),s&&this.unbind()},t.prototype.attribDisable=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var i=this.context.gl;t&&this.bind(),i.disableVertexAttribArray(e),r&&this.unbind()},Object.defineProperty(t.prototype,"bytes",{get:function(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return this.assertInitialized(),this._target},enumerable:!0,configurable:!0}),t.DEFAULT_BUFFER=void 0,o([s.Initializable.assert_initialized()],t.prototype,"bind",null),o([s.Initializable.assert_initialized()],t.prototype,"unbind",null),o([s.Initializable.assert_initialized()],t.prototype,"data",null),o([s.Initializable.assert_initialized()],t.prototype,"attribEnable",null),o([s.Initializable.assert_initialized()],t.prototype,"attribDisable",null),t}(r(8).AbstractObject);t.Buffer=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(2),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._shaders=new Array,t._linked=!1,t}return n(t,e),t.prototype.create=function(e,t){void 0===e&&(e=new Array),void 0===t&&(t=!0);for(var r=this._context.gl,i=0,n=0,o=0,s=e;o<s.length;o++)switch(s[o].type){case r.VERTEX_SHADER:++i;break;case r.FRAGMENT_SHADER:++n;break;default:a.assert(!1,"Unknown shader type detected.")}if(a.logIf(i<1,a.LogLevel.Error,"at least one vertex shader is expected"),a.logIf(n<1,a.LogLevel.Error,"at least one fragment shader is expected"),!(i<1||n<1))return this._object=r.createProgram(),this._valid=r.isProgram(this._object),a.assert(this._object instanceof WebGLProgram,"expected WebGLProgram object to be created"),e.length>0&&this.attach(e,t),this._object},t.prototype.delete=function(){a.assert(void 0!==this._object,"expected WebGLProgram object"),this._context.gl.deleteProgram(this._object),this._object=void 0,this._valid=!1},t.prototype.attach=function(e,t){void 0===t&&(t=!1),a.assert(void 0!==this._object,"expected a WebGLProgram object");for(var r=this._context.gl,i=0,n=e instanceof Array?e:[e];i<n.length;i++){var o=n[i];this._shaders.indexOf(o)>-1||(this._shaders.push(o),o.initialized?(r.attachShader(this._object,o.object),o.ref()):a.log(a.LogLevel.Error,"shader '"+o.identifier+"' not initialized."))}return t&&this.link(),!0},t.prototype.detach=function(e){a.assert(void 0!==this._object,"expected WebGLProgram object");for(var t=this._context.gl,r=0,i=e instanceof Array?e:[e];r<i.length;r++){var n=i[r],o=this._shaders.indexOf(n);o>-1&&this._shaders.splice(o),a.assert(n.initialized,"expected shader '"+n.identifier+"' to be initialized"),t.detachShader(this._object,n.object),n.unref()}},t.prototype.link=function(){a.assert(void 0!==this._object,"expected WebGLProgram object");var e=this._context.gl;if(e.linkProgram(this._object),e.getProgramParameter(this._object,e.LINK_STATUS))this._linked=!0;else{var t=e.getProgramInfoLog(this._object);a.log(a.LogLevel.Error,"linking of program '"+this._identifier+"' failed: '"+t+"'"),this._linked=!1}return this._linked},t.prototype.bind=function(){this._context.gl.useProgram(this._object)},t.prototype.unbind=function(){this._context.gl.useProgram(t.DEFAULT_PROGRAM)},t.prototype.uniform=function(e){return this._context.gl.getUniformLocation(this._object,e)},t.prototype.attribute=function(e,t){return void 0!==t?(a.logIf(this._linked,a.LogLevel.Debug,"name-to-generic attribute index mapping does go into effect on next linking, given "+e+" -> "+t+" ("+this.identifier+")"),this._context.gl.bindAttribLocation(this._object,t,e),t):this._context.gl.getAttribLocation(this._object,e)},Object.defineProperty(t.prototype,"shaders",{get:function(){return this._shaders},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"linked",{get:function(){return this._linked},enumerable:!0,configurable:!0}),t.DEFAULT_PROGRAM=void 0,o([s.Initializable.assert_initialized()],t.prototype,"bind",null),o([s.Initializable.assert_initialized()],t.prototype,"unbind",null),o([s.Initializable.assert_initialized()],t.prototype,"uniform",null),o([s.Initializable.assert_initialized()],t.prototype,"attribute",null),t}(r(8).AbstractObject);t.Program=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r,i){var n=e.call(this,t,i)||this;n._compiled=!1;var a=t.gl;if(void 0===i)switch(r){case t.gl.FRAGMENT_SHADER:i="FragmentShader";break;case t.gl.VERTEX_SHADER:i="VertexShader";break;default:o.assert(!1,"expected either a FRAGMENT_SHADER ("+a.FRAGMENT_SHADER+") or a VERTEX_SHADER ("+a.VERTEX_SHADER+"), given "+r)}return n._type=r,n}return n(t,e),t.prototype.create=function(e,t){void 0===t&&(t=!0);var r=this._context.gl;return this._object=r.createShader(this._type),this._valid=r.isShader(this._object),this._compiled=!1,o.assert(this._object instanceof WebGLShader,"expected WebGLShader object to be created"),e&&(this.source=e),e&&t&&this.compile(),this._object},t.prototype.delete=function(){o.assert(void 0!==this._object,"expected WebGLShader object"),this._context.gl.deleteShader(this._object),this._object=void 0,this._valid=!1,this._compiled=!1},t.prototype.compile=function(){var e=this._context.gl,t=this.sourceWithReplacements;if(this._context.isWebGL2&&(t="#version 300 es\n"+t),e.shaderSource(this._object,t),e.compileShader(this._object),this._compiled=e.getShaderParameter(this._object,e.COMPILE_STATUS),!this._compiled){var r=e.getShaderInfoLog(this._object);o.log(o.LogLevel.Error,"compilation of shader '"+this._identifier+"' failed: "+r)}},t.prototype.replace=function(e,t){void 0===this._replacements&&(this._replacements=new Map),this._replacements.set(e,t)},Object.defineProperty(t.prototype,"type",{get:function(){return this.assertInitialized(),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this.assertInitialized(),this._source},set:function(e){this._source!==e&&(this._source=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sourceWithReplacements",{get:function(){if(void 0===this._replacements)return this._source;var e=this._source;return this._replacements.forEach(function(t,r){var i=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");e=e.replace(new RegExp(i,"g"),t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"compiled",{get:function(){return this.assertInitialized(),this._compiled},enumerable:!0,configurable:!0}),t}(r(8).AbstractObject);t.Shader=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(2),u=function(e){function t(t,r){var i=e.call(this)||this;return i._valid=!1,i._referenceCount=0,i._context=t,i._identifier=void 0!==r&&""!==r?r:"Object",i}return n(t,e),t.prototype.initialize=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._identifier=this._context.allocationRegister.createUniqueIdentifier(this._identifier),this.create.apply(this,e),this._valid||(this._context.allocationRegister.deleteUniqueIdentifier(this._identifier),a.log(a.LogLevel.Error,"initialization of '"+this._identifier+"' failed")),this._valid},t.prototype.uninitialize=function(){this._context.allocationRegister.reallocate(this._identifier,0),this._context.allocationRegister.deleteUniqueIdentifier(this._identifier),this.delete(),a.assert(void 0===this._object,"expected object '"+this._identifier+"' to be undefined after delete"),a.assert(!1===this._valid,"expected object '"+this._identifier+"' to be invalid after delete")},Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"identifier",{get:function(){return this._identifier},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"object",{get:function(){return a.assert(void 0!==this._object,"access to undefined object"),this._object},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){return this._valid},enumerable:!0,configurable:!0}),t.prototype.ref=function(){a.assert(this.initialized,"expected object to be initialized in order to be referenced"),++this._referenceCount},t.prototype.unref=function(){a.assert(this._referenceCount>0,"expected object to be referenced in order to decrease its reference count"),--this._referenceCount},o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),t}(s.Initializable);t.AbstractObject=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),s=r(49),u=function(e){function t(t,r){var i=e.call(this)||this;return i._buffers=new Array,r=void 0!==r&&""!==r?r:i.constructor.name,i._vertexArray=new s.VertexArray(t,r+"VAO"),i}return n(t,e),t.prototype.initialize=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var i=t[0],n=t[1],o=!0,a=0;a<this._buffers.length;++a)o=this._buffers[a].initialize(i[a])&&o;return this._vertexArray.initialize(function(){return e.bindBuffers(n)},function(){return e.unbindBuffers(n)}),this._vertexArray.valid&&o},t.prototype.uninitialize=function(){this._vertexArray.uninitialize(),this._buffers.forEach(function(e){return e.uninitialize()})},t.prototype.bind=function(){this._vertexArray.bind()},t.prototype.unbind=function(){this._vertexArray.unbind()},Object.defineProperty(t.prototype,"buffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._vertexArray.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexArray",{get:function(){return this._vertexArray},enumerable:!0,configurable:!0}),o([a.Initializable.initialize()],t.prototype,"initialize",null),o([a.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([a.Initializable.assert_initialized()],t.prototype,"bind",null),o([a.Initializable.assert_initialized()],t.prototype,"unbind",null),t}(a.Initializable);t.Geometry=u},function(e,t){e.exports=r("rxjs")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(52),n=function(){function e(){this._camera=void 0,this._reference=new i.Camera}return Object.defineProperty(e.prototype,"camera",{set:function(e){this._camera!==e&&(this._camera=e,void 0!==e&&(Object.assign(this._reference,e),this.update()))},enumerable:!0,configurable:!0}),e}();t.CameraModifier=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(5),s=r(9),u=r(2),c=function(e){function t(t,r){var i=e.call(this,t,r)||this;r=void 0!==r&&""!==r?r:i.constructor.name;var n=new a.Buffer(t,r+"VBO");return i._buffers.push(n),i}return n(t,e),t.prototype.bindBuffers=function(){this._buffers[0].attribEnable(this._vertexLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1)},t.prototype.unbindBuffers=function(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0)},t.prototype.initialize=function(r){void 0===r&&(r=0),this._vertexLocation=r;var i=this.context.gl,n=e.prototype.initialize.call(this,[i.ARRAY_BUFFER]);return this._buffers[0].data(t.VERTICES,i.STATIC_DRAW),n},t.prototype.draw=function(){var e=this.context.gl;e.drawArrays(e.TRIANGLES,0,3)},Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),t.VERTICES=new Float32Array([-1,-3,3,1,-1,1]),o([u.Initializable.assert_initialized()],t.prototype,"draw",null),t}(s.Geometry);t.NdcFillingTriangle=c},function(e,t,r){"use strict";var i,n=r(1),o=r(3),a=r(0);!function(e){function t(e){return a.assert(2===e.length,"expected length of buffer to be 2, given "+e.length),[e[0],e[1]]}function r(e){return a.assert(3===e.length,"expected length of buffer to be 3, given "+e.length),[e[0],e[1],e[2]]}function i(e){return a.assert(4===e.length,"expected length of buffer to be 4, given "+e.length),[e[0],e[1],e[2],e[3]]}e.tuple2=t,e.tuple3=r,e.tuple4=i,e.clampf=function(e,t){var r=o.clamp(e,0,1);return a.logIf(void 0!==t&&e<0||e>1,a.LogLevel.Info,t+" clamped to ["+r+"], given ["+e+"]"),r},e.clampf2=function(e,r){var i=n.vec2.fromValues(e[0],e[1]);return(e[0]<0||e[0]>1||e[1]<0||e[1]>1)&&(o.clamp2(i,i,n.vec2.fromValues(0,0),n.vec2.fromValues(1,1)),a.logIf(void 0!==r,a.LogLevel.Info,r+" clamped to ["+i+"], given ["+e+"]")),t(i)},e.clampf3=function(e,t){var i=n.vec3.fromValues(e[0],e[1],e[2]);return(e[0]<0||e[0]>1||e[1]<0||e[1]>1||e[2]<0||e[2]>1)&&(o.clamp3(i,i,n.vec3.fromValues(0,0,0),n.vec3.fromValues(1,1,1)),a.logIf(void 0!==t,a.LogLevel.Info,t+" clamped to ["+i+"], given ["+e+"]")),r(i)},e.clampf4=function(e,t){var r=n.vec4.fromValues(e[0],e[1],e[2],e[3]);return(e[0]<0||e[0]>1||e[1]<0||e[1]>1||e[2]<0||e[2]>1||e[3]<0||e[3]>1)&&(o.clamp4(r,r,n.vec4.fromValues(0,0,0,0),n.vec4.fromValues(1,1,1,1)),a.logIf(void 0!==t,a.LogLevel.Info,t+" clamped to ["+r+"], given ["+e+"]")),i(r)},e.duplicate2=function(e){return[e[0],e[1]]},e.duplicate3=function(e){return[e[0],e[1],e[2]]},e.duplicate4=function(e){return[e[0],e[1],e[2],e[3]]},e.equals2=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.equals3=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.equals4=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}}(i||(i={})),e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){}return e.queryInternalTextureFormat=function(t,r,n){var o=t.gl,a=t.gl2facade,s=t.isWebGL1&&t.supportsTextureFloat||t.isWebGL2&&t.supportsColorBufferFloat,u=t.isWebGL1&&t.supportsTextureHalfFloat||t.isWebGL2&&t.supportsColorBufferFloat;void 0===n&&(n=e.Precision.auto);var c,l,f=void 0===n?e.Precision.auto:n;if(n in e.Precision||(i.log(i.LogLevel.Warning,"unknown precision '"+f+"' changed to '"+e.Precision.auto+"'"),n=e.Precision.auto),n===e.Precision.auto&&(f=s?e.Precision.float:u?e.Precision.half:e.Precision.byte),f===e.Precision.half&&u?(t.isWebGL2?t.colorBufferFloat:t.textureHalfFloat,c=a.HALF_FLOAT,l=1):f!==e.Precision.float&&f!==e.Precision.half||!s?(c=o.UNSIGNED_BYTE,l=2):(t.isWebGL2?t.colorBufferFloat:t.textureFloat,c=o.FLOAT,l=0),t.isWebGL1)return i.assert([o.RGB,o.RGBA].includes(r),"target must be gl.RGB or gl.RGBA in WebGL 1"),[r,c,f];switch(r){case o.RGBA:return[[o.RGBA32F,o.RGBA16F,o.RGBA8][l],c,f];case o.RGB:return[[o.RGB32F,o.RGB16F,o.RGB8][l],c,f];case o.RG:return[[o.RG32F,o.RG16F,o.RG8][l],c,f];case o.RED:return[[o.R32F,o.R16F,o.R8][l],c,f];default:i.assert(!1,"internal format querying is not yet supported for formats other than RGBA, RGB")}return[o.NONE,o.NONE,f]},e}();t.Wizard=n,function(e){!function(e){e.float="float",e.half="half",e.byte="byte",e.auto="auto"}(e.Precision||(e.Precision={}))}(n=t.Wizard||(t.Wizard={})),t.Wizard=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){}return e.alter=function(t,r){i.assert(r.hasOwnProperty("any"),"expected alterable object to provide 'any' key"),r.any=!0;var n=t.split("."),o=n.shift();if(i.assert(""===o||r.hasOwnProperty(o),"expected object to have key '"+o+"' in order to capture alterations"),""===o||"object"==typeof r[o])if(""!==o&&n.length>0)e.alter(n.join("."),r[o]);else for(var a=""!==o?r[o]:r,s=0,u=Object.getOwnPropertyNames(a);s<u.length;s++){var c=u[s];"any"!==c&&e.alter(c,a)}else r[o]=!0},e.reset=function(t){for(var r=0,i=Object.getOwnPropertyNames(t);r<i.length;r++){var n=i[r];"object"!=typeof t[n]?t[n]=!1:e.reset(t[n])}},e.prototype.alter=function(t){return e.alter(t,this)},e.prototype.reset=function(){return e.reset(this)},e}();t.ChangeLookup=n},function(e,t,r){"use strict";var i=r(35),n=t.ValidationError=function(e,t,r,i,n,o){i&&(this.property=i),e&&(this.message=e),r&&(r.id?this.schema=r.id:this.schema=r),t&&(this.instance=t),this.name=n,this.argument=o,this.stack=this.toString()};n.prototype.toString=function(){return this.property+" "+this.message};var o=t.ValidatorResult=function(e,t,r,i){this.instance=e,this.schema=t,this.propertyPath=i.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.disableFormat=r&&!0===r.disableFormat};function a(e,t){return t+": "+e.toString()+"\n"}o.prototype.addError=function(e){var t;if("string"==typeof e)t=new n(e,this.instance,this.schema,this.propertyPath);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new n(e.message,this.instance,this.schema,this.propertyPath,e.name,e.argument)}if(this.throwError)throw t;return this.errors.push(t),t},o.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&Array.prototype.push.apply(this.errors,e.errors)},o.prototype.toString=function(e){return this.errors.map(a).join("")},Object.defineProperty(o.prototype,"valid",{get:function(){return!this.errors.length}});var s=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};s.prototype=Object.create(Error.prototype,{constructor:{value:s,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var u=t.SchemaContext=function(e,t,r,i,n){this.schema=e,this.options=t,this.propertyPath=r,this.base=i,this.schemas=n};u.prototype.resolve=function(e){return i.resolve(this.base,e)},u.prototype.makeChild=function(e,t){var r=void 0===t?this.propertyPath:this.propertyPath+l(t),n=i.resolve(this.base,e.id||""),o=new u(e,this.options,r,n,Object.create(this.schemas));return e.id&&!o.schemas[n]&&(o.schemas[n]=e),o};var c=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+-.]*:[^\s]*$/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/\s*(.+?):\s*([^;]+);?/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/};c.regexp=c.regex,c.pattern=c.regex,c.ipv4=c["ip-address"],t.isFormat=function(e,t,r){if("string"==typeof e&&void 0!==c[t]){if(c[t]instanceof RegExp)return c[t].test(e);if("function"==typeof c[t])return c[t](e)}else if(r&&r.customFormats&&"function"==typeof r.customFormats[t])return r.customFormats[t](e);return!0};var l=t.makeSuffix=function(e){return(e=e.toString()).match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};function f(e,t){var r=Array.isArray(t),i=r&&[]||{};return r?(e=e||[],i=i.concat(e),t.forEach(function(e,t,r,i){"object"==typeof r?t[i]=f(e[i],r):-1===e.indexOf(r)&&t.push(r)}.bind(null,e,i))):(e&&"object"==typeof e&&Object.keys(e).forEach(function(e,t,r){t[r]=e[r]}.bind(null,e,i)),Object.keys(t).forEach(function(e,t,r,i){"object"==typeof t[i]&&t[i]&&e[i]?r[i]=f(e[i],t[i]):r[i]=t[i]}.bind(null,e,t,i))),i}function h(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}t.deepCompareStrict=function e(t,r){if(typeof t!=typeof r)return!1;if(Array.isArray(t))return!!Array.isArray(r)&&t.length===r.length&&t.every(function(i,n){return e(t[n],r[n])});if("object"==typeof t){if(!t||!r)return t===r;var i=Object.keys(t),n=Object.keys(r);return i.length===n.length&&i.every(function(i){return e(t[i],r[i])})}return t===r},e.exports.deepMerge=f,t.objectGetPath=function(e,t){for(var r,i=t.split("/").slice(1);"string"==typeof(r=i.shift());){var n=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(n in e))return;e=e[n]}return e},t.encodePath=function(e){return e.map(h).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!=typeof e&&(e=Number(e));var r=e.toString().split("e");if(2===r.length){if("-"!==r[1][0])return t;t=Number(r[1].slice(1))}var i=r[0].split(".");return 2===i.length&&(t+=i[1].length),t}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(2),u=r(8),c=r(23),l=r(4),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._buffersByAttachment=new Map,t._texturesByAttachment=new Map,t._colorClearQueue=new Array,t._drawBuffers=new Array,t._drawBuffersChanged=!1,t}return n(t,e),t.statusString=function(e,t){var r=e.gl;switch(t){case r.FRAMEBUFFER_COMPLETE:return"the framebuffer is ready to display (COMPLETE)";case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"the attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete (INCOMPLETE_ATTACHMENT)";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"there is no attachment (INCOMPLETE_MISSING_ATTACHMENT)";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"height and width of the attachment are not the same (INCOMPLETE_DIMENSIONS)";case r.FRAMEBUFFER_UNSUPPORTED:return"the format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer (UNSUPPORTED)";case r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"the values of gl.RENDERBUFFER_SAMPLES are different among attached renderbuffers, or are non-zero if the attached images are a mix of renderbuffers and textures (INCOMPLETE_MULTISAMPLE)";default:return a.assert(!1,"expected known framebuffer status, given "+t),""}},t.prototype.create=function(e){var r=this._context.gl,i=this.context.gl2facade;this._object=r.createFramebuffer(),this._clearColors=new Array(i.COLOR_ATTACHMENT_MAX-i.COLOR_ATTACHMENT0),this._clearDepth=1,this._clearStencil=0,this.clear=this.context.isWebGL1?this.es2Clear:this.es3Clear;for(var n=0,o=e;n<o.length;n++){var s=o[n],u=s[0],f=s[1];if(f instanceof c.Renderbuffer?this._buffersByAttachment.set(u,f):f instanceof l.Texture2D&&this._texturesByAttachment.set(u,f),!(u<i.COLOR_ATTACHMENT_MIN||u>i.COLOR_ATTACHMENT_MAX)){this._drawBuffers.push(u);var h=u-r.COLOR_ATTACHMENT0;this._colorClearQueue.push(h),this._clearColors[h]=[0,0,0,0]}}this._drawBuffersChanged=!0,r.bindFramebuffer(r.FRAMEBUFFER,this._object),this._buffersByAttachment.forEach(function(e,t){r.framebufferRenderbuffer(r.FRAMEBUFFER,t,r.RENDERBUFFER,e.object)}),this._texturesByAttachment.forEach(function(e,t){r.framebufferTexture2D(r.FRAMEBUFFER,t,r.TEXTURE_2D,e.object,0)}),i.drawBuffers&&i.drawBuffers(this._drawBuffers);var d=r.checkFramebufferStatus(r.FRAMEBUFFER);return this._valid=r.isFramebuffer(this._object)&&d===r.FRAMEBUFFER_COMPLETE,a.logIf(!this._valid,a.LogLevel.Warning,t.statusString(this.context,d)),r.bindFramebuffer(r.FRAMEBUFFER,t.DEFAULT_FRAMEBUFFER),this._object},t.prototype.delete=function(){a.assert(this._object instanceof WebGLFramebuffer,"expected WebGLFramebuffer object"),this.context.gl.deleteFramebuffer(this._object),this._object=void 0,this._valid=!1},t.prototype.es2Clear=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var i=this.context.gl,n=a.bitInBitfield(e,i.DEPTH_BUFFER_BIT),o=a.bitInBitfield(e,i.STENCIL_BUFFER_BIT),s=a.bitInBitfield(e,i.COLOR_BUFFER_BIT);if(s||n||o){if(t&&this.bind(),s&&void 0!==this._clearColors[0]){var u=this._clearColors[0];i.clearColor(u[0],u[1],u[2],u[3])}n&&void 0!==this._clearDepth&&i.clearDepth(this._clearDepth),o&&void 0!==this._clearStencil&&i.clearStencil(this._clearStencil),i.clear(e),r&&this.unbind()}},t.prototype.es3Clear=function(e,t,r,i){void 0===t&&(t=!0),void 0===r&&(r=!0);var n=this.context.gl,o=a.bitInBitfield(e,n.DEPTH_BUFFER_BIT),s=a.bitInBitfield(e,n.STENCIL_BUFFER_BIT),u=a.bitInBitfield(e,n.COLOR_BUFFER_BIT);if(u||o||s){if(t&&this.bind(),u){if(window.chrome&&(window.chrome.webstore||window.chrome.runtime)){var c=this._clearColors[0]?this._clearColors[0]:[0,0,0,1];n.clearColor(c[0],c[1],c[2],c[3]),n.clear(n.COLOR_BUFFER_BIT)}for(var l=0,f=i||this._colorClearQueue;l<f.length;l++){var h=f[l];n.clearBufferfv(n.COLOR,h,this._clearColors[h])}}o&&s?(n.clearStencil(this._clearStencil),n.clearDepth(this._clearDepth),n.clear(n.STENCIL_BUFFER_BIT|n.DEPTH_BUFFER_BIT)):o?n.clearBufferfv(n.DEPTH,0,[this._clearDepth]):s&&(n.clearStencil(this._clearStencil),n.clear(n.STENCIL_BUFFER_BIT)),r&&this.unbind()}},t.prototype.hasAttachment=function(e){return this._texturesByAttachment.has(e)||this._buffersByAttachment.has(e)},t.prototype.bind=function(e){void 0===e&&(e=this.context.gl.FRAMEBUFFER),this.context.gl.bindFramebuffer(e,this._object),this._drawBuffersChanged&&this.context.gl2facade.drawBuffers&&(this.context.gl2facade.drawBuffers(this._drawBuffers),this._drawBuffersChanged=!1)},t.prototype.unbind=function(e){void 0===e&&(e=this.context.gl.FRAMEBUFFER),this.context.gl.bindFramebuffer(e,t.DEFAULT_FRAMEBUFFER)},t.prototype.clearColor=function(e,t){a.assert(void 0===t||0===t||this.context.isWebGL2||this.context.supportsDrawBuffers,"WebGL2 context expected for clearing multiple color attachments.");var r=e[3]<1&&!this.context.alpha;a.logIf(r,a.LogLevel.Warning,"context has alpha disabled, clear color alpha is ignored");var i=[e[0],e[1],e[2],r?1:e[3]];if(this.context.premultipliedAlpha&&!r&&(i[0]*=i[3],i[1]*=i[3],i[2]*=i[3]),void 0!==t)this._clearColors[t]=i;else for(var n=0;n<this._clearColors.length;++n)this._clearColors[n]=i},t.prototype.clearDepth=function(e){this._clearDepth=e},t.prototype.clearStencil=function(e){this._clearStencil=e},t.prototype.texture=function(e){return this._texturesByAttachment.get(e)},t.prototype.resize=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),this._buffersByAttachment.forEach(function(n){n.resize(e,t,r,i)}),this._texturesByAttachment.forEach(function(n){n.resize(e,t,r,i)})},Object.defineProperty(t.prototype,"width",{get:function(){this.assertInitialized();var e=NaN;return this._buffersByAttachment.forEach(function(t){(isNaN(e)||t.width<e)&&(e=t.width)}),this._texturesByAttachment.forEach(function(t){(isNaN(e)||t.width<e)&&(e=t.width)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){this.assertInitialized();var e=NaN;return this._buffersByAttachment.forEach(function(t){(isNaN(e)||t.height<e)&&(e=t.height)}),this._texturesByAttachment.forEach(function(t){(isNaN(e)||t.height<e)&&(e=t.height)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawBuffers",{get:function(){return this.assertInitialized(),this._drawBuffers},set:function(e){this.assertInitialized();for(var t=this.context.gl2facade,r=0,i=e;r<i.length;r++){var n=i[r];a.assert(this.hasAttachment(n),"valid attachment expected for draw buffer, given "+n),a.assert(n>=t.COLOR_ATTACHMENT_MIN&&n<=t.COLOR_ATTACHMENT_MAX,"color attachment expected for draw buffer, given "+n),this._drawBuffersChanged=this._drawBuffersChanged||-1===this._drawBuffers.indexOf(n)}this._drawBuffersChanged=this._drawBuffersChanged||e.length!==this._drawBuffers.length,this._drawBuffersChanged&&(this._drawBuffers=e)},enumerable:!0,configurable:!0}),t.DEFAULT_FRAMEBUFFER=void 0,o([s.Initializable.assert_initialized()],t.prototype,"es2Clear",null),o([s.Initializable.assert_initialized()],t.prototype,"es3Clear",null),o([s.Initializable.assert_initialized()],t.prototype,"bind",null),o([s.Initializable.assert_initialized()],t.prototype,"unbind",null),o([s.Initializable.assert_initialized()],t.prototype,"clearColor",null),o([s.Initializable.assert_initialized()],t.prototype,"clearDepth",null),o([s.Initializable.assert_initialized()],t.prototype,"clearStencil",null),o([s.Initializable.assert_initialized()],t.prototype,"texture",null),o([s.Initializable.assert_initialized()],t.prototype,"resize",null),t}(u.AbstractObject);t.Framebuffer=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){var r=Math.max(0,t);this._texCoords=new Float32Array(r*e.FLOATS_PER_TEXCOORD),this._origins=new Float32Array(r*e.FLOATS_PER_ORIGIN),this._tangents=new Float32Array(r*e.FLOATS_PER_TANGENT),this._ups=new Float32Array(r*e.FLOATS_PER_UP)}return e.concat=function(t){var r=0;t.forEach(function(e){return r+=e?e.length:0});for(var i=new e(r),n=0,o=0;o<t.length;++o){var a=t[o];void 0!==a&&0!==a.length&&(i._texCoords.set(a._texCoords,n*e.FLOATS_PER_TEXCOORD),i._origins.set(a._origins,n*e.FLOATS_PER_ORIGIN),i._tangents.set(a._tangents,n*e.FLOATS_PER_TANGENT),i._ups.set(a._ups,n*e.FLOATS_PER_UP),n+=a.length)}return i},e.prototype.shrink=function(t){var r=Math.max(0,t);if(this.length!==r){var i=function(e,t,r){return new Float32Array(e.buffer.slice(0,t*e.BYTES_PER_ELEMENT*r),0,t*r)};i(this._texCoords,r,e.FLOATS_PER_TEXCOORD),i(this._origins,r,e.FLOATS_PER_ORIGIN),i(this._ups,r,e.FLOATS_PER_TANGENT),i(this._tangents,r,e.FLOATS_PER_UP)}},e.prototype.uvLowerLeft=function(t){var r=t*e.FLOATS_PER_TEXCOORD+0;return this._texCoords.subarray(r,r+2)},e.prototype.uvUpperRight=function(t){var r=t*e.FLOATS_PER_TEXCOORD+2;return this._texCoords.subarray(r,r+2)},e.prototype.origin=function(t){var r=t*e.FLOATS_PER_ORIGIN;return this._origins.subarray(r,r+e.FLOATS_PER_ORIGIN)},e.prototype.tangent=function(t){var r=t*e.FLOATS_PER_TANGENT;return this._tangents.subarray(r,r+e.FLOATS_PER_TANGENT)},e.prototype.up=function(t){var r=t*e.FLOATS_PER_UP;return this._ups.subarray(r,r+e.FLOATS_PER_UP)},Object.defineProperty(e.prototype,"length",{get:function(){return this._origins.length/e.FLOATS_PER_ORIGIN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"origins",{get:function(){return this._origins},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tangents",{get:function(){return this._tangents},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ups",{get:function(){return this._ups},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texCoords",{get:function(){return this._texCoords},enumerable:!0,configurable:!0}),e.FLOATS_PER_TEXCOORD=4,e.FLOATS_PER_ORIGIN=3,e.FLOATS_PER_TANGENT=3,e.FLOATS_PER_UP=3,e}();t.GlyphVertices=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(15),o=r(21),a=r(18),s=r(70),u=function(){function e(t,r,a){this._alignment=e.Alignment.Left,this._lineAnchor=e.LineAnchor.Baseline,this._lineWidth=NaN,this._fontSizeUnit=e.Unit.World,this._color=new o.Color(e.DEFAULT_COLOR),this._altered=Object.assign(new n.ChangeLookup,{any:!1,color:!1,resources:!1,text:!1,typesetting:!1,static:!1,dynamic:!1}),this._wrap=!1,this._elide=e.Elide.None,this._ellipsis=e.DEFAULT_ELLIPSIS,this._text=t,this._type=r,this._staticTransform=i.mat4.create(),this._dynamicTransform=i.mat4.create(),this._extent=[0,0],a&&(this._fontFace=a)}return e.devicePixelRatio=function(){return void 0===window||"number"!=typeof window.devicePixelRatio?1:window.devicePixelRatio},e.prototype.vertices=function(){return new a.GlyphVertices(this.length+this.ellipsis.length)},e.prototype.charAt=function(e){return this._text.charAt(e)},e.prototype.charCodeAt=function(e){return this._text.charCodeAt(e)},e.prototype.lineFeedAt=function(e){return this.charAt(e)===this.lineFeed},e.prototype.kerningBefore=function(e){return e<1||e>this.length?NaN:this._fontFace.kerning(this.charCodeAt(e-1),this.charCodeAt(e))},e.prototype.kerningAfter=function(e){return e<0||e>this.length-1?NaN:this._fontFace.kerning(this.charCodeAt(e),this.charCodeAt(e+1))},e.prototype.advance=function(e){return e<0||e>this.length?NaN:this._fontFace.glyph(this.charCodeAt(e)).advance},e.prototype.toString=function(){return this._text instanceof s.Text?this._text.text:this._text},e.prototype.reset=function(){this._altered.reset()},Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._altered.alter("text"),this._text=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._text.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineFeed",{get:function(){return this._text instanceof s.Text?this._text.lineFeed:s.Text.DEFAULT_LINE_FEED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrap",{get:function(){return this._wrap},set:function(e){this._wrap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elide",{get:function(){return this._elide},set:function(e){this._elide=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ellipsis",{get:function(){return this._ellipsis},set:function(t){this._ellipsis!==t&&(this._ellipsis=t,this._elide!==e.Elide.None&&this._altered.alter("typesetting"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this._lineWidth*this._fontFace.size/this.fontSize},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._altered.alter("typesetting"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this._alignment},set:function(e){this._alignment!==e&&(this._alignment=e,this._altered.alter("typesetting"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineAnchor",{get:function(){return this._lineAnchor},set:function(e){this._lineAnchor!==e&&(this._lineAnchor=e,this._altered.alter("typesetting"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this._altered.alter("typesetting"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSizeUnit",{get:function(){return this._fontSizeUnit},set:function(e){this._fontSizeUnit!==e&&(this._fontSizeUnit=e,this._altered.alter("typesetting"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontFace",{get:function(){return this._fontFace},set:function(e){this._fontFace!==e&&(this._fontFace=e,this._altered.alter("typesetting"),this._altered.alter("resources"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color.equals(e)||(this._color=e,this._altered.alter("color"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor.equals(e)||(this._backgroundColor=e,this._altered.alter("color"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"staticTransform",{get:function(){var e=this.fontSize/this._fontFace.size,t=i.mat4.create();return i.mat4.scale(t,this._staticTransform,i.vec3.fromValues(e,e,e)),t},set:function(e){i.mat4.equals(this._staticTransform,e)||(this._staticTransform=e,this._altered.alter("static"))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dynamicTransform",{get:function(){return this._dynamicTransform},set:function(e){this._altered.alter("dynamic"),this._dynamicTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return this._extent},set:function(e){this._extent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altered",{get:function(){return this._altered.any||this._text.altered||this._color.altered},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valid",{get:function(){return void 0!==this._fontFace&&this._fontFace.glyphTexture.valid&&this._text.length>0},enumerable:!0,configurable:!0}),e.DEFAULT_COLOR=[.1098,.4588,.7373,1],e.DEFAULT_ELLIPSIS="...",e}();t.Label=u,function(e){!function(e){e.Static="static",e.Dynamic="dynamic"}(e.Type||(e.Type={})),function(e){e.None="none",e.Left="left",e.Middle="middle",e.Right="right"}(e.Elide||(e.Elide={})),function(e){e.Left="left",e.Center="center",e.Right="right"}(e.Alignment||(e.Alignment={})),function(e){e.Top="top",e.Ascent="ascent",e.Center="center",e.Baseline="baseline",e.Descent="descent",e.Bottom="bottom"}(e.LineAnchor||(e.LineAnchor={})),function(e){e.World="world",e.Pixel="pixel",e.Mixed="mixed"}(e.Unit||(e.Unit={}))}(u=t.Label||(t.Label={})),t.Label=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0);t.byteSizeOfFormat=function(e,t){var r=e.gl,n=e.gl2facade,o=e.supportsDepthTexture?e.depthTexture.UNSIGNED_INT_24_8_WEBGL:void 0;switch(t){case void 0:default:break;case r.UNSIGNED_BYTE:case r.UNSIGNED_SHORT_5_6_5:case r.UNSIGNED_SHORT_4_4_4_4:case r.UNSIGNED_SHORT_5_5_5_1:case r.UNSIGNED_SHORT:case r.UNSIGNED_INT:case o:case r.FLOAT:case n.HALF_FLOAT:case r.BYTE:case r.UNSIGNED_SHORT:case r.SHORT:case r.UNSIGNED_INT:case r.INT:case r.HALF_FLOAT:case r.FLOAT:case r.UNSIGNED_INT_2_10_10_10_REV:case r.UNSIGNED_INT_10F_11F_11F_REV:case r.UNSIGNED_INT_5_9_9_9_REV:case r.UNSIGNED_INT_24_8:case r.FLOAT_32_UNSIGNED_INT_24_8_REV:return i.assert(!1,"expected format instead of type "+t),0}var a=e.supportsSRGB?e.sRGB.SRGB8_ALPHA8_EXT:void 0,s=e.supportsSRGB?e.sRGB.SRGB_EXT:void 0,u=e.supportsSRGB?e.sRGB.SRGB_ALPHA_EXT:void 0,c=e.supportsColorBufferFloat?e.colorBufferFloat.RGB32F_EXT:void 0,l=e.supportsColorBufferFloat?e.colorBufferFloat.RGBA32F_EXT:void 0;switch(t){case void 0:default:return i.assert(!1,"size of format "+t+" is unknown"),0;case r.ALPHA:case r.LUMINANCE:case r.R8:case r.R8I:case r.R8UI:case r.STENCIL_INDEX8:return 1;case r.DEPTH_COMPONENT16:case r.LUMINANCE_ALPHA:case r.R16F:case r.R16I:case r.R16UI:case r.RG8:case r.RG8I:case r.RG8UI:case r.RGB565:case r.RGB5_A1:case r.RGBA4:return 2;case r.DEPTH_COMPONENT24:case r.RGB:case r.RGB8:case r.RGB8UI:case r.SRGB:case s:case r.SRGB8:return 3;case r.DEPTH_STENCIL:case r.DEPTH24_STENCIL8:case r.DEPTH_COMPONENT32F:case r.R11F_G11F_B10F:case r.R32F:case r.R32I:case r.R32UI:case r.RG16F:case r.RG16I:case r.RG16UI:case r.RGB10_A2:case r.RGB10_A2UI:case r.RGB9_E5:case r.RGBA:case r.RGBA8:case r.RGBA8I:case r.RGBA8UI:case r.SRGB8_ALPHA8:case a:case r.SRGB_ALPHA:case u:case r.SRGB_ALPHA8:case r.SRGB_APLHA8:return 4;case r.DEPTH32F_STENCIL8:return 5;case r.RGB16F:return 6;case r.RG32F:case r.RG32I:case r.RG32UI:case r.RGBA16F:case r.RGBA16I:case r.RGBA16UI:return 8;case r.RGB32F:case r.RGB32F:case c:return 12;case r.RGBA32F:case l:case r.RGBA32I:case r.RGBA32UI:return 16;case r.DEPTH_COMPONENT:case r.DEPTH_STENCIL:return i.assert(!1,"byte size of DEPTH_COMPONENT or DEPTH_STENCIL formats depends on active render buffer"),0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(3),o=r(0),a=r(13),s=function(){function e(t,r){this._rgba=[0,0,0,e.DEFAULT_ALPHA],this._altered=!1,void 0!==t&&(3===t.length&&void 0!==r?this.fromF32(t[0],t[1],t[2],r):4===t.length?(this.fromF32(t[0],t[1],t[2],t[3]),o.assert(void 0===r,"expected alpha to be undefined when given an 4-tuple in RGBA")):this.fromF32(t[0],t[1],t[2]))}return e.hue2rgb=function(e,t,r){return o.assert(r>=-1&&r<=2,"t is expected to be between -1 and 2"),r<0?r+=1:r>1&&(r-=1),6*r<1?e+6*(t-e)*r:2*r<1?t:3*r<2?e+6*(t-e)*(2/3-r):e},e.to2CharHexCode=function(e){return(e<15.5/255?"0":"")+Math.round(255*e).toString(16)},e.hsl2rgb=function(t){var r=a.clampf3(t,"HSL input");if(0===r[1])return[r[2],r[2],r[2]];var i=r[2]<.5?r[2]*(1+r[1]):r[2]+r[1]-r[1]*r[2],n=2*r[2]-i;return[e.hue2rgb(n,i,r[0]+1/3),e.hue2rgb(n,i,r[0]),e.hue2rgb(n,i,r[0]-1/3)]},e.rgb2hsl=function(e){var t=a.clampf3(e,"RGB input"),r=[0,0,0],i=Math.min(t[0],t[1],t[2]),n=Math.max(t[0],t[1],t[2]),o=n-i;if(r[2]=.5*(n+i),0===o)return r;r[1]=r[2]<.5?o/(n+i):o/(2-n-i);var s=((n-t[0])/6+o/2)/o,u=((n-t[1])/6+o/2)/o,c=((n-t[2])/6+o/2)/o;return t[0]===n?r[0]=c-u:t[1]===n?r[0]=s-c+1/3:r[0]=u-s+2/3,r},e.lab2xyz=function(e){var t=a.clampf3(e,"LAB input"),r=(100*t[0]+16)/116,i=(256*t[1]-128)/500+r,n=r-(256*t[2]-128)/200,o=Math.pow(i,3),s=Math.pow(r,3),u=Math.pow(n,3);return[.95047*(o>.008856?o:(i-16/116)/7.787),1*(s>.008856?s:(r-16/116)/7.787),1.08883*(u>.008856?u:(n-16/116)/7.787)]},e.xyz2lab=function(e){var t=[e[0]/.95047,e[1]/1,e[2]/1.08883],r=t[0]>.008856?Math.cbrt(t[0]):7.787*t[0]+16/116,i=t[1]>.008856?Math.cbrt(t[1]):7.787*t[1]+16/116,n=t[2]>.008856?Math.cbrt(t[2]):7.787*t[2]+16/116;return a.clampf3([(116*i-16)/100,(500*(r-i)+128)/256,(200*(i-n)+128)/256])},e.xyz2rgb=function(e){var t=2.04137*e[0]+-.56495*e[1]+-.34469*e[2],r=-.96927*e[0]+1.87601*e[1]+.04156*e[2],i=.01345*e[0]+-.11839*e[1]+1.01541*e[2];return a.clampf3([t>0?Math.pow(t,1/2.19921875):0,r>0?Math.pow(r,1/2.19921875):0,i>0?Math.pow(i,1/2.19921875):0])},e.rgb2xyz=function(e){var t=a.clampf3(e,"RGB input"),r=Math.pow(t[0],2.19921875),i=Math.pow(t[1],2.19921875),n=Math.pow(t[2],2.19921875);return[.57667*r+.18555*i+.18819*n,.29738*r+.62735*i+.07527*n,.02703*r+.07069*i+.9911*n]},e.lab2rgb=function(t){return e.xyz2rgb(e.lab2xyz(t))},e.rgb2lab=function(t){return e.xyz2lab(e.rgb2xyz(t))},e.cmyk2rgb=function(e){var t=a.clampf4(e,"CMYK input"),r=1-t[3];return[(1-t[0])*r,(1-t[1])*r,(1-t[2])*r]},e.rgb2cmyk=function(e){var t=a.clampf3(e,"RGB input"),r=1-Math.max(t[0],t[1],t[2]),i=1-r,n=0===i?0:1/i;return[(i-t[0])*n,(i-t[1])*n,(i-t[2])*n,r]},e.hex2rgba=function(t){var r=[0,0,0,e.DEFAULT_ALPHA];if(!e.HEX_FORMAT_REGEX.test(t))return o.log(o.LogLevel.Warning,"hexadecimal RGBA color string must conform to either '0x0000', '#0000', '0000', '0x00000000', '#00000000', or '00000000', given '"+t+"'"),r;var i=t.startsWith("0x")?2:t.startsWith("#")?1:0,n=Math.floor((t.length-i)/3),a=n-1;return r[0]=parseInt(t[i+0*n]+t[i+0*n+a],16)/255,r[1]=parseInt(t[i+1*n]+t[i+1*n+a],16)/255,r[2]=parseInt(t[i+2*n]+t[i+2*n+a],16)/255,t.length-i!=4&&t.length-i!=8||(r[3]=parseInt(t[i+3*n]+t[i+3*n+a],16)/255),o.assert(!(isNaN(r[0])||isNaN(r[1])||isNaN(r[2])||isNaN(r[3])),"expected well formated hexadecimal RGBA string, given '"+t+"'"),r},e.rgb2hex=function(t){var r=a.clampf3(t,"RGB input");return"#"+e.to2CharHexCode(r[0])+e.to2CharHexCode(r[1])+e.to2CharHexCode(r[2])},e.rgba2hex=function(t){var r=a.clampf4(t,"RGBA input");return"#"+e.to2CharHexCode(r[0])+e.to2CharHexCode(r[1])+e.to2CharHexCode(r[2])+e.to2CharHexCode(r[3])},e.lerp=function(t,r,o,a){if(void 0===a&&(a=e.Space.LAB),o<=0)return new e(t.rgba);if(o>=1)return new e(r.rgba);var s=i.vec4.create();switch(a){case e.Space.CMYK:i.vec4.lerp(s,t.cmyk,r.cmyk,o);var u=n.mix(t.a,r.a,o);return(new e).fromCMYK(s[0],s[1],s[2],s[3],u);case e.Space.LAB:return i.vec4.lerp(s,t.laba,r.laba,o),(new e).fromLAB(s[0],s[1],s[2],s[3]);case e.Space.HSL:return i.vec4.lerp(s,t.hsla,r.hsla,o),(new e).fromHSL(s[0],s[1],s[2],s[3]);case e.Space.RGB:return i.vec4.lerp(s,t.rgba,r.rgba,o),(new e).fromRGB(s[0],s[1],s[2],s[3])}},e.prototype.equals=function(e){return a.equals4(this._rgba,e._rgba)},e.prototype.fromF32=function(t,r,i,n){void 0===n&&(n=e.DEFAULT_ALPHA);var o=a.duplicate4(this._rgba);return this._rgba[0]=a.clampf(t,"red value"),this._rgba[1]=a.clampf(r,"green value"),this._rgba[2]=a.clampf(i,"blue value"),this._rgba[3]=a.clampf(n,"alpha value"),this._altered=!a.equals4(this._rgba,o),this},e.prototype.fromUI8=function(t,r,i,o){void 0===o&&(o=Math.floor(255*e.DEFAULT_ALPHA));var s=a.duplicate4(this._rgba);return this._rgba[0]=n.clamp(t,0,255)/255,this._rgba[1]=n.clamp(r,0,255)/255,this._rgba[2]=n.clamp(i,0,255)/255,this._rgba[3]=n.clamp(o,0,255)/255,this._altered=!a.equals4(this._rgba,s),this},e.prototype.fromRGB=function(t,r,i,n){void 0===n&&(n=e.DEFAULT_ALPHA);var o=a.duplicate4(this._rgba);return this._rgba=a.clampf4([t,r,i,n],"RGBA input"),this._altered=!a.equals4(this._rgba,o),this},e.prototype.fromHSL=function(t,r,i,n){void 0===n&&(n=e.DEFAULT_ALPHA);var o=a.duplicate4(this._rgba),s=e.hsl2rgb([t,r,i]),u=a.clampf(n,"ALPHA input");return this._rgba=[s[0],s[1],s[2],u],this._altered=!a.equals4(this._rgba,o),this},e.prototype.fromLAB=function(t,r,i,n){void 0===n&&(n=e.DEFAULT_ALPHA);var o=a.duplicate4(this._rgba),s=e.lab2rgb([t,r,i]),u=a.clampf(n,"ALPHA input");return this._rgba=[s[0],s[1],s[2],u],this._altered=!a.equals4(this._rgba,o),this},e.prototype.fromCMYK=function(t,r,i,n,o){void 0===o&&(o=e.DEFAULT_ALPHA);var s=a.duplicate4(this._rgba),u=e.cmyk2rgb([t,r,i,n]),c=a.clampf(o,"ALPHA input");return this._rgba=[u[0],u[1],u[2],c],this._altered=!a.equals4(this._rgba,s),this},e.prototype.fromHex=function(t){var r=a.duplicate4(this._rgba);return this._rgba=e.hex2rgba(t),this._altered=!a.equals4(this._rgba,r),this},e.prototype.gray=function(t){switch(void 0===t&&(t=e.GrayscaleAlgorithm.LinearLuminance),t){case e.GrayscaleAlgorithm.Average:return(this._rgba[0]+this._rgba[1]+this._rgba[2])/3;case e.GrayscaleAlgorithm.LeastSaturatedVariant:return.5*(Math.max(this._rgba[0],this._rgba[1],this._rgba[2])-Math.min(this._rgba[0],this._rgba[1],this._rgba[2]));case e.GrayscaleAlgorithm.MinimumDecomposition:return Math.min(this._rgba[0],this._rgba[1],this._rgba[2]);case e.GrayscaleAlgorithm.MaximumDecomposition:return Math.max(this._rgba[0],this._rgba[1],this._rgba[2]);case e.GrayscaleAlgorithm.LinearLuminance:return.2126*this._rgba[0]+.7152*this._rgba[1]+.0722*this._rgba[2]}},e.prototype.tuple=function(t,r){switch(void 0===r&&(r=!0),t){case e.Space.RGB:return r?this.rgba:this.rgb;case e.Space.LAB:return r?this.laba:this.lab;case e.Space.CMYK:return r?this.cmyka:this.cmyk;case e.Space.HSL:return r?this.hsla:this.hsl}},Object.defineProperty(e.prototype,"rgb",{get:function(){return[this._rgba[0],this._rgba[1],this._rgba[2]]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgbUI8",{get:function(){var e=new Uint8Array(3);return e[0]=Math.round(255*this._rgba[0]),e[1]=Math.round(255*this._rgba[1]),e[2]=Math.round(255*this._rgba[2]),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgbF32",{get:function(){var e=new Float32Array(3);return e[0]=this._rgba[0],e[1]=this._rgba[1],e[2]=this._rgba[2],e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgba",{get:function(){return this._rgba},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgbaUI8",{get:function(){var e=new Uint8Array(4);return e[0]=Math.round(255*this._rgba[0]),e[1]=Math.round(255*this._rgba[1]),e[2]=Math.round(255*this._rgba[2]),e[3]=Math.round(255*this._rgba[3]),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rgbaF32",{get:function(){return new Float32Array(this._rgba)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this._rgba[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"g",{get:function(){return this._rgba[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"b",{get:function(){return this._rgba[2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a",{get:function(){return this._rgba[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hexRGB",{get:function(){return e.rgb2hex(this.rgb)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hexRGBA",{get:function(){return e.rgba2hex(this._rgba)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hsl",{get:function(){return e.rgb2hsl(this.rgb)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hsla",{get:function(){var t=e.rgb2hsl(this.rgb);return[t[0],t[1],t[2],this._rgba[3]]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lab",{get:function(){return e.rgb2lab(this.rgb)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"laba",{get:function(){var t=e.rgb2lab(this.rgb);return[t[0],t[1],t[2],this._rgba[3]]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cmyk",{get:function(){return e.rgb2cmyk(this.rgb)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cmyka",{get:function(){var t=e.rgb2cmyk(this.rgb);return[t[0],t[1],t[2],t[3],this._rgba[3]]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altered",{get:function(){return this._altered},set:function(e){this._altered=e},enumerable:!0,configurable:!0}),e.DEFAULT_ALPHA=1,e.HEX_FORMAT_REGEX=new RegExp(/^(#|0x)?(([0-9a-f]{3}){1,2}|([0-9a-f]{4}){1,2})$/i),e}();t.Color=s,function(e){!function(e){e.Average="average",e.LinearLuminance="linear-luminance",e.LeastSaturatedVariant="least-saturated-variant",e.MinimumDecomposition="minimum-decomposition",e.MaximumDecomposition="maximum-decomposition"}(e.GrayscaleAlgorithm||(e.GrayscaleAlgorithm={})),function(e){e.RGB="rgb",e.HSL="hsl",e.LAB="lab",e.CMYK="cmyk"}(e.Space||(e.Space={}))}(s=t.Color||(t.Color={})),t.Color=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){}return e.queryAndCacheAPI=function(){if(void 0===e._exit){for(var t=window.document,r=[t.exitPointerLock,t.mozExitPointerLock,t.webkitExitPointerLock,void 0],n=0;n<r.length&&void 0===r[n];++n);switch(n){case 0:e._exit=function(){return t.exitPointerLock()},e._request=function(e){return e.requestPointerLock()},e._element=function(){return t.pointerLockElement};break;case 1:e._exit=function(){return t.mozCancelPointerLock()},e._request=function(e){return e.mozRequestPointerLock()},e._element=function(){return t.mozPointerLockElement};break;case 2:e._exit=function(){return t.webkitExitPointerLock()},e._request=function(e){return e.webkitRequestPointerLock()},e._element=function(){return t.webkitPointerLockElement};break;default:i.assert(!1,"none of the following pointer lock apis was found: native, moz, or webkit")}}},e.active=function(t){return void 0!==this._element&&(void 0!==t&&e._element()===t||void 0===t&&void 0!==e._element()&&null!==e._element())},e.request=function(t,r){void 0!==t&&(e.queryAndCacheAPI(),e.active()&&e._element()!==t&&e._exit(),e.active()||e._request(t))},e.exit=function(){e._exit&&e._exit()},e}();t.PointerLock=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(20),u=r(2),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._internalFormat=void 0,t}return n(t,e),t.prototype.create=function(e,r,i){a.assert(e>0&&r>0,"renderbuffer object requires valid width and height greater than zero");var n=this.context.gl;this._object=n.createRenderbuffer(),this._width=e,this._height=r,this._internalFormat=i,n.bindRenderbuffer(n.RENDERBUFFER,this._object),n.renderbufferStorage(n.RENDERBUFFER,i,e,r),this._valid=n.isRenderbuffer(this._object),n.bindRenderbuffer(n.RENDERBUFFER,t.DEFAULT_RENDER_BUFFER);var o=e*r*s.byteSizeOfFormat(this.context,i);return this.context.allocationRegister.reallocate(this._identifier,o),this._object},t.prototype.delete=function(){a.assert(this._object instanceof WebGLRenderbuffer,"expected WebGLRenderbuffer object"),this.context.gl.deleteRenderbuffer(this._object),this._object=void 0,this._valid=!1,this._internalFormat=void 0,this._width=0,this._height=0},t.prototype.bind=function(){this.context.gl.bindRenderbuffer(this.context.gl.RENDERBUFFER,this._object)},t.prototype.unbind=function(){this.context.gl.bindRenderbuffer(this.context.gl.RENDERBUFFER,t.DEFAULT_RENDER_BUFFER)},t.prototype.resize=function(e,t,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=!1),e!==this._width||t!==this._height){this._width=e,this._height=t;var n=this.context.gl;r&&this.bind(),n.renderbufferStorage(n.RENDERBUFFER,this._internalFormat,e,t),i&&this.unbind();var o=e*t*s.byteSizeOfFormat(this.context,this._internalFormat);this.context.allocationRegister.reallocate(this._identifier,o)}},Object.defineProperty(t.prototype,"bytes",{get:function(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"internalFormat",{get:function(){return this.assertInitialized(),this._internalFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.assertInitialized(),this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.assertInitialized(),this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0}),t.DEFAULT_RENDER_BUFFER=void 0,o([u.Initializable.assert_initialized()],t.prototype,"bind",null),o([u.Initializable.assert_initialized()],t.prototype,"unbind",null),o([u.Initializable.assert_initialized()],t.prototype,"resize",null),t}(r(8).AbstractObject);t.Renderbuffer=c},function(e,t){e.exports="precision highp float;\r\nprecision highp int;\r\n\r\n/**\r\n  To be replaced via Shader.replace();\r\n */\r\n#define PROJECTION_TYPE\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\nuniform int u_mode;\r\nuniform bool u_skipLod;\r\n\r\n#if defined(CUBE_MAP)\r\n    uniform samplerCube u_cubemap;\r\n#elif defined(EQUI_MAP)\r\n    uniform sampler2D u_equirectmap;\r\n#elif defined(SPHERE_MAP)\r\n    uniform sampler2D u_spheremap;\r\n#elif defined(POLAR_MAP)\r\n    uniform sampler2D u_polarmap[2];\r\n#endif\r\n\r\nvarying vec2 v_uv;\r\nvarying vec4 v_ray;\r\n\r\n\r\nconst float PI = 3.141592653589793;\r\nconst float OneOver2PI = 0.1591549430918953357688837633725;\r\nconst float OneOverPI  = 0.3183098861837906715377675267450;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec2 uv = v_uv;\r\n    vec3 ray = normalize(v_ray.xyz);\r\n\r\n    #if defined(CUBE_MAP)\r\n        #if __VERSION__ == 100\r\n            fragColor = u_skipLod ? textureCubeLod(u_cubemap, vec3(ray), 0.0) : textureCube(u_cubemap, vec3(ray));\r\n        #else\r\n            fragColor = u_skipLod ? textureLod(u_cubemap, vec3(ray), 0.0) : texture(u_cubemap, vec3(ray));\r\n        #endif\r\n    #endif\r\n\r\n    #if defined(EQUI_MAP)\r\n        float v = acos(-ray.y) * OneOverPI;\r\n        float m = atan(-ray.x, ray.z);\r\n        uv = vec2(m * OneOver2PI + 0.5, v);\r\n\r\n        fragColor = texture(u_equirectmap, uv);\r\n    #endif\r\n\r\n    #if defined(SPHERE_MAP)\r\n        ray = -ray.xzy;\r\n        ray.y *= -1.0;\r\n        ray.z += +1.0;\r\n        uv = 0.5 + 0.5 * ray.xy / length(ray);\r\n\r\n        fragColor = texture(u_spheremap, uv);\r\n    #endif\r\n\r\n    #if defined(POLAR_MAP)\r\n        ray.xz /= abs(ray.y) + 1.0;\r\n        ray.xz = ray.xz * 0.5 + 0.5;\r\n        ray.x *= -1.0;\r\n\r\n        fragColor = mix(texture(u_polarmap[1], ray.xz),\r\n                        texture(u_polarmap[0], vec2(1.0, -1.0) * ray.xz),\r\n                        step(0.0, ray.y));\r\n    #endif\r\n}\r\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(123);t.ForwardSceneRenderPass=i.ForwardSceneRenderPass;var n=r(68);t.SceneNode=n.SceneNode;var o=r(39);t.SceneNodeComponent=o.SceneNodeComponent;var a=r(124);t.TransformComponent=a.TransformComponent;var s=r(125);t.GeometryComponent=s.GeometryComponent;var u=r(126);t.Material=u.Material;var c=r(67);t.SceneRenderPass=c.SceneRenderPass},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i};Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(0),a=r(3),s=r(19),u=function(){function e(){}return e.writeVertex=function(e,t,r,i,o){if(void 0!==i&&!1!==r.depictable()){var a=e.glyphTexturePadding,s=i.origin(o);n.vec3.set(s,t[0],t[1],0),s[0]+=r.bearing[0]-a[3],s[1]+=r.bearing[1]-r.extent[1],n.vec3.set(i.tangent(o),r.extent[0],0,0),n.vec3.set(i.up(o),0,r.extent[1],0);var u=i.uvLowerLeft(o);n.vec2.copy(u,r.subTextureOrigin);var c=i.uvUpperRight(o);n.vec2.add(c,r.subTextureOrigin,r.subTextureExtent)}},e.lineAnchorOffset=function(e){var t=0,r=e.fontFace.glyphTexturePadding,i=e.fontFace;switch(e.lineAnchor){case s.Label.LineAnchor.Baseline:default:t=-r[0];break;case s.Label.LineAnchor.Ascent:t=i.ascent-r[0];break;case s.Label.LineAnchor.Descent:t=i.descent*(1+r[0]/i.ascent);break;case s.Label.LineAnchor.Center:t=i.ascent-r[0]-.5*i.size;break;case s.Label.LineAnchor.Top:t=i.ascent-r[0]+.5*i.lineGap;break;case s.Label.LineAnchor.Bottom:t=i.ascent-r[0]+.5*i.lineGap-i.lineHeight}return t},e.advances=function(e,t){o.assert(void 0!==e.fontFace,"expected a font face for label in order to resolve advances"),void 0===t&&(t=e.text.text);for(var r=new Float32Array(t.length),i=0;i<t.length;++i){var n=t.charCodeAt(i);r[i]=e.fontFace.glyph(n).advance}return r},e.kernings=function(e,t){if(o.assert(void 0!==e.fontFace,"expected a font face for label in order to resolve kernings"),void 0===t){for(var r=new Float32Array(e.length),i=0;i<e.length;++i){var n=e.kerningAfter(i);r[i]=isNaN(n)?0:n}return r}var a,s=new Float32Array(t.length);for(i=0;i<t.length;++i)n=(a=i)<0||a>t.length-1?NaN:e.fontFace.kerning(t.charCodeAt(a),t.charCodeAt(a+1)),s[i]=isNaN(n)?0:n;return s},e.fragments=function(t){for(var r,i=new Array,n=0,o=0;o<t.length;++o)if(r=e.DELIMITERS.indexOf(t.charAt(o))>-1){n<o&&i.push([n,o,e.FragmentType.Word]);var a=t.lineFeedAt(o)?e.FragmentType.LineFeed:e.FragmentType.Delimiter;i.push([o,o+1,a]),n=o+1}return r||i.push([n,t.length,e.FragmentType.Word]),i},e.fragmentWidths=function(e,t,r){for(var i=new Float32Array(e.length),n=function(n){var o=e[n];i[n]=t.subarray(o[0],o[1]).reduce(function(e,t,i){return e+t+(i<o[1]?r[i+o[0]]:0)},0)},o=0;o<e.length;++o)n(o);return i},e.elideThresholds=function(e,t){switch(e.elide){case s.Label.Elide.Right:return[e.lineWidth-t,0];case s.Label.Elide.Middle:var r=e.lineWidth/2-t/2;return[r,r];case s.Label.Elide.Left:return[0,e.lineWidth-t];default:return[0,0]}},e.elideFragments=function(t,r,i,n,o,a){for(var s=new Array,u=new Array,c=0,l=0,f=a?r.length-1:0;a?f>-1:f<r.length;a?--f:++f){var h=r[f];if(h[2]!==e.FragmentType.LineFeed){if(!(c+i[f]<t)){if(h[2]===e.FragmentType.Delimiter||c+n[a?h[1]-1:h[0]]>t)break;for(var d=a?h[1]-1:h[0];a?d>=h[0]:d<h[1];a?--d:++d){if(!(c+l+n[d]+o[d]<t)){s.push([a?d+1:h[0],a?h[1]:d,h[2]]),u.push(l);break}l+=n[d]+o[d]}break}c+=i[f],s.push(h),u.push(i[f])}}return[s,u,c+l]},e.transformVertices=function(e,t,r,i){if(void 0!==t&&!n.mat4.equals(e,n.mat4.create()))for(var o=r;o<i;++o){var s=t.origin(o),u=a.v3();n.vec3.transformMat4(u,s,e);var c=a.v3();n.vec3.transformMat4(c,n.vec3.add(c,s,t.tangent(o)),e);var l=a.v3();n.vec3.transformMat4(l,n.vec3.add(l,s,t.up(o)),e),n.vec3.copy(t.origin(o),u),n.vec3.sub(t.tangent(o),c,u),n.vec3.sub(t.up(o),l,u)}},e.updateRectangleMinMax=function(e,t){o.assert(6===e.length&&6===t.length,"expected the rectangles to have 6 values!");for(var r=0;r<3;r++)e[r]=Math.min(e[r],t[r]);for(;r<6;r++)e[r]=Math.max(e[r],t[r])},e.minMax=function(e,t,r){var o=Math.min.apply(Math,i([e],r)),a=Math.max.apply(Math,i([t],r));return n.vec2.fromValues(o,a)},e.getMinMaxVertices=function(t,r,i){for(var n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=r;l<i;++l){var f=e.minMax(n,o,[t.origin(l)[0],t.origin(l)[0]+t.up(l)[0],t.origin(l)[0]+t.tangent(l)[0]]);n=f[0],o=f[1];var h=e.minMax(a,s,[t.origin(l)[1],t.origin(l)[1]+t.up(l)[1],t.origin(l)[1]+t.tangent(l)[1]]);a=h[0],s=h[1];var d=e.minMax(u,c,[t.origin(l)[2],t.origin(l)[2]+t.up(l)[2],t.origin(l)[2]+t.tangent(l)[2]]);u=d[0],c=d[1]}return[n,a,u,o,s,c]},e.transformAlignment=function(e,t,r,i,n){if(void 0!==r&&t!==s.Label.Alignment.Left){var o=-e;t===s.Label.Alignment.Center&&(o*=.5);for(var a=i;a<n;++a)r.origin(a)[0]+=o}},e.transform=function(t,r,i){for(var o=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],a=0,s=i;a<s.length;a++){var u=s[a];e.transformAlignment(u[2],t.alignment,r,u[0],u[1]),e.updateRectangleMinMax(o,e.getMinMaxVertices(r,u[0],u[1])),e.transformVertices(t.staticTransform,r,u[0],u[1])}var c=o[3]-o[0],l=o[4]-o[1],f=n.vec4.transformMat4(n.vec4.create(),n.vec4.fromValues(0,0,0,1),t.staticTransform),h=n.vec4.transformMat4(n.vec4.create(),n.vec4.fromValues(c,0,0,1),t.staticTransform),d=n.vec4.transformMat4(n.vec4.create(),n.vec4.fromValues(0,l,0,1),t.staticTransform),p=n.vec2.fromValues(n.vec4.distance(h,f),n.vec4.distance(d,f));t.extent=[p[0],p[1]]},e.typeset=function(t,r){if(0===t.length)return 0;o.assert(void 0!==t.fontFace,"expected a font face for label before typesetting");var i=t.fontFace,a=function(e){return e<t.length?i.glyph(t.charCodeAt(e)):i.glyph(t.ellipsis.charCodeAt(e-t.length))},u=e.advances(t),c=e.kernings(t),l=e.fragments(t),f=e.fragmentWidths(l,u,c),h=n.vec2.fromValues(0,-e.lineAnchorOffset(t)),d=new Array,p=0,_=t.elide!==s.Label.Elide.None,v=function(n,o,s,l,f,v){void 0===s&&(s=NaN),void 0===l&&(l=u),void 0===f&&(f=c),void 0===v&&(v=0);for(var m=p,b=0;b<n.length;++b){var g=n[b];if(!(g[0]>=g[1])){var y=!_&&g[2]===e.FragmentType.LineFeed,E=!1;if(!_&&!y&&t.wrap){var x=g[2]!==e.FragmentType.Delimiter||a(g[0]).depictable(),T=g[2]===e.FragmentType.Word&&b<n.length-1&&n[b+1][2]===e.FragmentType.Delimiter&&a(n[b+1][0]).depictable();E=h[0]+(x?o[b]:0)+(T?o[b+1]:0)>t.lineWidth}if(!y&&!E||(d.push([m,p,h[0]]),m=p,h[0]=0,h[1]-=i.lineHeight,!y))for(var O=g[0];O<g[1];++O)a(O).depictable()&&(e.writeVertex(i,h,a(O),r,p),++p),h[0]+=l[O-v]+f[O-v]}}m<p&&d.push([m,p,h[0]])},m=f.reduce(function(e,t){return e+t},0);if(_&&m>t.lineWidth){var b=[[t.length,t.length+t.ellipsis.length,e.FragmentType.Word]],g=e.advances(t,t.ellipsis),y=e.kernings(t,t.ellipsis),E=e.fragmentWidths([[0,t.ellipsis.length,e.FragmentType.Word]],g,y),x=E[0];if(t.lineWidth<x)return 0;var T=e.elideThresholds(t,x),O=e.elideFragments(T[0],l,f,u,c,!1),P=O[0],A=O[1],L=O[2];t.elide===s.Label.Elide.Middle&&(T[1]+=T[0]-L);var w=e.elideFragments(T[1],l,f,u,c,!0),S=w[0],R=w[1];v(P,new Float32Array(A)),v(b,E,NaN,g,y,t.length),v(S.reverse(),new Float32Array(R.reverse())),o.assert(d.length<4,"expected at most 3-line-yield from advance, given "+d),d[0][1]=d[d.length-1][1],d[0][2]=h[0],d.length=1}else v(l,f,t.lineWidth);return e.transform(t,r,d),r.shrink(p),p},e.DELIMITERS="\n ,.-/()[]<>",e}();t.Typesetter=u,function(e){!function(e){e[e.Word=0]="Word",e[e.Delimiter=1]="Delimiter",e[e.LineFeed=2]="LineFeed"}(e.FragmentType||(e.FragmentType={}))}(u=t.Typesetter||(t.Typesetter={})),t.Typesetter=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(20),o=r(83),a=r(41),s=r(42),u=r(28),c=r(85),l=function(){function e(t,r){this._attributes=void 0,this._extensions=new Array,this._allocationRegister=new o.AllocationRegister,this._context=t,this._mask=r;var n=t.toString(),a=/WebGLRenderingContext/.test(n)||/CaptureContext/.test(n),s=/WebGL2RenderingContext/.test(n);if(this._backend=a?e.BackendType.WebGL1:s?e.BackendType.WebGL2:void 0,i.assert(void 0!==this._backend&&this._backend.valueOf()!==e.BackendType.Invalid.valueOf(),"context is neither webgl nor webgl2, given "+n),this.queryAttributes(),this.queryExtensionSupport(),this._mask&&this._mask.functionsUndefine)for(var u in this._mask.functionsUndefine)this._context[u]=void 0;this._gl2=new c.GL2Facade(this)}return e.createMasqueradeFromGETorDataAttribute=function(e){return a.ContextMasquerade.fromGET()||(e.msqrdH?a.ContextMasquerade.fromHash(e.msqrdH):e.msqrdP?a.ContextMasquerade.fromPreset(e.msqrdP):void 0)},e.request=function(t,r){void 0===r&&(r=e.DEFAULT_ATTRIBUTES);var n,o=t.dataset,a=e.createMasqueradeFromGETorDataAttribute(o),s=a?a.backend:o.backend?o.backend.toLowerCase():"auto";switch(s in e.BackendRequestType||(i.log(i.LogLevel.Warning,"unknown backend '"+o.backend+"' changed to '"+e.BackendRequestType.auto+"'"),s="auto"),s){case e.BackendRequestType.webgl:break;case e.BackendRequestType.experimental:case e.BackendRequestType.webgl1:case e.BackendRequestType.experimental1:s=e.BackendRequestType.webgl;break;case e.BackendRequestType.webgl2:case e.BackendRequestType.experimental2:s=e.BackendRequestType.webgl2;break;default:s=e.BackendRequestType.auto}return s!==e.BackendRequestType.webgl&&(n=this.requestWebGL2(t,r)),n||(n=this.requestWebGL1(t,r),i.logIf(void 0!==n&&s===e.BackendRequestType.webgl2,i.LogLevel.Info,"backend changed to '"+e.BackendRequestType.webgl+"', given '"+s+"'")),i.assert(!!n,"creating a context failed"),new e(n,a)},e.requestWebGL1=function(t,r){void 0===r&&(r=e.DEFAULT_ATTRIBUTES);var i=t.getContext(e.BackendRequestType.webgl,r);return i||(null===(i=t.getContext(e.BackendRequestType.experimental,r))?void 0:i)},e.requestWebGL2=function(t,r){void 0===r&&(r=e.DEFAULT_ATTRIBUTES);var i=t.getContext(e.BackendRequestType.webgl2,r);return i||(null===(i=t.getContext(e.BackendRequestType.experimental2,r))?void 0:i)},e.prototype.queryAttributes=function(){var e=this._context.getContextAttributes();null!==e?this._attributes=e:i.log(i.LogLevel.Error,"querying context attributes failed (probably blocked)")},Object.defineProperty(e.prototype,"alpha",{get:function(){return!!this._attributes&&this._attributes.alpha},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"antialias",{get:function(){return!!this._attributes&&this._attributes.antialias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return!!this._attributes&&this._attributes.depth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"failIfMajorPerformanceCaveat",{get:function(){return!!this._attributes&&this._attributes.failIfMajorPerformanceCaveat},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"premultipliedAlpha",{get:function(){return!!this._attributes&&this._attributes.premultipliedAlpha},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preserveDrawingBuffer",{get:function(){return!!this._attributes&&this._attributes.preserveDrawingBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencil",{get:function(){return!!this._attributes&&this._attributes.stencil},enumerable:!0,configurable:!0}),e.prototype.supports=function(t){if(this._mask&&this._mask.extensionsConceal.indexOf(t)>-1)return!1;switch(this._backend){case e.BackendType.WebGL1:i.assert(s.WEBGL1_EXTENSIONS.indexOf(t)>-1,"extension "+t+" not available to WebGL1");break;case e.BackendType.WebGL2:i.assert(-1===s.WEBGL2_DEFAULT_EXTENSIONS.indexOf(t),"extension "+t+" supported by default in WebGL2"),i.assert(s.WEBGL2_EXTENSIONS.indexOf(t)>-1,"extension "+t+" not available to WebGL2")}return this._extensions.indexOf(t)>-1},e.prototype.enable=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.isWebGL1&&-1===s.WEBGL1_EXTENSIONS.indexOf(i)||this.isWebGL2&&-1===s.WEBGL2_EXTENSIONS.indexOf(i)||!1!==this.supports(i)&&this.extension(void 0,i)}},e.prototype.queryExtensionSupport=function(){var t=this._context.getSupportedExtensions();if(null!==t){for(var r=0,n=t;r<n.length;r++){var o=n[r];this._mask&&this._mask.extensionsConceal.indexOf(o)>-1||this._extensions.push(o)}this._backend===e.BackendType.WebGL1&&(this.ANGLE_instanced_arrays_supported=this.supports("ANGLE_instanced_arrays"),this.EXT_blend_minmax_supported=this.supports("EXT_blend_minmax"),this.EXT_color_buffer_half_float_supported=this.supports("EXT_color_buffer_half_float"),this.EXT_disjoint_timer_query_supported=this.supports("EXT_disjoint_timer_query"),this.EXT_frag_depth_supported=this.supports("EXT_frag_depth"),this.EXT_sRGB_supported=this.supports("EXT_sRGB"),this.EXT_shader_texture_lod_supported=this.supports("EXT_shader_texture_lod"),this.OES_element_index_uint_supported=this.supports("OES_element_index_uint"),this.OES_standard_derivatives_supported=this.supports("OES_standard_derivatives"),this.OES_texture_float_supported=this.supports("OES_texture_float"),this.OES_texture_half_float_supported=this.supports("OES_texture_half_float"),this.OES_vertex_array_object_supported=this.supports("OES_vertex_array_object"),this.WEBGL_color_buffer_float_supported=this.supports("WEBGL_color_buffer_float"),this.WEBGL_depth_texture_supported=this.supports("WEBGL_depth_texture"),this.WEBGL_draw_buffers_supported=this.supports("WEBGL_draw_buffers")),this._backend===e.BackendType.WebGL2&&(this.EXT_color_buffer_float_supported=this.supports("EXT_color_buffer_float"),this.EXT_disjoint_timer_query_webgl2_supported=this.supports("EXT_disjoint_timer_query_webgl2")),this.EXT_texture_filter_anisotropic_supported=this.supports("EXT_texture_filter_anisotropic"),this.OES_texture_float_linear_supported=this.supports("OES_texture_float_linear"),this.OES_texture_half_float_linear_supported=this.supports("OES_texture_half_float_linear"),this.WEBGL_compressed_texture_astc_supported=this.supports("WEBGL_compressed_texture_astc"),this.WEBGL_compressed_texture_atc_supported=this.supports("WEBGL_compressed_texture_atc"),this.WEBGL_compressed_texture_etc_supported=this.supports("WEBGL_compressed_texture_etc"),this.WEBGL_compressed_texture_etc1_supported=this.supports("WEBGL_compressed_texture_etc1"),this.WEBGL_compressed_texture_pvrtc_supported=this.supports("WEBGL_compressed_texture_pvrtc"),this.WEBGL_compressed_texture_s3tc_supported=this.supports("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb_supported=this.supports("WEBGL_compressed_texture_s3tc_srgb"),this.WEBGL_debug_renderer_info_supported=this.supports("WEBGL_debug_renderer_info"),this.WEBGL_debug_shaders_supported=this.supports("WEBGL_debug_shaders"),this.WEBGL_lose_context_supported=this.supports("WEBGL_lose_context")}else i.log(i.LogLevel.Error,"querying supported extensions failed (probably blocked)")},e.prototype.extension=function(e,t){return void 0===e&&(i.assert(this.supports(t),"extension "+t+" expected to be supported"),e=this._context.getExtension(t)),e},Object.defineProperty(e.prototype,"allocationRegister",{get:function(){return this._allocationRegister},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backend",{get:function(){return this._backend},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backendString",{get:function(){switch(this._backend){case e.BackendType.WebGL1:return"WebGL";case e.BackendType.WebGL2:return"WebGL2";default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._extensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gl",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gl2facade",{get:function(){return this._gl2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWebGL1",{get:function(){return this._backend===e.BackendType.WebGL1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWebGL2",{get:function(){return this._backend===e.BackendType.WebGL2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsInstancedArrays",{get:function(){return this.ANGLE_instanced_arrays_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instancedArrays",{get:function(){return this.extension(this.ANGLE_instanced_arrays,"ANGLE_instanced_arrays")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsBlendMinmax",{get:function(){return this.EXT_blend_minmax_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendMinmax",{get:function(){return this.extension(this.EXT_blend_minmax,"EXT_blend_minmax")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsColorBufferHalfFloat",{get:function(){return this.EXT_color_buffer_half_float_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorBufferHalfFloat",{get:function(){return this.extension(this.EXT_color_buffer_half_float,"EXT_color_buffer_half_float")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsDisjointTimerQuery",{get:function(){return this.EXT_disjoint_timer_query_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disjointTimerQuery",{get:function(){return this.extension(this.EXT_disjoint_timer_query,"EXT_disjoint_timer_query")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsDisjointTimerQueryWebGL2",{get:function(){return this.EXT_disjoint_timer_query_webgl2_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disjointTimerQueryWebGL2",{get:function(){return this.extension(this.EXT_disjoint_timer_query_webgl2,"EXT_disjoint_timer_query_webgl2")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsFragDepth",{get:function(){return this.EXT_frag_depth_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragDepth",{get:function(){return this.extension(this.EXT_frag_depth,"EXT_frag_depth")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsSRGB",{get:function(){return this.EXT_sRGB_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sRGB",{get:function(){return this.extension(this.EXT_sRGB,"EXT_sRGB")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsShaderTextureLOD",{get:function(){return this.EXT_shader_texture_lod_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shaderTextureLOD",{get:function(){return this.extension(this.EXT_shader_texture_lod,"EXT_shader_texture_lod")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTextureFilterAnisotropic",{get:function(){return this.EXT_texture_filter_anisotropic_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFilterAnisotropic",{get:function(){return this.extension(this.EXT_texture_filter_anisotropic,"EXT_texture_filter_anisotropic")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsElementIndexUint",{get:function(){return this.OES_element_index_uint_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementIndexUint",{get:function(){return this.extension(this.OES_element_index_uint,"OES_element_index_uint")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsStandardDerivatives",{get:function(){return this.OES_standard_derivatives_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"standardDerivatives",{get:function(){return this.extension(this.OES_standard_derivatives,"OES_standard_derivatives")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTextureFloat",{get:function(){return this.OES_texture_float_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFloat",{get:function(){return this.extension(this.OES_texture_float,"OES_texture_float")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTextureFloatLinear",{get:function(){return this.OES_texture_float_linear_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFloatLinear",{get:function(){return this.extension(this.OES_texture_float_linear,"OES_texture_float_linear")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTextureHalfFloat",{get:function(){return this.OES_texture_half_float_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHalfFloat",{get:function(){return this.extension(this.OES_texture_half_float,"OES_texture_half_float")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTextureHalfFloatLinear",{get:function(){return this.OES_texture_half_float_linear_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureHalfFloatLinear",{get:function(){return this.extension(this.OES_texture_half_float_linear,"OES_texture_half_float_linear")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsVertexArrayObject",{get:function(){return this.OES_vertex_array_object_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertexArrayObject",{get:function(){return this.extension(this.OES_vertex_array_object,"OES_vertex_array_object")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsColorBufferFloat",{get:function(){switch(this._backend){case e.BackendType.WebGL1:return this.WEBGL_color_buffer_float_supported;case e.BackendType.WebGL2:return this.EXT_color_buffer_float_supported;default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colorBufferFloat",{get:function(){switch(this._backend){case e.BackendType.WebGL1:return this.extension(this.WEBGL_color_buffer_float,"WEBGL_color_buffer_float");case e.BackendType.WebGL2:return this.extension(this.EXT_color_buffer_float,"EXT_color_buffer_float");default:return}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTextureASTC",{get:function(){return this.WEBGL_compressed_texture_astc_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTextureASTC",{get:function(){return this.extension(this.WEBGL_compressed_texture_astc,"WEBGL_compressed_texture_astc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTextureATC",{get:function(){return this.WEBGL_compressed_texture_atc_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTextureATC",{get:function(){return this.extension(this.WEBGL_compressed_texture_atc,"WEBGL_compressed_texture_atc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTextureETC",{get:function(){return this.WEBGL_compressed_texture_etc_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTextureETC",{get:function(){return this.extension(this.WEBGL_compressed_texture_etc,"WEBGL_compressed_texture_etc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTextureETC1",{get:function(){return this.WEBGL_compressed_texture_etc1_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTextureETC1",{get:function(){return this.extension(this.WEBGL_compressed_texture_etc1,"WEBGL_compressed_texture_etc1")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTexturePVRTC",{get:function(){return this.WEBGL_compressed_texture_pvrtc_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTexturePVRTC",{get:function(){return this.extension(this.WEBGL_compressed_texture_pvrtc,"WEBGL_compressed_texture_pvrtc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTextureS3TC",{get:function(){return this.WEBGL_compressed_texture_s3tc_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTextureS3TC",{get:function(){return this.extension(this.WEBGL_compressed_texture_s3tc,"WEBGL_compressed_texture_s3tc")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsCompressedTextureS3TCSRGB",{get:function(){return this.WEBGL_compressed_texture_s3tc_srgb_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compressedTextureS3TCSRGB",{get:function(){return this.extension(this.WEBGL_compressed_texture_s3tc_srgb,"WEBGL_compressed_texture_s3tc_srgb")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsDebugRendererInfo",{get:function(){return this.WEBGL_debug_renderer_info_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debugRendererInfo",{get:function(){return this.extension(this.WEBGL_debug_renderer_info,"WEBGL_debug_renderer_info")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsDebugShaders",{get:function(){return this.WEBGL_debug_shaders_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debugShaders",{get:function(){return this.extension(this.WEBGL_debug_shaders,"WEBGL_debug_shaders")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsDepthTexture",{get:function(){return this.WEBGL_depth_texture_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTexture",{get:function(){return this.extension(this.WEBGL_depth_texture,"WEBGL_depth_texture")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsDrawBuffers",{get:function(){return this.WEBGL_draw_buffers_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drawBuffers",{get:function(){return this.extension(this.WEBGL_draw_buffers,"WEBGL_draw_buffers")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsLoseContext",{get:function(){return this.WEBGL_lose_context_supported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loseContext",{get:function(){return this.extension(this.WEBGL_lose_context,"WEBGL_lose_context")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsBlitFramebuffer",{get:function(){return void 0!==this._context.blitFramebuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsReadBuffer",{get:function(){return void 0!==this._context.readBuffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supportsTexImage3D",{get:function(){return void 0!==this._context.texImage3D},enumerable:!0,configurable:!0}),e.prototype.param=function(e){return i.assert(!!this._context,"expected context to be valid"),this._context.getParameter(e)},e.prototype.hash=function(){return u.ExtensionsHash.encode(this._backend,this._extensions)},e.prototype.about=function(){if(this._backend===e.BackendType.Invalid)return new Array;i.assert(!!this._context,"expected context to be valid");var t=this._context,r=new Array;r.push(["BACKEND (GLOPERATE)",this.backend]),r.push(["CONTEXT_HASH (GLOPERATE)",this.hash()]),r.push(["RENDERER",this.param(t.RENDERER)]),r.push(["VENDOR",this.param(t.VENDOR)]),r.push(["VERSION",this.param(t.VERSION)]),r.push(["SHADING_LANGUAGE_VERSION",this.param(t.SHADING_LANGUAGE_VERSION)]),r.push(["UNMASKED_VENDOR_WEBGL",this.supportsDebugRendererInfo?this.param(this.debugRendererInfo.UNMASKED_VENDOR_WEBGL):"na"]),r.push(["UNMASKED_RENDERER_WEBGL",this.supportsDebugRendererInfo?this.param(this.debugRendererInfo.UNMASKED_RENDERER_WEBGL):"na"]),r.push(["ALPHA (ATTRIBUTE)",String(this.alpha)]),r.push(["ANTIALIAS (ATTRIBUTE)",String(this.antialias)]),r.push(["DEPTH (ATTRIBUTE)",String(this.depth)]),r.push(["FAIL_IF_MAJOR_PERFORMANCE_CAVEAT (ATTRIBUTE)",String(this.failIfMajorPerformanceCaveat)]),r.push(["PREMULTIPLIED_ALPHA (ATTRIBUTE)",String(this.premultipliedAlpha)]),r.push(["PRESERVE_DRAWING_BUFFER (ATTRIBUTE)",String(this.preserveDrawingBuffer)]),r.push(["STENCIL (ATTRIBUTE)",String(this.stencil)]),r.push(["DEVICE_PIXEL_RATIO (WINDOW)",window.devicePixelRatio]),r.push(["APP_CODE_NAME (NAVIGATOR)",window.navigator.appCodeName]),r.push(["APP_NAME (NAVIGATOR)",window.navigator.appName]),r.push(["APP_VERSION (NAVIGATOR)",window.navigator.appVersion]),r.push(["PLATFORM (NAVIGATOR)",window.navigator.platform]),r.push(["HARDWARE_CONCURRENCY (NAVIGATOR)",window.navigator.appCodeName]),r.push(["VENDOR (NAVIGATOR)",window.navigator.vendor]),r.push(["VENDOR_SUB (NAVIGATOR)",window.navigator.vendorSub]),r.push(["MAX_COMBINED_TEXTURE_IMAGE_UNITS",this.param(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)]),r.push(["MAX_CUBE_MAP_TEXTURE_SIZE",this.param(t.MAX_CUBE_MAP_TEXTURE_SIZE)]),r.push(["MAX_FRAGMENT_UNIFORM_VECTORS",this.param(t.MAX_FRAGMENT_UNIFORM_VECTORS)]),r.push(["MAX_RENDERBUFFER_SIZE",this.param(t.MAX_RENDERBUFFER_SIZE)]),r.push(["MAX_TEXTURE_IMAGE_UNITS",this.param(t.MAX_TEXTURE_IMAGE_UNITS)]),r.push(["MAX_TEXTURE_SIZE",this.param(t.MAX_TEXTURE_SIZE)]),r.push(["MAX_VARYING_VECTORS",this.param(t.MAX_VARYING_VECTORS)]),r.push(["MAX_VERTEX_ATTRIBS",this.param(t.MAX_VERTEX_ATTRIBS)]),r.push(["MAX_VERTEX_TEXTURE_IMAGE_UNITS",this.param(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)]),r.push(["MAX_VERTEX_UNIFORM_VECTORS",this.param(t.MAX_VERTEX_UNIFORM_VECTORS)]);var n=this.param(t.MAX_VIEWPORT_DIMS);if(r.push(["MAX_VIEWPORT_DIMS (WIDTH)",n?n[0]:null]),r.push(["MAX_VIEWPORT_DIMS (HEIGHT)",n?n[1]:null]),this.isWebGL2){var o=this._context;r.push(["MAX_3D_TEXTURE_SIZE",this.param(o.MAX_3D_TEXTURE_SIZE)]),r.push(["MAX_ARRAY_TEXTURE_LAYERS",this.param(o.MAX_ARRAY_TEXTURE_LAYERS)]),r.push(["MAX_CLIENT_WAIT_TIMEOUT_WEBGL",this.param(o.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)]),r.push(["MAX_COLOR_ATTACHMENTS",this.param(o.MAX_COLOR_ATTACHMENTS)]),r.push(["MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",this.param(o.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS)]),r.push(["MAX_COMBINED_UNIFORM_BLOCKS",this.param(o.MAX_COMBINED_UNIFORM_BLOCKS)]),r.push(["MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",this.param(o.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS)]),r.push(["MAX_DRAW_BUFFERS",this.param(o.MAX_DRAW_BUFFERS)]),r.push(["MAX_ELEMENT_INDEX",this.param(o.MAX_ELEMENT_INDEX)]),r.push(["MAX_ELEMENTS_INDICES",this.param(o.MAX_ELEMENTS_INDICES)]),r.push(["MAX_ELEMENTS_VERTICES",this.param(o.MAX_ELEMENTS_VERTICES)]),r.push(["MAX_FRAGMENT_INPUT_COMPONENTS",this.param(o.MAX_FRAGMENT_INPUT_COMPONENTS)]),r.push(["MAX_FRAGMENT_UNIFORM_BLOCKS",this.param(o.MAX_FRAGMENT_UNIFORM_BLOCKS)]),r.push(["MAX_FRAGMENT_UNIFORM_COMPONENTS",this.param(o.MAX_FRAGMENT_UNIFORM_COMPONENTS)]),r.push(["MAX_PROGRAM_TEXEL_OFFSET",this.param(o.MAX_PROGRAM_TEXEL_OFFSET)]),r.push(["MAX_SAMPLES",this.param(o.MAX_SAMPLES)]),r.push(["MAX_SERVER_WAIT_TIMEOUT",this.param(o.MAX_SERVER_WAIT_TIMEOUT)]),r.push(["MAX_TEXTURE_LOD_BIAS",this.param(o.MAX_TEXTURE_LOD_BIAS)]),r.push(["MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",this.param(o.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS)]),r.push(["MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",this.param(o.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS)]),r.push(["MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",this.param(o.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS)]),r.push(["MAX_UNIFORM_BLOCK_SIZE",this.param(o.MAX_UNIFORM_BLOCK_SIZE)]),r.push(["MAX_UNIFORM_BUFFER_BINDINGS",this.param(o.MAX_UNIFORM_BUFFER_BINDINGS)]),r.push(["MAX_VARYING_COMPONENTS",this.param(o.MAX_VARYING_COMPONENTS)]),r.push(["MAX_VERTEX_OUTPUT_COMPONENTS",this.param(o.MAX_VERTEX_OUTPUT_COMPONENTS)]),r.push(["MAX_VERTEX_UNIFORM_BLOCKS",this.param(o.MAX_VERTEX_UNIFORM_BLOCKS)]),r.push(["MAX_VERTEX_UNIFORM_COMPONENTS",this.param(o.MAX_VERTEX_UNIFORM_COMPONENTS)]),r.push(["MIN_PROGRAM_TEXEL_OFFSET",this.param(o.MIN_PROGRAM_TEXEL_OFFSET)])}if(this.isWebGL1)for(var a=0,u=s.WEBGL1_EXTENSIONS;a<u.length;a++){var c=u[a];r.push([c,this.supports(c)?"ok":"na"])}else if(this.isWebGL2){for(var l=0,f=s.WEBGL2_DEFAULT_EXTENSIONS;l<f.length;l++)c=f[l],r.push([c+" (default)","ok"]);for(var h=0,d=s.WEBGL2_EXTENSIONS;h<d.length;h++)c=d[h],r.push([c,this.supports(c)?"ok":"na"])}return r},e.prototype.aboutString=function(){for(var e=this.about(),t=0,r=0,i=e;r<i.length;r++){var n=i[r];t=Math.max(n[0].length,t)}for(var o=0,a="",u=this.isWebGL2?63+s.WEBGL2_DEFAULT_EXTENSIONS.length:-1,c=0,l=e;c<l.length;c++){switch(n=l[c],o){case 2:case 6:case 8:case 15:case 16:case 23:case 35:case 63:case u:a+="\n"}a+="  "+n[0]+" "+"-".repeat(t-n[0].length)+"-- "+n[1]+"\n",++o}return a+"\n"},e.prototype.logAbout=function(e){void 0===e&&(e=i.LogLevel.Info),i.log(e,"context.about\n\n"+this.aboutString())},e.prototype.logAboutIf=function(e,t){void 0===t&&(t=i.LogLevel.Info),i.logIf(e,t,"context.about\n\n"+this.aboutString())},e.prototype.byteSizeOfFormat=function(e){return n.byteSizeOfFormat(this,e)},e.DEFAULT_ATTRIBUTES={alpha:!0,antialias:!1,depth:!0,failIfMajorPerformanceCaveat:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,stencil:!1},e}();t.Context=l,function(e){!function(e){e.Invalid="invalid",e.WebGL1="webgl1",e.WebGL2="webgl2"}(e.BackendType||(e.BackendType={})),function(e){e.auto="auto",e.webgl="webgl",e.experimental="experimental-webgl",e.webgl1="webgl1",e.experimental1="experimental-webgl1",e.webgl2="webgl2",e.experimental2="experimental-webgl2"}(e.BackendRequestType||(e.BackendRequestType={}))}(l=t.Context||(t.Context={})),t.Context=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(42),o=function(){function e(){}return e.encode64=function(t){return i.assert(t>=0&&t<=63,"expected bitfield in range [ 0b000000, 0b111111 ], given "+t),e.BASE64_ALPHABET[t]},e.decode64=function(t){i.assert(1===t.length,"expected single base64 character, given '"+t+"'");var r=e.BASE64_ALPHABET.indexOf(t);return i.assert(r>-1,"unknown base64 character, given '"+t+"'"),r},e.encode=function(t,r){var n=e.LATEST_VERSION,o=e.EXTENSIONS_BY_VERSION.get(n),a=e.WEBGL_BACKENDS.indexOf(t);i.assert(a>-1,"expected valid backend "+e.WEBGL_BACKENDS+", given "+t+" ");var s=e.encode64(n<<3|a+1);if(0===r.length)return s;for(var u=0,c=0;c<o.length;++c)u|=r.indexOf(o[c])>-1?32>>c%6:0,c%6<5&&c<o.length-1||(s+=e.encode64(u),u=0);return s},e.decode=function(t){var r=e.decode64(t[0]),n=r>>3,o=(7&r)-1;i.assert(o<e.WEBGL_BACKENDS.length,"expected valid backend index, given "+o);var a=e.WEBGL_BACKENDS[o];i.assert(e.EXTENSIONS_BY_VERSION.has(n),"expected valid hash version, given "+n);var s=e.EXTENSIONS_BY_VERSION.get(n),u=Math.ceil(s.length/6)+1;i.assert(t.length===u,"expected hash of version "+n+" to have a length of "+u+", given "+t);for(var c=new Array,l=1;l<t.length;++l){var f=e.decode64(t[l]),h=6*(l-1);32&f&&c.push(s[h+0]),16&f&&c.push(s[h+1]),8&f&&c.push(s[h+2]),4&f&&c.push(s[h+3]),2&f&&c.push(s[h+4]),1&f&&c.push(s[h+5])}return[a,c]},e.complement=function(t,r){var n=e.WEBGL_BACKENDS.indexOf(t);return i.assert(n>-1,"expected valid backend "+e.WEBGL_BACKENDS+", given "+t+" "),e.WEBGL_EXTENSIONS_BY_BACKEND.get(n).filter(function(e){return r.indexOf(e)<0})},e.WEBGL_BACKENDS=["webgl1","webgl2"],e.WEBGL_EXTENSIONS_BY_BACKEND=new Map([[0,n.WEBGL1_EXTENSIONS],[1,n.WEBGL2_EXTENSIONS]]),e.EXTENSIONS_BY_VERSION=new Map([[0,["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_shader_texture_lod","EXT_sRGB","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context"]]]),e.LATEST_VERSION=0,e.BASE64_ALPHABET="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+",e}();t.ExtensionsHash=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=r(0),o=r(44),a=function(){function e(e,t){n.assert(void 0!==e,"expected a valid eye gaze data streams object on initialization, given "+e+"."),this._eyeGazeDataStream=new o.EyeGazeDataStream,this._eyeGazeDataStream.eyeGazeDataStreams=e,this._eyeGazeDataStream.connect(t)}return e.prototype.preventDefaultOnEvent=function(e,t){n.bitInBitfield(this._preventDefaultMask,e)&&t.preventDefault()},e.prototype.allowDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)&&(this._preventDefaultMask&=~o)}},e.prototype.preventDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)||(this._preventDefaultMask|=o)}},e.prototype.observable=function(t){switch(t){case e.Type.EyeGazeData:return this.EyeGazeData$;case e.Type.NewServerMessage:return this.NewServerMessage$;case e.Type.ConnectionStatus:return this.ConnectionStatus$;case e.Type.BinaryMessageParsingError:return this.BinaryMessageParsingError$;default:return}},Object.defineProperty(e.prototype,"EyeGazeData$",{get:function(){var t=this;return void 0===this._eyeGazeDataSubject&&(this._eyeGazeDataSubject=new i.ReplaySubject(void 0,this._timeframe),this._eyeGazeDataListener=function(r){t.preventDefaultOnEvent(e.Type.EyeGazeData,r),t._eyeGazeDataSubject.next(r)},this._eyeGazeDataStream.addEventListener(o.EyeGazeDataStream.EYE_GAZE_DATA,this._eyeGazeDataListener)),this._eyeGazeDataSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"NewServerMessage$",{get:function(){var t=this;return void 0===this._newServerMessageSubject&&(this._newServerMessageSubject=new i.ReplaySubject(void 0,this._timeframe),this._newServerMessageListener=function(r){t.preventDefaultOnEvent(e.Type.NewServerMessage,r),t._newServerMessageSubject.next(r)},this._eyeGazeDataStream.addEventListener(o.EyeGazeDataStream.NEW_SERVER_MESSAGE,this._newServerMessageListener)),this._newServerMessageSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ConnectionStatus$",{get:function(){var t=this;return void 0===this._connectionStatusSubject&&(this._connectionStatusSubject=new i.ReplaySubject(void 0,this._timeframe),this._connectionStatusListener=function(r){t.preventDefaultOnEvent(e.Type.ConnectionStatus,r),t._connectionStatusSubject.next(r)},this._eyeGazeDataStream.addEventListener(o.EyeGazeDataStream.CONNECTION_STATUS,this._connectionStatusListener)),this._connectionStatusSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"BinaryMessageParsingError$",{get:function(){var t=this;return void 0===this._binaryMessageParsingErrorSubject&&(this._binaryMessageParsingErrorSubject=new i.ReplaySubject(void 0,this._timeframe),this._binaryMessageParsingErrorListener=function(r){t.preventDefaultOnEvent(e.Type.BinaryMessageParsingError,r),t._binaryMessageParsingErrorSubject.next(r)},this._eyeGazeDataStream.addEventListener(o.EyeGazeDataStream.BINARY_MESSAGE_PARSING_ERROR,this._binaryMessageParsingErrorListener)),this._eyeGazeDataSubject.asObservable()},enumerable:!0,configurable:!0}),e}();t.EyeGazeEventProvider=a,function(e){!function(e){e[e.EyeGazeData=1]="EyeGazeData",e[e.NewServerMessage=2]="NewServerMessage",e[e.ConnectionStatus=4]="ConnectionStatus",e[e.BinaryMessageParsingError=8]="BinaryMessageParsingError"}(e.Type||(e.Type={}))}(a=t.EyeGazeEventProvider||(t.EyeGazeEventProvider={})),t.EyeGazeEventProvider=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=r(0),o=r(46),a=r(22),s=function(){function e(e,t){var r=this;this._pointerLockRequestPending=!1,n.assert(void 0!==e,"expected valid canvas element on initialization, given "+e),this._element=e,this._timeframe=t,this._element.addEventListener("click",function(){return r.processPointerLockRequests()}),(o.IS_EDGE||o.IS_IE11)&&this._element.addEventListener("dragstart",function(e){return e.preventDefault()})}return e.prototype.processPointerLockRequests=function(){this._pointerLockRequestPending&&a.PointerLock.request(this._element)},e.prototype.preventDefaultOnEvent=function(e,t){n.bitInBitfield(this._preventDefaultMask,e)&&t.preventDefault()},e.prototype.preventDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)||(this._preventDefaultMask|=o)}},e.prototype.allowDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)&&(this._preventDefaultMask&=~o)}},e.prototype.observable=function(t){switch(t){case e.Type.Click:return this.click$;case e.Type.Enter:return this.enter$;case e.Type.Leave:return this.leave$;case e.Type.Down:return this.down$;case e.Type.Up:return this.up$;case e.Type.Move:return this.move$;case e.Type.Wheel:return this.wheel$;case e.Type.Drag:return this.drag$;default:return}},Object.defineProperty(e.prototype,"pointerLock",{get:function(){return a.PointerLock.active(this._element)},set:function(e){this._pointerLockRequestPending=e,!1===e&&(this._pointerLockRequestPending=!1,a.PointerLock.exit())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"click$",{get:function(){var t=this;return void 0===this._clickSubject&&(this._clickSubject=new i.ReplaySubject(void 0,this._timeframe),this._clickListener=function(r){t.preventDefaultOnEvent(e.Type.Click,r),t._clickSubject.next(r)},this._element.addEventListener("click",this._clickListener)),this._clickSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enter$",{get:function(){var t=this;return void 0===this._enterSubject&&(this._enterSubject=new i.ReplaySubject(void 0,this._timeframe),this._enterListener=function(r){t.preventDefaultOnEvent(e.Type.Enter,r),t._enterSubject.next(r)},this._element.addEventListener("mouseenter",this._enterListener)),this._enterSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leave$",{get:function(){var t=this;return void 0===this._leaveSubject&&(this._leaveSubject=new i.ReplaySubject(void 0,this._timeframe),this._leaveListener=function(r){t.preventDefaultOnEvent(e.Type.Leave,r),t._leaveSubject.next(r)},this._element.addEventListener("mouseleave",this._leaveListener)),this._leaveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"down$",{get:function(){var t=this;return void 0===this._downSubject&&(this._downSubject=new i.ReplaySubject(void 0,this._timeframe),this._downListener=function(r){t.preventDefaultOnEvent(e.Type.Down,r),t._downSubject.next(r)},this._element.addEventListener("mousedown",this._downListener)),this._downSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up$",{get:function(){var t=this;return void 0===this._upSubject&&(this._upSubject=new i.ReplaySubject(void 0,this._timeframe),this._upListener=function(r){t.preventDefaultOnEvent(e.Type.Up,r),t._upSubject.next(r)},this._element.addEventListener("mouseup",this._upListener)),this._upSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"move$",{get:function(){var t=this;return void 0===this._moveSubject&&(this._moveSubject=new i.ReplaySubject(void 0,this._timeframe),this._moveListener=function(r){t.preventDefaultOnEvent(e.Type.Move,r),t._moveSubject.next(r)},this._element.addEventListener("mousemove",this._moveListener)),this._moveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wheel$",{get:function(){var t=this;return void 0===this._wheelSubject&&(this._wheelSubject=new i.ReplaySubject(void 0,this._timeframe),this._wheelListener=function(r){t.preventDefaultOnEvent(e.Type.Wheel,r),t._wheelSubject.next(r)},this._element.addEventListener("wheel",this._wheelListener)),this._wheelSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"drag$",{get:function(){var t=this;return void 0===this._dragSubject&&(this._dragSubject=new i.ReplaySubject(void 0,this._timeframe),this._dragListener=function(r){t.preventDefaultOnEvent(e.Type.Drag,r),t._dragSubject.next(r)},this._element.addEventListener("drag",this._dragListener)),this._dragSubject.asObservable()},enumerable:!0,configurable:!0}),e}();t.MouseEventProvider=s,function(e){!function(e){e[e.Click=1]="Click",e[e.Wheel=2]="Wheel",e[e.Enter=4]="Enter",e[e.Leave=8]="Leave",e[e.Move=16]="Move",e[e.Down=32]="Down",e[e.Up=64]="Up",e[e.Drag=128]="Drag"}(e.Type||(e.Type={}))}(s=t.MouseEventProvider||(t.MouseEventProvider={})),t.MouseEventProvider=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=r(0),o=r(46),a=r(22),s=function(){function e(e,t){var r=this;this._pointerLockRequestPending=!1,n.assert(void 0!==e,"expected valid canvas element on initialization, given "+e),this._element=e,this._timeframe=t,this._element.addEventListener("click",function(){return r.processPointerLockRequests()}),(o.IS_EDGE||o.IS_IE11)&&this._element.addEventListener("dragstart",function(e){return e.preventDefault()})}return e.prototype.processPointerLockRequests=function(){this._pointerLockRequestPending&&a.PointerLock.request(this._element)},e.prototype.preventDefaultOnEvent=function(e,t){n.bitInBitfield(this._preventDefaultMask,e)&&t.preventDefault()},e.prototype.preventDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)||(this._preventDefaultMask|=o)}},e.prototype.allowDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)&&(this._preventDefaultMask&=~o)}},e.prototype.observable=function(t){switch(t){case e.Type.Enter:return this.enter$;case e.Type.Leave:return this.leave$;case e.Type.Down:return this.down$;case e.Type.Up:return this.up$;case e.Type.Move:return this.move$;case e.Type.Cancel:return this.cancel$;default:return}},Object.defineProperty(e.prototype,"pointerLock",{get:function(){return a.PointerLock.active(this._element)},set:function(e){this._pointerLockRequestPending=e,!1===e&&(this._pointerLockRequestPending=!1,a.PointerLock.exit())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enter$",{get:function(){var t=this;return void 0===this._enterSubject&&(this._enterSubject=new i.ReplaySubject(void 0,this._timeframe),this._enterListener=function(r){t.preventDefaultOnEvent(e.Type.Enter,r),t._enterSubject.next(r)},this._element.addEventListener("pointerenter",this._enterListener)),this._enterSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leave$",{get:function(){var t=this;return void 0===this._leaveSubject&&(this._leaveSubject=new i.ReplaySubject(void 0,this._timeframe),this._leaveListener=function(r){t.preventDefaultOnEvent(e.Type.Leave,r),t._leaveSubject.next(r)},this._element.addEventListener("pointerleave",this._leaveListener)),this._leaveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"down$",{get:function(){var t=this;return void 0===this._downSubject&&(this._downSubject=new i.ReplaySubject(void 0,this._timeframe),this._downListener=function(r){t.preventDefaultOnEvent(e.Type.Down,r),t._downSubject.next(r)},this._element.addEventListener("pointerdown",this._downListener)),this._downSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up$",{get:function(){var t=this;return void 0===this._upSubject&&(this._upSubject=new i.ReplaySubject(void 0,this._timeframe),this._upListener=function(r){t.preventDefaultOnEvent(e.Type.Up,r),t._upSubject.next(r)},this._element.addEventListener("pointerup",this._upListener)),this._upSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"move$",{get:function(){var t=this;return void 0===this._moveSubject&&(this._moveSubject=new i.ReplaySubject(void 0,this._timeframe),this._moveListener=function(r){t.preventDefaultOnEvent(e.Type.Move,r),t._moveSubject.next(r)},this._element.addEventListener("pointermove",this._moveListener)),this._moveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancel$",{get:function(){var t=this;return void 0===this._cancelSubject&&(this._cancelSubject=new i.ReplaySubject(void 0,this._timeframe),this._cancelListener=function(r){t.preventDefaultOnEvent(e.Type.Cancel,r),t._cancelSubject.next(r)},this._element.addEventListener("pointercancel",this._cancelListener)),this._cancelSubject.asObservable()},enumerable:!0,configurable:!0}),e}();t.PointerEventProvider=s,function(e){!function(e){e[e.Enter=1]="Enter",e[e.Leave=2]="Leave",e[e.Move=4]="Move",e[e.Down=8]="Down",e[e.Up=16]="Up",e[e.Cancel=32]="Cancel"}(e.Type||(e.Type={}))}(s=t.PointerEventProvider||(t.PointerEventProvider={})),t.PointerEventProvider=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=r(0),o=function(){function e(e,t){n.assert(void 0!==e,"expected valid canvas element on initialization, given "+e),this._element=e,this._timeframe=t}return e.prototype.preventDefaultOnEvent=function(e,t){n.bitInBitfield(this._preventDefaultMask,e)&&t.preventDefault()},e.prototype.preventDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)||(this._preventDefaultMask|=o)}},e.prototype.allowDefault=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,i=e;r<i.length;r++){var o=i[r];n.bitInBitfield(this._preventDefaultMask,o)&&(this._preventDefaultMask&=~o)}},e.prototype.observable=function(t){switch(t){case e.Type.Start:return this.start$;case e.Type.End:return this.end$;case e.Type.Move:return this.move$;case e.Type.Cancel:return this.cancel$}return n.assert(!1,"Encountered unknown touch event."),new i.Observable},Object.defineProperty(e.prototype,"start$",{get:function(){var t=this;return void 0===this._startSubject&&(this._startSubject=new i.ReplaySubject(void 0,this._timeframe),this._startListener=function(r){t.preventDefaultOnEvent(e.Type.Start,r),t._startSubject.next(r)},this._element.addEventListener("touchstart",this._startListener)),this._startSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end$",{get:function(){var t=this;return void 0===this._endSubject&&(this._endSubject=new i.ReplaySubject(void 0,this._timeframe),this._endListener=function(r){t.preventDefaultOnEvent(e.Type.End,r),t._endSubject.next(r)},this._element.addEventListener("touchend",this._endListener)),this._endSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"move$",{get:function(){var t=this;return void 0===this._moveSubject&&(this._moveSubject=new i.ReplaySubject(void 0,this._timeframe),this._moveListener=function(r){t.preventDefaultOnEvent(e.Type.Move,r),t._moveSubject.next(r)},this._element.addEventListener("touchmove",this._moveListener)),this._moveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cancel$",{get:function(){var t=this;return void 0===this._cancelSubject&&(this._cancelSubject=new i.ReplaySubject(void 0,this._timeframe),this._cancelListener=function(r){t.preventDefaultOnEvent(e.Type.Cancel,r),t._cancelSubject.next(r)},this._element.addEventListener("touchcancel",this._cancelListener)),this._cancelSubject.asObservable()},enumerable:!0,configurable:!0}),e}();t.TouchEventProvider=o,function(e){!function(e){e[e.Start=1]="Start",e[e.End=2]="End",e[e.Move=4]="Move",e[e.Cancel=8]="Cancel"}(e.Type||(e.Type={}))}(o=t.TouchEventProvider||(t.TouchEventProvider={})),t.TouchEventProvider=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(0),o=r(29),a=r(30),s=r(31),u=r(32),c=function(){function e(e,t){this._subscriptions=new Array,this._latestMouseEventsByType=new Map,this._previousMouseEventsByType=new Map,this._mouseEventHandlerByType=new Map,this._latestTouchEventsByType=new Map,this._previousTouchEventsByType=new Map,this._touchEventHandlerByType=new Map,this._latestPointerEventsByType=new Map,this._previousPointerEventsByType=new Map,this._pointerEventHandlerByType=new Map,this._latestEyeGazeEventsByType=new Map,this._previousEyeGazeEventsByType=new Map,this._eyeGazeEventHandlerByType=new Map,this._invalidate=e,this._mouseEventProvider=t.mouseEventProvider,this._mouseEventProvider.preventDefault(a.MouseEventProvider.Type.Wheel),this._pointerEventProvider=t.pointerEventProvider,this._eyeGazeEventProvider=t.eyeGazeEventProvider}return e.prototype.invalidate=function(e){void 0===e&&(e=!1),this._invalidate&&this._invalidate(e)},e.prototype.pushMouseEventHandler=function(e,t){var r=this;if(this._mouseEventHandlerByType.has(e))this._mouseEventHandlerByType.get(e).push(t);else{this._mouseEventHandlerByType.set(e,new Array),this._previousMouseEventsByType.set(e,new Array);var i=new Array;this._latestMouseEventsByType.set(e,i),n.assert(void 0!==this._mouseEventProvider,"expected valid mouse event provider");var o=this._mouseEventProvider.observable(e);switch(e){case a.MouseEventProvider.Type.Wheel:default:this._subscriptions.push(o.subscribe(function(e){i.push(e),r.invalidate()}))}this._mouseEventHandlerByType.get(e).push(t)}},e.prototype.invokeMouseEventHandler=function(e){var t=this._mouseEventHandlerByType.get(e);if(void 0!==t&&0!==t.length){var r=this._latestMouseEventsByType.get(e);if(0!==r.length){var i=this._previousMouseEventsByType.get(e);t.forEach(function(e){return e(r,i)}),Object.assign(i,r),r.length=0}}},e.prototype.pushTouchEventHandler=function(e,t){var r=this;if(this._touchEventHandlerByType.has(e))this._touchEventHandlerByType.get(e).push(t);else{this._touchEventHandlerByType.set(e,new Array),this._previousTouchEventsByType.set(e,new Array);var i=new Array;this._latestTouchEventsByType.set(e,i),n.assert(void 0!==this._touchEventProvider,"expected valid touch event provider");var o=this._touchEventProvider.observable(e);this._subscriptions.push(o.subscribe(function(e){i.push(e),r.invalidate()})),this._touchEventHandlerByType.get(e).push(t)}},e.prototype.invokeTouchEventHandler=function(e){var t=this._touchEventHandlerByType.get(e);if(void 0!==t&&0!==t.length){var r=this._latestTouchEventsByType.get(e);if(0!==r.length){var i=this._previousTouchEventsByType.get(e);t.forEach(function(e){return e(r,i)}),Object.assign(i,r),r.length=0}}},e.prototype.pushPointerEventHandler=function(e,t){var r=this;if(this._pointerEventHandlerByType.has(e))this._pointerEventHandlerByType.get(e).push(t);else{this._pointerEventHandlerByType.set(e,new Array),this._previousPointerEventsByType.set(e,new Array);var i=new Array;this._latestPointerEventsByType.set(e,i),n.assert(void 0!==this._pointerEventProvider,"expected valid pointer event provider");var o=this._pointerEventProvider.observable(e);this._subscriptions.push(o.subscribe(function(e){i.push(e),r.invalidate()})),this._pointerEventHandlerByType.get(e).push(t)}},e.prototype.invokePointerEventHandler=function(e){var t=this._pointerEventHandlerByType.get(e);if(void 0!==t&&0!==t.length){var r=this._latestPointerEventsByType.get(e);if(0!==r.length){var i=this._previousPointerEventsByType.get(e);t.forEach(function(e){return e(r,i)}),Object.assign(i,r),r.length=0}}},e.prototype.pushEyeGazeEventHandler=function(e,t){var r=this;if(this._eyeGazeEventHandlerByType.has(e))this._eyeGazeEventHandlerByType.get(e).push(t);else{this._eyeGazeEventHandlerByType.set(e,new Array),this._previousEyeGazeEventsByType.set(e,new Array);var i=new Array;this._latestEyeGazeEventsByType.set(e,i),n.assert(void 0!==this._eyeGazeEventProvider,"expected valid eye gaze event provider");var o=this._eyeGazeEventProvider.observable(e);this._subscriptions.push(o.subscribe(function(e){i.push(e),r.invalidate()})),this._eyeGazeEventHandlerByType.get(e).push(t)}},e.prototype.invokeEyeGazeEventHandler=function(e){var t=this._eyeGazeEventHandlerByType.get(e);if(void 0!==t&&0!==t.length){var r=this._latestEyeGazeEventsByType.get(e);if(0!==r.length){var i=this._previousEyeGazeEventsByType.get(e);t.forEach(function(e){return e(r,i)}),Object.assign(i,r),r.length=0}}},e.prototype.dispose=function(){this._latestMouseEventsByType.forEach(function(e){return e.length=0}),this._previousMouseEventsByType.forEach(function(e){return e.length=0}),this._latestTouchEventsByType.forEach(function(e){return e.length=0}),this._previousTouchEventsByType.forEach(function(e){return e.length=0}),this._latestPointerEventsByType.forEach(function(e){return e.length=0}),this._previousPointerEventsByType.forEach(function(e){return e.length=0}),this._previousEyeGazeEventsByType.forEach(function(e){return e.length=0}),this._latestEyeGazeEventsByType.forEach(function(e){return e.length=0});for(var e=0,t=this._subscriptions;e<t.length;e++)t[e].unsubscribe()},e.prototype.update=function(){this.invokeMouseEventHandler(a.MouseEventProvider.Type.Click),this.invokeMouseEventHandler(a.MouseEventProvider.Type.Enter),this.invokeMouseEventHandler(a.MouseEventProvider.Type.Leave),this.invokeMouseEventHandler(a.MouseEventProvider.Type.Down),this.invokeMouseEventHandler(a.MouseEventProvider.Type.Up),this.invokeMouseEventHandler(a.MouseEventProvider.Type.Move),this.invokeMouseEventHandler(a.MouseEventProvider.Type.Wheel),this.invokeTouchEventHandler(u.TouchEventProvider.Type.Start),this.invokeTouchEventHandler(u.TouchEventProvider.Type.End),this.invokeTouchEventHandler(u.TouchEventProvider.Type.Move),this.invokeTouchEventHandler(u.TouchEventProvider.Type.Cancel),this.invokePointerEventHandler(s.PointerEventProvider.Type.Move),this.invokePointerEventHandler(s.PointerEventProvider.Type.Down),this.invokePointerEventHandler(s.PointerEventProvider.Type.Enter),this.invokePointerEventHandler(s.PointerEventProvider.Type.Up),this.invokePointerEventHandler(s.PointerEventProvider.Type.Leave),this.invokePointerEventHandler(s.PointerEventProvider.Type.Cancel),this.invokeEyeGazeEventHandler(o.EyeGazeEventProvider.Type.EyeGazeData),this.invokeEyeGazeEventHandler(o.EyeGazeEventProvider.Type.NewServerMessage),this.invokeEyeGazeEventHandler(o.EyeGazeEventProvider.Type.ConnectionStatus),this.invokeEyeGazeEventHandler(o.EyeGazeEventProvider.Type.BinaryMessageParsingError)},e.prototype.offsets=function(e,t){void 0===t&&(t=!0);var r=new Array,n=!1;if(e instanceof MouseEvent)n=0!==(o=e).offsetX&&0!==o.offsetY,r.push(n?i.vec2.fromValues(o.offsetX,o.offsetY):i.vec2.fromValues(o.clientX,o.clientY));else if(e instanceof WheelEvent)n=0!==(o=e).offsetX&&0!==o.offsetY,r.push(n?i.vec2.fromValues(o.offsetX,o.offsetY):i.vec2.fromValues(o.clientX,o.clientY));else if(e instanceof TouchEvent)for(var o=e,a=0;a<o.touches.length;++a){var s=o.touches.item(a);r.push(i.vec2.fromValues(s.clientX,s.clientY))}if(n){if(t)for(var u=0,c=r;u<c.length;u++){var l=c[u];i.vec2.scale(l,l,window.devicePixelRatio)}return r}for(var f=(e.target||e.currentTarget||e.srcElement).getBoundingClientRect(),h=0,d=r;h<d.length;h++)(l=d[h])[0]=Math.floor(l[0]-f.left),l[1]=Math.floor(l[1]-f.top),t&&i.vec2.scale(l,l,window.devicePixelRatio);return r},e.prototype.pushClickHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Click,e)},e.prototype.pushMouseEnterHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Enter,e)},e.prototype.pushMouseLeaveHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Leave,e)},e.prototype.pushMouseDownHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Down,e)},e.prototype.pushMouseUpHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Up,e)},e.prototype.pushMouseMoveHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Move,e)},e.prototype.pushMouseWheelHandler=function(e){this.pushMouseEventHandler(a.MouseEventProvider.Type.Wheel,e)},e.prototype.pushTouchStartHandler=function(e){this.pushTouchEventHandler(u.TouchEventProvider.Type.Start,e)},e.prototype.pushTouchEndHandler=function(e){this.pushTouchEventHandler(u.TouchEventProvider.Type.End,e)},e.prototype.pushTouchMoveHandler=function(e){this.pushTouchEventHandler(u.TouchEventProvider.Type.Move,e)},e.prototype.pushTouchCancelHandler=function(e){this.pushTouchEventHandler(u.TouchEventProvider.Type.Cancel,e)},e.prototype.pushPointerUpHandler=function(e){this.pushPointerEventHandler(s.PointerEventProvider.Type.Up,e)},e.prototype.pushPointerDownHandler=function(e){this.pushPointerEventHandler(s.PointerEventProvider.Type.Down,e)},e.prototype.pushPointerEnterHandler=function(e){this.pushPointerEventHandler(s.PointerEventProvider.Type.Enter,e)},e.prototype.pushPointerLeaveHandler=function(e){this.pushPointerEventHandler(s.PointerEventProvider.Type.Leave,e)},e.prototype.pushPointerMoveHandler=function(e){this.pushPointerEventHandler(s.PointerEventProvider.Type.Move,e)},e.prototype.pushPointerCancelHandler=function(e){this.pushPointerEventHandler(s.PointerEventProvider.Type.Cancel,e)},e.prototype.pushEyeGazeDataHandler=function(e){this.pushEyeGazeEventHandler(o.EyeGazeEventProvider.Type.EyeGazeData,e)},e.prototype.pushEyeGazeServerMessageHandler=function(e){this.pushEyeGazeEventHandler(o.EyeGazeEventProvider.Type.NewServerMessage,e)},e.prototype.pushEyeGazeConnectionStatusHandler=function(e){this.pushEyeGazeEventHandler(o.EyeGazeEventProvider.Type.ConnectionStatus,e)},e.prototype.pushEyeGazeBinaryMessageParsingErrorHandler=function(e){this.pushEyeGazeEventHandler(o.EyeGazeEventProvider.Type.BinaryMessageParsingError,e)},e.prototype.requestPointerLock=function(){this._mouseEventProvider&&(this._mouseEventProvider.pointerLock=!0)},e.prototype.exitPointerLock=function(){this._mouseEventProvider&&(this._mouseEventProvider.pointerLock=!1)},e}();t.EventHandler=c},function(e,t,r){"use strict";var i,n=r(47);!function(e){var t=function(e,t){return"fetching '"+e+"' failed ("+t.status+"): "+t.statusText};e.fetchAsync=function(e,r){return new Promise(function(i,n){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType=r,o.onload=function(){o.status<200||o.status>=300?n(t(e,o)):i(o.response)},o.onerror=function(){return n(t(e,o))},o.ontimeout=function(){return n(t(e,o))},o.send()})},e.fetchJsonAsync=function(e,r,i){return new Promise(function(o,a){var s=new XMLHttpRequest;s.open("GET",e,!0),s.onload=function(){if(s.status<200||s.status>=300)a(t(e,s));else{var u=s.responseText;if(void 0===i||n.validate(u,i)){var c;try{c=JSON.parse(u)}catch(t){return void a("fetching '"+e+"' failed ("+t.name+"): "+t.message)}var l=r(c);void 0!==l?o(l):a("fetching '"+e+"' failed (TransformError): transforming the object failed.")}}},s.onerror=function(){return a(t(e,s))},s.ontimeout=function(){return a(t(e,s))},s.send()})}}(i||(i={})),e.exports=i},function(e,t,r){"use strict";var i=r(91),n=r(94);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=g,t.resolve=function(e,t){return g(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?g(e,!1,!0).resolveObject(t):t},t.format=function(e){return n.isString(e)&&(e=g(e)),e instanceof o?e.format():o.prototype.format.call(e)},t.Url=o;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),f=["%","/","?",";","#"].concat(l),h=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,_={javascript:!0,"javascript:":!0},v={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=r(95);function g(e,t,r){if(e&&n.isObject(e)&&e instanceof o)return e;var i=new o;return i.parse(e,t,r),i}o.prototype.parse=function(e,t,r){if(!n.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var g=e=c.join(s);if(g=g.trim(),!r&&1===e.split("#").length){var y=u.exec(g);if(y)return this.path=g,this.href=g,this.pathname=y[1],y[2]?(this.search=y[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var E=a.exec(g);if(E){var x=(E=E[0]).toLowerCase();this.protocol=x,g=g.substr(E.length)}if(r||E||g.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===g.substr(0,2);!T||E&&v[E]||(g=g.substr(2),this.slashes=!0)}if(!v[E]&&(T||E&&!m[E])){for(var O,P,A=-1,L=0;L<h.length;L++)-1!==(w=g.indexOf(h[L]))&&(-1===A||w<A)&&(A=w);for(-1!==(P=-1===A?g.lastIndexOf("@"):g.lastIndexOf("@",A))&&(O=g.slice(0,P),g=g.slice(P+1),this.auth=decodeURIComponent(O)),A=-1,L=0;L<f.length;L++){var w;-1!==(w=g.indexOf(f[L]))&&(-1===A||w<A)&&(A=w)}-1===A&&(A=g.length),this.host=g.slice(0,A),g=g.slice(A),this.parseHost(),this.hostname=this.hostname||"";var S="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!S)for(var R=this.hostname.split(/\./),M=(L=0,R.length);L<M;L++){var I=R[L];if(I&&!I.match(d)){for(var N="",C=0,F=I.length;C<F;C++)I.charCodeAt(C)>127?N+="x":N+=I[C];if(!N.match(d)){var B=R.slice(0,L),j=R.slice(L+1),D=I.match(p);D&&(B.push(D[1]),j.unshift(D[2])),j.length&&(g="/"+j.join(".")+g),this.hostname=B.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),S||(this.hostname=i.toASCII(this.hostname));var z=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+z,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==g[0]&&(g="/"+g))}if(!_[x])for(L=0,M=l.length;L<M;L++){var U=l[L];if(-1!==g.indexOf(U)){var k=encodeURIComponent(U);k===U&&(k=escape(U)),g=g.split(U).join(k)}}var V=g.indexOf("#");-1!==V&&(this.hash=g.substr(V),g=g.slice(0,V));var H=g.indexOf("?");if(-1!==H?(this.search=g.substr(H),this.query=g.substr(H+1),t&&(this.query=b.parse(this.query)),g=g.slice(0,H)):t&&(this.search="",this.query={}),g&&(this.pathname=g),m[x]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){z=this.pathname||"";var W=this.search||"";this.path=z+W}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",i=this.hash||"",o=!1,a="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&n.isObject(this.query)&&Object.keys(this.query).length&&(a=b.stringify(this.query));var s=this.search||a&&"?"+a||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||m[t])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o||(o=""),i&&"#"!==i.charAt(0)&&(i="#"+i),s&&"?"!==s.charAt(0)&&(s="?"+s),t+o+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(s=s.replace("#","%23"))+i},o.prototype.resolve=function(e){return this.resolveObject(g(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(n.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var r=new o,i=Object.keys(this),a=0;a<i.length;a++){var s=i[a];r[s]=this[s]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(r[l]=e[l])}return m[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!m[e.protocol]){for(var f=Object.keys(e),h=0;h<f.length;h++){var d=f[h];r[d]=e[d]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||v[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var _=r.pathname||"",b=r.search||"";r.path=_+b}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var g=r.pathname&&"/"===r.pathname.charAt(0),y=e.host||e.pathname&&"/"===e.pathname.charAt(0),E=y||g||r.host&&e.pathname,x=E,T=r.pathname&&r.pathname.split("/")||[],O=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!m[r.protocol]);if(O&&(r.hostname="",r.port=null,r.host&&(""===T[0]?T[0]=r.host:T.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),E=E&&(""===p[0]||""===T[0])),y)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,T=p;else if(p.length)T||(T=[]),T.pop(),T=T.concat(p),r.search=e.search,r.query=e.query;else if(!n.isNullOrUndefined(e.search))return O&&(r.hostname=r.host=T.shift(),(S=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=S.shift(),r.host=r.hostname=S.shift())),r.search=e.search,r.query=e.query,n.isNull(r.pathname)&&n.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!T.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var P=T.slice(-1)[0],A=(r.host||e.host||T.length>1)&&("."===P||".."===P)||""===P,L=0,w=T.length;w>=0;w--)"."===(P=T[w])?T.splice(w,1):".."===P?(T.splice(w,1),L++):L&&(T.splice(w,1),L--);if(!E&&!x)for(;L--;L)T.unshift("..");!E||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),A&&"/"!==T.join("/").substr(-1)&&T.push("");var S,R=""===T[0]||T[0]&&"/"===T[0].charAt(0);return O&&(r.hostname=r.host=R?"":T.length?T.shift():"",(S=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=S.shift(),r.host=r.hostname=S.shift())),(E=E||r.host&&T.length)&&!R&&T.unshift(""),T.length?r.pathname=T.join("/"):(r.pathname=null,r.path=null),n.isNull(r.pathname)&&n.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},o.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,r){var i=r(35),n=r(16);function o(e,t){this.id=e,this.ref=t}e.exports.SchemaScanResult=o,e.exports.scan=function(e,t){function r(e,t){if(t&&"object"==typeof t)if(t.$ref){var o=i.resolve(e,t.$ref);c[o]=c[o]?c[o]+1:0}else{var l=t.id?i.resolve(e,t.id):e;if(l){if(l.indexOf("#")<0&&(l+="#"),u[l]){if(!n.deepCompareStrict(u[l],t))throw new Error("Schema <"+t+"> already exists with different definition");return u[l]}u[l]=t,"#"==l[l.length-1]&&(u[l.substring(0,l.length-1)]=t)}a(l+"/items",Array.isArray(t.items)?t.items:[t.items]),a(l+"/extends",Array.isArray(t.extends)?t.extends:[t.extends]),r(l+"/additionalItems",t.additionalItems),s(l+"/properties",t.properties),r(l+"/additionalProperties",t.additionalProperties),s(l+"/definitions",t.definitions),s(l+"/patternProperties",t.patternProperties),s(l+"/dependencies",t.dependencies),a(l+"/disallow",t.disallow),a(l+"/allOf",t.allOf),a(l+"/anyOf",t.anyOf),a(l+"/oneOf",t.oneOf),r(l+"/not",t.not)}}function a(e,t){if(Array.isArray(t))for(var i=0;i<t.length;i++)r(e+"/"+i,t[i])}function s(e,t){if(t&&"object"==typeof t)for(var i in t)r(e+"/"+i,t[i])}var u={},c={};return r(e,t),new o(u,c)}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(){function e(e,t,r,i){void 0===r&&(r=1),void 0===i&&(i=1),this._components=e,this._width=isNaN(t)?1:Math.max(1,t),this._height=Math.max(1,r),this._depth=Math.max(1,i),this.resize()}return e.prototype.get=function(e,t,r){var i;switch(i=void 0===t&&void 0===r?this._components*e:this.index(e,t,r||0),o.assert(i<this.length,"index expected to be in range [0, "+(this.length-1)+"], given "+i),this._components){case 1:return[this._samples[i]];case 2:return[this._samples[i],this._samples[i+1]];case 3:return[this._samples[i],this._samples[i+1],this._samples[i+2]];case 4:return[this._samples[i],this._samples[i+1],this._samples[i+2],this._samples[i+3]]}},e.prototype.set=function(e,t,r,i){var n;switch(o.assert(e.length===this._components,"number of components expected to be "+this._components+", given "+e.length),n=void 0===r&&void 0===i?this._components*Math.min(this.elements,Math.max(0,t)):this._components*this.index(t,r,i||0),o.assert(n<this.length,"index expected to be in range [0, "+(this.length-1)+"], given "+n),this._components){case 4:this._samples[n+3]=e[3];case 3:this._samples[n+2]=e[2];case 2:this._samples[n+1]=e[1];case 1:this._samples[n+0]=e[0]}},e.prototype.fromJSON=function(e){o.assert(e.size&&void 0!==e.size.width&&void 0!==e.size.height&&void 0!==e.size.depth,"expected kernel width, height, and depth to be set, given '"+e.size+"'");var t=function(e){return e.reduce(function(e,r){return e.concat(Array.isArray(r)?t(r):r)},[])};this._width=Math.max(1,e.size.width),this._height=Math.max(1,e.size.height),this._depth=Math.max(1,e.size.depth);var r=t(e.kernel);this._components=Math.floor(r.length/this.elements),this.resize(),this.fromArray(r)},e.prototype.index=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=0),this._width*(this._height*Math.min(this._depth,Math.max(0,r))+Math.min(this._height,Math.max(0,t)))+Math.min(this._width,Math.max(0,e))},e.prototype.position=function(e){var t=Math.min(this.elements,Math.max(0,e)),r=Math.floor(t/(this._width*this._height));t-=r*this._width*this._height;var i=Math.floor(t/this._width);return[t-=i*this._width,i,r]},e.prototype.sort=function(t){if(!(this.elements<2)){for(var r=Array(this.elements),i=0;i<this.elements;++i){var n=0;switch(t){default:case e.SortApproach.BySquaredLength:for(var o=0;o<this._components;++o){var a=this._samples[i*this._components+o];n+=a*a}}r[i]=[i,n]}switch(t){default:case e.SortApproach.BySquaredLength:r.sort(function(e,t){return e[1]-t[1]})}var s=this._samples.slice();for(i=0;i<r.length;++i)for(o=0;o<this._components;++o){var u=r[i][0]*this._components+o,c=i*this._components+o;this._samples[c]=s[u]}}},Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._width*this._height*this._depth*this._components},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elements",{get:function(){var e=this._width*this._height*this._depth;return isNaN(e)?0:e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._depth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"xStride",{get:function(){return this.bytesPerComponent*this._components},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yStride",{get:function(){return this.bytesPerComponent*this._components*this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zStride",{get:function(){return this.bytesPerComponent*this._components*this._width*this._depth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesLength",{get:function(){return this.bytesPerComponent*this._components*this._width*this._height*this._depth},enumerable:!0,configurable:!0}),e}();t.AbstractKernel=a,function(e){!function(e){e[e.BySquaredLength=0]="BySquaredLength"}(e.SortApproach||(e.SortApproach={}))}(a=t.AbstractKernel||(t.AbstractKernel={})),t.AbstractKernel=a;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.resize=function(){this._samples=new Float32Array(this.length)},t.prototype.fromArray=function(e){o.assert(e.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Float32Array(e))},Object.defineProperty(t.prototype,"bytesPerComponent",{get:function(){return 4},enumerable:!0,configurable:!0}),t}(a);t.KernelF32=s;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.resize=function(){this._samples=new Uint32Array(this.length)},t.prototype.fromArray=function(e){o.assert(e.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Uint32Array(e))},Object.defineProperty(t.prototype,"bytesPerComponent",{get:function(){return 4},enumerable:!0,configurable:!0}),t}(a);t.KernelUI32=u;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.resize=function(){this._samples=new Int32Array(this.length)},t.prototype.fromArray=function(e){o.assert(e.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Int32Array(e))},Object.defineProperty(t.prototype,"bytesPerComponent",{get:function(){return 4},enumerable:!0,configurable:!0}),t}(a);t.KernelI32=c;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.resize=function(){this._samples=new Uint8Array(this.length)},t.prototype.fromArray=function(e){o.assert(e.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Uint8Array(e))},Object.defineProperty(t.prototype,"bytesPerComponent",{get:function(){return 4},enumerable:!0,configurable:!0}),t}(a);t.KernelUI8=l;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.resize=function(){this._samples=new Int8Array(this.length)},t.prototype.fromArray=function(e){o.assert(e.length===this.length,"expected samples length to match this kernel's length"),this._samples.set(new Int8Array(e))},Object.defineProperty(t.prototype,"bytesPerComponent",{get:function(){return 4},enumerable:!0,configurable:!0}),t}(a);t.KernelI8=f},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=r(3),c=r(2),l=r(12),f=r(6),h=r(7),d=function(e){function t(t){var r=e.call(this)||this;return r._enforceProgramBlit=!1,r._ndcTriangleShared=!1,r._context=t,r}return n(t,e),t.prototype.functionBlit=function(){var e=this._context.gl;this._target.bind(e.DRAW_FRAMEBUFFER),this._framebuffer.bind(e.READ_FRAMEBUFFER),e.readBuffer(this._readBuffer),e.drawBuffers([this._drawBuffer]),e.enable(e.SCISSOR_TEST),e.scissor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.SCISSOR_TEST);var t=this._srcBounds?this._srcBounds:[0,0,this._framebuffer.width,this._framebuffer.height],r=this._dstBounds?this._dstBounds:[0,0,this._target.width,this._target.height];e.blitFramebuffer(t[0],t[1],t[2],t[3],r[0],r[1],r[2],r[3],e.COLOR_BUFFER_BIT,this._filter),this._framebuffer.unbind(e.READ_FRAMEBUFFER),this._target.unbind(e.DRAW_FRAMEBUFFER)},t.prototype.programBlit=function(){void 0===this._program&&this.createProgram(),s.assert(this._ndcTriangle&&this._ndcTriangle.initialized,"expected an initialized ndc triangle");var e=this._context.gl,t=this._srcBounds?this._srcBounds:a.vec4.fromValues(0,0,this._framebuffer.width,this._framebuffer.height),r=this._dstBounds?this._dstBounds:a.vec4.fromValues(0,0,this._target.width,this._target.height),i=a.vec4.div(u.v4(),t,[this._framebuffer.width,this._framebuffer.height,this._framebuffer.width,this._framebuffer.height]),n=a.vec4.div(u.v4(),r,[this._target.width,this._target.height,this._target.width,this._target.height]);e.viewport(r[0],r[1],r[2]-r[0],r[3]-r[1]),e.disable(e.DEPTH_TEST),e.depthMask(!1),this._program.bind(),e.uniform4fv(this._uSrcBounds,i),e.uniform4fv(this._uDstBounds,n),e.uniform1i(this._uNearest,this.filter===e.nearest);var o=this._framebuffer.texture(this._readBuffer);o.bind(e.TEXTURE0);var c=this._context.isWebGL2?e.DRAW_FRAMEBUFFER:e.FRAMEBUFFER;this._target.bind(c),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),this._target.unbind(c),o.unbind(),e.enable(e.DEPTH_TEST),e.depthMask(!0)},t.prototype.createProgram=function(){s.assert(void 0===this._program,"expected blit program to be undefined before its creation");var e=this._context.gl,t=new h.Shader(this._context,e.VERTEX_SHADER,"blit.vert (blit)");t.initialize(r(63));var i=new h.Shader(this._context,e.FRAGMENT_SHADER,"blit.frag (blit)");return i.initialize(r(109)),this._program=new f.Program(this._context,"BlitProgram"),this._program.initialize([t,i],!1),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uSrcBounds=this._program.uniform("u_srcBounds"),this._uDstBounds=this._program.uniform("u_dstBounds"),this._uNearest=this._program.uniform("u_nearest"),this._program.bind(),e.uniform1i(this._program.uniform("u_source"),0),this._program.unbind(),this._program.valid},t.prototype.initialize=function(e){var t=this._context.gl;return void 0===e?this._ndcTriangle=new l.NdcFillingTriangle(this._context,"NdcFillingTriangle-Blit"):(this._ndcTriangle=e,this._ndcTriangleShared=!0),this._filter=t.NEAREST,!0},t.prototype.uninitialize=function(){!this._ndcTriangleShared&&this._ndcTriangle.initialized&&this._ndcTriangle.uninitialize(),this._program.uninitialize()},t.prototype.frame=function(){s.logIf(!this._target||!this._target.valid,s.LogLevel.Warning,"valid target expected, given "+this._target),s.logIf(!this._framebuffer||!this._framebuffer.valid,s.LogLevel.Warning,"valid framebuffer for blitting from expected, given "+this._framebuffer);var e=this._context.gl;switch(this._readBuffer){case e.DEPTH_ATTACHMENT:case e.STENCIL_ATTACHMENT:case e.DEPTH_STENCIL_ATTACHMENT:return this.programBlit()}if(this._context.supportsBlitFramebuffer&&!1===this._enforceProgramBlit)return this.functionBlit();this.programBlit()},Object.defineProperty(t.prototype,"framebuffer",{set:function(e){this.assertInitialized(),this._framebuffer=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readBuffer",{set:function(e){this.assertInitialized(),this._readBuffer=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"drawBuffer",{set:function(e){this.assertInitialized(),this._drawBuffer=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{set:function(e){this._filter=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"srcBounds",{set:function(e){this._srcBounds=e?a.vec4.clone(e):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dstBounds",{set:function(e){this._dstBounds=e?a.vec4.clone(e):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enforceProgramBlit",{set:function(e){this._enforceProgramBlit=e},enumerable:!0,configurable:!0}),o([c.Initializable.initialize()],t.prototype,"initialize",null),o([c.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([c.Initializable.assert_initialized()],t.prototype,"frame",null),t}(c.Initializable);t.BlitPass=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._type=e}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),e}();t.SceneNodeComponent=i},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var n=r(82);t.branch=n.branch,t.commit=n.commit,t.version=n.version;var o=r(27);t.Context=o.Context;var a=r(86);t.Canvas=a.Canvas;var s=r(43);t.Controller=s.Controller;var u=r(2);t.Initializable=u.Initializable;var c=r(41);t.ContextMasquerade=c.ContextMasquerade;var l=r(28);t.ExtensionsHash=l.ExtensionsHash;var f=r(15);t.ChangeLookup=f.ChangeLookup;var h=r(30);t.MouseEventProvider=h.MouseEventProvider;var d=r(32);t.TouchEventProvider=d.TouchEventProvider;var p=r(31);t.PointerEventProvider=p.PointerEventProvider;var _=r(33);t.EventHandler=_.EventHandler;var v=r(5);t.Buffer=v.Buffer;var m=r(21);t.Color=m.Color;var b=r(88);t.ColorScale=b.ColorScale;var g=r(48);t.DefaultFramebuffer=g.DefaultFramebuffer;var y=r(17);t.Framebuffer=y.Framebuffer;var E=r(9);t.Geometry=E.Geometry;var x=r(6);t.Program=x.Program;var T=r(23);t.Renderbuffer=T.Renderbuffer;var O=r(50);t.Renderer=O.Renderer,t.LoadingStatus=O.LoadingStatus;var P=r(7);t.Shader=P.Shader;var A=r(4);t.Texture2D=A.Texture2D;var L=r(100);t.Texture3D=L.Texture3D;var w=r(51);t.TextureCube=w.TextureCube;var S=r(101);t.UnifiedBuffer=S.UnifiedBuffer;var R=r(49);t.VertexArray=R.VertexArray;var M=r(14);t.Wizard=M.Wizard;var I=r(52);t.Camera=I.Camera;var N=r(102);t.TileCameraGenerator=N.TileCameraGenerator;var C=r(11);t.CameraModifier=C.CameraModifier;var F=r(103);t.Navigation=F.Navigation;var B=r(53);t.FirstPersonModifier=B.FirstPersonModifier;var j=r(54);t.PanModifier=j.PanModifier;var D=r(22);t.PointerLock=D.PointerLock;var z=r(56);t.TrackballModifier=z.TrackballModifier;var G=r(57);t.TurntableModifier=G.TurntableModifier;var U=r(55);t.PinchZoomModifier=U.PinchZoomModifier;var k=r(58);t.WheelZoomModifier=k.WheelZoomModifier;var V=r(104);t.NdcFillingRectangle=V.NdcFillingRectangle;var H=r(12);t.NdcFillingTriangle=H.NdcFillingTriangle;var W=r(37);t.AbstractKernel=W.AbstractKernel;var X=r(59);t.AntiAliasingKernel=X.AntiAliasingKernel;var q=r(60);t.RandomSquareKernel=q.RandomSquareKernel;var Y=r(37);t.KernelF32=Y.KernelF32,t.KernelI32=Y.KernelI32,t.KernelI8=Y.KernelI8,t.KernelUI32=Y.KernelUI32,t.KernelUI8=Y.KernelUI8;var Z=r(61);t.AccumulatePass=Z.AccumulatePass;var K=r(38);t.BlitPass=K.BlitPass;var $=r(110);t.DebugPass=$.DebugPass;var Q=r(112);t.EnvironmentRenderingPass=Q.EnvironmentRenderingPass,t.EnvironmentTextureType=Q.EnvironmentTextureType;var J=r(114);t.ReadbackPass=J.ReadbackPass;var ee=r(64);t.GaussFilter=ee.GaussFilter;var te=r(118);t.ShadowPass=te.ShadowPass;var re=r(44);t.EyeGazeDataStream=re.EyeGazeDataStream,t.EyeGazeDataStreams=re.EyeGazeDataStreams;var ie=r(29);t.EyeGazeEventProvider=ie.EyeGazeEventProvider;var ne=r(45);t.EyeGazeData=ne.EyeGazeData,i(r(65)),i(r(25)),i(r(127));var oe=r(0);t.auxiliaries=oe;var ae=r(1);t.vec2=ae.vec2,t.vec3=ae.vec3,t.vec4=ae.vec4;var se=r(1);t.mat2=se.mat2,t.mat2d=se.mat2d,t.mat3=se.mat3,t.mat4=se.mat4;var ue=r(1);t.quat=ue.quat;var ce=r(3);t.gl_matrix_extensions=ce;var le=r(13);t.tuples=le},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(28),o=function(){function e(){this._extensionsStrive=new Array,this._extensionsConceal=new Array,this._functionsUndefine=new Array}return e.fromHash=function(t){var r=new e,i=n.ExtensionsHash.decode(t);return r._backend=i[0],r._extensionsStrive=i[1],r._extensionsConceal=n.ExtensionsHash.complement(r._backend,r._extensionsStrive),r},e.fromPreset=function(t){for(var r,o=new e,a=new Array,s=0,u=e.presets();s<u.length;s++){var c=u[s];if(a.push(c.identifier),c.identifier===t){r=c;break}}if(void 0===r&&i.assert(!1,"expected valid identifier, available ['"+a.join("', '")+"'], given '"+t+"'"),void 0!==(r=r).extensions_hash){var l=n.ExtensionsHash.decode(r.extensions_hash);o._backend=l[0],o._extensionsStrive=l[1]}else o._backend=r.backend;return i.assert(void 0!==o._backend,"expected backend to be included in preset"),void 0===r.extensions_strive?(o._extensionsStrive=[],o._extensionsConceal=r.extensions_conceal?r.extensions_conceal:[]):(o._extensionsStrive=r.extensions_strive,o._extensionsConceal=n.ExtensionsHash.complement(o._backend,r.extensions_strive)),o._functionsUndefine=r.functions_undefine?r.functions_undefine:[],o},e.fromGET=function(){var t=i.GETparameter("msqrd_h");if(void 0!==t)return e.fromHash(t);var r=i.GETparameter("msqrd_p");return void 0!==r?e.fromPreset(r):void 0},e.presets=function(){return this.MASQUERADE_JSON},Object.defineProperty(e.prototype,"backend",{get:function(){return this._backend},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensionsStrive",{get:function(){return this._extensionsStrive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensionsConceal",{get:function(){return this._extensionsConceal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"functionsUndefine",{get:function(){return this._functionsUndefine},enumerable:!0,configurable:!0}),e.MASQUERADE_JSON=r(84),e}();t.ContextMasquerade=o},function(e,t,r){"use strict";var i;!function(e){e.WEBGL1_EXTENSIONS=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_depth_texture","WEBGL_draw_buffers","WEBGL_lose_context"],e.WEBGL2_EXTENSIONS=["EXT_color_buffer_float","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","OES_texture_float_linear","OES_texture_half_float_linear","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context"],e.WEBGL2_DEFAULT_EXTENSIONS=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_vertex_array_object","WEBGL_depth_texture","WEBGL_draw_buffers"]}(i||(i={})),e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=r(0),o=r(3),a=function(){function e(){this._batchSize=1,this._multiFrameNumber=1,this._multiFrameNumberSubject=new i.ReplaySubject(1),this._debugFrameNumber=0,this._debugFrameNumberSubject=new i.ReplaySubject(1),this._frameNumber=0,this._frameNumberSubject=new i.ReplaySubject(1),this._multiFrameDelay=0,this._animationFrameID=0,this._block=!1,this._blockedUpdates=0,this._intermediateFrameCount=0,this._multiFrameCount=0,this._intermediateFrameTimes=new Array(2),this._multiTime=[0,0],this._invalidated=!1,this._force=!1}return Object.defineProperty(e.prototype,"debug",{set:function(t){t&&n.logVerbosity()<n.LogLevel.Debug&&(n.logVerbosity(n.LogLevel.Debug),n.log(n.LogLevel.Debug,"changed log verbosity to "+n.LogLevel.Debug+" (debug)")),e._debug=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batch",{set:function(e){n.log(n.LogLevel.Warning,"(adaptive) batch multi-frame rendering is experimental for now"),this._batchSize=Math.max(1,e)},enumerable:!0,configurable:!0}),e.prototype.request=function(t){var r=this;void 0===t&&(t=e.RequestType.Frame),this._animationFrameID=0,this._block?this._blockedUpdates++:this._animationFrameID=window.requestAnimationFrame(function(){return r.invoke(t)})},e.prototype.invoke=function(t){if(0!==this._animationFrameID){if(n.assert(void 0!==this._controllable,"frame sequence invoked without controllable set"),this._invalidated&&(this._invalidated=!1,(this.invokeUpdate()||this._force)&&(this._force=!1,this._frameNumber=0,this.cancelWaitMultiFrame(),this.invokePrepare())),t===e.RequestType.Frame&&1===this._frameNumber)return void 0===this._timeoutID&&this.startWaitMultiFrame(),void(this._animationFrameID=0);this.isMultiFrameFinished()?this._animationFrameID=0:(this.invokeFrameAndSwap(),this.request())}},e.prototype.invokeUpdate=function(){return n.logIf(e._debug,n.LogLevel.Debug,"c invoke update     | pending: '"+this._animationFrameID+"', mfnum: "+this._multiFrameNumber),this._controllable.update(this._multiFrameNumber)},e.prototype.invokePrepare=function(){n.logIf(e._debug,n.LogLevel.Debug,"c invoke prepare    |"),this._multiFrameTime=0,this._intermediateFrameTimes[0]=Number.MAX_VALUE,this._intermediateFrameTimes[1]=Number.MIN_VALUE,this._multiTime[0]=performance.now(),this._controllable.prepare(),this._multiTime[1]=performance.now();var t=this._multiTime[1]-this._multiTime[0];this._multiFrameTime=t,this._updateFrameTime=t},e.prototype.invokeFrameAndSwap=function(){n.logIf(e._debug,n.LogLevel.Debug,"c invoke frame      | pending: '"+this._animationFrameID+"'");var t=this._debugFrameNumber>0;n.assert(!t||this._frameNumber<this._debugFrameNumber,"frame number about to exceed debug-frame number");var r=performance.now(),i=Math.min(this._multiFrameNumber,this._frameNumber+this._batchSize);for(this._debugFrameNumber>0&&(i=Math.min(i,this._debugFrameNumber));this._frameNumber<i;++this._frameNumber)n.logIf(e._debug,n.LogLevel.Debug,"c -> frame          | frame: "+this._frameNumber),this._controllable.frame(this._frameNumber),++this._intermediateFrameCount;n.logIf(e._debug,n.LogLevel.Debug,"c -> swap           |"),this._controllable.swap(),this._multiTime[1]=performance.now();var o=this._multiTime[1]-r;this._multiFrameTime+=o,this._intermediateFrameTimes[0]=Math.min(this._intermediateFrameTimes[0],o),this._intermediateFrameTimes[1]=Math.max(this._intermediateFrameTimes[1],o),this.frameNumberNext()},e.prototype.startWaitMultiFrame=function(){var t=this;this._timeoutID=window.setTimeout(function(){t.request(e.RequestType.MultiFrame),t._timeoutID=void 0},this._multiFrameDelay)},e.prototype.cancelWaitMultiFrame=function(){void 0!==this._timeoutID&&(window.clearTimeout(this._timeoutID),this._timeoutID=void 0)},e.prototype.isMultiFrameFinished=function(){return this._debugFrameNumber>0?this._frameNumber===this._debugFrameNumber:this._frameNumber===this._multiFrameNumber},e.prototype.multiFrameNumberNext=function(){this._multiFrameNumberSubject.next(this._multiFrameNumber)},e.prototype.debugFrameNumberNext=function(){this._debugFrameNumberSubject.next(this._debugFrameNumber)},e.prototype.frameNumberNext=function(){this._frameNumberSubject.next(this._frameNumber)},e.prototype.update=function(e){void 0===e&&(e=!1),this._invalidated=!0,this._force=this._force||e,0===this._animationFrameID&&this.request()},e.prototype.block=function(){n.logIf(e._debug,n.LogLevel.Debug,"c block   "+(this._block?"(ignored) ":"          ")+"|"),this._block=!0},e.prototype.unblock=function(){n.logIf(e._debug,n.LogLevel.Debug,"c unblock "+(this._block?"          ":"(ignored) ")+"| blocked: #"+this._blockedUpdates),this._block&&(this._block=!1,this._blockedUpdates>0&&(this._blockedUpdates=0,this.update()))},e.prototype.cancel=function(){0!==this._animationFrameID&&(window.cancelAnimationFrame(this._animationFrameID),this._animationFrameID=0)},Object.defineProperty(e.prototype,"blocked",{get:function(){return this._block},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controllable",{set:function(e){e!==this._controllable&&(this._controllable=e,this.update(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiFrameNumber",{get:function(){return this._multiFrameNumber},set:function(e){var t=Math.max(1,isNaN(e)?1:e);t!==this._multiFrameNumber&&(this._multiFrameNumber=t,this.multiFrameNumberNext(),n.logIf(t!==e,n.LogLevel.Debug,"multi-frame number adjusted to "+t+", given "+e),this.debugFrameNumber>this.multiFrameNumber?this.debugFrameNumber=this.multiFrameNumber:this.update())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiFrameNumber$",{get:function(){return this._multiFrameNumberSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debugFrameNumber",{get:function(){return this._debugFrameNumber},set:function(e){var t=o.clamp(isNaN(e)?0:e,0,this.multiFrameNumber);t!==this._debugFrameNumber&&(this._debugFrameNumber=t,this.debugFrameNumberNext(),n.logIf(t!==e,n.LogLevel.Debug,"debug-frame number adjusted to "+t+", given "+e),this.update(this.debugFrameNumber<this._frameNumber))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debugFrameNumber$",{get:function(){return this._debugFrameNumberSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiFrameDelay",{get:function(){return this._multiFrameDelay},set:function(e){var t=Math.max(0,e);t!==this._multiFrameDelay&&(this._multiFrameDelay=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameNumber",{get:function(){return this._frameNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameNumber$",{get:function(){return this._frameNumberSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intermediateFrameCount",{get:function(){return this._intermediateFrameCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiFrameCount",{get:function(){return this._multiFrameCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return 0===this._frameNumber?0:this._multiFrameTime/this._frameNumber},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updateFrameTime",{get:function(){return this._updateFrameTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minimumFrameTime",{get:function(){return this._intermediateFrameTimes[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximumFrameTime",{get:function(){return this._intermediateFrameTimes[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiFrameTime",{get:function(){return 0===this._frameNumber?0:this._multiTime[1]-this._multiTime[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"framesPerSecond",{get:function(){return 0===this._frameNumber?0:1e3/(this.multiFrameTime/this._frameNumber)},enumerable:!0,configurable:!0}),e._debug=!1,e}();t.Controller=a,function(e){!function(e){e[e.Frame=0]="Frame",e[e.MultiFrame=1]="MultiFrame"}(e.RequestType||(e.RequestType={}))}(a=t.Controller||(t.Controller={})),t.Controller=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}u((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(45),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(EventTarget);t.EyeGazeEventTarget=u;var c=function(){function e(){this._eyeGazeDataStreams=new l,this._eyeGazeEventTarget=new EventTarget}return e.prototype.generateStreamConfigByte=function(){var e=Uint8Array.from([0]);return this._eyeGazeDataStreams.gazePosition&&(e[0]=1|e[0]),this._eyeGazeDataStreams.gazeOrigin&&(e[0]=2|e[0]),this._eyeGazeDataStreams.eyePositionNormalized&&(e[0]=4|e[0]),this._eyeGazeDataStreams.headPositionAndRotation&&(e[0]=8|e[0]),this._eyeGazeDataStreams.userPresence&&(e[0]=16|e[0]),e},e.prototype.performHandshake=function(){this._eyeGazeDataStreams.recalculateNumberOfFloats();var e=this.generateStreamConfigByte();this._webSocket.send(e)},e.prototype.parseEyeTrackingData=function(t){if(t.length<this._eyeGazeDataStreams.expectedNumberOfFloats)return new CustomEvent(e.BINARY_MESSAGE_PARSING_ERROR);var r=0,i=new s.EyeGazeData;return this._eyeGazeDataStreams.gazePosition&&(i.gazePositionXY[0]=t[r++],i.gazePositionXY[1]=t[r++]),this._eyeGazeDataStreams.gazeOrigin&&(i.gazeOriginRightXYZ[0]=t[r++],i.gazeOriginRightXYZ[1]=t[r++],i.gazeOriginRightXYZ[2]=t[r++],i.gazeOriginLeftXYZ[0]=t[r++],i.gazeOriginLeftXYZ[1]=t[r++],i.gazeOriginLeftXYZ[2]=t[r++]),this._eyeGazeDataStreams.eyePositionNormalized&&(i.eyePositionRightNormalizedXYZ[0]=t[r++],i.eyePositionRightNormalizedXYZ[1]=t[r++],i.eyePositionRightNormalizedXYZ[2]=t[r++],i.eyePositionLeftNormalizedXYZ[0]=t[r++],i.eyePositionLeftNormalizedXYZ[1]=t[r++],i.eyePositionLeftNormalizedXYZ[2]=t[r++]),this._eyeGazeDataStreams.headPositionAndRotation&&(i.headPositionXYZ[0]=t[r++],i.headPositionXYZ[1]=t[r++],i.headPositionXYZ[2]=t[r++],i.headRotationXYZ[0]=t[r++],i.headRotationXYZ[1]=t[r++],i.headRotationXYZ[2]=t[r++]),this._eyeGazeDataStreams.userPresence&&(i.userPresence=0!==t[r]),new CustomEvent(e.EYE_GAZE_DATA,{detail:{eyeGazeData:i}})},e.prototype.onOpen=function(t){this.dispatchEvent(new CustomEvent(e.CONNECTION_STATUS,{detail:{message:e.SUCCESSFULLY_CONNECTED_TO_SERVER,event:t}})),this.performHandshake()},e.prototype.onClose=function(t){this.dispatchEvent(new CustomEvent(e.CONNECTION_STATUS,{detail:{message:e.DISCONNECTED_TO_SERVER,event:t}}))},e.prototype.onError=function(t){this.dispatchEvent(new CustomEvent(e.CONNECTION_STATUS,{detail:{message:e.CONNECTION_ERROR,event:t}}))},e.prototype.onMessage=function(t){return o(this,void 0,void 0,function(){var r,i;return a(this,function(n){switch(n.label){case 0:return"string"==typeof t.data?[3,2]:[4,t.data.arrayBuffer()];case 1:return r=n.sent(),i=new Float32Array(r),this.dispatchEvent(this.parseEyeTrackingData(i)),[3,3];case 2:this.dispatchEvent(new CustomEvent(e.NEW_SERVER_MESSAGE,{detail:{message:t.data}})),n.label=3;case 3:return[2]}})})},e.prototype.connect=function(e){var t=this;this._webSocket=new WebSocket(e),this._webSocket.onopen=function(e){t.onOpen(e)},this._webSocket.onclose=function(e){t.onClose(e)},this._webSocket.onerror=function(e){t.onError(e)},this._webSocket.onmessage=function(e){t.onMessage(e)}},e.prototype.addEventListener=function(e,t,r){this._eyeGazeEventTarget.addEventListener(e,t,r)},e.prototype.dispatchEvent=function(e){return this._eyeGazeEventTarget.dispatchEvent(e)},e.prototype.removeEventListener=function(e,t,r){this._eyeGazeEventTarget.removeEventListener(e,t,r)},Object.defineProperty(e.prototype,"connectionState",{get:function(){return this._webSocket.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eyeGazeDataStreams",{get:function(){return this._eyeGazeDataStreams},set:function(e){this._eyeGazeDataStreams!==e&&(this._eyeGazeDataStreams=e)},enumerable:!0,configurable:!0}),e.EYE_GAZE_DATA="eyegazedata",e.NEW_SERVER_MESSAGE="newservermessage",e.CONNECTION_STATUS="connectionstatus",e.BINARY_MESSAGE_PARSING_ERROR="binarymessageparsingerror",e.SUCCESSFULLY_CONNECTED_TO_SERVER="successfully connected to server",e.DISCONNECTED_TO_SERVER="disconnected to server",e.CONNECTION_ERROR="connection error with server",e}();t.EyeGazeDataStream=c;var l=function(){function e(){this.gazePosition=!1,this.gazeOrigin=!1,this.eyePositionNormalized=!1,this.headPositionAndRotation=!1,this.userPresence=!1,this.expectedNumberOfFloats=0}return e.prototype.recalculateNumberOfFloats=function(){var e=0;this.gazePosition&&(e+=2),this.gazeOrigin&&(e+=6),this.eyePositionNormalized&&(e+=6),this.headPositionAndRotation&&(e+=6),this.userPresence&&(e+=1),this.expectedNumberOfFloats=e},e}();t.EyeGazeDataStreams=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.gazePositionXY=[0,0],this.gazeOriginRightXYZ=[0,0,0],this.gazeOriginLeftXYZ=[0,0,0],this.eyePositionRightNormalizedXYZ=[0,0,0],this.eyePositionLeftNormalizedXYZ=[0,0,0],this.headPositionXYZ=[0,0,0],this.headRotationXYZ=[0,0,0],this.userPresence=!1}return e.prototype.toString=function(){var e="";return e+="Gaze Position: "+this.gazePositionXY+"\n",e+="Gaze Origin Right: "+this.gazeOriginRightXYZ+"\n",e+="Gaze Origin Left: "+this.gazeOriginLeftXYZ+"\n",e+="Eye Position Normalized Right: "+this.eyePositionRightNormalizedXYZ+"\n",e+="Eye Position Normalized Left: "+this.eyePositionLeftNormalizedXYZ+"\n",e+="Head Position: "+this.headPositionXYZ+"\n",(e+="Head Rotation: "+this.headRotationXYZ+"\n")+"User Presence: "+this.userPresence+"\n"},e}();t.EyeGazeData=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IS_IE11="undefined"==typeof navigator?void 0:/MSIE 11|Windows/i.test(navigator.userAgent),t.IS_EDGE="undefined"==typeof navigator?void 0:/Edge\/\d./i.test(navigator.userAgent)},function(e,t,r){"use strict";var i,n,o=r(89),a=r(0);(n=i||(i={})).validate=function(e,t,r){var i=new o.Validator;if(void 0!==r)for(var n=0,s=r;n<s.length;n++){var u=s[n];i.addSchema(u[0],u[1])}var c=i.validate(e,t);return a.logIf(!c.valid,a.LogLevel.Warning,"schema expected to be valid:\n"+c.toString()),c.valid},n.complement=function e(t,r){if(void 0!==t)switch(a.assert(r.hasOwnProperty("properties")&&"object"===r.type||r.hasOwnProperty("items")&&"array"===r.type,"expected schema to have 'properties' or 'items', given "+r),r.type){case"object":for(var i=r.properties,n=0,o=Object.getOwnPropertyNames(i);n<o.length;n++){var s=o[n],u=i[s],c="object"===u.type,l=t.hasOwnProperty(s),f=u.hasOwnProperty("properties"),h=u.hasOwnProperty("default");a.assert(f&&c||!f&&!c,"expected property '"+s+"' to be of type 'object', given '"+u.type+"'"),l&&f?e(t[s],u):!l&&h&&Object.defineProperty(t,s,{value:u.default,writable:!0})}break;case"array":var d=r.items;if("object"!==d.type)break;for(var p=0,_=Object.getOwnPropertyNames(t);p<_.length;p++){var v=_[p];"length"!==v&&e(t[v],d)}}},n.compare=function e(t,r,i,n){void 0===n&&(n="");var o=void 0!==i;if(a.assert(!o||i.hasOwnProperty("any"),"expected allocation lookup object to have 'any' key"),void 0===t&&void 0!==r||void 0!==t&&void 0===r)return o&&i.alter(n),!0;var s=!0,u=[typeof t,typeof r],c=[t instanceof Array,r instanceof Array];if(!(c[0]&&c[1]||"object"===u[0]&&"object"===u[1]))return!(s=t===r)&&o&&i.alter(""+n),!s;for(var l=0,f=Array.from(new Set(Array().concat(Object.getOwnPropertyNames(t),Object.getOwnPropertyNames(r))).values());l<f.length;l++){var h=f[l];if("length"!==h){var d=[t[h],r[h]];u=[typeof d[0],typeof d[1]];var p=n+(n.length>0&&!c[0]?".":"")+(c[0]?"":h);if(d[0]instanceof Array&&d[1]instanceof Array||"object"===u[0]&&"object"===u[1])s=s&&!e(d[0],d[1],i,p);else{if(u[0]===u[1]&&d[0]===d[1])continue;s=!1,o&&i.alter(p)}}}return!s},e.exports=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(17),u=r(2),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.create=function(){return this._object=s.Framebuffer.DEFAULT_FRAMEBUFFER,this._valid=!0,this._clearColors=new Array(1),this._clearDepth=1,this._clearStencil=0,this.clear=this.es2Clear,this._object},t.prototype.delete=function(){this._object=void 0,this._valid=!1},t.prototype.hasAttachment=function(e){return!1},t.prototype.bind=function(e){void 0===e&&(e=this.context.gl.FRAMEBUFFER),this.context.gl.bindFramebuffer(e,this._object)},t.prototype.clearColor=function(t){e.prototype.clearColor.call(this,t)},t.prototype.resize=function(){a.assert(!1,"the default framebuffer cannot be resized directly")},Object.defineProperty(t.prototype,"width",{get:function(){return this.context.gl.canvas.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.context.gl.canvas.height},enumerable:!0,configurable:!0}),o([u.Initializable.assert_initialized()],t.prototype,"bind",null),t}(s.Framebuffer);t.DefaultFramebuffer=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(2),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._buffersBound=!1,t}return n(t,e),t.prototype.create=function(e,r){var i=this;if(this.context.isWebGL2||this.context.supportsVertexArrayObject){var n=this.context.gl2facade;this._object=n.createVertexArray(),this._valid=void 0!==this._object,this._bind=function(){n.bindVertexArray(i.object),i._buffersBound||(e(),i._buffersBound=!0)},this._unbind=function(){return n.bindVertexArray(t.DEFAULT_VERTEX_ARRAY)}}else this._bind=function(){return e()},this._unbind=function(){return r()},this._valid=!0;return this._object},t.prototype.delete=function(){this.context.isWebGL2||this.context.supportsVertexArrayObject?(a.assert(void 0!==this._object,"expected WebGLVertexArrayObject object"),this._context.gl2facade.deleteVertexArray(this._object),this._object=void 0,this._valid=!1,this._buffersBound=!1):this._valid=!1},t.prototype.bind=function(){this._bind()},t.prototype.unbind=function(){this._unbind()},t.prototype.invalidate=function(){this._buffersBound=!1},t.DEFAULT_VERTEX_ARRAY=void 0,o([s.Initializable.assert_initialized()],t.prototype,"bind",null),o([s.Initializable.assert_initialized()],t.prototype,"unbind",null),t}(r(8).AbstractObject);t.VertexArray=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s=r(10),u=r(1),c=r(0),l=r(3),f=r(15),h=r(2),d=r(13),p=r(14);!function(e){e[e.Started=0]="Started",e[e.Finished=1]="Finished"}(a=t.LoadingStatus||(t.LoadingStatus={}));var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._altered=Object.assign(new f.ChangeLookup,{any:!1,multiFrameNumber:!1,frameSize:!1,canvasSize:!1,framePrecision:!1,clearColor:!1,debugTexture:!1}),t._frameSize=[0,0],t._canvasSize=[0,0],t._framePrecision=p.Wizard.Precision.half,t._clearColor=[0,0,0,1],t._debugTextures=new Array,t._debugTextureSubject=new s.ReplaySubject(1),t}return n(t,e),t.prototype.invalidate=function(e){void 0===e&&(e=!1),this._invalidate(e)},t.prototype.debugTextureNext=function(){this._debugTextureSubject.next(this._debugTexture)},Object.defineProperty(t.prototype,"context",{get:function(){return this.assertInitialized(),this._context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvasSize",{get:function(){return this.assertInitialized(),this._canvasSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"altered",{get:function(){return this._altered.any},enumerable:!0,configurable:!0}),t.prototype.onSwap=function(){},t.prototype.startLoading=function(){this._isLoading=!0,this._loadingStatusSubscription.next(a.Started)},t.prototype.finishLoading=function(){this._isLoading=!1,this._loadingStatusSubscription.next(a.Finished)},t.prototype.initialize=function(e,t,r){return c.assert(void 0!==e,"valid webgl context required"),this._context=e,c.assert(void 0!==t,"valid multi-frame update callback required"),this._invalidate=t,this._isLoading=!0,this._loadingStatusSubscription=new s.ReplaySubject,this.onInitialize(e,t,r)},t.prototype.uninitialize=function(){this.onUninitialize()},t.prototype.discard=function(){this.onDiscarded()},t.prototype.update=function(e){return this._canvasSize[0]===this._context.gl.canvas.width&&this._canvasSize[1]===this._context.gl.canvas.height||(this._canvasSize[0]=this._context.gl.canvas.width,this._canvasSize[1]=this._context.gl.canvas.height,this._altered.alter("canvasSize")),this._multiFrameNumber!==e&&(this._multiFrameNumber=e,this._altered.alter("multiFrameNumber")),this.onUpdate()||this._altered.any},t.prototype.prepare=function(){this.onPrepare()},t.prototype.frame=function(e){this.onFrame(e)},t.prototype.swap=function(){this.onSwap()},t.prototype.frameCoords=function(e,t){var r=u.vec2.divide(l.v2(),this._frameSize,this.canvasSize);return u.vec2.floor(r,u.vec2.multiply(r,[e+.5,t+.5],r)),u.vec2.add(r,r,[.5,.5]),d.tuple2(r)},Object.defineProperty(t.prototype,"frameSize",{set:function(e){this.assertInitialized(),u.vec2.equals(this._frameSize,e)||(Object.assign(this._frameSize,e),this._altered.alter("frameSize"),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framePrecision",{set:function(e){this.assertInitialized(),this._framePrecision!==e&&(this._framePrecision=e,this._altered.alter("framePrecision"),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearColor",{set:function(e){this.assertInitialized(),u.vec4.equals(this._clearColor,e)||(Object.assign(this._clearColor,e),this._altered.alter("clearColor"),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debugTextures",{get:function(){return this.assertInitialized(),this._debugTextures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debugTexture",{get:function(){return this.assertInitialized(),this._debugTexture},set:function(e){this.assertInitialized(),this._debugTexture!==e&&(c.logIf(e>=this._debugTextures.length,c.LogLevel.Error,"invalid texture index, debug texture disabled (index set to -1) | "+e+" not in [-1,+"+(this._debugTextures.length-1)+"]"),this._debugTexture=e<this._debugTextures.length?l.clamp(e,-1,this._debugTextures.length-1):-1,this._altered.alter("debugTexture"),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"debugTexture$",{get:function(){return this._debugTextureSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadingStatus$",{get:function(){return this._loadingStatusSubscription.asObservable()},enumerable:!0,configurable:!0}),o([h.Initializable.assert_initialized()],t.prototype,"invalidate",null),o([h.Initializable.initialize()],t.prototype,"initialize",null),o([h.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([h.Initializable.discard()],t.prototype,"discard",null),o([h.Initializable.assert_initialized()],t.prototype,"update",null),o([h.Initializable.assert_initialized()],t.prototype,"prepare",null),o([h.Initializable.assert_initialized()],t.prototype,"frame",null),o([h.Initializable.assert_initialized()],t.prototype,"swap",null),t}(h.Initializable);t.Renderer=_},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(20),u=r(2),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._size=0,t._internalFormat=0,t._format=0,t._type=0,t._bytes=[0,0,0,0,0,0],t}return n(t,e),t.prototype.faceID=function(e){var t=this._context.gl;switch(e){case t.TEXTURE_CUBE_MAP_POSITIVE_X:return 0;case t.TEXTURE_CUBE_MAP_NEGATIVE_X:return 1;case t.TEXTURE_CUBE_MAP_POSITIVE_Y:return 2;case t.TEXTURE_CUBE_MAP_NEGATIVE_Y:return 3;case t.TEXTURE_CUBE_MAP_POSITIVE_Z:return 4;case t.TEXTURE_CUBE_MAP_NEGATIVE_Z:return 5;default:return a.assert(!1,"expected texture cube map identifier ("+t.TEXTURE_CUBE_MAP_POSITIVE_X+", "+t.TEXTURE_CUBE_MAP_NEGATIVE_X+", "+t.TEXTURE_CUBE_MAP_POSITIVE_Y+", "+t.TEXTURE_CUBE_MAP_NEGATIVE_Y+", "+t.TEXTURE_CUBE_MAP_POSITIVE_Z+", or"+t.TEXTURE_CUBE_MAP_NEGATIVE_Z+"), given "+e),-1}},t.prototype.create=function(e,r,i,n){a.assert(e>0,"texture cube requires valid size (width/height) of greater than zero");var o=this._context.gl,s=this._context.gl2facade;return this._object=o.createTexture(),this._size=e,this._internalFormat=r,this._format=i,this._type=n,o.bindTexture(o.TEXTURE_CUBE_MAP,this._object),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),s.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X,0,this._internalFormat,this._size,this._size,0,this._format,this._type),s.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_X,0,this._internalFormat,this._size,this._size,0,this._format,this._type),s.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Y,0,this._internalFormat,this._size,this._size,0,this._format,this._type),s.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,this._internalFormat,this._size,this._size,0,this._format,this._type),s.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_Z,0,this._internalFormat,this._size,this._size,0,this._format,this._type),s.texImage2D(o.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,this._internalFormat,this._size,this._size,0,this._format,this._type),o.bindTexture(o.TEXTURE_CUBE_MAP,t.DEFAULT_TEXTURE),this._valid=o.isTexture(this._object),this.context.allocationRegister.reallocate(this._identifier,0),this._object},t.prototype.delete=function(){a.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._size=0},t.prototype.cropImage=function(e,t,r,i,n){var o=document.createElement("canvas");o.width=i,o.height=n;var s=o.getContext("2d");return s?(s.drawImage(e,t,r,i,n,0,0,i,n),s.getImageData(0,0,i,n)):(console.log(a.LogLevel.Warning,"2D context creation failed when cropping image."),new ImageData(0,0))},t.prototype.extractMipLevelFromAtlas=function(e,t){for(var r=this.context.gl,i=e.height/2*Math.pow(.5,t),n=[0,0],o=[e.width,e.height],a=0;a<t;++a)o[0]/=2,o[1]/=2,n[0]+=o[0],n[1]+=o[1];r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);var s=this.cropImage(e,n[0],n[1],i,i);this.data([r.TEXTURE_CUBE_MAP_NEGATIVE_X,s],t);var u=this.cropImage(e,n[0]+i,n[1],i,i);this.data([r.TEXTURE_CUBE_MAP_POSITIVE_Z,u],t);var c=this.cropImage(e,n[0]+2*i,n[1],i,i);this.data([r.TEXTURE_CUBE_MAP_POSITIVE_X,c],t);var l=this.cropImage(e,n[0]+3*i,n[1],i,i);this.data([r.TEXTURE_CUBE_MAP_NEGATIVE_Z,l],t);var f=this.cropImage(e,n[0],n[1]+i,i,i);this.data([r.TEXTURE_CUBE_MAP_POSITIVE_Y,f],t);var h=this.cropImage(e,n[0]+i,n[1]+i,i,i);this.data([r.TEXTURE_CUBE_MAP_NEGATIVE_Y,h],t),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!1)},t.prototype.bind=function(e){var t=this.context.gl;e&&t.activeTexture(e),t.bindTexture(t.TEXTURE_CUBE_MAP,this._object)},t.prototype.unbind=function(e){var r=this.context.gl;e&&r.activeTexture(e),r.bindTexture(r.TEXTURE_CUBE_MAP,t.DEFAULT_TEXTURE)},t.prototype.fetch=function(e,t,r){var i=this;void 0===t&&(t=!1),void 0===r&&(r=0);var n=this.context.gl;return new Promise(function(o,s){var u=new Array;e.positiveX&&u.push([n.TEXTURE_CUBE_MAP_POSITIVE_X,e.positiveX]),e.negativeX&&u.push([n.TEXTURE_CUBE_MAP_NEGATIVE_X,e.negativeX]),e.positiveY&&u.push([n.TEXTURE_CUBE_MAP_POSITIVE_Y,e.positiveY]),e.negativeY&&u.push([n.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.negativeY]),e.positiveZ&&u.push([n.TEXTURE_CUBE_MAP_POSITIVE_Z,e.positiveZ]),e.negativeZ&&u.push([n.TEXTURE_CUBE_MAP_NEGATIVE_Z,e.negativeZ]);for(var c=u.length,l=function(e){var u=new Image;u.crossOrigin="anonymous",u.onerror=function(){return s()},u.onload=function(){var t=i.calculateMipLevelSize(r);u.width===u.height?u.width===t?(n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),i.data([e[0],u],r),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),0==(c-=1)&&o()):a.log(a.LogLevel.Warning,"image ignored, width and height expected to match this texture's size "+t+", given "+u.width):a.log(a.LogLevel.Warning,"image ignored, width and height expected to be equal (square image)")},t&&(u.crossOrigin="anonymous"),u.src=e[1]},f=0,h=u;f<h.length;f++)l(h[f])})},t.prototype.fetchMipmapAtlas=function(e,t){var r=this;return void 0===t&&(t=!1),new Promise(function(i,n){var o=new Image;o.onerror=function(){return n()},o.onload=function(){if(o.width===2*o.height){for(var e=o.height/2,t=Math.log2(e),n=0;n<t;++n)r.extractMipLevelFromAtlas(o,n);i()}else a.log(a.LogLevel.Warning,"Mipmap atlas expected to have dimensions of 2x1.")},t&&(o.crossOrigin="anonymous"),o.src=e})},t.prototype.calculateMipLevelSize=function(e){return this._size*Math.pow(.5,e)},t.prototype.data=function(e,t,r,i){void 0===t&&(t=0),void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl,o=this.context.gl2facade,a=this.calculateMipLevelSize(t),u=a*a*s.byteSizeOfFormat(this.context,this._internalFormat);if(this._type===this.context.gl2facade.HALF_FLOAT&&this._internalFormat!==this.context.gl.RGBA16F?u*=2:this._type===this.context.gl.FLOAT&&this._internalFormat!==this.context.gl.RGBA16F&&(u*=4),r&&this.bind(),e instanceof Array&&2===e.length){o.texImage2D(e[0],t,this._internalFormat,a,a,0,this._format,this._type,e[1]);var c=this.faceID(e[0]);this.context.allocationRegister.deallocate(this._identifier,this._bytes[c]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[c]=u}else{var l=e;void 0!==l.positiveX&&(o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X,t,this._internalFormat,a,a,0,this._format,this._type,l.positiveX),this.context.allocationRegister.deallocate(this._identifier,this._bytes[0]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[0]=u),void 0!==l.negativeX&&(o.texImage2D(n.TEXTURE_CUBE_MAP_NEGATIVE_X,t,this._internalFormat,a,a,0,this._format,this._type,l.negativeX),this.context.allocationRegister.deallocate(this._identifier,this._bytes[1]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[1]=u),void 0!==l.positiveY&&(o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_Y,t,this._internalFormat,a,a,0,this._format,this._type,l.positiveY),this.context.allocationRegister.deallocate(this._identifier,this._bytes[2]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[2]=u),void 0!==l.negativeY&&(o.texImage2D(n.TEXTURE_CUBE_MAP_NEGATIVE_Y,t,this._internalFormat,a,a,0,this._format,this._type,l.negativeY),this.context.allocationRegister.deallocate(this._identifier,this._bytes[3]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[3]=u),void 0!==l.positiveZ&&(o.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_Z,t,this._internalFormat,a,a,0,this._format,this._type,l.positiveZ),this.context.allocationRegister.deallocate(this._identifier,this._bytes[4]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[4]=u),void 0!==l.negativeZ&&(o.texImage2D(n.TEXTURE_CUBE_MAP_NEGATIVE_Z,t,this._internalFormat,a,a,0,this._format,this._type,l.negativeZ),this.context.allocationRegister.deallocate(this._identifier,this._bytes[5]),this.context.allocationRegister.allocate(this._identifier,u),this._bytes[5]=u)}i&&this.unbind()},t.prototype.filter=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,t),i&&this.unbind()},t.prototype.wrap=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,t),i&&this.unbind()},t.prototype.levels=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_BASE_LEVEL,e),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_LEVEL,t),i&&this.unbind()},t.prototype.reformat=function(e,t,r,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),(e!==this._internalFormat||void 0!==t&&t!==this._format||void 0!==r&&r!==this._type)&&(a.assert(void 0!==e,"valid internal format expected"),this._internalFormat=e,t&&(this._format=t),r&&(this._type=r),this.data({clearOnUndefined:!0},0,i,n))},t.prototype.resize=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),e!==this._size&&(this._size=e,this.data({clearOnUndefined:!0},0,t,r))},Object.defineProperty(t.prototype,"bytes",{get:function(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"internalFormat",{get:function(){return this.assertInitialized(),this._internalFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this.assertInitialized(),this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.assertInitialized(),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.assertInitialized(),this._size},enumerable:!0,configurable:!0}),t.DEFAULT_TEXTURE=void 0,o([u.Initializable.assert_initialized()],t.prototype,"bind",null),o([u.Initializable.assert_initialized()],t.prototype,"unbind",null),o([u.Initializable.assert_initialized()],t.prototype,"fetch",null),o([u.Initializable.assert_initialized()],t.prototype,"fetchMipmapAtlas",null),o([u.Initializable.assert_initialized()],t.prototype,"data",null),o([u.Initializable.assert_initialized()],t.prototype,"filter",null),o([u.Initializable.assert_initialized()],t.prototype,"wrap",null),o([u.Initializable.assert_initialized()],t.prototype,"levels",null),o([u.Initializable.assert_initialized()],t.prototype,"reformat",null),o([u.Initializable.assert_initialized()],t.prototype,"resize",null),t}(r(8).AbstractObject);t.TextureCube=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(3),o=r(0),a=r(13),s=function(){function e(t,r,n){this._fovy=e.DEFAULT_FOVY,this._near=e.DEFAULT_NEAR,this._far=e.DEFAULT_FAR,this._viewport=[1,1],this._aspect=1,this._altered=!1,this._eye=t?i.vec3.clone(t):i.vec3.clone(e.DEFAULT_EYE),this._center=r?i.vec3.clone(r):i.vec3.clone(e.DEFAULT_CENTER),this._up=n?i.vec3.clone(n):i.vec3.clone(e.DEFAULT_UP)}return e.calculateFovY=function(e,t){return 2*Math.atan(.5*e/t)},e.prototype.invalidate=function(e,t,r){void 0===r&&(r=!1),e&&(this._view=void 0,this._viewInverse=void 0),t&&(this._projection=void 0,this._projectionInverse=void 0),(e||t||r)&&(this._viewProjection=void 0,this._viewProjectionInverse=void 0),this._altered=!0},Object.defineProperty(e.prototype,"eye",{get:function(){return this._eye},set:function(e){i.vec3.equals(this._eye,e)||(this._eye=i.vec3.clone(e),this.invalidate(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(e){i.vec3.equals(this._center,e)||(this._center=i.vec3.clone(e),this.invalidate(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this._up},set:function(e){i.vec3.equals(this._up,e)||(this._up=i.vec3.clone(e),this.invalidate(!0,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovy",{get:function(){return this._fovy},set:function(e){this._fovy!==e&&(this._fovy=e,this.invalidate(!1,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fovx",{set:function(e){var t=e*o.DEG2RAD,r=2*Math.atan(Math.tan(t/2)*(1/this.aspect))*o.RAD2DEG;this._fovy!==r&&(this._fovy=r,this.invalidate(!1,!0))},enumerable:!0,configurable:!0}),e.prototype.fovFromLens=function(e,t){var r=2*Math.atan(e/(2*t));this.fovx=r*o.RAD2DEG},Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(e){this._near!==e&&(e>=this._far&&o.log(o.LogLevel.Warning,"near expected to be smaller than far ("+this._far+"), given "+e),this._near=e,this.invalidate(!1,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(e){this._far!==e&&(this._near>=e&&o.log(o.LogLevel.Warning,"far expected to be greater than near ("+this._near+"), given "+e),this._far=e,this.invalidate(!1,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return this._viewport},set:function(e){this._viewport[0]===e[0]&&this._viewport[1]===e[1]||(this._viewport=a.duplicate2(e),this.invalidate(!1,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._viewport[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._viewport[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspect",{get:function(){return this._aspect},set:function(e){this._aspect!==e&&(this._aspect=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view||(this._view=i.mat4.lookAt(n.m4(),this._eye,this._center,this._up)),this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewInverse",{get:function(){return void 0!==this._viewInverse||(this._viewInverse=i.mat4.invert(n.m4(),this.view)),this._viewInverse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projection",{get:function(){return this._projection||(this._projection=i.mat4.perspective(n.m4(),this.fovy*o.DEG2RAD,this.aspect,this.near,this.far)),this._projection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectionInverse",{get:function(){return void 0!==this._projectionInverse||(this._projectionInverse=i.mat4.invert(n.m4(),this.projection)),this._projectionInverse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjection",{get:function(){return this._viewProjection||(this._viewProjection=i.mat4.multiply(n.m4(),this.projection,this.view),this._viewProjection=i.mat4.multiply(n.m4(),this.postViewProjection,this._viewProjection)),this._viewProjection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewProjectionInverse",{get:function(){return void 0!==this._viewProjectionInverse||(this._viewProjectionInverse=i.mat4.invert(n.m4(),this.viewProjection)),this._viewProjectionInverse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"postViewProjection",{get:function(){return this._postViewProjection?this._postViewProjection:i.mat4.identity(n.m4())},set:function(e){this._postViewProjection=e,this.invalidate(!1,!1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altered",{get:function(){return this._altered},set:function(e){this._altered=e},enumerable:!0,configurable:!0}),e.DEFAULT_EYE=i.vec3.fromValues(0,0,1),e.DEFAULT_CENTER=i.vec3.fromValues(0,0,0),e.DEFAULT_UP=i.vec3.fromValues(0,1,0),e.DEFAULT_FOVY=45,e.DEFAULT_NEAR=2,e.DEFAULT_FAR=8,e}();t.Camera=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(3),s=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._rotation=o.mat4.create(),r._sensitivity=t.DEFAULT_SENSITIVITY,r}return n(t,e),t.prototype.initiate=function(e){Object.assign(this._reference,this._camera),this._initialPoint=e},t.prototype.process=function(e,t){this._currentPoint=e;var r=o.vec2.create();void 0===t?o.vec2.subtract(r,this._initialPoint,this._currentPoint):o.vec2.copy(r,t),o.vec2.scale(r,r,window.devicePixelRatio*this._sensitivity),o.vec2.copy(this._initialPoint,this._currentPoint);var i=o.vec3.sub(a.v3(),this._reference.eye,this._reference.center);o.vec3.normalize(i,i);var n=o.vec3.cross(a.v3(),i,this._reference.up),s=o.mat4.fromRotation(a.m4(),-r[0],this._reference.up),u=o.mat4.fromRotation(a.m4(),r[1],n);o.mat4.mul(this._rotation,u,s),this.update()},t.prototype.update=function(){if(void 0!==this._camera){var e=o.mat4.fromTranslation(a.m4(),this._reference.eye);o.mat4.multiply(e,e,this._rotation),o.mat4.translate(e,e,o.vec3.negate(a.v3(),this._reference.eye));var t=o.vec3.transformMat4(a.v3(),this._reference.center,e);this._camera.center=t,Object.assign(this._reference,this._camera)}},Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e},enumerable:!0,configurable:!0}),t.DEFAULT_SENSITIVITY=8e-4,t}(r(11).CameraModifier);t.FirstPersonModifier=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(3),s=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._sensitivity=t.DEFAULT_SENSITIVITY,r._translation=a.v3(),r}return n(t,e),t.prototype.initiate=function(e){Object.assign(this._reference,this._camera),this._initialPoint=e},t.prototype.process=function(e){this._currentPoint=e;var t=o.vec2.subtract(a.v2(),this._initialPoint,this._currentPoint);o.vec2.scale(t,t,window.devicePixelRatio*this._sensitivity);var r=o.vec3.sub(a.v3(),this._reference.eye,this._reference.center);o.vec3.normalize(r,r);var i=this._reference.up;o.vec3.normalize(i,i);var n=o.vec3.cross(a.v3(),i,r),s=o.vec3.scale(a.v3(),n,t[0]),u=o.vec3.scale(a.v3(),i,t[1]);o.vec3.negate(u,u),this._translation=o.vec3.add(a.v3(),u,s),this.update()},t.prototype.update=function(){if(void 0!==this._camera){var e=o.mat4.fromTranslation(a.m4(),this._translation),t=o.vec3.transformMat4(a.v3(),this._reference.eye,e),r=o.vec3.transformMat4(a.v3(),this._reference.center,e);this._camera.eye=t,this._camera.center=r}},t.DEFAULT_SENSITIVITY=.002,t}(r(11).CameraModifier);t.PanModifier=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(3),s=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._sensitivity=t.DEFAULT_SENSITIVITY,r._translation=a.v3(),r}return n(t,e),t.prototype.initiate=function(e,t){Object.assign(this._reference,this._camera);var r=o.vec2.subtract(a.v2(),e,t);this._initialDistance=o.vec2.length(r)},t.prototype.process=function(e,r){var i=o.vec2.subtract(a.v2(),e,r);this._currentDistance=o.vec2.length(i);var n=(this._currentDistance/this._initialDistance-1)*t.DEFAULT_SENSITIVITY,s=o.vec3.sub(a.v3(),this._reference.center,this._reference.eye);o.vec3.normalize(s,s),this._translation=o.vec3.scale(a.v3(),s,n),this.update()},t.prototype.update=function(){if(void 0!==this._camera){var e=o.mat4.fromTranslation(a.m4(),this._translation),t=o.vec3.transformMat4(a.v3(),this._reference.eye,e);this._camera.eye=t}},t.DEFAULT_SENSITIVITY=2,t}(r(11).CameraModifier);t.PinchZoomModifier=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(3),s=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._rotation=o.mat4.create(),r._sensitivity=t.DEFAULT_SENSITIVITY,r}return n(t,e),t.prototype.initiate=function(e){this._initialPoint=e},t.prototype.process=function(e){this._currentPoint=e;var t=o.vec2.subtract(a.v2(),this._initialPoint,this._currentPoint);o.vec2.scale(t,t,window.devicePixelRatio*this._sensitivity),o.vec2.copy(this._initialPoint,this._currentPoint);var r=o.vec3.sub(a.v3(),this._reference.eye,this._reference.center);o.vec3.normalize(r,r);var i=o.vec3.normalize(a.v3(),this._reference.up),n=o.vec3.cross(a.v3(),r,i);o.vec3.scale(i,i,t[1]),o.vec3.scale(n,n,t[0]);var s=o.vec3.cross(a.v3(),o.vec3.add(a.v3(),i,n),r);o.vec3.normalize(s,s);var u=o.quat.setAxisAngle(o.quat.create(),s,o.vec2.len(t));o.mat4.multiply(this._rotation,this._rotation,o.mat4.fromQuat(a.m4(),u)),this.update()},t.prototype.update=function(){if(void 0!==this._camera){var e=o.mat4.fromTranslation(a.m4(),this._reference.center);o.mat4.multiply(e,e,this._rotation),o.mat4.translate(e,e,o.vec3.negate(a.v3(),this._reference.center));var t=o.vec3.transformMat4(a.v3(),[0,1,0],this._rotation),r=o.vec3.transformMat4(a.v3(),this._reference.eye,e);this._camera.up=t,this._camera.eye=r}},Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e},enumerable:!0,configurable:!0}),t.DEFAULT_SENSITIVITY=.002,t}(r(11).CameraModifier);t.TrackballModifier=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(3),s=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._rotation=a.m4(),r._maxAzimuth=.5*+Math.PI-1e-4,r._minAzimuth=.5*-Math.PI+1e-4,r._xAxisScreenSpace=a.v3(),r._sensitivity=t.DEFAULT_SENSITIVITY,r}return n(t,e),t.prototype.initiate=function(e){Object.assign(this._reference,this._camera),this._initialPoint=e;var t=o.vec3.sub(a.v3(),this._reference.eye,this._reference.center);o.vec3.normalize(t,t),this._xAxisScreenSpace=o.vec3.cross(a.v3(),[0,1,0],t),this._azimuth=Math.acos(o.vec3.dot(t,[0,1,0])),this._azimuth=.5*Math.PI-this._azimuth},t.prototype.process=function(e){this._currentPoint=e;var t=o.vec2.subtract(a.v2(),this._initialPoint,this._currentPoint);o.vec2.scale(t,t,window.devicePixelRatio*this._sensitivity),this._minAzimuth&&(t[1]=Math.min(this._azimuth-this._minAzimuth,t[1])),this._maxAzimuth&&(t[1]=Math.max(this._azimuth-this._maxAzimuth,t[1])),o.mat4.rotateY(this._rotation,a.m4(),t[0]),o.mat4.rotate(this._rotation,this._rotation,t[1],this._xAxisScreenSpace),this.update()},t.prototype.update=function(){if(void 0!==this._camera){var e=o.mat4.fromTranslation(a.m4(),this._reference.center);o.mat4.multiply(e,e,this._rotation),o.mat4.translate(e,e,o.vec3.negate(a.v3(),this._reference.center));var t=o.vec3.transformMat4(a.v3(),[0,1,0],this._rotation),r=o.vec3.transformMat4(a.v3(),this._reference.eye,e);this._camera.up=t,this._camera.eye=r}},Object.defineProperty(t.prototype,"sensitivity",{get:function(){return this._sensitivity},set:function(e){this._sensitivity=e},enumerable:!0,configurable:!0}),t.DEFAULT_SENSITIVITY=.002,t}(r(11).CameraModifier);t.TurntableModifier=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(3),s=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._sensitivity=t.DEFAULT_SENSITIVITY,r._translation=a.v3(),r}return n(t,e),t.prototype.process=function(e){Object.assign(this._reference,this._camera);var t=e*this._sensitivity,r=o.vec3.sub(a.v3(),this._reference.center,this._reference.eye);o.vec3.normalize(r,r),this._translation=o.vec3.scale(a.v3(),r,t),this.update()},t.prototype.update=function(){if(void 0!==this._camera){var e=o.mat4.fromTranslation(a.m4(),this._translation),t=o.vec3.transformMat4(a.v3(),this._reference.eye,e);this._camera.eye=t}},t.DEFAULT_SENSITIVITY=.2,t}(r(11).CameraModifier);t.WheelZoomModifier=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.generate=function(){switch(this._width){case 8:this.fromJSON(r(105));break;case 64:this.fromJSON(r(106));break;case 128:this.fromJSON(r(107));break;default:e.prototype.generate.call(this)}},t}(r(60).RandomSquareKernel);t.AntiAliasingKernel=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t){var r=e.call(this,2,t)||this;return r.generate(),r}return n(t,e),t.prototype.generate=function(){o.assert(this.width>0,"expected every kernel to comprise at least one element"),this.set([0,0],0);for(var e=1;e<this.width;++e)this.set([o.rand(-.5,.5),o.rand(-.5,.5)],e)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this.resize(),this.generate())},enumerable:!0,configurable:!0}),t}(r(37).KernelF32);t.RandomSquareKernel=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(15),u=r(17),c=r(2),l=r(12),f=r(6),h=r(7),d=r(4),p=r(14),_=function(e){function t(t){var r=e.call(this)||this;return r._altered=Object.assign(new s.ChangeLookup,{any:!1,texture:!1,precision:!1,passThrough:!1}),r._precision=p.Wizard.Precision.half,r._write=0,r._ndcTriangleShared=!1,r._context=t,r}return n(t,e),t.prototype.initialize=function(e){var t=this._context.gl;this._accumulationFBOs=[new u.Framebuffer(this._context,"AccumPingFBO"),new u.Framebuffer(this._context,"AccumPongFBO")],this._accumulationTextures=[new d.Texture2D(this._context,"AccumPingTexture"),new d.Texture2D(this._context,"AccumPongTexture")],void 0===e?this._ndcTriangle=new l.NdcFillingTriangle(this._context,"NdcFillingTriangle-Accumulate"):(this._ndcTriangle=e,this._ndcTriangleShared=!0);var i=new h.Shader(this._context,t.VERTEX_SHADER,"ndcvertices.vert (accumulate)");i.initialize(r(62));var n=new h.Shader(this._context,t.FRAGMENT_SHADER,"accumulate.frag");return n.initialize(r(108)),this._program=new f.Program(this._context,"AccumulateProgram"),this._program.initialize([i,n],!1),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uWeight=this._program.uniform("u_weight"),this._program.bind(),t.uniform1f(this._uWeight,0),t.uniform1i(this._program.uniform("u_accumulationTexture"),0),t.uniform1i(this._program.uniform("u_currentFrameTexture"),1),this._program.unbind(),!0},t.prototype.uninitialize=function(){!this._ndcTriangleShared&&this._ndcTriangle.initialized&&this._ndcTriangle.uninitialize(),this._program.uninitialize(),this._accumulationFBOs[0].uninitialize(),this._accumulationFBOs[1].uninitialize(),this._accumulationTextures[0].uninitialize(),this._accumulationTextures[1].uninitialize(),this._write=0},t.prototype.update=function(){if(this._texture&&this._texture.valid){if(!this._passThrough){var e=this._altered.texture||this._accumulationTextures[0].width!==this._texture.width||this._accumulationTextures[0].height!==this._texture.height;if(this._altered.any||e){var t=this._context.gl,r=this._context.gl2facade,i=this._texture.size;if(this._accumulationTextures[0].initialized)(this._altered.texture||e)&&(this._accumulationTextures[0].resize(this._texture.width,this._texture.height),this._accumulationTextures[1].resize(this._texture.width,this._texture.height)),this._altered.precision&&(n=p.Wizard.queryInternalTextureFormat(this._context,t.RGBA,this._precision),this._accumulationTextures[0].reformat(n[0],t.RGBA,n[1]),this._accumulationTextures[1].reformat(n[0],t.RGBA,n[1]));else{var n=p.Wizard.queryInternalTextureFormat(this._context,t.RGBA,this._precision);this._accumulationTextures[0].initialize(i[0],i[1],n[0],t.RGBA,n[1]),this._accumulationTextures[1].initialize(i[0],i[1],n[0],t.RGBA,n[1])}this._accumulationFBOs[0].initialized||(this._accumulationFBOs[0].initialize([[r.COLOR_ATTACHMENT0,this._accumulationTextures[0]]]),this._accumulationFBOs[1].initialize([[r.COLOR_ATTACHMENT0,this._accumulationTextures[1]]])),a.assert(this._accumulationFBOs[0].valid&&this._accumulationFBOs[1].valid,"valid accumulation framebuffers expected"),this._altered.reset()}else a.assert(this._accumulationFBOs[0].valid&&this._accumulationFBOs[1].valid,"valid accumulation framebuffers expected")}}else a.log(a.LogLevel.Warning,"valid texture for accumulation update expected, given "+this._texture)},t.prototype.frame=function(e,t){if(a.assert(this._accumulationFBOs[0].valid&&this._accumulationFBOs[1].valid,"valid framebuffer objects for accumulation expected (initialize or update was probably not called)"),!this._passThrough&&void 0!==this._texture){a.logIf(!this._texture||!this._texture.valid,a.LogLevel.Warning,"valid texture for accumulation frame expected, given "+this._texture);var r=this._context.gl;void 0!==t&&r.viewport(0,0,t[0],t[1]);var i=e%2,n=this._write=1-i,o=this._accumulationTextures[i],s=this._texture;o.bind(r.TEXTURE0),s.bind(r.TEXTURE1),this._program.bind(),r.uniform1f(this._uWeight,1/(e+1)),this._accumulationFBOs[n].bind(r.DRAW_FRAMEBUFFER),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),this._accumulationFBOs[n].unbind(r.DRAW_FRAMEBUFFER),o.unbind(r.TEXTURE0),s.unbind(r.TEXTURE1)}},Object.defineProperty(t.prototype,"texture",{set:function(e){this.assertInitialized(),this._texture!==e&&(this._texture=e,this._altered.alter("texture"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"precision",{set:function(e){this.assertInitialized(),this._precision!==e&&(this._precision=e,this._altered.alter("precision"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"passThrough",{set:function(e){this.assertInitialized(),this._passThrough!==e&&(this._passThrough&&this._accumulationTextures[0].initialized&&(this._accumulationTextures[0].uninitialize(),this._accumulationTextures[1].uninitialize()),this._passThrough&&this._accumulationFBOs[0].initialized&&(this._accumulationFBOs[0].uninitialize(),this._accumulationFBOs[1].uninitialize()),this._passThrough=e,this._altered.alter("passThrough"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this._passThrough?void 0:this._accumulationFBOs[this._write]},enumerable:!0,configurable:!0}),o([c.Initializable.initialize()],t.prototype,"initialize",null),o([c.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([c.Initializable.assert_initialized()],t.prototype,"update",null),o([c.Initializable.assert_initialized()],t.prototype,"frame",null),t}(c.Initializable);t.AccumulatePass=_},function(e,t){e.exports="\r\nprecision lowp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    attribute vec2 a_vertex;\r\n#else\r\n    layout(location = 0) in vec2 a_vertex;\r\n#endif\r\n\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    v_uv = a_vertex * 0.5 + 0.5;\r\n\r\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\r\n}\r\n"},function(e,t){e.exports="\r\nprecision lowp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    attribute vec2 a_vertex;\r\n#else\r\n    layout(location = 0) in vec2 a_vertex;\r\n#endif\r\n\r\nuniform vec4 u_srcBounds; // normalized\r\nuniform vec4 u_dstBounds; // normalized\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec2 uv = a_vertex * 0.5 + 0.5;\r\n\r\n    v_uv = mix(u_srcBounds.xy, u_srcBounds.zw, uv);\r\n    gl_Position = vec4(a_vertex.xy, 0.0, 1.0);\r\n}\r\n"},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=r(3),c=r(2),l=r(12),f=r(6),h=r(7),d=function(e){function t(t){var r=e.call(this)||this;return r._kernelSize=7,r._standardDeviation=1,r._redistribute=!0,r._ndcTriangleShared=!1,r._context=t,r}return n(t,e),t.prototype.recalculateWeights=function(){if(this._weights)return!1;var e=1/Math.sqrt(2*Math.PI)*this._standardDeviation,t=2*this._standardDeviation*this._standardDeviation;this._weights=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(var r=0,i=0;i<=Math.floor(this._kernelSize/2);i++)this._weights[i]=e*Math.pow(Math.E,-Math.pow(i,2)/t),r+=i>0?2*this._weights[i]:this._weights[i];if(this._redistribute){var n=1-r;for(i=0;i<=Math.floor(this._kernelSize/2);i++)this._weights[i]+=this._weights[i]/r*n}return!0},Object.defineProperty(t.prototype,"kernelSize",{get:function(){return this._kernelSize},set:function(e){s.assert(e>0,"Kernel size has to be positive."),s.assert(e<=2*(t._MAXKERNELSIZEHALF-1)+1,"Kernel size has to be smaller than "+(2*(t._MAXKERNELSIZEHALF-1)+2)+"."),s.assert(Number.isInteger(e),"Kernel size has to be an integer."),s.assert(e%2==1,"Kernel size has to be odd."),this._kernelSize=e,this._weights=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDeviation",{get:function(){return this._standardDeviation},set:function(e){s.assert(e>0,"Standard deviation has to be positive."),this._standardDeviation=e,this._weights=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"redistribute",{get:function(){return this._redistribute},set:function(e){this._redistribute=e,this._weights=void 0},enumerable:!0,configurable:!0}),t.prototype.initialize=function(e){var t=this._context.gl,i=new h.Shader(this._context,t.VERTEX_SHADER,"gauss.vert");i.initialize(r(116)),this._fragmentShader=new h.Shader(this._context,t.FRAGMENT_SHADER,"gauss.frag"),this._fragmentShader.replace("$KERNEL_HALF_SIZE",""+Math.floor(this.kernelSize/2)),this._fragmentShader.initialize(r(117)),this._program=new f.Program(this._context),this._program.initialize([i,this._fragmentShader]),this._uDelta=this._program.uniform("u_delta"),this._uWeights=this._program.uniform("u_weights");var n=this._program.attribute("a_vertex",0);return void 0===e?this._ndcTriangle=new l.NdcFillingTriangle(this._context,"GaussFilterQuad"):(this._ndcTriangle=e,this._ndcTriangleShared=!0),this._ndcTriangle.initialize(n),!0},t.prototype.uninitialize=function(){this._program.uninitialize(),this._ndcTriangleShared||this._ndcTriangle.uninitialize()},t.prototype.filter=function(e,t){var r=this._context.gl,i=[a.vec2.fromValues(1,0),a.vec2.fromValues(0,1)];this.recalculateWeights()&&(this._fragmentShader.replace("$KERNEL_HALF_SIZE",""+Math.floor(this.kernelSize/2)),this._fragmentShader.compile(),this._program.link(),this._uDelta=this._program.uniform("u_delta"),this._uWeights=this._program.uniform("u_weights"),this._program.bind(),r.uniform1fv(this._uWeights,this._weights)),this._program.bind(),e.bind(r.TEXTURE0),r.uniform2fv(this._uDelta,a.vec2.divide(u.v2(),i[t],e.size)),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),e.unbind(r.TEXTURE0),this._program.unbind()},t._MAXKERNELSIZEHALF=32,o([c.Initializable.initialize()],t.prototype,"initialize",null),o([c.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([c.Initializable.assert_initialized()],t.prototype,"filter",null),t}(c.Initializable);t.GaussFilter=d,function(e){!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(e.Direction||(e.Direction={}))}(d=t.GaussFilter||(t.GaussFilter={})),t.GaussFilter=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(119);t.CuboidGeometry=i.CuboidGeometry;var n=r(66);t.Icosahedron=n.Icosahedron;var o=r(120);t.GeosphereGeometry=o.GeosphereGeometry;var a=r(121);t.PlaneGeometry=a.PlaneGeometry;var s=r(122);t.ResourceManager=s.ResourceManager},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(3),o=function(){function e(){}return e.prototype.baseVertices=function(){var e=.5*(1+Math.sqrt(5)),t=1/Math.sqrt(e*e+1),r=e*t;return[i.vec3.fromValues(-t,+r,0),i.vec3.fromValues(+t,+r,0),i.vec3.fromValues(-t,-r,0),i.vec3.fromValues(+t,-r,0),i.vec3.fromValues(0,-t,+r),i.vec3.fromValues(0,+t,+r),i.vec3.fromValues(0,-t,-r),i.vec3.fromValues(0,+t,-r),i.vec3.fromValues(+r,0,-t),i.vec3.fromValues(+r,0,+t),i.vec3.fromValues(-r,0,-t),i.vec3.fromValues(-r,0,+t)]},e.prototype.baseFaces=function(){return[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]]},e.prototype.refine=function(e,t,r){for(var i=new Map,n=0;n<r;n++)for(var o=t.length,a=0;a<o;a++){var s=t[a],u=s[0],c=s[1],l=s[2],f=this.split(u,c,e,i),h=this.split(c,l,e,i),d=this.split(l,u,e,i);t[a]=[f,h,d],t.push([u,f,d]),t.push([c,h,f]),t.push([l,d,h])}},e.prototype.split=function(e,t,r,o){var a=e<t,s=((a?e:t)<<16)+(a?t:e);if(o.has(s))return o.get(s);var u=i.vec3.add(n.v3(),r[e],r[t]);i.vec3.normalize(u,u),r.push(u);var c=r.length-1;return o.set(s,c),c},e.prototype.generateGeometry=function(e){this._vertices=this.baseVertices(),this._faces=this.baseFaces(),e>0&&this.refine(this._vertices,this._faces,Math.min(Math.max(e,0),8))},e.prototype.generateTextureCoordinates=function(){this._texcoords=new Array;for(var e=0,t=this._vertices;e<t.length;e++){var r=t[e],o=i.vec3.normalize(n.v3(),r),a=i.vec2.fromValues(.5-Math.atan2(o[2],o[0])/(2*Math.PI),Math.asin(o[1])/Math.PI+.5);this._texcoords.push(a)}},Object.defineProperty(e.prototype,"faces",{get:function(){return this._faces},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertices",{get:function(){return this._vertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texcoords",{get:function(){return this._texcoords},enumerable:!0,configurable:!0}),e}();t.Icosahedron=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene},set:function(e){this._scene=e,void 0!==this._scene&&this.preprocessScene()},enumerable:!0,configurable:!0}),t}(r(2).Initializable);t.SceneRenderPass=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this._nodes=new Array,this._components=new Array,this._name=e,this._parent=void 0}return e.prototype.traverse=function(e){e(this);for(var t=0,r=this._nodes;t<r.length;t++)r[t].traverse(e)},e.prototype.addNode=function(e){return e._parent=this,this._nodes.push(e),e},e.prototype.addComponent=function(e){return this._components.push(e),e},e.prototype.componentsOfType=function(e){return this._components.filter(function(t){return e===t.type})},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"components",{get:function(){return this._components},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLeaf",{get:function(){return 0===this._nodes.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return void 0===this._parent},enumerable:!0,configurable:!0}),e}();t.SceneNode=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(13),n=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._bearing=[0,0],this._extent=[0,0],this._kernings=new Map,this._subTextureOrigin=[0,0],this._subTextureExtent=[0,0],this._index=e,this._advance=t}return e.prototype.depictable=function(){return this._subTextureExtent[0]>0&&this._subTextureExtent[1]>0},e.prototype.kerning=function(e){var t=this._kernings.get(e);return void 0!==t?t:0},e.prototype.setKerning=function(e,t){this._kernings.set(e,t)},Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subTextureOrigin",{get:function(){return this._subTextureOrigin},set:function(e){this._subTextureOrigin=i.clampf2(e,"texture origin")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subTextureExtent",{get:function(){return this._subTextureExtent},set:function(e){this._subTextureExtent=i.clampf2(e,"texture extent")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bearing",{get:function(){return this._bearing},set:function(e){this._bearing=e},enumerable:!0,configurable:!0}),e.prototype.bearingFromFontBaseAndOffset=function(e,t,r){this._bearing[0]=t,this._bearing[1]=e-r},Object.defineProperty(e.prototype,"extent",{get:function(){return this._extent},set:function(e){this._extent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this._advance},set:function(e){this._advance=e},enumerable:!0,configurable:!0}),e}();t.Glyph=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,r){this._lineFeed=e.DEFAULT_LINE_FEED,this._altered=!1,this._text=t||"",this._lineFeed=void 0!==r?r:this._lineFeed}return Object.defineProperty(e.prototype,"length",{get:function(){return this._text.length},enumerable:!0,configurable:!0}),e.prototype.charAt=function(e){return this._text.charAt(e)},e.prototype.charCodeAt=function(e){return this._text.charCodeAt(e)},Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._altered=!0,this._text=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineFeed",{get:function(){return this._lineFeed},set:function(e){this._lineFeed!==e&&(this._altered=!0,this._lineFeed=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"altered",{get:function(){return this._altered},set:function(e){this._altered=e},enumerable:!0,configurable:!0}),e.DEFAULT_LINE_FEED="\n",e}();t.Text=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(5),u=r(9),c=r(2),l=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i._numberOfGlyphs=0,a.assert(t.isWebGL2||t.supportsInstancedArrays,"expected extension 'ANGLE_instanced_arrays' to be supported"),r=void 0!==r&&""!==r?r:i.constructor.name,i._vertices=new s.Buffer(t,r+"VBO"),i._buffers.push(i._vertices),i._texCoords=new s.Buffer(t,r+"TexCoordVBO"),i._buffers.push(i._texCoords),i._origins=new s.Buffer(t,r+"OriginVBO"),i._buffers.push(i._origins),i._tangents=new s.Buffer(t,r+"TangentVBO"),i._buffers.push(i._tangents),i._ups=new s.Buffer(t,r+"UpVBO"),i._buffers.push(i._ups),i}return n(t,e),t.prototype.bindBuffers=function(){var e=this.context.gl,t=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,e.FLOAT,!1,8,0,!0,!1),t.vertexAttribDivisor(this._vertexLocation,0),this._texCoords.attribEnable(this._texCoordLocation,4,e.FLOAT,!1,16,0,!0,!1),t.vertexAttribDivisor(this._texCoordLocation,1),this._origins.attribEnable(this._originLocation,3,e.FLOAT,!1,12,0,!0,!1),t.vertexAttribDivisor(this._originLocation,1),this._tangents.attribEnable(this._tangentLocation,3,e.FLOAT,!1,12,0,!0,!1),t.vertexAttribDivisor(this._tangentLocation,1),this._ups.attribEnable(this._upLocation,3,e.FLOAT,!1,12,0,!0,!1),t.vertexAttribDivisor(this._upLocation,1)},t.prototype.unbindBuffers=function(){this._vertices.attribDisable(this._vertexLocation,!1,!1),this._texCoords.attribDisable(this._texCoordLocation,!1,!1),this._origins.attribDisable(this._originLocation,!1,!1),this._tangents.attribDisable(this._tangentLocation,!1,!1),this._ups.attribDisable(this._upLocation,!1,!1)},t.prototype.initialize=function(r,i,n,o,a){void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=2),void 0===o&&(o=3),void 0===a&&(a=4),this._vertexLocation=r,this._texCoordLocation=i,this._originLocation=n,this._tangentLocation=o,this._upLocation=a;var s=this.context.gl,u=e.prototype.initialize.call(this,[s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER]);return this._vertices.data(t.VERTICES,s.STATIC_DRAW),u},t.prototype.update=function(e,t,r,i){this._numberOfGlyphs=e.length/3;var n=this.context.gl;this._texCoords.data(i,n.STATIC_DRAW),this._origins.data(e,n.STATIC_DRAW),this._tangents.data(t,n.STATIC_DRAW),this._ups.data(r,n.STATIC_DRAW)},t.prototype.draw=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var r=this.context.gl,i=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,r.FLOAT,!1,8,0,!0,!1),this._texCoords.attribEnable(this._texCoordLocation,4,r.FLOAT,!1,16,16*e,!0,!1),this._origins.attribEnable(this._originLocation,3,r.FLOAT,!1,12,12*e,!0,!1),this._tangents.attribEnable(this._tangentLocation,3,r.FLOAT,!1,12,12*e,!0,!1),this._ups.attribEnable(this._upLocation,3,r.FLOAT,!1,12,12*e,!0,!1),i.drawArraysInstanced(r.TRIANGLE_STRIP,0,4,t)},Object.defineProperty(t.prototype,"numGlyphs",{get:function(){return this._numberOfGlyphs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){var e=this._vertices&&this._vertices.valid,t=this._texCoords&&this._texCoords.valid,r=this._origins&&this._origins.valid,i=this._tangents&&this._tangents.valid,n=this._ups&&this._ups.valid;return this.initialized&&e&&t&&r&&i&&n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texCoordLocation",{get:function(){return this._texCoordLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originLocation",{get:function(){return this._originLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tangentLocation",{get:function(){return this._tangentLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upLocation",{get:function(){return this._upLocation},enumerable:!0,configurable:!0}),t.VERTICES=new Float32Array([0,0,0,1,1,0,1,1]),o([c.Initializable.assert_initialized()],t.prototype,"draw",null),t}(u.Geometry);t.LabelGeometry=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=r(3),u=r(18),c=r(19),l=r(26),f=function(e){function t(r,i,n){var a=e.call(this,r,i,n)||this;return a._position=o.vec2.fromValues(0,0),a._direction=o.vec2.fromValues(1,0),a._frameSize=o.vec2.create(),a._fontSize=t.DEFAULT_FONTSIZE_PX,a._fontSizeUnit=c.Label.Unit.Pixel,a}return n(t,e),t.prototype.typeset=function(e){void 0===e&&(e=!1);var t=e||this._altered.typesetting||this._altered.static||this._altered.text||this.text.altered;if(t||this._altered.dynamic||e){if(!this.valid)return new u.GlyphVertices(0);var r=o.vec4.create(),i=o.mat4.create();o.mat4.translate(i,s.m4(),o.vec3.fromValues(-1,-1,0)),o.mat4.scale(i,i,o.vec3.fromValues(2/this._frameSize[0],2/this._frameSize[1],1));var n=o.vec2.sub(s.v2(),o.vec2.fromValues(this._frameSize[0],this._frameSize[1]),o.vec2.fromValues(r[3]+r[1],r[2]+r[0])),a=o.vec3.fromValues(.5*n[0],.5*n[1],0);o.vec3.add(a,a,o.vec3.fromValues(r[3],r[2],0)),o.mat4.translate(i,i,a),o.mat4.translate(i,i,o.vec3.fromValues(this._position[0],this._position[1],0));var f=o.vec2.fromValues(1,0),h=o.vec2.angle(f,this._direction);switch(f[0]*this._direction[1]-f[1]*this._direction[0]<0&&(h=-h),o.mat4.rotateZ(i,i,h),this._type){case c.Label.Type.Static:this.staticTransform=o.mat4.clone(i),this.dynamicTransform=s.m4();break;case c.Label.Type.Dynamic:this.staticTransform=s.m4(),this.dynamicTransform=o.mat4.clone(i)}if(this._altered.reset(),this._text.altered=!1,this._color.altered=!1,t){var d=this.vertices();return l.Typesetter.typeset(this,d),d}}},Object.defineProperty(t.prototype,"frameSize",{get:function(){return this._frameSize},set:function(e){o.vec2.equals(this._frameSize,e)||(o.vec2.max(this._frameSize,e,[1,1]),this._altered.alter(this._type))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){o.vec2.equals(this._position,e)||(this._position=o.vec2.clone(e),this._altered.alter(this._type))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){o.vec2.normalize(this._direction,e),this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSizeUnit",{get:function(){return this._fontSizeUnit},set:function(e){a.logIf(e!==c.Label.Unit.Pixel,a.LogLevel.Warning,"font size unit other than 'px' are not supported in position-2d-label, given "+e)},enumerable:!0,configurable:!0}),t.DEFAULT_FONTSIZE_PX=20,t}(c.Label);t.Position2DLabel=f},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=r(3),u=r(18),c=r(19),l=r(26),f=function(e){function t(r,i,n){var a=e.call(this,r,i,n)||this;return a._position=o.vec3.fromValues(0,0,0),a._direction=o.vec3.fromValues(1,0,0),a._up=o.vec3.fromValues(0,1,0),a._fontSize=t.DEFAULT_FONTSIZE_WORLD,a._fontSizeUnit=c.Label.Unit.World,a}return n(t,e),t.prototype.typeset=function(e){void 0===e&&(e=!1);var t=e||this._altered.typesetting||this._altered.static||this._altered.text||this.text.altered;if(t||this._altered.dynamic||e){if(!this.valid)return new u.GlyphVertices(0);var r=o.mat4.create();o.mat4.translate(r,s.m4(),this._position);var i=o.vec3.cross(s.v3(),this._direction,this._up),n=o.mat4.fromValues(this._direction[0],this._direction[1],this._direction[2],0,this._up[0],this._up[1],this._up[2],0,i[0],i[1],i[2],0,0,0,0,1);switch(o.mat4.mul(r,r,n),this._type){case c.Label.Type.Static:this.staticTransform=o.mat4.clone(r),this.dynamicTransform=s.m4();break;case c.Label.Type.Dynamic:this.staticTransform=s.m4(),this.dynamicTransform=o.mat4.clone(r)}if(this._altered.reset(),this._text.altered=!1,this._color.altered=!1,t){var a=this.vertices();return l.Typesetter.typeset(this,a),a}}},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=o.vec3.clone(e),this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){o.vec3.normalize(this._direction,e),this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return this._up},set:function(e){this._up=o.vec3.normalize(this._up,e),this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSizeUnit",{get:function(){return this._fontSizeUnit},set:function(e){a.logIf(e!==c.Label.Unit.World,a.LogLevel.Warning,"font size unit other than 'world' are not supported in position-3d-label, given "+e)},enumerable:!0,configurable:!0}),t.DEFAULT_FONTSIZE_WORLD=.05,t}(c.Label);t.Position3DLabel=f},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=r(3),u=r(18),c=r(19),l=r(26),f=function(e){function t(r,i,n){var a=e.call(this,r,i,n)||this;return a._position=o.vec3.fromValues(0,0,0),a._direction=o.vec2.fromValues(1,0),a._fontSize=t.DEFAULT_FONTSIZE_PX,a._fontSizeUnit=c.Label.Unit.Mixed,a}return n(t,e),t.prototype.typeset=function(e){void 0===e&&(e=!1);var t=e||this._altered.typesetting||this._altered.static||this._altered.text||this.text.altered;if(t||this._altered.dynamic||e){if(!this.valid||void 0===this._camera)return new u.GlyphVertices(0);var r=o.vec4.create(),i=o.mat4.create();o.mat4.translate(i,i,o.vec3.fromValues(-1,-1,0)),o.mat4.scale(i,i,o.vec3.fromValues(2/this._camera.viewport[0],2/this._camera.viewport[1],1)),o.mat4.scale(i,i,o.vec3.fromValues(1,1,1));var n=o.vec2.create();o.vec2.sub(n,o.vec2.fromValues(this._camera.viewport[0]/1,this._camera.viewport[1]/1),o.vec2.fromValues(r[3]+r[1],r[2]+r[0]));var f=o.vec3.fromValues(.5*n[0],.5*n[1],0);o.vec3.add(f,f,o.vec3.fromValues(r[3],r[2],0)),o.mat4.translate(i,i,f);var h=o.vec4.fromValues(this._position[0],this._position[1],this._position[2],1);o.vec4.transformMat4(h,h,this._camera.viewProjection);var d=o.mat4.create(),p=h[3];o.mat4.translate(d,d,o.vec3.fromValues(h[0]/p,h[1]/p,h[2]/p)),o.mat4.mul(i,d,i);var _=o.vec2.fromValues(1,0),v=o.vec2.angle(_,this._direction);switch(_[0]*this._direction[1]-_[1]*this._direction[0]<0&&(v=-v),o.mat4.rotateZ(i,i,v),this._camera.viewProjectionInverse?o.mat4.mul(i,this._camera.viewProjectionInverse,i):a.log(a.LogLevel.Warning,"camera.viewProjectionInverse is null"),this._type){case c.Label.Type.Static:this.staticTransform=o.mat4.clone(i),this.dynamicTransform=s.m4();break;case c.Label.Type.Dynamic:this.staticTransform=s.m4(),this.dynamicTransform=o.mat4.clone(i)}if(this._altered.reset(),this._text.altered=!1,this._color.altered=!1,t){var m=this.vertices();return l.Typesetter.typeset(this,m),m}}},Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(e){this._camera=e,this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=o.vec3.clone(e),this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){o.vec2.normalize(this._direction,e),this._altered.alter(this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fontSizeUnit",{get:function(){return this._fontSizeUnit},set:function(e){a.logIf(e!==c.Label.Unit.Mixed,a.LogLevel.Warning,"font size unit other than 'px' are not supported in projected-3d-label, given "+e)},enumerable:!0,configurable:!0}),t.DEFAULT_FONTSIZE_PX=20,t}(c.Label);t.Projected3DLabel=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._primitives=new Array}return Object.defineProperty(e.prototype,"primitives",{get:function(){return this._primitives},enumerable:!0,configurable:!0}),e.prototype.addPrimitive=function(e){this._primitives.push(e)},e}();t.GLTFMesh=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=r(1),u=r(25);!function(e){e[e.HAS_NORMALS=1]="HAS_NORMALS",e[e.HAS_TANGENTS=2]="HAS_TANGENTS",e[e.HAS_UV=4]="HAS_UV",e[e.HAS_COLORS=8]="HAS_COLORS",e[e.USE_IBL=16]="USE_IBL",e[e.HAS_BASECOLORMAP=32]="HAS_BASECOLORMAP",e[e.HAS_NORMALMAP=64]="HAS_NORMALMAP",e[e.HAS_EMISSIVEMAP=128]="HAS_EMISSIVEMAP",e[e.HAS_METALROUGHNESSMAP=256]="HAS_METALROUGHNESSMAP",e[e.HAS_OCCLUSIONMAP=512]="HAS_OCCLUSIONMAP",e[e.USE_TEX_LOD=1024]="USE_TEX_LOD"}(o=t.GLTFShaderFlags||(t.GLTFShaderFlags={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.MASK=1]="MASK",e[e.BLEND=2]="BLEND"}(a=t.GLTFAlphaMode||(t.GLTFAlphaMode={}));var c=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.baseColorTexCoord=0,i.metallicRoughnessTexCoord=0,i.normalTexCoord=0,i.occlusionTexCoord=0,i.emissiveTexCoord=0,i._alphaMode=a.OPAQUE,i._alphaCutoff=1,i._baseColorFactor=s.vec4.fromValues(1,1,1,1),i._metallicFactor=1,i._roughnessFactor=1,i._emissiveFactor=s.vec3.fromValues(0,0,0),i._isDoubleSided=!1,i._normalScale=1,i}return n(t,e),Object.defineProperty(t.prototype,"baseColorTexture",{get:function(){return this._baseColorTexture},set:function(e){this._baseColorTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metallicRoughnessTexture",{get:function(){return this._metallicRoughnessTexture},set:function(e){this._metallicRoughnessTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalTexture",{get:function(){return this._normalTexture},set:function(e){this._normalTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"occlusionTexture",{get:function(){return this._occlusionTexture},set:function(e){this._occlusionTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emissiveTexture",{get:function(){return this._emissiveTexture},set:function(e){this._emissiveTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emissiveFactor",{get:function(){return this._emissiveFactor},set:function(e){this._emissiveFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseColorFactor",{get:function(){return this._baseColorFactor},set:function(e){this._baseColorFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metallicFactor",{get:function(){return this._metallicFactor},set:function(e){this._metallicFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roughnessFactor",{get:function(){return this._roughnessFactor},set:function(e){this._roughnessFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"normalScale",{get:function(){return this._normalScale},set:function(e){this._normalScale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDoubleSided",{get:function(){return this._isDoubleSided},set:function(e){this._isDoubleSided=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(e){this._alphaMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaCutoff",{get:function(){return this._alphaCutoff},set:function(e){this._alphaCutoff=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){var e=0;return void 0!==this.baseColorTexture&&(e|=o.HAS_BASECOLORMAP),void 0!==this.metallicRoughnessTexture&&(e|=o.HAS_METALROUGHNESSMAP),void 0!==this.normalTexture&&(e|=o.HAS_NORMALMAP),void 0!==this.occlusionTexture&&(e|=o.HAS_OCCLUSIONMAP),void 0!==this.emissiveTexture&&(e|=o.HAS_EMISSIVEMAP),e},enumerable:!0,configurable:!0}),t}(u.Material);t.GLTFPbrMaterial=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(9);t.IndexBinding=function(){};t.VertexBinding=function(){};var a=function(e){function t(t,r,i,n,o,a,s){var u=e.call(this,t,s)||this;return u._bindings=r,u._indexBinding=i,u._material=o,u._geometryFlags=a,u._drawMode=n,u}return n(t,e),t.prototype.bindBuffers=function(){this._indexBinding&&this._indexBinding.buffer.bind();for(var e=0,t=this._bindings;e<t.length;e++){var r=t[e];r.buffer.attribEnable(r.attributeIndex,r.size,r.type,r.normalized,r.stride,r.offset,!0,!0)}},t.prototype.unbindBuffers=function(){this._indexBinding&&this._indexBinding.buffer.unbind();for(var e=0,t=this._bindings;e<t.length;e++){var r=t[e];r.buffer.attribDisable(r.attributeIndex,!0,!0)}},t.prototype.draw=function(){var e=this.context.gl;this._indexBinding?e.drawElements(this._drawMode,this._indexBinding.numIndices,this._indexBinding.type,this._indexBinding.offset):e.drawArrays(this._drawMode,0,this._bindings[0].numVertices)},Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flags",{get:function(){return this._geometryFlags},enumerable:!0,configurable:!0}),t}(o.Geometry);t.GLTFPrimitive=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(33),n=function(){function e(e,t){var r=this;this._altered=!1,this._eventHandler=new i.EventHandler(e,t),this._eventHandler.pushMouseEnterHandler(function(e,t){return r.onMouseEnter(e,t)}),this._eventHandler.pushMouseLeaveHandler(function(e,t){return r.onMouseLeave(e,t)})}return e.prototype.onMouseEnter=function(e,t){this._altered=!1},e.prototype.onMouseLeave=function(e,t){this._altered=!0},e.prototype.update=function(){this._eventHandler.update()},e.prototype.reset=function(){this._altered=!1},Object.defineProperty(e.prototype,"altered",{get:function(){return this._altered},enumerable:!0,configurable:!0}),e}();t.TestNavigation=n},function(e,t,r){r(80),e.exports=r(81)},function(e,t,r){"use strict";var i=this;void 0===String.prototype.repeat&&(String.prototype.repeat=function(e){if(null===this)throw new TypeError("can't convert "+this+" to object");var t=""+this;if((e=+e)!=e&&(e=0),e<0)throw new RangeError("repeat count must be non-negative");if(e===1/0)throw new RangeError("repeat count must be less than infinity");if(e=Math.floor(e),0===t.length||0===e)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var r="",i=0;i<e;i++)r+=t;return r}),void 0===String.prototype.startsWith&&(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),void 0===String.prototype.includes&&(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),void 0===String.prototype.trimLeft&&(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),void 0===String.prototype.trimRight&&(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),void 0===Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){for(var r=i.length,n=0;n<r;n++)n in i&&e.call(t,i[n],n,i)}),void 0===Array.prototype.fill&&(Array.prototype.fill=function(e,t,r){if(null===i)throw new TypeError("this is null or not defined");for(var n=Object(i),o=n.length>>>0,a=t>>0,s=a<0?Math.max(o+a,0):Math.min(a,o),u=void 0===r?o:r>>0,c=u<0?Math.max(o+u,0):Math.min(u,o);s<c;)n[s]=e,++s;return n}),void 0===Math.log10&&(Math.log10=function(e){return Math.log(e)*Math.LOG10E}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),[Float32Array,Uint8Array,Int8Array,Uint32Array,Int32Array].forEach(function(e){e.prototype.slice||Object.defineProperty(e.prototype,"slice",{value:Array.prototype.slice}),e.prototype.reduce||Object.defineProperty(e.prototype,"reduce",{value:Array.prototype.reduce}),e.prototype.filter||Object.defineProperty(e.prototype,"filter",{value:Array.prototype.filter}),e.prototype.map||Object.defineProperty(e.prototype,"map",{value:Array.prototype.map}),e.prototype.indexOf||Object.defineProperty(e.prototype,"indexOf",{value:Array.prototype.indexOf})}),void 0===Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(void 0===e&&null===e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},configurable:!0,writable:!0})},function(e,t,r){"use strict";function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r(40)),i(r(133));var n=r(47);t.properties=n;var o=r(34);t.fetch=o;var a=r(139);t.ray_math=a,i(r(140));var s=r(144),u=r(145);!function(e){e.EventBlocker=s.EventBlocker,e.Fullscreen=u.Fullscreen}(t.viewer||(t.viewer={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.branch="master",t.commit="50315b7a797981700de80b3eea844415c20e02fc",t.version="v0.7.1"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),n=r(0),o=function(){function e(){this._bytesByIdentifier=new Map,this._bytes=0,this._bytesSubject=new i.ReplaySubject(1)}return e.prototype.bytesNext=function(){this._bytesSubject.next([this._bytes,this.bytesToString()])},e.prototype.assertIdentifier=function(e){n.assert(this._bytesByIdentifier.has(e),"allocation identifier unknown")},e.prototype.createUniqueIdentifier=function(e){for(var t=e,r=2;this._bytesByIdentifier.has(t);)t=e+"-"+r,++r;return this._bytesByIdentifier.set(t,0),t},e.prototype.deleteUniqueIdentifier=function(e){n.assert(this._bytesByIdentifier.has(e),"identifier expected to be known for allocation registration"),this._bytesByIdentifier.delete(e)},e.prototype.allocate=function(e,t){if(this.assertIdentifier(e),n.assert(t>=0,"positive number of bytes expected for allocation, given "+t),0!==t){var r=this._bytesByIdentifier.get(e)+t;this._bytesByIdentifier.set(e,r),this._bytes=this._bytes+t,this.bytesNext()}},e.prototype.deallocate=function(e,t){this.assertIdentifier(e);var r=this._bytesByIdentifier.get(e);n.assert(t>=0,"positive number of bytes expected for deallocation, given "+t),n.assert(t<=r,"deallocation cannot exceed previous allocations of "+r+", given "+t),0!==t&&(this._bytesByIdentifier.set(e,r-t),this._bytes=this._bytes-t,this.bytesNext())},e.prototype.reallocate=function(e,t){this.assertIdentifier(e),n.assert(t>=0,"positive number of bytes expected for reallocation, given "+t);var r=this._bytesByIdentifier.get(e);r!==t&&(this._bytes=this._bytes-r,this._bytesByIdentifier.set(e,t),this._bytes=this._bytes+t,this.bytesNext())},e.prototype.allocated=function(e){return void 0===e?this._bytes:(this.assertIdentifier(e),this._bytesByIdentifier.get(e))},e.prototype.toString=function(){var e=new Array;return this._bytesByIdentifier.forEach(function(t,r){e.push(r+": "+n.prettyPrintBytes(t))}),e.join(", ")},e.prototype.bytesToString=function(e){return n.prettyPrintBytes(this.allocated(e))},Object.defineProperty(e.prototype,"bytes",{get:function(){return this._bytes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytes$",{get:function(){return this._bytesSubject.asObservable()},enumerable:!0,configurable:!0}),e}();t.AllocationRegister=o},function(e){e.exports=JSON.parse('[{"identifier":"chrome-63","backend":"webgl2","extensions_strive":["EXT_color_buffer_float","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context"]},{"identifier":"edge-41","backend":"webgl1","extensions_strive":["ANGLE_instanced_arrays","EXT_frag_depth","EXT_texture_filter_anisotropic","OES_texture_float","OES_texture_float_linear","OES_standard_derivatives","OES_element_index_uint","OES_texture_half_float","OES_texture_half_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info","WEBGL_depth_texture"]},{"identifier":"ie-11","backend":"webgl1","extensions_strive":["ANGLE_instanced_arrays","EXT_texture_filter_anisotropic","OES_texture_float","OES_texture_float_linear","OES_standard_derivatives","OES_element_index_uint","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info"]},{"identifier":"firefox-57","backend":"webgl2","extensions_strive":["EXT_color_buffer_float","EXT_texture_filter_anisotropic","EXT_disjoint_timer_query","OES_texture_float_linear","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info","WEBGL_debug_shaders","WEBGL_lose_context","MOZ_WEBGL_lose_context","MOZ_WEBGL_compressed_texture_s3tc"]},{"identifier":"safari-10.1","backend":"webgl1","extensions_strive":["compressed_texture_pvrtc","compressed_texture_s3tc","debug_renderer_info","disjoint_timer_query","draw_buffers","element_index_uint","frag_depth","instanced_arrays","lose_context","sRGB","shader_texture_lod","standard_derivatives","texture_filter_anisotropic","texture_float","texture_float_linear","texture_half_float","texture_half_float_linear","vertex_array_object"],"functions_undefine":["readBuffer"]},{"identifier":"no-WEBGL_draw_buffers","backend":"webgl1","extensions_conceal":["WEBGL_draw_buffers"]},{"identifier":"no-readBuffer","extensions_hash":"100000","functions_undefine":["readBuffer"]},{"identifier":"webgl1","extensions_hash":"1+++++"},{"identifier":"webgl2","extensions_hash":"2+++++"}]')},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(27),o=function(){function e(e){this.drawBuffers=void 0,i.assert(void 0!==e,"gl2 facade expects a valid WebGL context"),this.queryHalfFloatSupport(e),this.queryColorAttachments(e),this.queryInstancedArraySupport(e),this.queryDrawBuffersSupport(e),this.queryVertexArrayObjectSupport(e),this.queryMaxUniformVec3Components(e),this.queryBufferSubDataInterface(e),this.queryTexImageInterface(e)}return Object.defineProperty(e.prototype,"HALF_FLOAT",{get:function(){return this._halfFloat},enumerable:!0,configurable:!0}),e.prototype.queryHalfFloatSupport=function(e){switch(e.backend){case n.Context.BackendType.WebGL1:this._halfFloat=e.supportsTextureHalfFloat&&e.textureHalfFloat?e.textureHalfFloat.HALF_FLOAT_OES:void 0;break;case n.Context.BackendType.WebGL2:default:this._halfFloat=e.gl.HALF_FLOAT}},Object.defineProperty(e.prototype,"COLOR_ATTACHMENT_MIN",{get:function(){return this._colorAttachmentMin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT_MAX",{get:function(){return this._colorAttachmentMax},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT0",{get:function(){return this._colorAttachments[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT1",{get:function(){return this._colorAttachments[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT2",{get:function(){return this._colorAttachments[2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT3",{get:function(){return this._colorAttachments[3]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT4",{get:function(){return this._colorAttachments[4]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT5",{get:function(){return this._colorAttachments[5]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT6",{get:function(){return this._colorAttachments[6]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT7",{get:function(){return this._colorAttachments[7]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT8",{get:function(){return this._colorAttachments[8]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT9",{get:function(){return this._colorAttachments[9]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT10",{get:function(){return this._colorAttachments[10]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT11",{get:function(){return this._colorAttachments[11]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT12",{get:function(){return this._colorAttachments[12]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT13",{get:function(){return this._colorAttachments[13]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT14",{get:function(){return this._colorAttachments[14]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"COLOR_ATTACHMENT15",{get:function(){return this._colorAttachments[15]},enumerable:!0,configurable:!0}),e.prototype.queryColorAttachments=function(e){var t=e.gl;switch(this._colorAttachments=new Array(16),this._colorAttachments[0]=t.COLOR_ATTACHMENT0,e.backend){case n.Context.BackendType.WebGL1:var r=e.supportsDrawBuffers?e.drawBuffers:void 0;if(this._colorAttachmentMin=this._colorAttachments[0],this._colorAttachmentMax=this._colorAttachmentMin+(r?t.getParameter(r.MAX_COLOR_ATTACHMENTS_WEBGL):0),this._colorAttachments[0]=r?r.COLOR_ATTACHMENT0_WEBGL:t.COLOR_ATTACHMENT0,!r)break;for(var i=1;i<16;++i)this._colorAttachments[i]=r.COLOR_ATTACHMENT0_WEBGL+i;break;case n.Context.BackendType.WebGL2:default:for(this._colorAttachmentMin=e.gl.COLOR_ATTACHMENT0,this._colorAttachmentMax=e.gl.COLOR_ATTACHMENT0+t.getParameter(t.MAX_COLOR_ATTACHMENTS),i=0;i<16;++i)this._colorAttachments[i]=t.COLOR_ATTACHMENT0+i}},e.prototype.queryInstancedArraySupport=function(e){(e.isWebGL2||e.supportsInstancedArrays)&&(this.drawArraysInstanced=e.isWebGL2?function(t,r,i,n){return e.gl.drawArraysInstanced(t,r,i,n)}:function(t,r,i,n){return e.instancedArrays.drawArraysInstancedANGLE(t,r,i,n)},this.drawElementsInstanced=e.isWebGL2?function(t,r,i,n,o){return e.gl.drawElementsInstanced(t,r,i,n,o)}:function(t,r,i,n,o){return e.instancedArrays.drawElementsInstancedANGLE(t,r,i,n,o)},this.vertexAttribDivisor=e.isWebGL2?function(t,r){return e.gl.vertexAttribDivisor(t,r)}:function(t,r){return e.instancedArrays.vertexAttribDivisorANGLE(t,r)})},Object.defineProperty(e.prototype,"MAX_DRAW_BUFFERS",{get:function(){return this._maxDrawBuffers},enumerable:!0,configurable:!0}),e.prototype.queryDrawBuffersSupport=function(e){(e.isWebGL2||e.supportsDrawBuffers)&&(this.drawBuffers=e.isWebGL2?function(t){return e.gl.drawBuffers(t)}:function(t){return e.drawBuffers.drawBuffersWEBGL(t)},this._maxDrawBuffers=e.isWebGL2?e.gl.MAX_DRAW_BUFFERS:e.drawBuffers.MAX_DRAW_BUFFERS_WEBGL)},e.prototype.queryVertexArrayObjectSupport=function(e){(e.isWebGL2||e.supportsVertexArrayObject)&&(this.createVertexArray=e.isWebGL2?function(){return e.gl.createVertexArray()}:function(){return e.vertexArrayObject.createVertexArrayOES()},this.deleteVertexArray=e.isWebGL2?function(t){return e.gl.deleteVertexArray(t)}:function(t){return e.vertexArrayObject.deleteVertexArrayOES(t)},this.isVertexArray=e.isWebGL2?function(t){return e.gl.isVertexArray(t)}:function(t){return e.vertexArrayObject.isVertexArrayOES(t)},this.bindVertexArray=e.isWebGL2?function(t){return e.gl.bindVertexArray(t)}:function(t){return e.vertexArrayObject.bindVertexArrayOES(t)})},Object.defineProperty(e.prototype,"maxUniformVec3Components",{get:function(){return this._maxUniformVec3Components},enumerable:!0,configurable:!0}),e.prototype.queryMaxUniformVec3Components=function(e){var t=e.gl;this._maxUniformVec3Components=e.isWebGL2?t.getParameter(t.MAX_VERTEX_UNIFORM_COMPONENTS):3*t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)},e.prototype.queryBufferSubDataInterface=function(e){var t=e.gl;e.isWebGL2?this.bufferSubData=function(e,r,i,n,o){return void 0===o&&(o=0),t.bufferSubData(e,r,i,n,o)}:this.bufferSubData=function(e,r,n,o,a){return void 0===o&&(o=0),void 0===a&&(a=0),i.logIf(0!==o,i.LogLevel.Warning,"srcOffset ignored (not supported in WebGL)"),i.logIf(0!==a,i.LogLevel.Warning,"length ignored (not supported in WebGL)"),t.bufferSubData(e,r,n)}},e.prototype.queryTexImageInterface=function(e){var t=e.gl;e.isWebGL2?this.texImage2D=function(e,r,n,o,a,s,u,c,l,f){return l instanceof ArrayBuffer?t.texImage2D(e,r,n,o,a,s,u,c,void 0===l?null:l,f):(i.assert(void 0===f,"offset expected to be undefined for non ArrayBuffer source"),t.texImage2D(e,r,n,o,a,s,u,c,void 0===l?null:l))}:this.texImage2D=function(e,r,i,n,o,a,s,u,c,l){return void 0===c?t.texImage2D(e,r,i,n,o,a,s,u,null):c instanceof Int8Array||c instanceof Uint8Array||c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array||c instanceof DataView?t.texImage2D(e,r,i,n,o,a,s,u,c):t.texImage2D(e,r,i,s,u,c)},e.supportsTexImage3D?this.texImage3D=function(e,r,n,o,a,s,u,c,l,f,h){return f instanceof ArrayBuffer?t.texImage3D(e,r,n,o,a,s,u,c,l,void 0===f?null:f,h):(i.assert(void 0===h,"offset expected to be undefined for non ArrayBuffer source"),t.texImage3D(e,r,n,o,a,s,u,c,l,void 0===f?null:f))}:this.texImage3D=function(e,t,r,n,o,a,s,u,c,l,f){return i.assert(!1,"texImage3D not supported on this context")}},e}();t.GL2Facade=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),a=r(1),s=r(3),u=r(0),c=r(13),l=r(21),f=r(27),h=r(43),d=r(29),p=r(30),_=r(31),v=r(87),m=r(32),b=r(14),g=function(e){function t(r,i){var n=e.call(this)||this;n._framePrecisionSubject=new o.ReplaySubject(1),n._size=[0,0],n._sizeSubject=new o.ReplaySubject(1),n._frameScaleSubject=new o.ReplaySubject(1),n._frameSizeSubject=new o.ReplaySubject(1),n._element=r instanceof HTMLCanvasElement?r:document.getElementById(r),n._element.addEventListener("webglcontextcreationerror",function(e){console.log(e.statusMessage||"Unknown error")},!1),n.observe(n._element),n._mouseEventProvider=new p.MouseEventProvider(n._element,200),n._touchEventProvider=new m.TouchEventProvider(n._element,200),n._pointerEventProvider=new _.PointerEventProvider(n._element,200),n._element.style.touchAction="none";var a,h=n._element.dataset;n._context=f.Context.request(n._element,i),n.configureController(h),n.configureSizeAndScale(h),n.configureContextLostAndRestore(),n.configureContextLostAndRestoreEmulation(),h.clearColor&&(a=s.parseVec4(h.clearColor),u.logIf(void 0===a,u.LogLevel.Warning,"data-clear-color could not be parsed, given '"+h.clearColor+"'")),n._clearColor=a?new l.Color(c.tuple4(a)):t.DEFAULT_CLEAR_COLOR;var d=h.accumulationFormat?h.accumulationFormat:t.DEFAULT_FRAME_PRECISION;return d in b.Wizard.Precision||(d=t.DEFAULT_FRAME_PRECISION,u.log(u.LogLevel.Warning,"unknown frame precision '"+h.accumulationFormat+"' changed to '"+d+"'")),n._framePrecision=d,n.framePrecisionNext(),n}return n(t,e),t.prototype.configureController=function(e){var r,i;this._controller=new h.Controller,this._controller.block(),e.multiFrameNumber&&(r=parseInt(e.multiFrameNumber,10),u.logIf(isNaN(r),u.LogLevel.Warning,"data-multi-frame-number could not be parsed, given '"+e.multiFrameNumber+"'")),e.debugFrameNumber&&(i=parseInt(e.debugFrameNumber,10),u.logIf(isNaN(i),u.LogLevel.Warning,"data-debug-frame-number could not be parsed, given '"+e.debugFrameNumber+"'")),this._controller.multiFrameNumber=r||t.DEFAULT_MULTI_FRAME_NUMBER,this._controller.debugFrameNumber=i||0;var n=!!r&&r!==this._controller.multiFrameNumber;u.logIf(n,u.LogLevel.Warning,"data-multi-frame-number changed to "+this._controller.multiFrameNumber+", given '"+e.multiFrameNumber+"'");var o=!!i&&i!==this._controller.debugFrameNumber;u.logIf(o,u.LogLevel.Warning,"data-debug-frame-number changed to "+this._controller.debugFrameNumber+", given '"+e.debugFrameNumber+"'")},t.prototype.configureSizeAndScale=function(e){var t,r;e.frameScale&&(t=s.parseVec2(e.frameScale),u.logIf(void 0!==e.frameScale&&void 0===t,u.LogLevel.Warning,"data-frame-scale could not be parsed, given '"+e.frameScale+"'")),this._frameScale=t?c.tuple2(t):[1,1],e.frameSize&&(r=s.parseVec2(e.frameSize),u.logIf(void 0!==e.frameSize&&void 0===r,u.LogLevel.Warning,"data-frame-size could not be parsed, given '"+e.frameSize+"'")),this._favorSizeOverScale=void 0!==r,this._frameSize=r?c.tuple2(r):[this._size[0],this._size[1]],this.onResize()},t.prototype.configureContextLostAndRestore=function(){var e=this;this._element.addEventListener("webglcontextlost",function(t){t.preventDefault(),e.onContextLost()},!1),this._element.addEventListener("webglcontextrestored",function(t){e.onContextRestore()},!1)},t.prototype.configureContextLostAndRestoreEmulation=function(){this._lostContextExtension=this._context.gl.getExtension("WEBGL_lose_context")},t.prototype.onContextLost=function(){u.log(u.LogLevel.Warning,"WebGL Context lost. Discarding renderer..."),this._controller.cancel(),this._controller.block(),this._renderer&&this._renderer.discard()},t.prototype.onContextRestore=function(){u.log(u.LogLevel.Warning,"WebGL Context restored. Reinitializing renderer...");var e=this._renderer;this.unbind(),this.bind(e),this._controller.unblock();var t=this._element.style.visibility;this._element.style.visibility="hidden",this._element.offsetHeight,this._element.style.visibility=t},t.prototype.retrieveSize=function(){var e=v.Resizable.elementSize(this._element);void 0!==e?(this._size=[e[0],e[1]],this.sizeNext()):this._size=[0,0]},t.prototype.onResize=function(){if(this.retrieveSize(),0===this._size[0]||0===this._size[1])return u.log(u.LogLevel.Debug,"canvas width or height is invalid, resize discarded and controller blocked"),void this._controller.block();this._element.width=this._size[0],this._element.height=this._size[1],this._renderer&&this._controller.block(),this._favorSizeOverScale?this.frameSize=this._frameSize:this.frameScale=this._frameScale,this._renderer&&(this._controller.unblock(),this._renderer.swap())},t.prototype.framePrecisionNext=function(){this._framePrecisionSubject.next(this._framePrecision)},t.prototype.sizeNext=function(){this._sizeSubject.next(this._size)},t.prototype.frameScaleNext=function(){this._frameScaleSubject.next(this._frameScale)},t.prototype.frameSizeNext=function(){this._frameSizeSubject.next(this._frameSize)},t.prototype.bind=function(e){var t=this;this._renderer!==e&&(this.unbind(),void 0!==e&&(u.assert(this._controller.blocked,"expected controller to be blocked"),this._renderer=e,this._renderer.initialize(this.context,function(e){return t._controller.update(e)},{pointerEventProvider:this._pointerEventProvider,mouseEventProvider:this._mouseEventProvider,eyeGazeEventProvider:this._eyeGazeEventProvider}),this._renderer.frameSize=this._frameSize,this._renderer.clearColor=this._clearColor.rgba,this._renderer.framePrecision=this._framePrecision,this._renderer.debugTexture=-1,this._controller.controllable=this._renderer,this._controller.unblock()))},t.prototype.unbind=function(){void 0!==this._renderer&&(this._controller.block(),this._controller.controllable=void 0,this._renderer=void 0)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._renderer&&(this._renderer.uninitialize(),this.unbind())},t.prototype.resize=function(){this.onResize()},Object.defineProperty(t.prototype,"controller",{get:function(){return this._controller},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},set:function(e){this.bind(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameScale",{get:function(){return this._frameScale},set:function(e){if(isFinite(e[0])&&isFinite(e[1])){u.logIf(e[0]<0||e[0]>2,u.LogLevel.Info,"frame width scale clamped to [0.0,2.0], given "+e[0]),u.logIf(e[1]<0||e[1]>2,u.LogLevel.Info,"frame height scale clamped to [0.0,2.0], given "+e[0]);var t=a.vec2.create();s.clamp2(t,e,[0,0],[2,2]);var r=a.vec2.create();a.vec2.mul(r,this._size,t),a.vec2.max(r,[1,1],r),a.vec2.round(r,r),a.vec2.div(t,r,this._size),u.logIf(!a.vec2.exactEquals(t,e),2,"frame scale was adjusted to "+t.toString()+", given "+e.toString()),this._frameScale=c.tuple2(t),this._frameSize=c.tuple2(r),this._favorSizeOverScale=!1,this.frameScaleNext(),this.frameSizeNext(),this._renderer&&(this._renderer.frameSize=this._frameSize)}else u.log(u.LogLevel.Warning,"expected finite frame size, non-finite values ignored, given ["+e+"]")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameScale$",{get:function(){return this._frameScaleSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameSize",{get:function(){return this._frameSize},set:function(e){if(isFinite(e[0])&&isFinite(e[1])){u.logIf(e[0]<1||e[0]>this._size[0],u.LogLevel.Info,"frame width scale clamped to [1,"+this._size[0]+"], given "+e[0]),u.logIf(e[1]<1||e[1]>this._size[1],u.LogLevel.Info,"frame height scale clamped to [1, "+this._size[1]+"], given "+e[1]);var t=a.vec2.create();s.clamp2(t,e,[1,1],this._size),a.vec2.round(t,t),u.logIf(!a.vec2.exactEquals(t,e),u.LogLevel.Warning,"frame size was adjusted to "+t.toString()+", given "+e.toString());var r=a.vec2.create();a.vec2.div(r,t,this._size),this._frameScale=c.tuple2(r),this._frameSize=c.tuple2(t),this._favorSizeOverScale=!a.vec2.exactEquals(this._frameSize,this._size),this.frameScaleNext(),this.frameSizeNext(),this._renderer&&(this._renderer.frameSize=this._frameSize)}else u.log(u.LogLevel.Warning,"expected finite frame size, non-finite values ignored, given ["+e+"]")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameSize$",{get:function(){return this._frameSizeSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearColor",{get:function(){return this._clearColor},set:function(e){this._clearColor=e,this._renderer&&(this._renderer.clearColor=this._clearColor.rgba)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framePrecision",{get:function(){return this._framePrecision},set:function(e){this._framePrecision=e,this._renderer&&(this._renderer.framePrecision=this._framePrecision,this._framePrecision=this._renderer.framePrecision),this.framePrecisionNext()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"framePrecision$",{get:function(){return this._framePrecisionSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backend",{get:function(){return this._context.backendString},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size$",{get:function(){return this._sizeSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._size[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._size[1]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mouseEventProvider",{get:function(){return this._mouseEventProvider},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchEventProvider",{get:function(){return this._touchEventProvider},enumerable:!0,configurable:!0}),t.prototype.testLoseContext=function(){void 0!==this._lostContextExtension&&this._lostContextExtension.loseContext()},t.prototype.testRestoreContext=function(){void 0!==this._lostContextExtension&&this._lostContextExtension.restoreContext()},Object.defineProperty(t.prototype,"eyeGazeEventProvider",{get:function(){return this._eyeGazeEventProvider},enumerable:!0,configurable:!0}),t.prototype.activateEyeGazeEventProvider=function(e,t){this._eyeGazeEventProvider=new d.EyeGazeEventProvider(e,t)},t.DEFAULT_CLEAR_COLOR=new l.Color([.203,.227,.25,1]),t.DEFAULT_FRAME_PRECISION=b.Wizard.Precision.auto,t.DEFAULT_MULTI_FRAME_NUMBER=0,t}(v.Resizable);t.Canvas=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){var t=this;if(this._resizeEventListener=function(){return e.resize()},this._mutationEventListener=function(){t._mutationObserver.takeRecords(),e.resize()},0===e.instances.length){var r="on"+e.EVENT_IDENTIFIER;e.eventSupported=document&&(r in document.documentElement||r in document.body),i.logIf(!e.eventSupported,i.LogLevel.Warning,"resize event not supported")}0===e.instances.length&&e.eventSupported&&window.addEventListener(e.EVENT_IDENTIFIER,this._resizeEventListener),e.instances.push(this)}return e.resize=function(){i.assert(e.instances.length>0,"resize event received without a single resizable registered"),e.instances.forEach(function(e){return e.onResize()})},e.elementSize=function(e){if(void 0===e||void 0===window||"number"!=typeof window.devicePixelRatio)return[0,0];var t=window.devicePixelRatio,r=getComputedStyle(e);if(null!==r.width&&r.width.endsWith("px")&&null!==r.height&&r.height.endsWith("px")){var n=[parseFloat(r.width),parseFloat(r.height)];return[Math.round(n[0]*t),Math.round(n[1]*t)]}i.log(i.LogLevel.Debug,"computed element size expected in 'px', given "+r.width+" "+r.height)},e.prototype.observe=function(t){void 0!==t&&(this._mutationObserver=new MutationObserver(this._mutationEventListener)),this._mutationObserver.observe(t,e.MUTATION_OBSERVER_CONFIG)},e.prototype.dispose=function(){var t=e.instances.indexOf(this);i.assert(-1!==t,"invalid reference counting of resizable instances"),e.instances.splice(t,1),0===e.instances.length&&e.eventSupported&&window.removeEventListener(e.EVENT_IDENTIFIER,this._resizeEventListener),this._mutationObserver&&this._mutationObserver.disconnect()},e.EVENT_IDENTIFIER="resize",e.instances=[],e.eventSupported=!1,e.MUTATION_OBSERVER_CONFIG={attributes:!0,attributeFilter:["style","class"],childList:!0,subtree:!0},e}();t.Resizable=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),n=r(0),o=r(21),a=r(34),s=function(){function e(){this._hint=e.InterpolationHint.Linear,this._colors=new Array,this._inverted=!1}return e.stride=function(t){switch(t){default:case e.ArrayType.RGB:case e.ArrayType.RGBf:return 3;case e.ArrayType.RGBA:case e.ArrayType.RGBAf:return 4}},e.fromPreset=function(t,r,i){return a.fetchJsonAsync(t,function(t){for(var n,o=0,a=t;o<a.length;o++){var s=a[o];if(s.identifier===r){n=s;break}}if(void 0!==n){for(var u=n.format,c=e.stride(u),l=n.colors,f=l.length-1,h=0;h<l.length;++h)if(l[h].length===i*c){f=h;break}var d,p=l[f],_=n.positions;if(void 0===_)return e.fromArray(p,u,i,void 0);for(h=0;h<_.length;++h)_[h].length===p.length&&(d=_[h]);return e.fromArray(p,u,i,d)}},e.SCHEMA.properties)},e.fromArray=function(t,r,i,a){if(0===i||0===t.length)return new e;for(var s=t,u=e.stride(r),c=s.length/u,l=new Array(c),f=0;f<s.length;f+=u){var h=new o.Color;switch(r){case e.ArrayType.RGB:h.fromUI8(s[f+0],s[f+1],s[f+2]);break;case e.ArrayType.RGBA:h.fromUI8(s[f+0],s[f+1],s[f+2],s[f+3]);break;case e.ArrayType.RGBf:h.fromF32(s[f+0],s[f+1],s[f+2]);break;case e.ArrayType.RGBAf:h.fromF32(s[f+0],s[f+1],s[f+2],s[f+3])}l[f/u]=h}var d=new e;if(void 0===a&&i===c)return d._colors=l,d;if(1===i&&d._colors.push(l[0]),void 0===a)for((a=new Array(c))[0]=0,f=1;f<c;++f)a[f]=f/(c-1);n.assert(a.length===l.length,"expected number of positions ("+a.length+") to match number of colors ("+l.length+")");var p=0,_=p+1,v=c-1;for(f=0;f<i;++f){var m=0===f?0:f/(i-1);if(m<=a[p])d._colors.push(l[p]);else if(a[v]<=m)d._colors.push(l[v]);else{for(var b=p+1;b<c;++b)if(!(a[b]<m)){_=b,p=b-1;break}var g=(m-a[p])/(a[_]-a[p]);d._colors.push(o.Color.lerp(l[p],l[_],g,o.Color.Space.LAB))}}return d},e.prototype.lerp=function(t,r){if(void 0===r&&(r=o.Color.Space.LAB),0!==this._colors.length){if(1===this._colors.length)return this._colors[0];var a=i.clamp(t,0,1);if(a<=0)return this._colors[0];if(a>=1)return this._colors[this._colors.length-1];var s=t*this._colors.length,u=Math.floor(s),c=u+1;return c>=this._colors.length?this._colors[this._colors.length-1]:(n.assert(c<this._colors.length,"expected upper not exceed maximum color index: "+c+" < "+this._colors.length),this._hint===e.InterpolationHint.Nearest?this._colors[s-u<=c-s?u:c]:o.Color.lerp(this._colors[u],this._colors[c],s-u,r))}},e.prototype.color=function(e){if(!(e<0||e>=this._colors.length))return this._colors[e]},Object.defineProperty(e.prototype,"colors",{get:function(){return this._colors},set:function(e){this._colors=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hint",{get:function(){return this._hint},set:function(e){this._hint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._colors.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inverted",{get:function(){return this._inverted},enumerable:!0,configurable:!0}),e.prototype.invert=function(){this._colors.reverse(),this._inverted=!this._inverted},e.prototype.bitsUI8=function(e,t){void 0===e&&(e=o.Color.Space.RGB),void 0===t&&(t=!0);for(var r=this._colors.length,i=t?4:3,n=new Uint8Array(r*i),a=0;a<r;++a){var s=this._colors[a].tuple(e,t);n[a*i+0]=255*s[0],n[a*i+1]=255*s[1],n[a*i+2]=255*s[2],t&&4===s.length&&(n[a*i+3]=255*s[3])}return n},e.prototype.bitsF32=function(e,t){void 0===e&&(e=o.Color.Space.RGB),void 0===t&&(t=!0);for(var r=this._colors.length,i=t?4:3,n=new Float32Array(r*i),a=0;a<r;++a){var s=this._colors[a].tuple(e,t);n[a*i+0]=s[0],n[a*i+1]=s[1],n[a*i+2]=s[2],t&&4===s.length&&(n[a*i+3]=s[3])}return n},e.SCHEMA=r(99),e}();t.ColorScale=s,function(e){!function(e){e.Linear="linear",e.Nearest="nearest"}(e.InterpolationHint||(e.InterpolationHint={})),function(e){e.sequential="sequential",e.diverging="diverging",e.qualitative="qualitative"}(e.ScaleType||(e.ScaleType={})),function(e){e.RGB="rgb",e.RGBf="rgbf",e.RGBA="rgba",e.RGBAf="rgbaf"}(e.ArrayType||(e.ArrayType={}))}(s=t.ColorScale||(t.ColorScale={})),t.ColorScale=s},function(e,t,r){"use strict";var i=e.exports.Validator=r(90);e.exports.ValidatorResult=r(16).ValidatorResult,e.exports.ValidationError=r(16).ValidationError,e.exports.SchemaError=r(16).SchemaError,e.exports.SchemaScanResult=r(36).SchemaScanResult,e.exports.scan=r(36).scan,e.exports.validate=function(e,t,r){return(new i).validate(e,t,r)}},function(e,t,r){"use strict";var i=r(35),n=r(98),o=r(16),a=r(36).scan,s=o.ValidatorResult,u=o.SchemaError,c=o.SchemaContext,l=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(h),this.attributes=Object.create(n.validators)};function f(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}l.prototype.customFormats={},l.prototype.schemas=null,l.prototype.types=null,l.prototype.attributes=null,l.prototype.unresolvedRefs=null,l.prototype.addSchema=function(e,t){var r=this;if(!e)return null;var i=a(t||"/",e),n=t||e.id;for(var o in i.id)this.schemas[o]=i.id[o];for(var o in i.ref)this.unresolvedRefs.push(o);return this.unresolvedRefs=this.unresolvedRefs.filter(function(e){return void 0===r.schemas[e]}),this.schemas[n]},l.prototype.addSubSchemaArray=function(e,t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},l.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var r in t)this.addSubSchema(e,t[r])},l.prototype.setSchemas=function(e){this.schemas=e},l.prototype.getSchema=function(e){return this.schemas[e]},l.prototype.validate=function(e,t,r,n){r||(r={});var o=r.propertyName||"instance",s=i.resolve(r.base||"/",t.id||"");if(!n){(n=new c(t,r,o,s,Object.create(this.schemas))).schemas[s]||(n.schemas[s]=t);var l=a(s,t);for(var f in l.id){var h=l.id[f];n.schemas[f]=h}}if(t){var d=this.validateSchema(e,t,r,n);if(!d)throw new Error("Result undefined");return d}throw new u("no schema specified",t)},l.prototype.validateSchema=function(e,t,r,i){var a,l=new s(e,t,r,i);if("boolean"==typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(Array.isArray(t.extends)){var h={schema:t,ctx:i};t.extends.forEach(this.schemaTraverser.bind(this,h)),t=h.schema,h.schema=null,h.ctx=null,h=null}else t=o.deepMerge(t,this.superResolve(t.extends,i));if(a=f(t)){var d=this.resolve(t,a,i),p=new c(d.subschema,r,i.propertyPath,d.switchSchema,i.schemas);return this.validateSchema(e,d.subschema,r,p)}var _=r&&r.skipAttributes||[];for(var v in t)if(!n.ignoreProperties[v]&&_.indexOf(v)<0){var m=null,b=this.attributes[v];if(b)m=b.call(this,e,t,r,i);else if(!1===r.allowUnknownAttributes)throw new u("Unsupported attribute: "+v,t);m&&l.importErrors(m)}if("function"==typeof r.rewrite){var g=r.rewrite.call(this,e,t,r,i);l.instance=g}return l},l.prototype.schemaTraverser=function(e,t){e.schema=o.deepMerge(e.schema,this.superResolve(t,e.ctx))},l.prototype.superResolve=function(e,t){var r;return(r=f(e))?this.resolve(e,r,t).subschema:e},l.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var n=i.parse(t),a=n&&n.hash,s=a&&a.length&&t.substr(0,t.length-a.length);if(!s||!r.schemas[s])throw new u("no such schema <"+t+">",e);var c=o.objectGetPath(r.schemas[s],a.substr(1));if(void 0===c)throw new u("no such schema "+a+" located in <"+s+">",e);return{subschema:c,switchSchema:t}},l.prototype.testType=function(e,t,r,i,n){if("function"==typeof this.types[n])return this.types[n].call(this,e);if(n&&"object"==typeof n){var o=this.validateSchema(e,n,r,i);return void 0===o||!(o&&o.errors.length)}return!0};var h=l.prototype.types={};h.string=function(e){return"string"==typeof e},h.number=function(e){return"number"==typeof e&&isFinite(e)},h.integer=function(e){return"number"==typeof e&&e%1==0},h.boolean=function(e){return"boolean"==typeof e},h.array=function(e){return Array.isArray(e)},h.null=function(e){return null===e},h.date=function(e){return e instanceof Date},h.any=function(e){return!0},h.object=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date)},e.exports=l},function(e,t,r){(function(e,i){var n;!function(o){t&&t.nodeType,e&&e.nodeType;var a="object"==typeof i&&i;a.global!==a&&a.window!==a&&a.self;var s,u=2147483647,c=/^xn--/,l=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},d=Math.floor,p=String.fromCharCode;function _(e){throw new RangeError(h[e])}function v(e,t){for(var r=e.length,i=[];r--;)i[r]=t(e[r]);return i}function m(e,t){var r=e.split("@"),i="";return r.length>1&&(i=r[0]+"@",e=r[1]),i+v((e=e.replace(f,".")).split("."),t).join(".")}function b(e){for(var t,r,i=[],n=0,o=e.length;n<o;)(t=e.charCodeAt(n++))>=55296&&t<=56319&&n<o?56320==(64512&(r=e.charCodeAt(n++)))?i.push(((1023&t)<<10)+(1023&r)+65536):(i.push(t),n--):i.push(t);return i}function g(e){return v(e,function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+p(e)}).join("")}function y(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function E(e,t,r){var i=0;for(e=r?d(e/700):e>>1,e+=d(e/t);e>455;i+=36)e=d(e/35);return d(i+36*e/(e+38))}function x(e){var t,r,i,n,o,a,s,c,l,f,h,p=[],v=e.length,m=0,b=128,y=72;for((r=e.lastIndexOf("-"))<0&&(r=0),i=0;i<r;++i)e.charCodeAt(i)>=128&&_("not-basic"),p.push(e.charCodeAt(i));for(n=r>0?r+1:0;n<v;){for(o=m,a=1,s=36;n>=v&&_("invalid-input"),((c=(h=e.charCodeAt(n++))-48<10?h-22:h-65<26?h-65:h-97<26?h-97:36)>=36||c>d((u-m)/a))&&_("overflow"),m+=c*a,!(c<(l=s<=y?1:s>=y+26?26:s-y));s+=36)a>d(u/(f=36-l))&&_("overflow"),a*=f;y=E(m-o,t=p.length+1,0==o),d(m/t)>u-b&&_("overflow"),b+=d(m/t),m%=t,p.splice(m++,0,b)}return g(p)}function T(e){var t,r,i,n,o,a,s,c,l,f,h,v,m,g,x,T=[];for(v=(e=b(e)).length,t=128,r=0,o=72,a=0;a<v;++a)(h=e[a])<128&&T.push(p(h));for(i=n=T.length,n&&T.push("-");i<v;){for(s=u,a=0;a<v;++a)(h=e[a])>=t&&h<s&&(s=h);for(s-t>d((u-r)/(m=i+1))&&_("overflow"),r+=(s-t)*m,t=s,a=0;a<v;++a)if((h=e[a])<t&&++r>u&&_("overflow"),h==t){for(c=r,l=36;!(c<(f=l<=o?1:l>=o+26?26:l-o));l+=36)x=c-f,g=36-f,T.push(p(y(f+x%g,0))),c=d(x/g);T.push(p(y(c,0))),o=E(r,m,i==n),r=0,++i}++r,++t}return T.join("")}s={version:"1.4.1",ucs2:{decode:b,encode:g},decode:x,encode:T,toASCII:function(e){return m(e,function(e){return l.test(e)?"xn--"+T(e):e})},toUnicode:function(e){return m(e,function(e){return c.test(e)?x(e.slice(4).toLowerCase()):e})}},void 0===(n=function(){return s}.call(t,r,t,e))||(e.exports=n)}()}).call(this,r(92)(e),r(93))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,r){"use strict";t.decode=t.parse=r(96),t.encode=t.stringify=r(97)},function(e,t,r){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,o){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var s=/\+/g;e=e.split(t);var u=1e3;o&&"number"==typeof o.maxKeys&&(u=o.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var f,h,d,p,_=e[l].replace(s,"%20"),v=_.indexOf(r);v>=0?(f=_.substr(0,v),h=_.substr(v+1)):(f=_,h=""),d=decodeURIComponent(f),p=decodeURIComponent(h),i(a,d)?n(a[d])?a[d].push(p):a[d]=[a[d],p]:a[d]=p}return a};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,r){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,s){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?o(a(e),function(a){var s=encodeURIComponent(i(a))+r;return n(e[a])?o(e[a],function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[a]))}).join(t):s?encodeURIComponent(i(s))+r+encodeURIComponent(i(e)):""};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var r=[],i=0;i<e.length;i++)r.push(t(e[i],i));return r}var a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},function(e,t,r){"use strict";var i=r(16),n=i.ValidatorResult,o=i.SchemaError,a={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,exclusiveMinimum:!0,exclusiveMaximum:!0,additionalItems:!0,$schema:!0,$ref:!0,extends:!0}},s=a.validators={};function u(e,t,r,i,n){var o=t.throwError;t.throwError=!1;var a=this.validateSchema(e,n,t,r);return t.throwError=o,!a.valid&&i instanceof Function&&i(a),a.valid}function c(e,t,r,i,n,o){if(this.types.object(e)&&(!t.properties||void 0===t.properties[n]))if(!1===t.additionalProperties)o.addError({name:"additionalProperties",argument:n,message:"additionalProperty "+JSON.stringify(n)+" exists in instance when not allowed"});else{var a=t.additionalProperties||{};"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,n,a,r,i);var s=this.validateSchema(e[n],a,r,i.makeChild(a,n));s.instance!==o.instance[n]&&(o.instance[n]=s.instance),o.importErrors(s)}}s.type=function(e,t,r,i){if(void 0===e)return null;var o=new n(e,t,r,i),a=Array.isArray(t.type)?t.type:[t.type];if(!a.some(this.testType.bind(this,e,t,r,i))){var s=a.map(function(e){return e.id&&"<"+e.id+">"||e+""});o.addError({name:"type",argument:s,message:"is not of a type(s) "+s})}return o},s.anyOf=function(e,t,r,i){if(void 0===e)return null;var a=new n(e,t,r,i),s=new n(e,t,r,i);if(!Array.isArray(t.anyOf))throw new o("anyOf must be an array");if(!t.anyOf.some(u.bind(this,e,r,i,function(e){s.importErrors(e)}))){var c=t.anyOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});r.nestedErrors&&a.importErrors(s),a.addError({name:"anyOf",argument:c,message:"is not any of "+c.join(",")})}return a},s.allOf=function(e,t,r,i){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new o("allOf must be an array");var a=new n(e,t,r,i),s=this;return t.allOf.forEach(function(t,n){var o=s.validateSchema(e,t,r,i);if(!o.valid){var u=t.id&&"<"+t.id+">"||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+n+"]";a.addError({name:"allOf",argument:{id:u,length:o.errors.length,valid:o},message:"does not match allOf schema "+u+" with "+o.errors.length+" error[s]:"}),a.importErrors(o)}}),a},s.oneOf=function(e,t,r,i){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new o("oneOf must be an array");var a=new n(e,t,r,i),s=new n(e,t,r,i),c=t.oneOf.filter(u.bind(this,e,r,i,function(e){s.importErrors(e)})).length,l=t.oneOf.map(function(e,t){return e.id&&"<"+e.id+">"||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"});return 1!==c&&(r.nestedErrors&&a.importErrors(s),a.addError({name:"oneOf",argument:l,message:"is not exactly one from "+l.join(",")})),a},s.properties=function(e,t,r,i){if(this.types.object(e)){var o=new n(e,t,r,i),a=t.properties||{};for(var s in a){"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,s,a[s],r,i);var u=Object.hasOwnProperty.call(e,s)?e[s]:void 0,c=this.validateSchema(u,a[s],r,i.makeChild(a[s],s));c.instance!==o.instance[s]&&(o.instance[s]=c.instance),o.importErrors(c)}return o}},s.patternProperties=function(e,t,r,i){if(this.types.object(e)){var o=new n(e,t,r,i),a=t.patternProperties||{};for(var s in e){var u=!0;for(var l in a)if(new RegExp(l).test(s)){u=!1,"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,s,a[l],r,i);var f=this.validateSchema(e[s],a[l],r,i.makeChild(a[l],s));f.instance!==o.instance[s]&&(o.instance[s]=f.instance),o.importErrors(f)}u&&c.call(this,e,t,r,i,s,o)}return o}},s.additionalProperties=function(e,t,r,i){if(this.types.object(e)){if(t.patternProperties)return null;var o=new n(e,t,r,i);for(var a in e)c.call(this,e,t,r,i,a,o);return o}},s.minProperties=function(e,t,r,i){if(this.types.object(e)){var o=new n(e,t,r,i);return Object.keys(e).length>=t.minProperties||o.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),o}},s.maxProperties=function(e,t,r,i){if(this.types.object(e)){var o=new n(e,t,r,i);return Object.keys(e).length<=t.maxProperties||o.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),o}},s.items=function(e,t,r,i){var o=this;if(this.types.array(e)&&t.items){var a=new n(e,t,r,i);return e.every(function(e,n){var s=Array.isArray(t.items)?t.items[n]||t.additionalItems:t.items;if(void 0===s)return!0;if(!1===s)return a.addError({name:"items",message:"additionalItems not permitted"}),!1;var u=o.validateSchema(e,s,r,i.makeChild(s,n));return u.instance!==a.instance[n]&&(a.instance[n]=u.instance),a.importErrors(u),!0}),a}},s.minimum=function(e,t,r,i){if(this.types.number(e)){var o=new n(e,t,r,i);return(t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum:e>=t.minimum)||o.addError({name:"minimum",argument:t.minimum,message:"must have a minimum value of "+t.minimum}),o}},s.maximum=function(e,t,r,i){if(this.types.number(e)){var o=new n(e,t,r,i);return(t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum:e<=t.maximum)||o.addError({name:"maximum",argument:t.maximum,message:"must have a maximum value of "+t.maximum}),o}};var l=function(e,t,r,a,s,u){if(this.types.number(e)){var c=t[s];if(0==c)throw new o(s+" cannot be zero");var l=new n(e,t,r,a),f=i.getDecimalPlaces(e),h=i.getDecimalPlaces(c),d=Math.max(f,h),p=Math.pow(10,d);return Math.round(e*p)%Math.round(c*p)!=0&&l.addError({name:s,argument:c,message:u+JSON.stringify(c)}),l}};function f(e,t,r){var n,o=r.length;for(n=t+1;n<o;n++)if(i.deepCompareStrict(e,r[n]))return!1;return!0}s.multipleOf=function(e,t,r,i){return l.call(this,e,t,r,i,"multipleOf","is not a multiple of (divisible by) ")},s.divisibleBy=function(e,t,r,i){return l.call(this,e,t,r,i,"divisibleBy","is not divisible by (multiple of) ")},s.required=function(e,t,r,i){var o=new n(e,t,r,i);return void 0===e&&!0===t.required?o.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach(function(t){void 0===e[t]&&o.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})}),o},s.pattern=function(e,t,r,i){if(this.types.string(e)){var o=new n(e,t,r,i);return e.match(t.pattern)||o.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern.toString())}),o}},s.format=function(e,t,r,o){if(void 0!==e){var a=new n(e,t,r,o);return a.disableFormat||i.isFormat(e,t.format,this)||a.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),a}},s.minLength=function(e,t,r,i){if(this.types.string(e)){var o=new n(e,t,r,i),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)>=t.minLength||o.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),o}},s.maxLength=function(e,t,r,i){if(this.types.string(e)){var o=new n(e,t,r,i),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)<=t.maxLength||o.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),o}},s.minItems=function(e,t,r,i){if(this.types.array(e)){var o=new n(e,t,r,i);return e.length>=t.minItems||o.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),o}},s.maxItems=function(e,t,r,i){if(this.types.array(e)){var o=new n(e,t,r,i);return e.length<=t.maxItems||o.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),o}},s.uniqueItems=function(e,t,r,o){if(this.types.array(e)){var a=new n(e,t,r,o);return e.every(function(e,t,r){for(var n=t+1;n<r.length;n++)if(i.deepCompareStrict(e,r[n]))return!1;return!0})||a.addError({name:"uniqueItems",message:"contains duplicate item"}),a}},s.uniqueItems=function(e,t,r,i){if(this.types.array(e)){var o=new n(e,t,r,i);return e.every(f)||o.addError({name:"uniqueItems",message:"contains duplicate item"}),o}},s.dependencies=function(e,t,r,i){if(this.types.object(e)){var o=new n(e,t,r,i);for(var a in t.dependencies)if(void 0!==e[a]){var s=t.dependencies[a],u=i.makeChild(s,a);if("string"==typeof s&&(s=[s]),Array.isArray(s))s.forEach(function(t){void 0===e[t]&&o.addError({name:"dependencies",argument:u.propertyPath,message:"property "+t+" not found, required by "+u.propertyPath})});else{var c=this.validateSchema(e,s,r,u);o.instance!==c.instance&&(o.instance=c.instance),c&&c.errors.length&&(o.addError({name:"dependencies",argument:u.propertyPath,message:"does not meet dependency required by "+u.propertyPath}),o.importErrors(c))}}return o}},s.enum=function(e,t,r,a){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new o("enum expects an array",t);var s=new n(e,t,r,a);return t.enum.some(i.deepCompareStrict.bind(null,e))||s.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),s},s.const=function(e,t,r,o){if(void 0===e)return null;var a=new n(e,t,r,o);return i.deepCompareStrict(t.const,e)||a.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),a},s.not=s.disallow=function(e,t,r,i){var o=this;if(void 0===e)return null;var a=new n(e,t,r,i),s=t.not||t.disallow;return s?(Array.isArray(s)||(s=[s]),s.forEach(function(n){if(o.testType(e,t,r,i,n)){var s=n&&n.id&&"<"+n.id+">"||n;a.addError({name:"not",argument:s,message:"is of prohibited type "+s})}}),a):null},e.exports=a},function(e){e.exports=JSON.parse('{"id":"/ColorScalePresets","title":"Color Scale Presets Schema","description":"JSON schema for a color scale presets data, used in the webgl-operate module for validation.","type":"array","items":{"type":"object","properties":{"identifier":{"type":"string"},"type":{"type":"string","enum":["sequential","diverging","qualitative"]},"format":{"type":"string","enum":["rgb","rgbf"]},"colors":{"type":"array","items":{"type":"array","items":{"type":["integer","number"]}}},"positions":{"type":"array","items":{"type":"array","items":{"type":["integer","number"]}}}},"required":["identifier","format","colors"],"additionalProperties":false}}')},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(20),u=r(2),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._width=0,t._height=0,t._depth=0,t._internalFormat=0,t._format=0,t._type=0,t}return n(t,e),t.prototype.create=function(e,r,i,n,o,s){a.assert(this._context.supportsTexImage3D,"expected texImage3D to be supported"),a.assert(e>0&&r>0&&i>0,"texture requires valid width, height, and depth of greater than zero");var u=this._context.gl,c=this._context.gl2facade;return this._object=u.createTexture(),this._width=e,this._height=r,this._depth=i,this._internalFormat=n,this._format=o,this._type=s,u.bindTexture(u.TEXTURE_3D,this._object),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_R,u.CLAMP_TO_EDGE),c.texImage3D(u.TEXTURE_3D,0,this._internalFormat,this._width,this._height,this._depth,0,this._format,this._type),u.bindTexture(u.TEXTURE_3D,t.DEFAULT_TEXTURE),this._valid=u.isTexture(this._object),this.reallocate(),this._object},t.prototype.delete=function(){a.assert(this._object instanceof WebGLTexture,"expected WebGLTexture object"),this._context.gl.deleteTexture(this._object),this._object=void 0,this._valid=!1,this._internalFormat=0,this._format=0,this._type=0,this._width=0,this._height=0,this._depth=0},t.prototype.reallocate=function(){var e=this.context.gl,t=this._context.gl2facade,r=this._width*this._height*this._depth*s.byteSizeOfFormat(this.context,this._internalFormat);this._type===t.HALF_FLOAT&&this._internalFormat!==e.RGBA16F?r*=2:this._type===e.FLOAT&&this._internalFormat!==e.RGBA16F&&(r*=4),this.context.allocationRegister.reallocate(this._identifier,r)},t.prototype.bind=function(e){var t=this.context.gl;e&&t.activeTexture(e),t.bindTexture(t.TEXTURE_3D,this._object)},t.prototype.unbind=function(e){var r=this.context.gl;e&&r.activeTexture(e),r.bindTexture(r.TEXTURE_3D,t.DEFAULT_TEXTURE)},t.prototype.load=function(e,t,r){return void 0===r&&(r=!1),a.assert(!1,"not implemented"),new Promise(function(){return!0})},t.prototype.data=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0);var i=this.context.gl,n=this._context.gl2facade;t&&this.bind(),n.texImage3D(i.TEXTURE_3D,0,this._internalFormat,this._width,this._height,this._depth,0,this._format,this._type,e),r&&this.unbind(),this.reallocate()},t.prototype.filter=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0);var n=this.context.gl;r&&this.bind(),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,t),i&&this.unbind()},t.prototype.wrap=function(e,t,r,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0);var o=this.context.gl;i&&this.bind(),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,t),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,r),n&&this.unbind()},t.prototype.reformat=function(e,t,r,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),(e!==this._internalFormat||void 0!==t&&t!==this._format||void 0!==r&&r!==this._type)&&(a.assert(void 0!==e,"valid internal format expected"),this._internalFormat=e,t&&(this._format=t),r&&(this._type=r),this.data(void 0,i,n))},t.prototype.resize=function(e,t,r,i,n){void 0===i&&(i=!0),void 0===n&&(n=!0),e===this._width&&t===this._height&&r===this._depth||(this._width=e,this._height=t,this._depth=r,this.data(void 0,i,n))},Object.defineProperty(t.prototype,"bytes",{get:function(){return this.assertInitialized(),this.context.allocationRegister.allocated(this._identifier)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"internalFormat",{get:function(){return this.assertInitialized(),this._internalFormat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"format",{get:function(){return this.assertInitialized(),this._format},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.assertInitialized(),this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.assertInitialized(),this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.assertInitialized(),this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depth",{get:function(){return this.assertInitialized(),this._depth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.assertInitialized(),[this._width,this._height,this._depth]},enumerable:!0,configurable:!0}),t.DEFAULT_TEXTURE=void 0,o([u.Initializable.assert_initialized()],t.prototype,"bind",null),o([u.Initializable.assert_initialized()],t.prototype,"unbind",null),o([u.Initializable.assert_initialized()],t.prototype,"load",null),o([u.Initializable.assert_initialized()],t.prototype,"data",null),o([u.Initializable.assert_initialized()],t.prototype,"filter",null),o([u.Initializable.assert_initialized()],t.prototype,"wrap",null),o([u.Initializable.assert_initialized()],t.prototype,"reformat",null),o([u.Initializable.assert_initialized()],t.prototype,"resize",null),t}(r(8).AbstractObject);t.Texture3D=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(5),s=r(2),u=function(e){function t(t,r,i,n,o){void 0===n&&(n=0);var s=e.call(this)||this;return s._updates=new Array,s._cpuBuffer=new ArrayBuffer(r),s._gpuBuffer=new a.Buffer(t,o),s._usage=i,s._mergeThreshold=n,s}return n(t,e),t.updatesNeedMerge=function(e,t,r){return t.begin-e.end<r||-1===r},t.prototype.mergeUpdatesLeft=function(e){for(var r=0,i=this._updates[e],n=e-1;n>=0;n--){var o=this._updates[n];if(!t.updatesNeedMerge(o,i,this._mergeThreshold))break;i.begin=Math.min(i.begin,o.begin),i.end=Math.max(i.end,o.end),r++}return this._updates.splice(e-r,r),r+1},t.prototype.mergeUpdatesRight=function(e){for(var r=0,i=this._updates[e],n=e+1;n<this._updates.length;n++){var o=this._updates[n];if(!t.updatesNeedMerge(i,o,this._mergeThreshold))break;i.begin=Math.min(i.begin,o.begin),i.end=Math.max(i.end,o.end),r++}return this._updates.splice(e+1,r),r+1},t.prototype.addUpdate=function(e){var t=this._updates.findIndex(function(t){return e.begin<t.begin});-1===t?(this._updates.push(e),this.mergeUpdatesLeft(this._updates.length-1)):(this._updates.splice(t,0,e),this.mergeUpdatesRight(t),this.mergeUpdatesLeft(t))},t.prototype.initialize=function(e){return this._gpuBuffer.initialize(e)},t.prototype.uninitialize=function(){this._gpuBuffer.uninitialize()},t.prototype.bind=function(){this._gpuBuffer.bind()},t.prototype.unbind=function(){this._gpuBuffer.unbind()},t.prototype.attribEnable=function(e,t,r,i,n,o,a,s){void 0===i&&(i=!1),void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=!0),void 0===s&&(s=!0),this._gpuBuffer.attribEnable(e,t,r,i,n,o,a,s)},t.prototype.attribDisable=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),this._gpuBuffer.attribDisable(e,t,r)},t.prototype.mergeSubDataRanges=function(){for(var e=0;e<this._updates.length;)e+=this.mergeUpdatesRight(e)},t.prototype.subData=function(e,t){var r;r=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer).subarray(t.byteOffset,t.byteOffset+t.byteLength),new Uint8Array(this._cpuBuffer).set(r,e),this.addUpdate({begin:e,end:e+r.byteLength})},t.prototype.update=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),e&&this._gpuBuffer.bind(),this._gpuBuffer.bytes!==this._cpuBuffer.byteLength)this._gpuBuffer.data(this._cpuBuffer,this._usage);else for(var r=new Uint8Array(this._cpuBuffer),i=0,n=this._updates;i<n.length;i++){var o=n[i],a=r.subarray(o.begin,o.end);this._gpuBuffer.subData(o.begin,a)}t&&this._gpuBuffer.unbind(),this._updates.length=0},Object.defineProperty(t.prototype,"size",{get:function(){return this._cpuBuffer.byteLength},set:function(e){var t=this._cpuBuffer;this._cpuBuffer=new ArrayBuffer(e);var r=new Uint8Array(t).slice(0,e);new Uint8Array(this._cpuBuffer).set(r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){return this.assertInitialized(),this._gpuBuffer.target},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usage",{get:function(){return this._usage},set:function(e){this._usage=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeThreshold",{get:function(){return this._mergeThreshold},set:function(e){this._mergeThreshold=e},enumerable:!0,configurable:!0}),o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([s.Initializable.assert_initialized()],t.prototype,"bind",null),o([s.Initializable.assert_initialized()],t.prototype,"unbind",null),o([s.Initializable.assert_initialized()],t.prototype,"attribEnable",null),o([s.Initializable.assert_initialized()],t.prototype,"attribDisable",null),o([s.Initializable.assert_initialized()],t.prototype,"update",null),t}(s.Initializable);t.UnifiedBuffer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(3),o=r(0),a=function(){function e(){this._tileSize=[0,0],this._padding=i.vec4.fromValues(0,0,0,0),this._tile=-1,this._algorithm=e.Algorithm.ScanLine,this._offset=[0,0]}return e.hilbertIndices=function(e,t,r,i,n,o,a,s,u,c,l){if(c>0)return l=this.hilbertIndices(e,t,r,i,n,s/2,u/2,o/2,a/2,c-1,l),l=this.hilbertIndices(e,t,r,i+o/2,n+a/2,o/2,a/2,s/2,u/2,c-1,l),l=this.hilbertIndices(e,t,r,i+o/2+s/2,n+a/2+u/2,o/2,a/2,s/2,u/2,c-1,l),this.hilbertIndices(e,t,r,i+o/2+s,n+a/2+u,-s/2,-u/2,-o/2,-a/2,c-1,l);if(n+=(a+u-1)/2,(i+=(o+s-1)/2)<t&&n<r){var f=2*l;e[f+0]=i,e[f+1]=n,++l}return l},e.generateHilbertIndices=function(e,t,r){o.assert(e.length===2*t*r,"expected interleaved indices-array of length "+2*t*r+", given "+e.length);var i=Math.max(t,r),n=Math.ceil(Math.log2(i)),a=o.upperPowerOfTwo(i);this.hilbertIndices(e,t,r,0,0,a,0,0,a,n,0)},e.generateScanLineIndices=function(e,t,r){o.assert(e.length===2*t*r,"expected interleaved indices-array of length "+2*t*r+", given "+e.length);for(var i=0;i<r;++i)for(var n=0;n<t;++n){var a=2*(n+i*t);e[a+0]=n,e[a+1]=i}},e.generateZCurveIndices=function(e,t,r){o.assert(e.length===2*t*r,"expected interleaved indices-array of length "+2*t*r+", given "+e.length);for(var i=Math.max(t,r),n=2*Math.floor(Math.log2(i)),a=0,s=0;s<t*r;++a){for(var u=0,c=0,l=0;l<n;++l)u+=(a>>2*l&1)<<l,c+=(a>>2*l+1&1)<<l;if(u<t&&c<r){var f=2*s;e[f+0]=u,e[f+1]=c,++s}}},e.prototype.invalidate=function(e){e&&(this._indices=new Uint16Array(0)),this._valid=!1},e.prototype.ensureValidIterationIndices=function(){if(!(this._indices.length>0))switch(this._indices=new Uint16Array(2*this.numTiles),this._algorithm){case e.Algorithm.ScanLine:e.generateScanLineIndices(this._indices,this.numXTiles,this.numYTiles);break;case e.Algorithm.HilbertCurve:e.generateHilbertIndices(this._indices,this.numXTiles,this.numYTiles);break;case e.Algorithm.ZCurve:e.generateZCurveIndices(this._indices,this.numXTiles,this.numYTiles);break;default:e.generateScanLineIndices(this._indices,this.numXTiles,this.numYTiles)}},e.prototype.tableIndices=function(){this.ensureValidIterationIndices();var e=2*this.tile;return[this._indices[e+0],this._indices[e+1]]},e.prototype.getPaddedTileSize=function(){return[this.padding[1]+this.padding[3]+this.tileSize[0],this.padding[0]+this.padding[2]+this.tileSize[1]]},e.prototype.nextTile=function(){return!(this.tile>=this.numTiles-1||(this.tile<0&&(this.tile=-1),++this.tile,this.update(),0))},e.prototype.hasNextTile=function(){return this.tile<=this.numTiles-1&&this.tile>=0},e.prototype.reset=function(){this.tile=-1,this._offset[0]=0,this._offset[1]=0},e.prototype.sourceCameraChanged=function(){o.assert(void 0!==this._sourceCamera,"expected the unput/source camera to be defined"),this._camera=Object.create(this._sourceCamera)},e.prototype.update=function(){if(this._valid)return this._offset;if(this.numTiles<=this.tile||0>this.tile)return o.log(o.LogLevel.Warning,"index "+this.tile+" is out of bounds "+this.numTiles+", returning first tile"),this._offset;o.assert(void 0!==this._sourceViewport&&void 0!==this._sourceCamera,"expected source camera and source viewport to be defined before updating"),this._valid=!0;var e=this.tableIndices(),t=this.sourceViewport,r=this.getPaddedTileSize(),a=[0,0];a[0]=e[0]*this.tileSize[0]+r[0]/2,a[1]=e[1]*this.tileSize[1]+r[1]/2;var s=[0,0];s[0]=e[0]*this.tileSize[0],s[1]=e[1]*this.tileSize[1];var u=[2*a[0]/t[0]-1,2*a[1]/t[1]-1],c=i.vec3.fromValues(t[0]/r[0],t[1]/r[1],1),l=i.vec3.fromValues(-u[0],-u[1],0),f=i.mat4.scale(n.m4(),i.mat4.identity(n.m4()),c),h=i.mat4.translate(n.m4(),f,l);return this._camera.postViewProjection=h,this._offset=s,s},Object.defineProperty(e.prototype,"valid",{get:function(){return void 0!==this._camera&&void 0!==this._sourceCamera&&this._valid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numXTiles",{get:function(){return o.assert(void 0!==this._sourceViewport,"expected the source viewport to be defined"),Math.ceil(this.sourceViewport[0]/this.tileSize[0])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numYTiles",{get:function(){return o.assert(void 0!==this._sourceViewport,"expected the source viewport to be defined"),Math.ceil(this.sourceViewport[1]/this.tileSize[1])},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numTiles",{get:function(){return this.numXTiles*this.numYTiles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get:function(){return[this.offset[0],this.offset[1],this.tileSize[0],this.tileSize[1]]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceCamera",{get:function(){return this._sourceCamera},set:function(e){void 0!==e?(this._sourceCamera=e,this._camera=Object.create(e),this.invalidate(!1)):this._sourceCamera=this._camera=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tile",{get:function(){return this._tile},set:function(e){this._tile!==e&&(this._tile=e,this.invalidate(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sourceViewport",{get:function(){return this._sourceViewport},set:function(e){void 0!==this._sourceViewport&&void 0!==e&&this._sourceViewport[0]===e[0]&&this._sourceViewport[1]===e[1]||(this._sourceViewport=e,this.invalidate(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileSize",{get:function(){return this._tileSize},set:function(e){this._tileSize[0]===e[0]&&this._tileSize[1]===e[1]||(this._tileSize=e,this.invalidate(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(e){i.vec4.equals(this._padding,e)||(this._padding=i.vec4.clone(e),this.invalidate(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"algorithm",{get:function(){return this._algorithm},set:function(e){this._algorithm!==e&&(this._algorithm=e,this.invalidate(!0))},enumerable:!0,configurable:!0}),e}();t.TileCameraGenerator=a,function(e){!function(e){e.ScanLine="scanline",e.HilbertCurve="hilbertcurve",e.ZCurve="zcurve"}(e.Algorithm||(e.Algorithm={}))}(a=t.TileCameraGenerator||(t.TileCameraGenerator={})),t.TileCameraGenerator=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),n=r(33),o=r(22),a=r(0),s=r(53),u=r(54),c=r(55),l=r(56),f=r(57),h=r(40),d=r(58),p=function(){function e(t,r){var i=this;this._alwaysRotateOnMove=!1,this._invalidate=t,this._eventHandler=new n.EventHandler(t,r),this._eventHandler.pushPointerDownHandler(function(e,t){return i.onPointerDown(e,t)}),this._eventHandler.pushPointerUpHandler(function(e,t){return i.onPointerUp(e,t)}),this._eventHandler.pushPointerEnterHandler(function(e,t){return i.onPointerEnter(e,t)}),this._eventHandler.pushPointerLeaveHandler(function(e,t){return i.onPointerLeave(e,t)}),this._eventHandler.pushPointerMoveHandler(function(e,t){return i.onPointerMove(e,t)}),this._eventHandler.pushPointerCancelHandler(function(e,t){return i.onPointerCancel(e,t)}),this._eventHandler.pushMouseWheelHandler(function(e,t){return i.onWheel(e,t)}),this.rotationMetaphor=e.RotationMetaphor.Turntable,this._pan=new u.PanModifier,this._pinch=new c.PinchZoomModifier,this._wheelZoom=new d.WheelZoomModifier,this._activeEvents=new Map}return e.prototype.mode=function(){var t=Array.from(this._activeEvents.values()),r=this.getPrimaryEvent(t);if(void 0!==r){var i="mouse"===r.pointerType,n="touch"===r.pointerType||"pen"===r.pointerType,s=1&r.buttons,u=r.shiftKey,c=o.PointerLock.active()&&this._alwaysRotateOnMove,l=this._activeEvents.size,f=i&&s&&1===l,d=n&&1===l,p=i&&s&&u&&1===l,_=n&&2===l;return c?e.Modes.Rotate:p?e.Modes.Pan:_?e.Modes.MultiTouch:f||d?e.Modes.Rotate:void 0}h.auxiliaries.log(a.LogLevel.Warning,"No primary pointer event detected in Navigation::mode.")},e.prototype.resolveMultiTouch=function(){if(!(this._activeEvents.size<2)){var t=Array.from(this._activeEvents.values()),r=i.vec2.fromValues(t[0].movementX,t[0].movementY),n=i.vec2.fromValues(t[1].movementX,t[1].movementY);return 0===i.vec2.length(r)||0===i.vec2.length(n)?e.Modes.Zoom:(i.vec2.normalize(r,r),i.vec2.normalize(n,n),i.vec2.dot(r,n)>.2?e.Modes.Pan:e.Modes.Zoom)}h.auxiliaries.log(a.LogLevel.Warning,"MultiTouch resolution was canceled because less than two touches were detected.")},e.prototype.rotate=function(t){if(1===this._activeEvents.size){var r=Array.from(this._activeEvents.values()),n=this._eventHandler.offsets(r[0])[0];switch(this._rotationMetaphor){case e.RotationMetaphor.FirstPerson:var s=this._firstPerson,u=void 0;o.PointerLock.active()&&event instanceof MouseEvent&&(u=i.vec2.fromValues(event.movementX,event.movementY)),t?s.initiate(n):s.process(n,u);break;case e.RotationMetaphor.Trackball:var c=this._trackball;t?c.initiate(n):c.process(n);break;case e.RotationMetaphor.Turntable:var l=this._turntable;t?l.initiate(n):l.process(n)}}else h.auxiliaries.log(a.LogLevel.Info,"Rotate event was canceled because less or more than two pointers were detected.")},e.prototype.pan=function(e){var t=Array.from(this._activeEvents.values()),r=this.getPrimaryEvent(t);if(void 0!==r){var i=this._eventHandler.offsets(r)[0],n=this._pan;e?n.initiate(i):n.process(i)}else h.auxiliaries.log(a.LogLevel.Warning,"Pan event was canceled because no primary event was detected.")},e.prototype.pinch=function(e){if(2===this._activeEvents.size){var t=Array.from(this._activeEvents.values()),r=this._eventHandler.offsets(t[0])[0],i=this._eventHandler.offsets(t[1])[0],n=this._pinch;e?n.initiate(r,i):n.process(r,i)}else h.auxiliaries.log(a.LogLevel.Info,"Pinch event was canceled because less or more than two pointers were detected.")},e.prototype.getPrimaryEvent=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];if(i.isPrimary)return i}},e.prototype.onPointerDown=function(t,r){for(var i=0,n=t;i<n.length;i++){var o=n[i];this._activeEvents.set(o.pointerId,o)}switch(this._mode=this.mode(),this._mode){case e.Modes.Rotate:this.rotate(!0);break;case e.Modes.Pan:this.pan(!0);break;case e.Modes.Zoom:this.pinch(!0)}},e.prototype.onPointerUp=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];this._activeEvents.delete(n.pointerId)}},e.prototype.onPointerEnter=function(e,t){},e.prototype.onPointerLeave=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];this._activeEvents.delete(n.pointerId)}},e.prototype.onPointerCancel=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];this._activeEvents.delete(n.pointerId)}},e.prototype.onPointerMove=function(t,r){for(var i=0,n=t;i<n.length;i++){var o=n[i];this._activeEvents.set(o.pointerId,o)}if(void 0!==this._mode){var a=Array.from(this._activeEvents.values()),s=this.getPrimaryEvent(a);"mouse"===(null==s?void 0:s.pointerType)&&(this._mode=this.mode());var u=!1;switch(this._mode===e.Modes.MultiTouch&&(this._mode=this.resolveMultiTouch(),u=!0),this._mode){case e.Modes.Rotate:this.rotate(u);break;case e.Modes.Pan:this.pan(u);break;case e.Modes.Zoom:this.pinch(u)}this._lastInteractionTime=performance.now()}},e.prototype.onWheel=function(e,t){var r,i=e[0];null===(r=this._wheelZoom)||void 0===r||r.process(i.deltaY)},e.prototype.update=function(){this._eventHandler.update()},Object.defineProperty(e.prototype,"camera",{set:function(e){this._camera=e,this._firstPerson&&(this._firstPerson.camera=e),this._trackball&&(this._trackball.camera=e),this._turntable&&(this._turntable.camera=e),this._pan&&(this._pan.camera=e),this._pinch&&(this._pinch.camera=e),this._wheelZoom&&(this._wheelZoom.camera=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationMetaphor",{get:function(){return this._rotationMetaphor},set:function(t){if(this._rotationMetaphor!==t){switch(this._firstPerson=void 0,this._trackball=void 0,this._turntable=void 0,this._eventHandler.exitPointerLock(),this._alwaysRotateOnMove=!1,this._rotationMetaphor=t,this._rotationMetaphor){case e.RotationMetaphor.FirstPerson:this._eventHandler.requestPointerLock(),this._alwaysRotateOnMove=!0,this._firstPerson=new s.FirstPersonModifier,this._firstPerson.camera=this._camera;break;case e.RotationMetaphor.Trackball:this._trackball=new l.TrackballModifier,this._trackball.camera=this._camera;break;case e.RotationMetaphor.Turntable:this._turntable=new f.TurntableModifier,this._turntable.camera=this._camera}this._invalidate(!0)}},enumerable:!0,configurable:!0}),e}();t.Navigation=p,function(e){!function(e){e[e.Move=0]="Move",e[e.Pan=1]="Pan",e[e.MultiTouch=2]="MultiTouch",e[e.Rotate=3]="Rotate",e[e.Zoom=4]="Zoom",e[e.ZoomStep=5]="ZoomStep"}(e.Modes||(e.Modes={})),function(e){e.FirstPerson="firstperson",e.Flight="flight",e.Trackball="trackball",e.Turntable="turntable"}(e.RotationMetaphor||(e.RotationMetaphor={}))}(p=t.Navigation||(t.Navigation={})),t.Navigation=p},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(5),s=r(9),u=r(2),c=function(e){function t(t,r){var i=e.call(this,t,r)||this;r=void 0!==r&&""!==r?r:i.constructor.name;var n=new a.Buffer(t,r+"VBO");return i._buffers.push(n),i}return n(t,e),t.prototype.bindBuffers=function(){this._buffers[0].attribEnable(this._vertexLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1)},t.prototype.unbindBuffers=function(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0)},t.prototype.initialize=function(r){void 0===r&&(r=0),this._vertexLocation=r;var i=this.context.gl,n=e.prototype.initialize.call(this,[i.ARRAY_BUFFER]);return this._buffers[0].data(t.VERTICES,i.STATIC_DRAW),n},t.prototype.draw=function(){var e=this.context.gl;e.drawArrays(e.TRIANGLE_STRIP,0,4)},Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),t.VERTICES=new Float32Array([-1,-1,1,-1,-1,1,1,1]),o([u.Initializable.assert_initialized()],t.prototype,"draw",null),t}(s.Geometry);t.NdcFillingRectangle=c},function(e){e.exports=JSON.parse('{"kernel":[[[[0.201114,0.016597],[-0.090682,-0.219471],[-0.180852,0.162495],[0.055216,0.398563],[-0.41692,-0.073573],[0.291284,-0.365369],[0.437182,0.252665],[-0.32675,-0.455539]]]],"size":{"depth":1,"height":1,"width":8}}')},function(e){e.exports=JSON.parse('{"kernel":[[[[-0.058976,0.021042],[0.065636,-0.034686],[0.023064,0.111212],[-0.011378,-0.124856],[-0.122834,-0.069128],[0.155806,0.055484],[-0.170432,0.07677],[-0.101548,0.16694],[0.190248,-0.090414],[0.121364,-0.180584],[0.100078,0.201382],[-0.080262,-0.215026],[-0.247446,-0.0134],[-0.024534,0.25711],[-0.204874,-0.159298],[0.267262,-0.000244],[0.22469,0.145654],[0.031194,-0.270754],[-0.213004,0.222668],[-0.303174,0.132498],[0.245976,-0.236312],[-0.13599,0.312838],[0.177092,0.291552],[-0.157276,-0.305196],[0.31486,-0.146142],[0.04435,0.34728],[-0.337616,-0.10357],[-0.04582,-0.360924],[0.168962,-0.326482],[0.357432,0.089926],[-0.372058,0.042328],[-0.281888,-0.249468],[0.301704,0.235824],[-0.067106,0.403008],[0.40503,-0.055972],[0.078792,-0.416652],[-0.350772,0.278396],[-0.4065,-0.19374],[-0.260602,0.368566],[-0.449072,-0.047842],[-0.22616,-0.395366],[0.13452,0.43745],[0.259132,0.381722],[0.426316,0.180096],[-0.114704,-0.451094],[-0.427786,0.188226],[0.370588,-0.29204],[0.280418,-0.38221],[0.482044,0.034198],[0.447602,-0.20187],[0.009908,0.493178],[-0.358902,-0.339638],[-0.191718,0.458736],[-0.49667,0.098056],[0.391874,0.325994],[0.211534,-0.47238],[-0.483514,-0.28391],[-0.462228,0.334124],[-0.393344,0.424294],[0.336146,0.471892],[-0.31633,-0.485536],[0.41316,-0.437938],[-0.440942,-0.429808],[0.460758,0.416164]]]],"size":{"depth":1,"height":1,"width":64}}')},function(e){e.exports=JSON.parse('{"kernel":[[[[-0.992216,-0.610879],[-0.975957,0.625189],[-0.965904,-0.138743],[-0.949645,-0.902675],[-0.933385,0.333393],[-0.923332,-0.430539],[-0.907073,0.805529],[-0.89702,0.0415974],[-0.88076,-0.722335],[-0.864501,0.513733],[-0.854448,-0.250199],[-0.838189,0.985869],[-0.811876,0.221937],[-0.795617,-0.541995],[-0.785564,0.694073],[-0.769305,-0.0698586],[-0.753045,-0.833791],[-0.742992,0.402277],[-0.726733,-0.361655],[-0.70042,0.874413],[-0.684161,0.110482],[-0.674108,-0.65345],[-0.657849,0.582618],[-0.631536,-0.181314],[-0.615277,-0.945246],[-0.605224,0.290822],[-0.588964,-0.47311],[-0.572705,0.762958],[-0.562652,-0.000974417],[-0.546393,-0.764906],[-0.52008,0.471162],[-0.503821,-0.29277],[-0.493768,0.943298],[-0.477509,0.179366],[-0.461249,-0.584566],[-0.451196,0.651502],[-0.434937,-0.11243],[-0.424884,-0.876362],[-0.408624,0.359706],[-0.392365,-0.404226],[-0.382312,0.831842],[-0.366053,0.0679097],[-0.33974,-0.696022],[-0.323481,0.540046],[-0.313428,-0.223886],[-0.297168,-0.987818],[-0.280909,0.24825],[-0.270856,-0.515682],[-0.254597,0.720386],[-0.228284,-0.0435462],[-0.212025,-0.807478],[-0.201972,0.42859],[-0.185713,-0.335342],[-0.169453,0.900726],[-0.1594,0.136794],[-0.143141,-0.627138],[-0.133088,0.60893],[-0.116828,-0.155002],[-0.100569,-0.918934],[-0.0905161,0.317134],[-0.0742567,-0.446798],[-0.0479443,0.78927],[-0.0316849,0.0253379],[-0.021632,-0.738594],[-0.00537252,0.497474],[0.0108869,-0.266458],[0.0209398,0.96961],[0.0371993,0.205678],[0.0635116,-0.558254],[0.079771,0.677814],[0.089824,-0.086118],[0.106083,-0.85005],[0.132396,0.386018],[0.148655,-0.377914],[0.158708,0.858154],[0.174968,0.0942221],[0.191227,-0.66971],[0.20128,0.566358],[0.217539,-0.197574],[0.243852,-0.961506],[0.260111,0.274562],[0.270164,-0.48937],[0.286423,0.746698],[0.302683,-0.0172338],[0.312736,-0.781166],[0.328995,0.454902],[0.339048,-0.30903],[0.355308,0.927038],[0.371567,0.163106],[0.38162,-0.600826],[0.397879,0.635242],[0.424192,-0.12869],[0.440451,-0.892622],[0.450504,0.343446],[0.466763,-0.420486],[0.483023,0.815582],[0.493076,0.0516503],[0.509335,-0.712282],[0.535648,0.523786],[0.551907,-0.240146],[0.56196,0.995922],[0.578219,0.23199],[0.604532,-0.531942],[0.620791,0.704126],[0.630844,-0.0598056],[0.647104,-0.823738],[0.663363,0.41233],[0.673416,-0.351602],[0.689675,0.884466],[0.715988,0.120534],[0.732247,-0.643398],[0.7423,0.59267],[0.758559,-0.171262],[0.774819,-0.935194],[0.784872,0.300874],[0.801131,-0.463058],[0.811184,0.77301],[0.827444,0.0090785],[0.843703,-0.754853],[0.853756,0.481215],[0.870015,-0.282717],[0.896328,0.953351],[0.912587,0.189419],[0.92264,-0.574513],[0.9389,0.661555],[0.955159,-0.102377],[0.965212,-0.866309],[0.981471,0.369759]]]],"size":{"depth":1,"height":1,"width":128}}')},function(e,t){e.exports="\r\nprecision lowp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\nuniform float u_weight;\r\nuniform sampler2D u_accumulationTexture;\r\nuniform sampler2D u_currentFrameTexture;\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec4 accumulationColor = texture(u_accumulationTexture, v_uv);\r\n    vec4 currentFrameColor = texture(u_currentFrameTexture, v_uv);\r\n    fragColor = mix(accumulationColor, currentFrameColor, u_weight);\r\n}\r\n"},function(e,t){e.exports="\r\nprecision highp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\nuniform sampler2D u_source;\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    fragColor = texture(u_source, v_uv);\r\n}\r\n"},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(6),s=r(7),u=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r._debug=t.Mode.Depth,r._near=0,r._far=0,r}return n(t,e),t.prototype.createProgram=function(){o.assert(void 0===this._program,"expected blit program to be undefined before its creation");var e=this._context.gl,t=new s.Shader(this._context,e.VERTEX_SHADER,"blit.vert (debug)");t.initialize(r(63));var i=new s.Shader(this._context,e.FRAGMENT_SHADER,"blit_debug.frag (debug)");return i.initialize(r(111)),this._program=new a.Program(this._context,"DebugProgram"),this._program.initialize([t,i]),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uSrcBounds=this._program.uniform("u_srcBounds"),this._uDstBounds=this._program.uniform("u_dstBounds"),this._uNearest=this._program.uniform("u_nearest"),this._uDebugMode=this._program.uniform("u_mode"),this._uLinearize=this._program.uniform("u_linearize"),this._program.bind(),e.uniform1i(this._program.uniform("u_source"),0),e.uniform1i(this._uDebugMode,this._debug),this._program.unbind(),this._program.valid},t.prototype.initialize=function(t){var r=e.prototype.initialize.call(this,t);return this.enforceProgramBlit=!0,r&&this.createProgram()},t.prototype.uninitialize=function(){e.prototype.uninitialize.call(this),this._uDebugMode=void 0,this._uLinearize=void 0},Object.defineProperty(t.prototype,"debug",{set:function(e){this.assertInitialized(),this._debug!==e&&(this._debug=e,void 0!==this._program&&this._program.valid&&(this._program.bind(),this._context.gl.uniform1i(this._uDebugMode,this._debug),this._program.unbind()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"near",{set:function(e){this._near=e||0,void 0!==this._program&&this._program.valid&&(this._program.bind(),this._context.gl.uniform2f(this._uLinearize,this._near,this._far),this._program.unbind())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"far",{set:function(e){this._far=e||0,void 0!==this._program&&this._program.valid&&(this._program.bind(),this._context.gl.uniform2f(this._uLinearize,this._near,this._far),this._program.unbind())},enumerable:!0,configurable:!0}),t}(r(38).BlitPass);t.DebugPass=u,function(e){!function(e){e[e.None=0]="None",e[e.Depth=1]="Depth",e[e.DepthLinear=2]="DepthLinear",e[e.DepthPacked=3]="DepthPacked",e[e.DepthLinearPacked=4]="DepthLinearPacked"}(e.Mode||(e.Mode={}))}(u=t.DebugPass||(t.DebugPass={})),t.DebugPass=u},function(e,t){e.exports="\r\nprecision highp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\nconst float one255ths = 1.0 / 255.0;\r\n\r\nvec3 float24x1_to_uint8x3(const in float f) {\r\n    vec3 uint8x3 = vec3(f, fract(f * 256.0), fract(f * 65536.0));\r\n    return floor(uint8x3 * 256.0) * one255ths;\r\n}\r\n\r\nvec4 float24x1_to_uint8x4(const in float f) {\r\n    vec4 uint8x4 = vec4(f, fract(f * 256.0), fract(f * 65536.0), fract(f * 16777216.0));\r\n    return floor(uint8x4 * 256.0) * one255ths;\r\n}\r\n\r\nconst vec3 premultUint8x3 = vec3(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0);\r\nfloat uint8x3_to_float24x1(const in vec3 v) {\r\n    return dot(v, premultUint8x3); // a1 * b1 + a2 * b2 + a3 * b3  ;)\r\n}\r\n\r\nconst vec4 premultUint8x4 = vec4(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0, 255.0 / 4294967296.0);\r\nfloat uint8x4_to_float32x1(const in vec4 v) {\r\n    return dot(v, premultUint8x4); // a1 * b1 + a2 * b2 + a3 * b3 + a4 * b4  ;)\r\n}\r\n\r\n\r\nfloat linearizeDepth(float zInNDC, float near, float far) {\r\n    float zLinear = 2.0 * near;\r\n    zLinear /= far + near - zInNDC * (far - near);\r\n    return zLinear;\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\nuniform sampler2D u_source;\r\n\r\nuniform int u_mode; /* Debug mode. */\r\nuniform vec2 u_linearize; /* [ zNear, zFar ] */\r\n\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec4 source = texture(u_source, v_uv);\r\n\r\n    /* u_mode == 0                 None */\r\n\r\n    if(u_mode == 1) {           /* Depth */\r\n        source.rgb = vec3(source[0]);\r\n\r\n    } else if (u_mode == 2) {   /* DepthLinear */\r\n        float zLinear = linearizeDepth(source[0], u_linearize[0], u_linearize[1]);\r\n        source.rgb = vec3(zLinear);\r\n\r\n    } else if(u_mode == 3) {    /* DepthPacked */\r\n        source.rgb = float24x1_to_uint8x3(source[0]);\r\n\r\n    } else if (u_mode == 4) {   /* DepthLinearPacked */\r\n        float zLinear = linearizeDepth(source[0], u_linearize[0], u_linearize[1]);\r\n        source.rgb = float24x1_to_uint8x3(zLinear);\r\n    }\r\n\r\n    fragColor = source;\r\n}\r\n"},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a,s=r(0),u=r(2),c=r(12),l=r(6),f=r(7),h=r(4),d=r(51),p=function(e){function t(t){var r=e.call(this)||this;return r._skipCubeLod=!1,r._altered=!0,r._context=t,r._cubeMapProgram=new l.Program(t,"CubemapEnvironmentProgram"),r._equiMapProgram=new l.Program(t,"EquimapEnvironmentProgram"),r._polarMapProgram=new l.Program(t,"PolarmapEnvironmentProgram"),r._sphereMapProgram=new l.Program(t,"SpheremapEnvironmentProgram"),r._ndcTriangle=new c.NdcFillingTriangle(r._context,"EnvironmentNdcTriangle"),r}return n(t,e),t.prototype.initialize=function(){var e=this._context.gl;this._ndcTriangle.initialize();var t=new f.Shader(this._context,e.VERTEX_SHADER,"env-projections.vert");t.initialize(r(113));var i=new f.Shader(this._context,e.FRAGMENT_SHADER,"env-projections.frag");i.initialize(r(24),!1),i.replace("PROJECTION_TYPE","CUBE_MAP"),i.compile(),this._cubeMapProgram.initialize([t,i],!1),this._cubeMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._cubeMapProgram.link(),this._cubeMapProgram.bind(),e.uniform1i(this._cubeMapProgram.uniform("u_cubemap"),0),this._uSkipLod=this._cubeMapProgram.uniform("u_skipLod"),this._cubeMapProgram.unbind();var n=new f.Shader(this._context,e.FRAGMENT_SHADER,"env-projections.frag");n.initialize(r(24),!1),n.replace("PROJECTION_TYPE","EQUI_MAP"),n.compile(),this._equiMapProgram.initialize([t,n],!1),this._equiMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._equiMapProgram.link(),this._equiMapProgram.bind(),e.uniform1i(this._equiMapProgram.uniform("u_equirectmap"),0),this._equiMapProgram.unbind();var o=new f.Shader(this._context,e.FRAGMENT_SHADER,"env-projections.frag");o.initialize(r(24),!1),o.replace("PROJECTION_TYPE","SPHERE_MAP"),o.compile(),this._sphereMapProgram.initialize([t,o],!1),this._sphereMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._sphereMapProgram.link(),this._sphereMapProgram.bind(),e.uniform1i(this._sphereMapProgram.uniform("u_spheremap"),0),this._sphereMapProgram.unbind();var a=new f.Shader(this._context,e.FRAGMENT_SHADER,"env-projections.frag");return a.initialize(r(24),!1),a.replace("PROJECTION_TYPE","POLAR_MAP"),a.compile(),this._polarMapProgram.initialize([t,a],!1),this._polarMapProgram.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._polarMapProgram.link(),this._polarMapProgram.bind(),e.uniform1iv(this._polarMapProgram.uniform("u_polarmap"),[0,1]),this._polarMapProgram.unbind(),!0},t.prototype.uninitialize=function(){this._cubeMapProgram.uninitialize(),this._equiMapProgram.uninitialize(),this._sphereMapProgram.uninitialize(),this._polarMapProgram.uninitialize()},t.prototype.update=function(){if(!1!==this._altered){var e=this._context.gl;this._cubeMapProgram.bind(),e.uniform1i(this._uSkipLod,this._skipCubeLod),this._altered=!1}},t.prototype.frame=function(){var e=this._context.gl;s.assert(void 0!==this._camera,"Camera is undefined in environment rendering pass."),s.assert(void 0!==this._environmentTexture,"Environment texture is undefined in environment rendering pass.");var t=this._cubeMapProgram;this._envTextureType===a.EquirectangularMap?(s.assert(this._environmentTexture instanceof h.Texture2D,"Input texture expected to be Texture2D for equirectangular mapping."),this._environmentTexture.bind(e.TEXTURE0),t=this._equiMapProgram):this._envTextureType===a.SphereMap?(s.assert(this._environmentTexture instanceof h.Texture2D,"Input texture expected to be Texture2D for sphere mapping."),this._environmentTexture.bind(e.TEXTURE0),t=this._sphereMapProgram):this._envTextureType===a.CubeMap?(s.assert(this._environmentTexture instanceof d.TextureCube,"Input texture expected to be a TextureCube for cube mapping."),this._environmentTexture.bind(e.TEXTURE0),t=this._cubeMapProgram):this._envTextureType===a.PolarMap&&(s.assert(void 0!==this._environmentTexture2,"Two input textures expected for polar mapping."),s.assert(this._environmentTexture instanceof h.Texture2D,"Input texture expected to be a Texture2D for polar mapping."),s.assert(this._environmentTexture2 instanceof h.Texture2D,"Input texture expected to be a Texture2D for polar mapping."),this._environmentTexture.bind(e.TEXTURE0),this._environmentTexture2.bind(e.TEXTURE1),t=this._polarMapProgram),t.bind(),e.uniformMatrix4fv(t.uniform("u_viewProjectionInverse"),!1,this._camera.viewProjectionInverse),this._ndcTriangle.bind(),this._ndcTriangle.draw(),t.unbind()},Object.defineProperty(t.prototype,"environmentTextureType",{set:function(e){this._envTextureType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"environmentTexture",{set:function(e){this._environmentTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"environmentTexture2",{set:function(e){this._environmentTexture2=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this._camera=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipCubeLod",{set:function(e){this._skipCubeLod!==e&&(this._skipCubeLod=e,this._altered=!0)},enumerable:!0,configurable:!0}),o([u.Initializable.initialize()],t.prototype,"initialize",null),o([u.Initializable.uninitialize()],t.prototype,"uninitialize",null),t}(u.Initializable);t.EnvironmentRenderingPass=p,function(e){e[e.CubeMap=0]="CubeMap",e[e.EquirectangularMap=1]="EquirectangularMap",e[e.SphereMap=2]="SphereMap",e[e.PolarMap=3]="PolarMap"}(a=t.EnvironmentTextureType||(t.EnvironmentTextureType={}))},function(e,t){e.exports="precision highp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    attribute vec2 a_vertex;\r\n#else\r\n    in vec2 a_vertex;\r\n#endif\r\n\r\n\r\nuniform mat4 u_viewProjectionInverse;\r\n\r\n\r\nvarying vec2 v_uv;\r\nvarying vec4 v_ray;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    v_uv = a_vertex * 0.5 + 0.5;\r\n    v_ray = u_viewProjectionInverse * vec4(a_vertex, 1.0, 1.0);\r\n\r\n    gl_Position = vec4(a_vertex.xy, 1.0 - 1e-6, 1.0);\r\n}\r\n"},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=r(3),c=r(17),l=r(2),f=r(12),h=r(6),d=r(7),p=r(4),_=function(e){function t(t){var r=e.call(this)||this;return r._cache=!1,r._depthAttachment=0,r._cachedDepths=new Map,r._cachedIDs=new Map,r._buffer=new Uint8Array(4),r._ndcTriangleShared=!1,r._context=t,r}return n(t,e),t.maxClearDepth=function(){return u.decode_float24x1_from_uint8x3(a.vec3.fromValues(255,255,255))},t.prototype.onFrame=function(){this._cachedDepths.clear(),this._cachedIDs.clear()},t.prototype.hash=function(e,t){return 65535*t+e},t.prototype.directReadDepthAt=function(e,t){s.assert(void 0!==this._depthFBO&&this._depthFBO.valid,"valid depth FBO expected for reading back depth");var r=this._depthFBO.texture(this._depthAttachment),i=this._context.gl,n=r.size;this._depthFBO.bind();var o=void 0===this._referenceSize?[1,1]:[n[0]/this._referenceSize[0],n[1]/this._referenceSize[1]];return(this._context.isWebGL2||this._context.supportsDrawBuffers)&&i.readBuffer(this._depthAttachment),i.readPixels(e*o[0],n[1]-t*o[1],1,1,i.RGBA,i.UNSIGNED_BYTE,this._buffer),this._buffer},t.prototype.renderThenReadDepthAt=function(e,t){s.assert(void 0!==this._depthFBO&&this._depthFBO.valid,"valid depth FBO expected for reading back depth");var r=this._depthFBO.texture(this._depthAttachment),i=this._context.gl,n=r.size,o=void 0===this._referenceSize?[1,1]:[n[0]/this._referenceSize[0],n[1]/this._referenceSize[1]];return i.viewport(0,0,1,1),this._program.bind(),i.uniform2f(this._uOffset,e*o[0]/n[0],(n[1]-t*o[1])/n[1]),i.uniform2f(this._uScale,1/n[0],1/n[1]),r.bind(i.TEXTURE0),this._framebuffer.bind(),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._ndcTriangle.unbind(),r.unbind(),(this._context.isWebGL2||this._context.supportsDrawBuffers)&&i.readBuffer&&i.readBuffer(i.COLOR_ATTACHMENT0),i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,this._buffer),this._framebuffer.unbind(),this._buffer},t.prototype.initialize=function(e,t){var i=this._context.gl,n=this._context.gl2facade;if(t)return this.readDepthAt=this.directReadDepthAt,!0;this.readDepthAt=this.renderThenReadDepthAt;var o=new d.Shader(this._context,i.VERTEX_SHADER,"ndcvertices.vert (readback)");o.initialize(r(62));var a=new d.Shader(this._context,i.FRAGMENT_SHADER,"readbackdepth.frag");return a.initialize(r(115)),this._program=new h.Program(this._context,"ReadbackDepthProgram"),this._program.initialize([o,a],!1),void 0===e?this._ndcTriangle=new f.NdcFillingTriangle(this._context):(this._ndcTriangle=e,this._ndcTriangleShared=!0),this._ndcTriangle.initialized||this._ndcTriangle.initialize(),this._program.attribute("a_vertex",this._ndcTriangle.vertexLocation),this._program.link(),this._uOffset=this._program.uniform("u_offset"),this._program.bind(),i.uniform1i(this._program.uniform("u_texture"),0),this._program.unbind(),this._texture=new p.Texture2D(this._context,"ReadbackRenderTexture"),this._texture.initialize(1,1,i.RGBA,i.RGBA,i.UNSIGNED_BYTE),this._framebuffer=new c.Framebuffer(this._context,"ReadbackFBO"),this._framebuffer.initialize([[n.COLOR_ATTACHMENT0,this._texture]]),!0},t.prototype.uninitialize=function(){this._context.isWebGL1&&!this._context.supportsDepthTexture||(!this._ndcTriangleShared&&this._ndcTriangle.initialized&&this._ndcTriangle.uninitialize(),this._program.uninitialize(),this._texture.uninitialize(),this._framebuffer.uninitialize())},t.prototype.depthAt=function(e,t){var r=this.hash(e,t);if(this._cache&&this._cachedDepths.has(r))return this._cachedDepths.get(r);var i=this.readDepthAt(e,t),n=255===i[0]&&255===i[1]&&255===i[2]?void 0:u.decode_float24x1_from_uint8x3(a.vec3.fromValues(i[0],i[1],i[2]));return this._cache&&this._cachedDepths.set(r,n),n},t.prototype.coordsAt=function(e,t,r,i){var n=this._depthFBO.texture(this._depthAttachment).size,o=void 0===r?this.depthAt(e,t):r;if(void 0!==o){var s=void 0===this._referenceSize?[1,1]:[n[0]/this._referenceSize[0],n[1]/this._referenceSize[1]],u=a.vec3.fromValues(e*s[0]*2/n[0]-1,1-t*s[1]*2/n[1],2*o-1);return a.vec3.transformMat4(a.vec3.create(),u,i)}},t.prototype.idAt=function(e,t){var r=this.hash(e,t);if(this._cache&&this._cachedIDs.has(r))return this._cachedIDs.get(r);var i=this._context.gl,n=this._idFBO.texture(this._idAttachment).size,o=void 0===this._referenceSize?[1,1]:[n[0]/this._referenceSize[0],n[1]/this._referenceSize[1]];this._idFBO.bind(),this._context.isWebGL2&&i.readBuffer(this._idAttachment),i.readPixels(e*o[0],n[1]-t*o[1],1,1,i.RGBA,i.UNSIGNED_BYTE,this._buffer);var s=u.decode_uint32_from_rgba8(a.vec4.fromValues(this._buffer[0],this._buffer[1],this._buffer[2],this._buffer[3]));return this._cache&&this._cachedIDs.set(r,s),s},t.prototype.frame=function(){this.onFrame()},Object.defineProperty(t.prototype,"cache",{set:function(e){this._cache=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthFBO",{set:function(e){this._depthFBO=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthAttachment",{set:function(e){this._depthAttachment=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idFBO",{set:function(e){this._idFBO=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idAttachment",{set:function(e){this._idAttachment=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coordinateReferenceSize",{set:function(e){this._referenceSize=e},enumerable:!0,configurable:!0}),o([l.Initializable.assert_initialized()],t.prototype,"directReadDepthAt",null),o([l.Initializable.assert_initialized()],t.prototype,"renderThenReadDepthAt",null),o([l.Initializable.initialize()],t.prototype,"initialize",null),o([l.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([l.Initializable.assert_initialized()],t.prototype,"depthAt",null),o([l.Initializable.assert_initialized()],t.prototype,"coordsAt",null),o([l.Initializable.assert_initialized()],t.prototype,"idAt",null),t}(l.Initializable);t.ReadbackPass=_},function(e,t){e.exports="\r\nprecision highp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\nconst float one255ths = 1.0 / 255.0;\r\n\r\nvec3 float24x1_to_uint8x3(const in float f) {\r\n    vec3 uint8x3 = vec3(f, fract(f * 256.0), fract(f * 65536.0));\r\n    return floor(uint8x3 * 256.0) * one255ths;\r\n}\r\n\r\nvec4 float24x1_to_uint8x4(const in float f) {\r\n    vec4 uint8x4 = vec4(f, fract(f * 256.0), fract(f * 65536.0), fract(f * 16777216.0));\r\n    return floor(uint8x4 * 256.0) * one255ths;\r\n}\r\n\r\nconst vec3 premultUint8x3 = vec3(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0);\r\nfloat uint8x3_to_float24x1(const in vec3 v) {\r\n    return dot(v, premultUint8x3); // a1 * b1 + a2 * b2 + a3 * b3  ;)\r\n}\r\n\r\nconst vec4 premultUint8x4 = vec4(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0, 255.0 / 4294967296.0);\r\nfloat uint8x4_to_float32x1(const in vec4 v) {\r\n    return dot(v, premultUint8x4); // a1 * b1 + a2 * b2 + a3 * b3 + a4 * b4  ;)\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragDepth gl_FragColor\r\n#else \r\n    layout(location = 0) out vec4 fragDepth;\r\n#endif\r\n\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec2 u_offset;\r\nuniform vec2 u_scale;\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec2 uv = vec2(v_uv.x, 1.0 - v_uv.y) * u_scale + u_offset;\r\n    float depth = texture(u_texture, uv).r;\r\n\r\n    fragDepth = vec4(float24x1_to_uint8x3(depth), 1.0);\r\n}\r\n"},function(e,t){e.exports="\r\nprecision lowp float;\r\nprecision lowp int;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\n#if __VERSION__ == 100\r\n  attribute vec2 a_vertex;\r\n#else\r\n  layout(location = 0) in vec2 a_vertex;\r\n#endif\r\n\r\n\r\nvarying vec2 v_texCoords;\r\n\r\n\r\nvoid main()\r\n{\r\n    v_texCoords = a_vertex * 0.5 + 0.5;\r\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\r\n}\r\n"},function(e,t){e.exports="\r\nprecision lowp float;\r\nprecision lowp int;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n#if __VERSION__ == 100\r\n  #define fragColor gl_FragColor\r\n#else\r\n  layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\nuniform float u_weights[32];\r\nuniform vec2 u_delta;\r\n\r\nuniform sampler2D u_texture;\r\n\r\nvarying vec2 v_texCoords;\r\n\r\n\r\nvoid main()\r\n{\r\n    vec4 result = u_weights[0] * texture(u_texture, v_texCoords);\r\n    for (int i = 1; i <= $KERNEL_HALF_SIZE; i++)\r\n    {\r\n        result += u_weights[i] * texture(u_texture, v_texCoords + float(i) * u_delta);\r\n        result += u_weights[i] * texture(u_texture, v_texCoords - float(i) * u_delta);\r\n    }\r\n\r\n    fragColor = result;\r\n}\r\n"},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),s=r(17),u=r(64),c=r(2),l=r(23),f=r(4),h=r(14),d=function(e){function t(t){var r=e.call(this)||this;return r._gaussFilterKernelSize=21,r._context=t,r}return n(t,e),Object.defineProperty(t.prototype,"shadowMapFBO",{get:function(){return this._shadowMapFBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowMapTexture",{get:function(){return this.hasBlur?this._blurTexture:this._shadowMapTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasBlur",{get:function(){return this._shadowType!==t.ShadowMappingType.HardLinear},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurSize",{get:function(){return this._gaussFilterKernelSize},set:function(e){e!==this._gaussFilterKernelSize&&(void 0!==this._gaussFilter&&(this._gaussFilter.kernelSize=e,this._gaussFilter.standardDeviation=e/6),this._gaussFilterKernelSize=e)},enumerable:!0,configurable:!0}),t.prototype.resize=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),a.assert(e[0]>0&&e[1]>0,"Size has to be > 0."),this._shadowMapSize=e,this._shadowMapFBO.resize(this._shadowMapSize[0],this._shadowMapSize[1],t,r)},t.prototype.resizeBlurTexture=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),a.assert(e[0]>0&&e[1]>0,"Size has to be > 0."),this._blurredShadowMapSize=e,this._intermediateBlurFBO.resize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],t,r),this._blurFBO.resize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],t,r)},t.prototype.initialize=function(e,r,i){a.assert(r[0]>0&&r[1]>0,"Size has to be > 0."),this._shadowType=e,this._shadowMapSize=r,this._blurredShadowMapSize=void 0!==i?i:this._shadowMapSize;var n=this._context.gl,o=this._context.gl2facade,c=n.RGBA;if(this._context.isWebGL2){var d=this._context.gl;switch(this._shadowType){case t.ShadowMappingType.HardLinear:case t.ShadowMappingType.HardExponential:c=d.RED;break;case t.ShadowMappingType.SoftLinear:c=d.RG;break;case t.ShadowMappingType.SoftExponential:c=d.RGBA;break;default:a.assert(!1,"Unexpected value for shadowType")}}var p=h.Wizard.queryInternalTextureFormat(this._context,c,h.Wizard.Precision.float),_=p[0],v=p[1];this._shadowType!==t.ShadowMappingType.HardLinear&&v!==n.FLOAT&&(a.log(a.LogLevel.Warning,"floating point textures are not supported, falling back to HardLinear"),this._shadowType=t.ShadowMappingType.HardLinear);var m=n.LINEAR;return v!==n.FLOAT||this._context.supportsTextureFloatLinear||(m=n.NEAREST),v!==o.HALF_FLOAT||this._context.supportsTextureHalfFloatLinear||(m=n.NEAREST),this._shadowMapTexture=new f.Texture2D(this._context),this._shadowMapTexture.initialize(this._shadowMapSize[0],this._shadowMapSize[1],_,c,n.FLOAT),this._shadowMapTexture.wrap(n.CLAMP_TO_EDGE,n.CLAMP_TO_EDGE),this._shadowMapTexture.filter(m,m),this._shadowMapRenderbuffer=new l.Renderbuffer(this._context),this._shadowMapRenderbuffer.initialize(this._shadowMapSize[0],this._shadowMapSize[1],n.DEPTH_COMPONENT16),this._shadowMapFBO=new s.Framebuffer(this._context),this._shadowMapFBO.initialize([[o.COLOR_ATTACHMENT0,this._shadowMapTexture],[n.DEPTH_ATTACHMENT,this._shadowMapRenderbuffer]]),this._shadowMapFBO.clearColor([1,1,1,1]),this._shadowMapFBO.clearDepth(1),this.hasBlur&&(this._gaussFilter=new u.GaussFilter(this._context),this._gaussFilter.kernelSize=this._gaussFilterKernelSize,this._gaussFilter.standardDeviation=this._gaussFilterKernelSize/6,this._gaussFilter.initialize(),this._intermediateBlurTexture=new f.Texture2D(this._context,"IntermediateBlurTexture"),this._intermediateBlurTexture.initialize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],_,c,n.FLOAT),this._intermediateBlurTexture.wrap(n.CLAMP_TO_EDGE,n.CLAMP_TO_EDGE),this._intermediateBlurTexture.filter(m,m),this._intermediateBlurFBO=new s.Framebuffer(this._context,"IntermediateBlurFramebuffer"),this._intermediateBlurFBO.initialize([[o.COLOR_ATTACHMENT0,this._intermediateBlurTexture]]),this._intermediateBlurFBO.clearColor([1,1,1,1]),this._intermediateBlurFBO.clearDepth(1),this._blurTexture=new f.Texture2D(this._context,"BlurTexture"),this._blurTexture.initialize(this._blurredShadowMapSize[0],this._blurredShadowMapSize[1],_,c,n.FLOAT),this._blurTexture.wrap(n.CLAMP_TO_EDGE,n.CLAMP_TO_EDGE),this._blurTexture.filter(m,m),this._blurFBO=new s.Framebuffer(this._context,"BlurFramebuffer"),this._blurFBO.initialize([[o.COLOR_ATTACHMENT0,this._blurTexture]]),this._blurFBO.clearColor([1,1,1,1]),this._blurFBO.clearDepth(1)),!0},t.prototype.uninitialize=function(){this._shadowMapFBO.uninitialize(),this._shadowMapRenderbuffer.uninitialize(),this._shadowMapTexture.uninitialize(),this.hasBlur&&(this._intermediateBlurFBO.uninitialize(),this._intermediateBlurTexture.uninitialize(),this._blurFBO.uninitialize(),this._blurTexture.uninitialize(),this._gaussFilter.uninitialize())},t.prototype.frame=function(e){var t=this._context.gl;t.viewport(0,0,this._shadowMapSize[0],this._shadowMapSize[1]),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),this._shadowMapFBO.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT,!0,!1),e(),t.disable(t.DEPTH_TEST),t.depthFunc(t.LESS),this.hasBlur&&(t.viewport(0,0,this._intermediateBlurFBO.width,this._intermediateBlurFBO.height),this._intermediateBlurFBO.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT,!0,!1),this._gaussFilter.filter(this._shadowMapTexture,u.GaussFilter.Direction.Horizontal),t.viewport(0,0,this._blurFBO.width,this._blurFBO.height),this._blurFBO.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT,!0,!1),this._gaussFilter.filter(this._intermediateBlurTexture,u.GaussFilter.Direction.Vertical))},o([c.Initializable.assert_initialized()],t.prototype,"resize",null),o([c.Initializable.assert_initialized()],t.prototype,"resizeBlurTexture",null),o([c.Initializable.initialize()],t.prototype,"initialize",null),o([c.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([c.Initializable.assert_initialized()],t.prototype,"frame",null),t}(c.Initializable);t.ShadowPass=d,function(e){!function(e){e[e.HardLinear=0]="HardLinear",e[e.SoftLinear=1]="SoftLinear",e[e.HardExponential=2]="HardExponential",e[e.SoftExponential=3]="SoftExponential"}(e.ShadowMappingType||(e.ShadowMappingType={}))}(d=t.ShadowPass||(t.ShadowPass={})),t.ShadowPass=d},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(5),s=function(e){function t(t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=[1,1,1]);var s=e.call(this,t,r)||this;s._vertexLocation=0,s._extent=o.vec3.fromValues(1,1,1),s._uvCoordinates=!1,r=void 0!==r&&""!==r?r:s.constructor.name;var u=new a.Buffer(t,r+"VBO");s._buffers.push(u);var c=new a.Buffer(t,r+"IndicesVBO");return s._buffers.push(c),s._extent=o.vec3.clone(n),s._uvCoordinates=i,s}return n(t,e),t.prototype.bindBuffers=function(){!1===this._uvCoordinates?this._buffers[0].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,0,0,!0,!1):(this._buffers[0].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,20,0,!0,!1),this._buffers[0].attribEnable(this._uvCoordLocation,2,this.context.gl.FLOAT,!1,20,12,!1,!1)),this._buffers[1].bind()},t.prototype.unbindBuffers=function(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0),this._uvCoordinates&&this._buffers[0].attribDisable(this._uvCoordLocation,!1,!0),this._buffers[1].unbind()},t.prototype.initialize=function(r,i){var n=this;void 0===r&&(r=0),void 0===i&&(i=1),this._vertexLocation=r,this._uvCoordLocation=i;var o=this.context.gl,a=e.prototype.initialize.call(this,[o.ARRAY_BUFFER,o.ELEMENT_ARRAY_BUFFER],[r,i]),s=this._uvCoordinates,u=s?t.VERTICES_UV:t.VERTICES;return u=u.map(function(e,t){return e*(!1===s?.5*n._extent[t%3]:t%5<3?.5*n._extent[t%5]:1)}),this._buffers[0].data(u,o.STATIC_DRAW),this._buffers[1].data(s?t.INDICES_UV:t.INDICES,o.STATIC_DRAW),this._count=s?t.INDICES_UV.length:t.INDICES.length,a},t.prototype.draw=function(){var e=this.context.gl;e.drawElements(e.TRIANGLE_STRIP,this._count,e.UNSIGNED_BYTE,0)},Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uvCoordLocation",{get:function(){return this._uvCoordLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this._extent},enumerable:!0,configurable:!0}),t.VERTICES=new Float32Array([-1,-1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1]),t.INDICES=new Uint8Array([0,1,2,3,7,1,5,4,7,6,2,4,0,1]),t.VERTICES_UV=new Float32Array([-1,-1,1,0,0,1,-1,1,1,0,-1,1,1,0,1,1,1,1,1,1,-1,1,1,0,0,1,1,1,1,0,1,1,-1,1,1,1,1,1,0,1,1,-1,1,0,0,1,-1,-1,1,0,1,-1,1,1,1,-1,-1,-1,0,0,1,-1,-1,0,0,-1,-1,-1,1,0,1,1,-1,0,1,-1,1,-1,1,1,-1,1,-1,0,1,-1,1,1,1,1,-1,-1,1,1,0,-1,-1,1,0,1]),t.INDICES_UV=new Uint8Array([3,2,1,0,10,19,11,18,11,17,16,4,16,5,6,7,6,8,9,10,9,11,12,13,14,15]),t}(r(9).Geometry);t.CuboidGeometry=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(5),s=r(9),u=r(66),c=function(e){function t(t,r,i,n){void 0===i&&(i=1),void 0===n&&(n=!0);var o=e.call(this,t,r)||this;o._diameter=1,o._textured=!1,o._size=0,r=void 0!==r&&""!==r?r:o.constructor.name,o._diameter=i,o._textured=n;var s=new a.Buffer(t,r+"IndexBuffer");o._buffers.push(s);var u=new a.Buffer(t,r+"VBO");if(o._buffers.push(u),o._textured){var c=new a.Buffer(t,r+"UV");o._buffers.push(c)}return o}return n(t,e),t.prototype.bindBuffers=function(){this._buffers[0].bind(),this._buffers[1].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,0,0,!0,!1),this._textured&&this._buffers[2].attribEnable(this._texCoordLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1)},t.prototype.unbindBuffers=function(){this._buffers[0].unbind(),this._buffers[1].attribDisable(this._vertexLocation,!0,!0),this._textured&&this._buffers[2].attribDisable(this._texCoordLocation,!0,!0)},t.prototype.initialize=function(t,r){void 0===t&&(t=0),void 0===r&&(r=1);var i=this.context.gl;this._vertexLocation=t,this._texCoordLocation=r;var n=e.prototype.initialize.call(this,[i.ELEMENT_ARRAY_BUFFER,i.ARRAY_BUFFER,i.ARRAY_BUFFER],[8,t,r]);o.assert(void 0!==this._buffers[0]&&this._buffers[0].object instanceof WebGLBuffer,"expected valid WebGLBuffer"),o.assert(void 0!==this._buffers[1]&&this._buffers[1].object instanceof WebGLBuffer,"expected valid WebGLBuffer"),this._textured&&o.assert(void 0!==this._buffers[2]&&this._buffers[2].object instanceof WebGLBuffer,"expected valid WebGLBuffer");var a=new u.Icosahedron;a.generateGeometry(3),this._textured&&a.generateTextureCoordinates();for(var s=a.faces,c=new Uint16Array(3*s.length),l=0,f=0,h=s;f<h.length;f++){var d=h[f];c[l+0]=d[0],c[l+1]=d[1],c[l+2]=d[2],l+=3}this._buffers[0].data(c,i.STATIC_DRAW),this._size=3*s.length;var p=a.vertices,_=new Float32Array(3*p.length);l=0;for(var v=0,m=p;v<m.length;v++){var b=m[v];_[l+0]=b[0]*this._diameter,_[l+1]=b[1]*this._diameter,_[l+2]=b[2]*this._diameter,l+=3}if(this._buffers[1].data(_,i.STATIC_DRAW),this._textured){var g=a.texcoords,y=new Float32Array(2*g.length);if(g&&g.length>0){l=0;for(var E=0,x=g;E<x.length;E++){var T=x[E];y[l+0]=T[0],y[l+1]=T[1],l+=2}}this._buffers[2].data(y,i.STATIC_DRAW)}return n},t.prototype.draw=function(){var e=this.context.gl;e.drawElements(e.TRIANGLES,this._size,e.UNSIGNED_SHORT,0)},Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texCoordLocation",{get:function(){return this._texCoordLocation},enumerable:!0,configurable:!0}),t}(s.Geometry);t.GeosphereGeometry=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(5),s=function(e){function t(t,r){var i=e.call(this,t,r)||this;i._vertexLocation=0,i._texCoordLocation=1,i._translation=o.vec3.fromValues(0,0,0),i._scale=o.vec3.fromValues(1,1,1),i._rotation=o.quat.create(),r=void 0!==r&&""!==r?r:i.constructor.name;var n=new a.Buffer(t,r+"VertexVBO"),s=new a.Buffer(t,r+"TexCoordVBO"),u=new a.Buffer(t,r+"IndexBuffer");return i._buffers.push(n),i._buffers.push(s),i._buffers.push(u),i}return n(t,e),t.prototype.bindBuffers=function(){this._buffers[0].attribEnable(this._vertexLocation,3,this.context.gl.FLOAT,!1,0,0,!0,!1),this._buffers[1].attribEnable(this._texCoordLocation,2,this.context.gl.FLOAT,!1,0,0,!0,!1),this._buffers[2].bind()},t.prototype.unbindBuffers=function(){this._buffers[0].attribDisable(this._vertexLocation,!0,!0),this._buffers[1].attribDisable(this._texCoordLocation,!0,!0),this._buffers[2].unbind()},t.prototype.initialize=function(r,i){void 0===r&&(r=0),void 0===i&&(i=1);var n=this.context.gl;this._vertexLocation=r,this._texCoordLocation=i;var o=e.prototype.initialize.call(this,[n.ARRAY_BUFFER,n.ARRAY_BUFFER,n.ELEMENT_ARRAY_BUFFER],[r,i,8]);return this._buffers[0].data(t.VERTICES,n.STATIC_DRAW),this._buffers[1].data(t.UV,n.STATIC_DRAW),this._buffers[2].data(t.INDICES,n.STATIC_DRAW),o},t.prototype.draw=function(){var e=this.context.gl;e.drawElements(e.TRIANGLE_STRIP,t.INDICES.length,e.UNSIGNED_BYTE,0)},Object.defineProperty(t.prototype,"translation",{set:function(e){this._translation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{set:function(e){this._scale=o.vec3.fromValues(e[0],1,e[1])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{set:function(e){this._rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transformation",{get:function(){var e=o.mat4.create();return o.mat4.fromRotationTranslationScale(e,this._rotation,this._translation,this._scale)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texCoordLocation",{get:function(){return this._texCoordLocation},enumerable:!0,configurable:!0}),t.VERTICES=new Float32Array([-1,0,-1,-1,0,1,1,0,-1,1,0,1]),t.UV=new Float32Array([-1,-1,-1,1,1,-1,1,1]),t.INDICES=new Uint8Array([0,1,2,3]),t}(r(9).Geometry);t.PlaneGeometry=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(5),o=r(9),a=r(25),s=r(4),u=function(){function e(e){this._texture2Ds=new Map,this._materials=new Map,this._geometries=new Map,this._buffers=new Map,this._context=e}return e.prototype.fetchTexture2D=function(e,t,r){if(void 0===r&&(r=!1),!this._texture2Ds.has(e)){var n=new s.Texture2D(this._context,e);return i.assert(n.identifier===e,"expected object identifier to be unchanged"),this._texture2Ds.set(e,n),n.fetch(t,r)}},e.prototype.add=function(e,t){var r=new Array;if(e instanceof s.Texture2D)for(var i=e,u=0,c=t;u<c.length;u++){var l=c[u];this._texture2Ds.has(l)||(this._texture2Ds.set(l,i),r.push(l))}if(e instanceof a.Material)for(var f=e,h=0,d=t;h<d.length;h++)l=d[h],this._materials.has(l)||(this._materials.set(l,f),r.push(l));if(e instanceof o.Geometry)for(var p=e,_=0,v=t;_<v.length;_++)l=v[_],this._geometries.has(l)||(this._geometries.set(l,p),r.push(l));if(e instanceof n.Buffer)for(var m=e,b=0,g=t;b<g.length;b++)l=g[b],this._buffers.has(l)||(this._buffers.set(l,m),r.push(l));return r},e.prototype.get=function(e){return this._texture2Ds.has(e)?this._texture2Ds.get(e):this._materials.has(e)?this._materials.get(e):this._geometries.has(e)?this._geometries.get(e):this._buffers.has(e)?this._buffers.get(e):void 0},e.prototype.uninitialize=function(){for(var e=0,t=Array.from(this._geometries.values());e<t.length;e++){var r=t[e];r.initialized&&r.uninitialize()}this._geometries.clear();for(var i=0,n=Array.from(this._texture2Ds.values());i<n.length;i++){var o=n[i];o.initialized&&o.uninitialize()}this._texture2Ds.clear();for(var a=0,s=Array.from(this._buffers.values());a<s.length;a++){var u=s[a];u.initialized&&u.uninitialize()}this._buffers.clear(),this._materials.clear()},e}();t.ResourceManager=u},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=r(15),c=r(2),l=function(e){function t(t){var r=e.call(this)||this;return r._altered=Object.assign(new u.ChangeLookup,{any:!1,camera:!1}),r._context=t,r._opaqueGeometryMap=new Map,r._transparentGeometryMap=new Map,r}return n(t,e),t.prototype.preprocessScene=function(){s.assert(void 0!==this._scene,"Scene was undefined during preprocessing."),void 0!==this._scene&&(this._opaqueGeometryMap.clear(),this._transparentGeometryMap.clear(),this.preprocessNode(this._scene,a.mat4.create()))},t.prototype.preprocessNode=function(e,t){var r=a.mat4.clone(t),i=e.componentsOfType("TransformComponent");if(s.assert(i.length<=1,"SceneNode can not have more than one transform component"),1===i.length){var n=i[0];a.mat4.mul(r,r,n.transform)}for(var o=0,u=e.componentsOfType("GeometryComponent");o<u.length;o++){var c,l=u[o],f=l.material,h=l.geometry;f.isTransparent?(void 0===(c=this._transparentGeometryMap.get(f))&&(c=[]),c.push([h,r]),this._transparentGeometryMap.set(f,c)):(void 0===(c=this._opaqueGeometryMap.get(f))&&(c=[]),c.push([h,r]),this._opaqueGeometryMap.set(f,c))}if(void 0!==e.nodes)for(var d=0,p=e.nodes;d<p.length;d++){var _=p[d];this.preprocessNode(_,r)}},t.prototype.renderGeometryMap=function(e){for(var t=0,r=Array.from(e.keys());t<r.length;t++){var i=r[t];this.bindMaterial(i);for(var n=0,o=e.get(i);n<o.length;n++){var a=o[n],s=a[0],u=a[1];s.bind(),void 0!==this.bindGeometry&&this.bindGeometry(s),this.updateModelTransform(u),s.draw(),s.unbind()}}},t.prototype.initialize=function(){return!0},t.prototype.uninitialize=function(){},t.prototype.prepare=function(){},t.prototype.update=function(e){void 0===e&&(e=!1)},t.prototype.frame=function(){if(s.assert(this._target&&this._target.valid,"valid target expected"),s.assert(this._program&&this._program.valid,"valid program expected"),s.assert(void 0!==this.updateModelTransform,"Model transform function needs to be initialized."),s.assert(void 0!==this.updateViewProjectionTransform,"View Projection transform function needs to be initialized."),s.assert(void 0!==this.bindMaterial,"Material binding function needs to be initialized."),void 0!==this._scene){var e=this._context.gl;e.enable(e.DEPTH_TEST);var t=this._target.size;e.viewport(0,0,t[0],t[1]);var r=this._clearColor;e.clearColor(r[0],r[1],r[2],r[3]),this._target.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT,!0,!1),this._program.bind(),void 0!==this.bindUniforms&&this.bindUniforms(),this.updateViewProjectionTransform(this._camera.viewProjection),this.drawCalls(),this._program.unbind(),e.disable(e.BLEND)}},t.prototype.drawCalls=function(e){void 0===e&&(e=!0),void 0!==this._scene&&(this.renderGeometryMap(this._opaqueGeometryMap),e&&this.renderGeometryMap(this._transparentGeometryMap))},Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffset",{set:function(e){this.assertInitialized(),this._ndcOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this.assertInitialized(),this._camera!==e&&(this._camera=e,this._altered.alter("camera"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clearColor",{set:function(e){this._clearColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"program",{set:function(e){this._program=e},enumerable:!0,configurable:!0}),o([c.Initializable.initialize()],t.prototype,"initialize",null),o([c.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([c.Initializable.assert_initialized()],t.prototype,"update",null),o([c.Initializable.assert_initialized()],t.prototype,"frame",null),o([c.Initializable.assert_initialized()],t.prototype,"drawCalls",null),t}(r(67).SceneRenderPass);t.ForwardSceneRenderPass=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var r=e.call(this,"TransformComponent")||this;return r._transform=t,r}return n(t,e),Object.defineProperty(t.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),t}(r(39).SceneNodeComponent);t.TransformComponent=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this,"GeometryComponent")||this}return n(t,e),Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},set:function(e){this._material=e},enumerable:!0,configurable:!0}),t}(r(39).SceneNodeComponent);t.GeometryComponent=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this._context=e,this._name=t,this._isTransparent=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(e){this._isTransparent=e},enumerable:!0,configurable:!0}),e}();t.Material=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(128);t.FontFace=i.FontFace;var n=r(18);t.GlyphVertices=n.GlyphVertices;var o=r(19);t.Label=o.Label;var a=r(71);t.LabelGeometry=a.LabelGeometry;var s=r(130);t.LabelRenderPass=s.LabelRenderPass;var u=r(72);t.Position2DLabel=u.Position2DLabel;var c=r(73);t.Position3DLabel=c.Position3DLabel;var l=r(74);t.Projected3DLabel=l.Projected3DLabel;var f=r(70);t.Text=f.Text;var h=r(26);t.Typesetter=h.Typesetter},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(4),o=r(14),a=r(34),s=r(129),u=r(69),c=function(){function e(e,t){this._ascent=0,this._descent=0,this._lineGap=0,this._glyphTextureExtent=[0,0],this._glyphTexturePadding=[0,0,0,0],this._glyphs=new Map,this._context=e;var r=e.gl;t=void 0!==t&&""!==t?t:this.constructor.name,this._glyphTexture=new n.Texture2D(e,t+"GlyphAtlas");var i=o.Wizard.queryInternalTextureFormat(e,r.RGBA,o.Wizard.Precision.byte);this._glyphTexture.initialize(1,1,i[0],r.RGBA,i[1]),this._glyphTexture.filter(r.LINEAR,r.LINEAR)}return e.fromFile=function(t,r,i,n){return void 0===i&&(i=!1),a.fetchAsync(t,"text").then(function(o){var a=new e(r,n);return s.FontFaceLoader.process(a,o,t,i).then(function(e){return e}).catch(function(e){return Promise.reject("processing font face data failed: "+e)})})},e.prototype.hasGlyph=function(e){return!!this._glyphs.get(e)},e.prototype.glyph=function(e){var t=this._glyphs.get(e);if(t)return t;var r=new u.Glyph;return r.index=e,r},e.prototype.addGlyph=function(e){i.assert(!this._glyphs.get(e.index),"expected glyph to not already exist"),this._glyphs.set(e.index,e)},e.prototype.arrayOfGlyphIndices=function(){return Array.from(this._glyphs.keys())},e.prototype.depictable=function(e){return this.glyph(e).depictable()},e.prototype.kerning=function(e,t){var r=this._glyphs.get(e);return r?r.kerning(t):0},e.prototype.setKerning=function(e,t,r){var n=this._glyphs.get(e);n&&this.hasGlyph(t)?n.setKerning(t,r):i.assert(!1,"expected glyph or glyph of subsequent index to exist,                 given "+e+" and "+t+" respectively")},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){i.assert(e>0,"expected size to be greater than 0.0, given "+e),this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"base",{get:function(){return this._base},set:function(e){i.assert(e>0,"expected base to be greater than 0.0, given "+e),this._base=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this._ascent},set:function(e){i.assert(e>0,"expected ascent to be greater than 0.0, given "+e),this._ascent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._descent},set:function(e){this._descent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineGap",{get:function(){return this._lineGap},set:function(e){this._lineGap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this.size+this.lineGap},set:function(e){i.assert(this.size>0,"expected size to be greater than zero to derive line gap from line height"),this._lineGap=e-this.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineSpace",{get:function(){return 0===this.lineHeight?this.lineHeight:this.size/this.lineHeight},set:function(e){this._lineGap=this.size*(e-1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glyphTextureExtent",{get:function(){return this._glyphTextureExtent},set:function(e){i.assert(e[0]>0,"expected extent.x to be greater than 0.0, given "+e[0]),i.assert(e[1]>0,"expected extent.y to be greater than 0.0, given "+e[1]),this._glyphTextureExtent=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glyphTexturePadding",{get:function(){return this._glyphTexturePadding},set:function(e){i.assert(e[0]>=0,"expected padding[0] to be greater than 0.0, given "+e[0]),i.assert(e[1]>=0,"expected padding[1] to be greater than 0.0, given "+e[1]),i.assert(e[2]>=0,"expected padding[2] to be greater than 0.0, given "+e[2]),i.assert(e[3]>=0,"expected padding[3] to be greater than 0.0, given "+e[3]),this._glyphTexturePadding=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glyphTexture",{get:function(){return this._glyphTexture},set:function(e){this._glyphTexture=e},enumerable:!0,configurable:!0}),e}();t.FontFace=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=r(69),o=function(){function e(){}return e.processInfo=function(e,t){var r=new Map;if(!this.readKeyValuePairs(e,["size","padding"],r))return!1;t.size=parseFloat(r.get("size"));var n=r.get("padding").split(",");if(4!==n.length)return i.log(i.LogLevel.Warning,"expected 4 values for padding, given "+n+" ("+n.length+")"),!1;var o=[parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])];return t.glyphTexturePadding=o,!0},e.processCommon=function(e,t){var r=new Map;return!!this.readKeyValuePairs(e,["lineHeight","base","scaleW","scaleH"],r)&&(t.base=parseFloat(r.get("base")),r.has("ascent")&&(t.ascent=parseFloat(r.get("ascent"))),r.has("descent")&&(t.descent=parseFloat(r.get("descent"))),t.lineHeight=parseFloat(r.get("lineHeight")),t.glyphTextureExtent=[parseFloat(r.get("scaleW")),parseFloat(r.get("scaleH"))],!0)},e.processPage=function(e,t,r){var n=new Map;if(this.readKeyValuePairs(e,["file"],n)){var o=i.dirname(r),a=n.get("file");return a=a.replace(/['"]+/g,""),t.glyphTexture.fetch(o+"/"+a,!1,!0).catch(function(){return Promise.reject("page '"+a+"' referenced in font file '"+r+"' was not found")})}},e.processChar=function(e,t){var r=new Map;if(!this.readKeyValuePairs(e,["id","x","y","width","height","xoffset","yoffset","xadvance"],r))return!1;var o=parseInt(r.get("id"),10);i.logIf(o<=0,i.LogLevel.Warning,"expected glyph index to be greater than 0, given "+o);var a=new n.Glyph;a.index=o;var s=[1/t.glyphTextureExtent[0],1/t.glyphTextureExtent[1]],u=[parseFloat(r.get("width")),parseFloat(r.get("height"))];return a.subTextureOrigin=[parseFloat(r.get("x"))*s[0],1-(parseFloat(r.get("y"))+u[1])*s[1]],a.extent=u,a.subTextureExtent[0]=u[0]*s[0],a.subTextureExtent[1]=u[1]*s[1],a.bearingFromFontBaseAndOffset(t.base,parseFloat(r.get("xoffset")),parseFloat(r.get("yoffset"))),a.advance=parseFloat(r.get("xadvance")),t.addGlyph(a),!0},e.processKerning=function(e,t){var r=new Map;if(!this.readKeyValuePairs(e,["first","second","amount"],r))return!1;var n=parseInt(r.get("first"),10);if(n<=0)return i.log(i.LogLevel.Warning,"expected kerning's first to be greater than 0, given "+n),!1;var o=parseInt(r.get("second"),10);if(o<=0)return i.log(i.LogLevel.Warning,"expected kerning's second to be greater than 0, given "+o),!1;var a=parseFloat(r.get("amount"));return t.setKerning(n,o,a),!0},e.readKeyValuePairs=function(e,t,r){for(var n,o,a=0,s=e;a<s.length;a++){var u=s[a].split("=");n=u[0],o=u[1],r.set(n,o)}var c=!0;return t.forEach(function(e){return c=c&&r.has(e)}),c||i.log(i.LogLevel.Warning,"Not all required keys are provided! Mandatory keys: "+t),c},e.findAscentAndDescentIfNoneProvided=function(e,t){if(!(e.ascent>0&&e.descent<0)){e.ascent>0&&(e.descent=e.ascent-t),e.descent<0&&(e.ascent=e.descent-t);for(var r=Number.MIN_VALUE,n=0,o=e.arrayOfGlyphIndices();n<o.length;n++){var a=o[n];0!==e.glyph(a).extent[1]&&(r=Math.max(e.glyph(a).bearing[1],r))}e.ascent=r,e.descent=e.ascent-t,i.log(i.LogLevel.Debug,"ascent not specified, derived "+e.ascent+" from maximum y-offset")}},e.process=function(t,r,n,o){void 0===o&&(o=!1);for(var a=r.split("\n"),s=new Array,u=!0,c=0,l=a;c<l.length;c++){var f=l[c].split(" "),h=f[0];switch(f=f.slice(1),h){case"info":u=this.processInfo(f,t);break;case"common":u=this.processCommon(f,t);break;case"page":if(o)break;var d=this.processPage(f,t,n);void 0!==d&&s.push(d);break;case"char":u=this.processChar(f,t);break;case"kerning":this.processKerning(f,t)}if(!1===u)break}return e.findAscentAndDescentIfNoneProvided(t,t.size),t.size<=0&&i.log(i.LogLevel.Warning,"expected fontFace.size to be greater than 0, given "+t.size),Promise.all(s).then(function(){return t})},e}();t.FontFaceLoader=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),s=r(0),u=r(15),c=r(2),l=r(6),f=r(7),h=r(4),d=r(18),p=r(19),_=r(71),v=r(72),m=r(73),b=r(74),g=function(e){function t(r){var i=e.call(this)||this;return i._altered=Object.assign(new u.ChangeLookup,{any:!1,camera:!1,geometry:!1,labels:!1,aaStepScale:!1,aaSampling:!1}),i._ndcOffset=[0,0],i._depthMask=!1,i._aaSampling=t.Sampling.Smooth1,i._labels=new Array,i._ranges=new Array,i._verticesPerLabel=new Array,i._context=r,i._depthFunc=r.gl.LESS,i._program=new l.Program(r,"LabelRenderProgram"),i._geometry=new _.LabelGeometry(i._context,"LabelGeometry"),i._aaStepScale=t.DEFAULT_AA_STEP_SCALE,i}return n(t,e),t.prototype.prepare=function(){for(var e=this._camera.viewport,t=0;t<this._labels.length;++t){var r=this._labels[t],i=void 0,n=this._altered.labels&&void 0===this._verticesPerLabel[t];r instanceof v.Position2DLabel?(r.frameSize=e,i=r.typeset(n)):r instanceof b.Projected3DLabel?(r.camera=this._camera,i=r.typeset(n)):r instanceof m.Position3DLabel&&(i=r.typeset(n)),void 0===i?i=this._verticesPerLabel[t]:this._verticesPerLabel[t]=i;var o=t>0?this._ranges[t-1][1]:0,a=o+(void 0===i?0:i.length);this._ranges[t]=[o,a]}var s=d.GlyphVertices.concat(this._verticesPerLabel);this._geometry.update(s.origins,s.tangents,s.ups,s.texCoords)},t.prototype.initialize=function(){var e=this._context.gl;this._geometry.initialize(),this._context.enable(["OES_standard_derivatives"]);var t=new f.Shader(this._context,e.VERTEX_SHADER,"glyph.vert");t.initialize(r(131));var i=new f.Shader(this._context,e.FRAGMENT_SHADER,"glyph.frag");return i.initialize(r(132)),this._program.initialize([t,i],!1),this._program.attribute("a_vertex",this._geometry.vertexLocation),this._program.attribute("a_texCoord",this._geometry.texCoordLocation),this._program.attribute("a_origin",this._geometry.originLocation),this._program.attribute("a_tangent",this._geometry.tangentLocation),this._program.attribute("a_up",this._geometry.upLocation),this._program.link(),this._uViewProjection=this._program.uniform("u_viewProjection"),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uColor=this._program.uniform("u_color"),this._uAAStepScale=this._program.uniform("u_aaStepScale"),this._uAASampling=this._program.uniform("u_aaSampling"),this._uTransform=this._program.uniform("u_transform"),this._uDynamic=this._program.uniform("u_dynamic"),this._program.bind(),e.uniform1i(this._program.uniform("u_glyphs"),0),e.uniform1f(this._uAAStepScale,this._aaStepScale),e.uniform1i(this._uAASampling,this._aaSampling),this._program.unbind(),!0},t.prototype.uninitialize=function(){this._geometry.uninitialize(),this._program.uninitialize(),this._uViewProjection=void 0,this._uNdcOffset=void 0,this._uColor=void 0,this._uAAStepScale=void 0,this._uAASampling=void 0,this._uTransform=void 0,this._uDynamic=void 0},t.prototype.update=function(e){void 0===e&&(e=!1);var t=this._context.gl;this._program.bind(),(e||this._altered.camera||this._camera.altered)&&t.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),(e||this._altered.aaStepScale)&&t.uniform1f(this._uAAStepScale,this._aaStepScale),(e||this._altered.aaSampling)&&t.uniform1i(this._uAASampling,this._aaSampling);for(var r=e||this._altered.labels||this._altered.camera||this._camera.altered,i=0;!1===r&&i<this._labels.length;)r=this._labels[i].altered,++i;r&&this.prepare(),this._altered.reset()},t.prototype.frame=function(){if(0!==this._geometry.numGlyphs&&0!==this._labels.length){s.assert(this._target&&this._target.valid,"valid target expected");var e=this._context.gl,t=this._target.size;e.viewport(0,0,t[0],t[1]),e.enable(e.DEPTH_TEST),e.depthFunc(this._depthFunc),!1===this._depthMask&&e.depthMask(this._depthMask),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),this._program.bind(),e.uniform2fv(this._uNdcOffset,this._ndcOffset),e.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),this._target.bind(),this._geometry.bind();for(var r,i,n=[0,0],o=a.mat4.create(),u=0;u<this._labels.length;++u){var c=this._labels[u];if(n[1]=this._ranges[u][1],!(n[0]===n[1]||u<this._labels.length-1&&!c.valid)){var l=u<this._labels.length-1?this._labels[u+1]:void 0,f=l&&c.type===p.Label.Type.Static&&l.type===p.Label.Type.Static,d=l&&c.color.equals(l.color),_=l&&c.fontFace===l.fontFace,v=l&&c.fontSizeUnit===l.fontSizeUnit;if(!l||!(this._ranges[u+1][0]===this._ranges[u+1][1]||f&&d&&_&&v)){var m=c.type===p.Label.Type.Dynamic;switch(e.uniform1i(this._uDynamic,m),m&&e.uniformMatrix4fv(this._uTransform,!1,c.dynamicTransform),void 0!==r&&r.equals(c.color)||(e.uniform4fv(this._uColor,c.color.rgbaF32),r=c.color),i!==c.fontFace&&(c.fontFace.glyphTexture.bind(e.TEXTURE0),i=c.fontFace),c.fontSizeUnit){case p.Label.Unit.Pixel:e.uniformMatrix4fv(this._uViewProjection,!1,o);break;case p.Label.Unit.World:case p.Label.Unit.Mixed:default:e.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection)}this._geometry.draw(n[0],n[1]-n[0]),n[0]=n[1]}}}e.bindTexture(e.TEXTURE_2D,h.Texture2D.DEFAULT_TEXTURE),!1===this._depthMask&&e.depthMask(!0),e.depthFunc(e.LESS),e.disable(e.DEPTH_TEST),e.disable(e.BLEND)}},t.prototype.unbind=function(){this._geometry.valid&&this._geometry.unbind(),this._program.valid&&this._program.unbind()},Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffset",{set:function(e){this.assertInitialized(),this._ndcOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this.assertInitialized(),this._camera!==e&&(this._camera=e,this._altered.alter("camera"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labels",{get:function(){return this._labels},set:function(e){this._labels=e,this._ranges.length=this._labels.length,this._verticesPerLabel.length=this._labels.length,this._verticesPerLabel.fill(void 0),this._altered.alter("labels")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aaStepScale",{get:function(){return this._aaStepScale},set:function(e){this._aaStepScale!==e&&(this._aaStepScale=e,this._altered.alter("aaStepScale"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aaSampling",{get:function(){return this._aaSampling},set:function(e){this._aaSampling!==e&&(this._aaSampling=e,this._altered.alter("aaSampling"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0}),t.DEFAULT_AA_STEP_SCALE=.6666,o([c.Initializable.initialize()],t.prototype,"initialize",null),o([c.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([c.Initializable.assert_initialized()],t.prototype,"update",null),o([c.Initializable.assert_initialized()],t.prototype,"frame",null),o([c.Initializable.assert_initialized()],t.prototype,"unbind",null),t}(c.Initializable);t.LabelRenderPass=g,function(e){!function(e){e[e.None=0]="None",e[e.Smooth1=1]="Smooth1",e[e.Horizontal3=2]="Horizontal3",e[e.Vertical3=3]="Vertical3",e[e.Grid3x3=4]="Grid3x3",e[e.Grid4x4=5]="Grid4x4"}(e.Sampling||(e.Sampling={}))}(g=t.LabelRenderPass||(t.LabelRenderPass={})),t.LabelRenderPass=g},function(e,t){e.exports="precision mediump float;\r\nprecision lowp int;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n\r\n#extension GL_EXT_draw_buffers : enable\r\nattribute vec2 a_vertex;\r\n/* [ texture ll: vec2, ur: vec2 ] */\r\nattribute vec4 a_texCoord;\r\nattribute vec3 a_origin;\r\nattribute vec3 a_tangent;\r\nattribute vec3 a_up;\r\n\r\n#else\r\n\r\nin vec2 a_vertex;\r\n/* [ texture ll: vec2, ur: vec2 ]*/\r\nin vec4 a_texCoord;\r\nin vec3 a_origin;\r\nin vec3 a_tangent;\r\nin vec3 a_up;\r\n\r\n#endif\r\n\r\n\r\nuniform mat4 u_viewProjection;\r\nuniform vec2 u_ndcOffset;\r\nuniform mat4 u_transform;\r\nuniform bool u_dynamic;\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid ndcOffset(inout vec4 vertex, in vec2 offset) {\r\n    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r\n}\r\n\r\n\r\n\r\nvoid main(void)\r\n{\r\n    /* TEXTURE COORDS */\r\n\r\n    /* flip y-coordinates */\r\n    vec2 texExt = vec2(a_texCoord[2] - a_texCoord[0], a_texCoord[1] - a_texCoord[3]);\r\n\r\n    v_uv = a_vertex * texExt + vec2(a_texCoord[0], 1.0 - a_texCoord[1]);\r\n\r\n    /* POSITIONING */\r\n    /* quad data as flat array: [0, 0,  0, 1,  1, 0,  1, 1] (a_vertex), which translates to ll, lr, ul, ur corners.\r\n     * 2-------4\r\n     * |  \\    |\r\n     * |    \\  |\r\n     * 1-------3\r\n     * The current vertex is calculated based on the current quad corners and the tangent attributes.\r\n     * The following lines are optimized for MAD optimization.\r\n     */\r\n    vec3 tangentDirection = a_origin + a_vertex.x * a_tangent;\r\n    vec4 vertex = vec4(tangentDirection + a_vertex.y * a_up, 1.0);\r\n\r\n    if(u_dynamic) {\r\n        vertex = u_transform * vertex;\r\n    }\r\n    vertex = u_viewProjection * vertex;\r\n\r\n    ndcOffset(vertex, u_ndcOffset);\r\n    gl_Position = vertex;\r\n}\r\n"},function(e,t){e.exports="precision mediump float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n\r\n    #ifdef GL_OES_standard_derivatives\r\n        #extension GL_OES_standard_derivatives : enable\r\n        #define AASTEP\r\n    #endif\r\n\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n\r\n    #define AASTEP\r\n\r\n#endif\r\n\r\n\r\nuniform sampler2D u_glyphs;\r\nuniform vec4 u_color;\r\nuniform float u_aaStepScale;\r\nuniform int u_aaSampling;\r\n\r\nvarying vec2 v_uv;\r\n\r\nconst int channel = 0;\r\n\r\n\r\nfloat aastep(float t, float value)\r\n{\r\n#ifdef AASTEP\r\n    /* float afwidth = length(vec2(dFdx(value), dFdy(value))) * u_aaStepScale; */\r\n    float afwidth = fwidth(value) * u_aaStepScale;\r\n    /* The aa step scale is more of a hack to provide seemingly smoother (e.g., >= 1.0) or crisper (e.g., between 0.0\r\n     * and 1.0) contours without specific sampling. It's just scaling the outcome of the derivatives.\r\n     */\r\n\r\n    return smoothstep(t - afwidth, t + afwidth, value);\r\n#else\r\n    return step(t, value);\r\n#endif\r\n}\r\n\r\nfloat texStep(float t, vec2 uv)\r\n{\r\n    /*\r\n     * This is a workaround for a known bug in Chrome software rendering (SwiftShader), for updates follow\r\n     * https://issuetracker.google.com/u/1/issues/146041290\r\n     * Workaround: Storing the result of the texture access into another variable that then is passed as parameter.\r\n     */\r\n    float distanceValue = texture(u_glyphs, uv)[channel];\r\n    return step(t, distanceValue);\r\n}\r\n\r\nfloat texSmooth(float t, vec2 uv)\r\n{\r\n    /*\r\n     * This is a workaround for a known bug in Chrome software rendering (SwiftShader), for updates follow\r\n     * https://issuetracker.google.com/u/1/issues/146041290\r\n     * Workaround: Storing the result of the texture access into another variable that then is passed as parameter.\r\n     */\r\n    float distanceValue = texture(u_glyphs, uv)[channel];\r\n    return aastep(t, distanceValue);\r\n}\r\n\r\n#ifdef AASTEP\r\n\r\nfloat aastep3h(float t, vec2 uv)\r\n{\r\n    float x = dFdy(uv.x) * 1.0 / 3.0;\r\n\r\n    float v = texSmooth(t, uv + vec2( -x, 0.0))\r\n            + texSmooth(t, uv + vec2(0.0, 0.0))\r\n            + texSmooth(t, uv + vec2( +x, 0.0));\r\n\r\n    return v / 3.0;\r\n}\r\n\r\nfloat aastep3v(float t, vec2 uv)\r\n{\r\n    float y = dFdy(uv.y) * 1.0 / 3.0;\r\n\r\n    float v = texSmooth(t, uv + vec2( 0.0,  -y))\r\n            + texSmooth(t, uv + vec2( 0.0, 0.0))\r\n            + texSmooth(t, uv + vec2( 0.0,  +y));\r\n\r\n    return v / 3.0;\r\n}\r\n\r\nfloat aastep3x3(float t, vec2 uv)\r\n{\r\n    float x = dFdx(uv.x) * 1.0 / 3.0;\r\n    float y = dFdy(uv.y) * 1.0 / 3.0;\r\n\r\n    float v = texSmooth(t, uv + vec2(  -x, -y)) + texSmooth(t, uv + vec2(  -x, 0.0)) + texSmooth(t, uv + vec2(  -x, +y))\r\n            + texSmooth(t, uv + vec2( 0.0, -y)) + texSmooth(t, uv + vec2( 0.0, 0.0)) + texSmooth(t, uv + vec2( 0.0, +y))\r\n            + texSmooth(t, uv + vec2(  +x, -y)) + texSmooth(t, uv + vec2(  +x, 0.0)) + texSmooth(t, uv + vec2(  +x, +y));\r\n\r\n    return v / 9.0;\r\n}\r\n\r\nfloat aastep4x4(float t, vec2 uv)\r\n{\r\n    float x0 = dFdx(uv.x);\r\n    float y0 = dFdx(uv.y);\r\n    float x1 = x0 * 1.0 / 8.0;\r\n    float y1 = y0 * 1.0 / 8.0;\r\n    float x2 = x0 * 3.0 / 8.0;\r\n    float y2 = y0 * 3.0 / 8.0;\r\n\r\n    float v = texSmooth(t, uv + vec2(-x2,-y2)) + texSmooth(t, uv + vec2(-x2,-y1))\r\n            + texSmooth(t, uv + vec2(-x2,+y1)) + texSmooth(t, uv + vec2(-x2,+y2))\r\n\r\n            + texSmooth(t, uv + vec2(-x1,-y2)) + texSmooth(t, uv + vec2(-x1,-y1))\r\n            + texSmooth(t, uv + vec2(-x1,+y1)) + texSmooth(t, uv + vec2(-x1,+y2))\r\n\r\n            + texSmooth(t, uv + vec2(+x1,-y2)) + texSmooth(t, uv + vec2(+x1,-y1))\r\n            + texSmooth(t, uv + vec2(+x1,+y1)) + texSmooth(t, uv + vec2(+x1,+y2))\r\n\r\n            + texSmooth(t, uv + vec2(+x2,-y2)) + texSmooth(t, uv + vec2(+x2,-y1))\r\n            + texSmooth(t, uv + vec2(+x2,+y1)) + texSmooth(t, uv + vec2(+x2,+y2));\r\n\r\n    return v / 16.0;\r\n}\r\n\r\n// vec4 subpix(float r, float g, float b, vec4 fore, vec4 back)\r\n// {\r\n//     return vec4(mix(back.rgb, fore.rgb, vec3(r, g, b)), mix(back.a, fore.a, (r + b + g) / 3.0));\r\n// }\r\n\r\n#endif\r\n\r\nvoid main(void)\r\n{\r\n    /** @todo mipmap access? */\r\n\r\n    float a = 0.0;\r\n    /* When using multiframe sampling, might not be necessary and even tends to add more blur */\r\n#ifdef AASTEP\r\n    if(u_aaSampling == 0) {         // LabelRenderPass.Sampling.None\r\n#endif\r\n\r\n        a = texStep(0.5, v_uv);\r\n\r\n#ifdef AASTEP\r\n    } else if(u_aaSampling == 1) {  // LabelRenderPass.Sampling.Smooth\r\n        a = texSmooth(0.5, v_uv);\r\n    } else if(u_aaSampling == 2) {  // LabelRenderPass.Sampling.Horizontal3\r\n        a = aastep3h(0.5, v_uv);\r\n    } else if(u_aaSampling == 3) {  // LabelRenderPass.Sampling.Vertical3\r\n        a = aastep3v(0.5, v_uv);\r\n    } else if(u_aaSampling == 4) {  // LabelRenderPass.Sampling.Grid3x3\r\n        a = aastep3x3(0.5, v_uv);\r\n    } else if(u_aaSampling == 5) {  // LabelRenderPass.Sampling.Grid4x4\r\n        a = aastep4x4(0.5, v_uv);\r\n    }\r\n#endif\r\n\r\n    /**\r\n     * @todo - design decision: Don't discard fragments?, as we might need them for an id-buffer for\r\n     * clicking-interaction. Furthermore, using if-statement and discard can slow down performance:\r\n     * it's bad for IMR, TBR, TBDR and early-Z optimization\r\n     * https://stackoverflow.com/questions/8509051/is-discard-bad-for-program-performance-in-opengl\r\n     */\r\n    if(a <= 0.0) {\r\n        discard;\r\n    }\r\n    fragColor = vec4(u_color.rgb, u_color.a * a);\r\n\r\n    /* use when pre-multiplied color is required. */\r\n    /* fragColor = vec4(u_color.rgb * u_color.a * a, u_color.a * a); */\r\n}\r\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(134);t.GLTFLoader=i.GLTFLoader;var n=r(76);t.GLTFAlphaMode=n.GLTFAlphaMode,t.GLTFPbrMaterial=n.GLTFPbrMaterial,t.GLTFShaderFlags=n.GLTFShaderFlags;var o=r(77);t.GLTFPrimitive=o.GLTFPrimitive;var a=r(75);t.GLTFMesh=a.GLTFMesh},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}u((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((n=(n=a.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=r(135),u=r(136),c=r(75),l=r(76),f=r(77),h=r(5),d=r(65),p=r(6),_=r(25),v=r(68),m=r(7),b=r(4),g=function(){function e(e){this._context=e;var t=this._context.gl;this._resourceManager=new d.ResourceManager(this._context),this._scenes=new Array;var i=new m.Shader(this._context,t.VERTEX_SHADER,"gltf_default.vert");i.initialize(r(137));var n=new m.Shader(this._context,t.FRAGMENT_SHADER,"gltf_default.frag");n.initialize(r(138)),this._pbrProgram=new p.Program(this._context,"GLTFPbrProgram"),this._pbrProgram.initialize([i,n])}return e.prototype.loadTextures=function(e){return i(this,void 0,void 0,function(){var t,r,i,o,s,u,c,l,f,h,d,p,_,v,m,g,y;return n(this,function(n){switch(n.label){case 0:if(t=this._context.gl,r=e.gltf.textures,i=e.gltf.images,o=e.gltf.samplers,!r||!i)return[2];s=0,u=0,c=r,n.label=1;case 1:return u<c.length?void 0===(l=c[u]).source?(a.log(a.LogLevel.Warning,"The GLTF model does not specify a texture source. Possibly it uses an unsupported extension."),s++,[3,3]):(f=l.source,h=i[f],d=this._sceneName+"_texture_"+s,p=void 0===h.name?h.uri:h.name,[4,e.imageData.get(f)]):[3,4];case 2:_=n.sent(),a.isPowerOfTwo(_.width)&&a.isPowerOfTwo(_.height)||((v=document.createElement("canvas")).width=a.upperPowerOfTwo(_.width),v.height=a.upperPowerOfTwo(_.height),void 0===(m=v.getContext("2d"))&&a.log(a.LogLevel.Error,"Failed to create context while trying to resize non power of two texture"),m.drawImage(_,0,0,v.width,v.height),_=v),(g=new b.Texture2D(this._context,p)).initialize(_.width,_.height,t.RGBA8,t.RGBA,t.UNSIGNED_BYTE),g.data(_),void 0===o||void 0===l.sampler?(g.wrap(t.REPEAT,t.REPEAT),g.filter(t.LINEAR,t.LINEAR)):(y=o[l.sampler],g.wrap(y.wrapS||t.REPEAT,y.wrapT||t.REPEAT),g.filter(y.magFilter||t.LINEAR,y.minFilter||t.LINEAR),y.minFilter!==t.NEAREST_MIPMAP_NEAREST&&y.minFilter!==t.LINEAR_MIPMAP_NEAREST&&y.minFilter!==t.NEAREST_MIPMAP_LINEAR&&y.minFilter!==t.LINEAR_MIPMAP_LINEAR||g.generateMipMap()),this._resourceManager.add(g,[p,d]),s++,n.label=3;case 3:return u++,[3,1];case 4:return[2]}})})},e.prototype.getTexture=function(e){var t=this._sceneName+"_texture_"+e,r=this._resourceManager.get(t);if(void 0!==r)return r;a.log(a.LogLevel.Warning,"Texture with index "+e+" could not be located.")},e.prototype.loadMaterials=function(e){return i(this,void 0,void 0,function(){var t,r,i,s,u,c,f,h,d,p,_,v,m;return n(this,function(n){if(this._pbrDefaultMaterial=new l.GLTFPbrMaterial(this._context,"DefaultMaterial"),this._resourceManager.add(this._pbrDefaultMaterial,[this._pbrDefaultMaterial.name]),!(t=e.gltf.materials))return[2];for(r=0,i=0,s=t;i<s.length;i++)u=s[i],c=this._sceneName+"_material_"+r,f=new l.GLTFPbrMaterial(this._context,u.name),void 0!==(h=u.normalTexture)&&(f.normalTexture=this.getTexture(h.index),f.normalTexCoord=h.texCoord||0,f.normalScale=h.scale||1),void 0!==(d=u.occlusionTexture)&&(f.occlusionTexture=this.getTexture(d.index),f.occlusionTexCoord=d.texCoord||0),void 0!==(p=u.emissiveTexture)&&(f.emissiveTexture=this.getTexture(p.index),f.emissiveTexCoord=p.texCoord||0),f.emissiveFactor=o.vec3.fromValues(0,0,0),void 0!==u.emissiveFactor&&(f.emissiveFactor=o.vec3.fromValues.apply(void 0,u.emissiveFactor)),f.alphaMode=l.GLTFAlphaMode.OPAQUE,"MASK"===u.alphaMode?(f.alphaMode=l.GLTFAlphaMode.MASK,void 0===u.alphaCutoff?f.alphaCutoff=.5:f.alphaCutoff=u.alphaCutoff):"BLEND"===u.alphaMode&&(f.alphaMode=l.GLTFAlphaMode.BLEND,f.isTransparent=!0),f.isDoubleSided=u.doubleSided||!1,void 0===(_=u.pbrMetallicRoughness)&&a.log(a.LogLevel.Warning,"Model contains a material without PBR information"),void 0!==(v=_.baseColorTexture)&&(f.baseColorTexture=this.getTexture(v.index),f.baseColorTexCoord=v.texCoord||0),void 0!==(m=_.metallicRoughnessTexture)&&(f.metallicRoughnessTexture=this.getTexture(m.index),f.metallicRoughnessTexCoord=m.texCoord||0),f.baseColorFactor=o.vec4.fromValues(1,1,1,1),void 0!==_.baseColorFactor&&(f.baseColorFactor=o.vec4.fromValues.apply(void 0,_.baseColorFactor)),f.metallicFactor=1,void 0!==_.metallicFactor&&(f.metallicFactor=_.metallicFactor),f.roughnessFactor=1,void 0!==_.roughnessFactor&&(f.roughnessFactor=_.roughnessFactor),this._resourceManager.add(f,[u.name,c]),r++;return[2]})})},e.prototype.inferBufferUsage=function(e,t){var r=this._context.gl,i=e.gltf.meshes,n=e.gltf.accessors;if(void 0===i||void 0===n)return a.log(a.LogLevel.Error,"Asset does not include any meshes or accessors"),r.ARRAY_BUFFER;for(var o=0,s=i;o<s.length;o++)for(var u=0,c=s[o].primitives;u<c.length;u++){var l=c[u].indices;if(void 0!==l){var f=n[l].bufferView;if(void 0!==f&&f===t)return r.ELEMENT_ARRAY_BUFFER}}return r.ARRAY_BUFFER},e.prototype.loadBuffers=function(e){return i(this,void 0,void 0,function(){var t,r,i,o,s,u,c,l,f,d,p,_,v,m,b,g,y;return n(this,function(n){switch(n.label){case 0:if(t=this._context.gl,r=e.gltf.bufferViews,i=e.gltf.accessors,!r)return a.log(a.LogLevel.Warning,"The asset does not include any buffer view information."),[2];if(!i)return a.log(a.LogLevel.Warning,"The asset does not include any accessor information."),[2];o=0,s=0,u=r,n.label=1;case 1:return s<u.length?(c=u[s],b=this._sceneName+"_bufferView_"+o,[4,e.bufferViewData(o)]):[3,4];case 2:y=n.sent(),void 0===(l=c.target)&&(l=this.inferBufferUsage(e,o)),(g=new h.Buffer(this._context,b)).initialize(l),g.data(y,t.STATIC_DRAW),this._resourceManager.add(g,[b]),o++,n.label=3;case 3:return s++,[3,1];case 4:f=0,d=0,p=i,n.label=5;case 5:return d<p.length?(_=p[d],v=_.bufferView,m=_.sparse,void 0!==v&&void 0===m?[3,7]:(b=this._sceneName+"_accessor_"+f,g=new h.Buffer(this._context,b),[4,e.accessorData(f)])):[3,9];case 6:y=n.sent(),g.initialize(t.ARRAY_BUFFER),g.data(y,t.STATIC_DRAW),this._resourceManager.add(g,[b]),n.label=7;case 7:f++,n.label=8;case 8:return d++,[3,5];case 9:return[2]}})})},e.prototype.loadMeshes=function(e){return i(this,void 0,void 0,function(){var t,r,i,o,s,u,l,f,h,d,p;return n(this,function(n){switch(n.label){case 0:if(t=new Array,void 0===(r=e.gltf.meshes))return a.log(a.LogLevel.Warning,"The asset does not contain any mesh information"),[2,t];i=0,o=0,s=r,n.label=1;case 1:if(!(o<s.length))return[3,7];u=s[o],l=new c.GLTFMesh,f=0,h=u.primitives,n.label=2;case 2:return f<h.length?(d=h[f],[4,this.loadPrimitive(e,d,i)]):[3,5];case 3:void 0!==(p=n.sent())&&l.addPrimitive(p),i++,n.label=4;case 4:return f++,[3,2];case 5:t.push(l),n.label=6;case 6:return o++,[3,1];case 7:return[2,t]}})})},e.prototype.loadPrimitive=function(e,t,r){return i(this,void 0,void 0,function(){var i,o,c,h,d,p,_,v,m,b,g,y,E,x,T,O,P,A,L,w,S,R,M,I,N;return n(this,function(n){if(i=this._context.gl,o=e.gltf.accessors,c=e.gltf.bufferViews,void 0===o)return a.log(a.LogLevel.Error,"GLTF asset does not have any accessors."),[2];if(void 0===c)return a.log(a.LogLevel.Error,"GLTF asset does not have any buffer views."),[2];for(y in h=t.mode,d=this._sceneName+"_primitive_"+r,h||(h=4),p=u.GLTFHelper.modeToEnum(i,h),_=new Array,v=this._pbrDefaultMaterial,void 0!==t.material&&(m=this._sceneName+"_material_"+t.material,void 0!==(b=this._resourceManager.get(m))?v=b:a.log(a.LogLevel.Warning,"Material "+m+" could not be found.")),g=0,t.attributes)E=u.GLTFHelper.nameToAttributeIndex(y),"NORMAL"===y&&(g|=l.GLTFShaderFlags.HAS_NORMALS),"TANGENT"===y&&(g|=l.GLTFShaderFlags.HAS_TANGENTS),"COLOR_0"===y&&(g|=l.GLTFShaderFlags.HAS_COLORS),"TEXCOORD_0"!==y&&"TEXCOORD_1"!==y&&"TEXCOORD_2"!==y||(g|=l.GLTFShaderFlags.HAS_UV),x=t.attributes[y],S=o[x],R=S.bufferView,T=S.sparse,I=void 0,O=0,void 0===R||void 0!==T?(P=this._sceneName+"_accessor_"+x,I=this._resourceManager.get(P)):(A=c[R],M=this._sceneName+"_bufferView_"+R,I=this._resourceManager.get(M),O=A.byteStride||0),(L=new f.VertexBinding).buffer=I,L.attributeIndex=E,L.numVertices=S.count,L.normalized=S.normalized||!1,L.size=s.GLTF_ELEMENTS_PER_TYPE[S.type],L.offset=S.byteOffset||0,L.stride=O,L.type=S.componentType,_.push(L);return void 0!==t.indices&&(S=o[t.indices],void 0===!(R=S.bufferView)&&a.log(a.LogLevel.Error,"Accessor does not reference a BufferView."),M=this._sceneName+"_bufferView_"+R,I=this._resourceManager.get(M),(w=new f.IndexBinding).buffer=I,w.numIndices=S.count,w.offset=S.byteOffset||0,w.type=S.componentType),(N=new f.GLTFPrimitive(this._context,_,w,p,v,g)).initialize(),this._resourceManager.add(N,[d]),[2,N]})})},e.prototype.generateScenes=function(e,t){return i(this,void 0,void 0,function(){var r,i,s,u,c,l,f,h,d,p,m,b,g,y,E,x,T,O,P,A,L,w,S,R,M,I,N,C,F,B,j,D,z,G;return n(this,function(n){if(r=e.gltf.nodes,i=e.gltf.scenes,!r||!i)return a.log(a.LogLevel.Warning,"The asset does not contain any nodes or scene information."),[2];for(s=new Map,u=0,c=0,l=r;c<l.length;c++){if(z=l[c],f=z.name||"node_"+u,F=new v.SceneNode(f),s.set(u,F),z.matrix?(m=o.mat4.fromValues.apply(void 0,z.matrix),b=new _.TransformComponent(m),F.addComponent(b)):(z.translation||z.rotation||z.scale)&&(h=o.quat.create(),z.rotation&&(h=o.quat.fromValues.apply(void 0,z.rotation)),d=o.vec3.create(),z.translation&&(d=o.vec3.fromValues.apply(void 0,z.translation)),p=o.vec3.fromValues(1,1,1),z.scale&&(p=o.vec3.fromValues.apply(void 0,z.scale)),m=o.mat4.fromRotationTranslationScale(o.mat4.create(),h,d,p),b=new _.TransformComponent(m),F.addComponent(b)),void 0!==z.mesh)for(g=t[z.mesh],y=0,E=g.primitives;y<E.length;y++)x=E[y],(T=new _.GeometryComponent).material=x.material,T.geometry=x,F.addComponent(T);(z.skin||z.weights)&&a.log(a.LogLevel.Info,"Imported GLTF assets uses skins, which are not supported yet."),u++}for(u=0,O=0,P=r;O<P.length;O++){if(z=P[O],F=s.get(u),a.assert(void 0!==F,"Scene node could not be found."),z.children)for(A=0,L=z.children;A<L.length;A++)w=L[A],(S=s.get(w))||a.log(a.LogLevel.Error,"Model references a node that does not exist."),F.addNode(S);u++}for(R=0,M=0,I=i;M<I.length;M++){if(N=I[M],C=N.name||"scene_"+R,F=new v.SceneNode(C),N.nodes)for(B=0,j=N.nodes;B<j.length;B++)D=j[B],(z=s.get(D))||a.log(a.LogLevel.Error,"Scene references a node that does not exist."),F.addNode(z);else a.log(a.LogLevel.Warning,"Scene "+C+" does not contain any nodes.");this._scenes.push(F),R++}return void 0!==(G=e.gltf.scene)&&(this._defaultScene=this._scenes[G]),[2]})})},e.prototype.loadAsset=function(e){return i(this,void 0,void 0,function(){var t,r,i=this;return n(this,function(n){switch(n.label){case 0:return[4,(new s.GltfLoader).load(e)];case 1:return t=n.sent(),r=t.gltf,this._sceneName="scene",r.scenes&&r.scene&&r.scenes[r.scene].name&&(this._sceneName=r.scenes[r.scene].name),[4,this.loadTextures(t).then(function(){return i.loadMaterials(t)}).then(function(){return i.loadBuffers(t)}).then(function(){return i.loadMeshes(t)}).then(function(e){return i.generateScenes(t,e)})];case 2:return n.sent(),[2]}})})},e.prototype.uninitialize=function(){this._scenes=[],this._defaultScene=void 0,this._resourceManager.uninitialize()},Object.defineProperty(e.prototype,"pbrProgram",{get:function(){return this._pbrProgram},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scenes",{get:function(){return this._scenes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultScene",{get:function(){return void 0!==this._defaultScene?this._defaultScene:void 0!==this._scenes&&this._scenes.length>0?this._scenes[0]:(a.log(a.LogLevel.Warning,"Default scene was requested, but none is available."),new v.SceneNode("EmptyScene"))},enumerable:!0,configurable:!0}),e}();t.GLTFLoader=g},function(e,t){e.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadingManager=class{constructor(){this.urlModifier=void 0,this.onStart=void 0,this.onProgress=void 0,this.onLoad=void 0,this.onError=void 0,this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0}itemStart(e){this.itemsTotal++,!this.isLoading&&this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(e){this.itemsLoaded++,this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,this.onLoad&&this.onLoad())}itemError(e){this.onError&&this.onError(e)}resolveURL(e){return this.urlModifier?this.urlModifier(e):e}}},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),o=r(0);t.GLTF_COMPONENT_TYPE_ARRAYS={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},t.GLTF_ELEMENTS_PER_TYPE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},t.GltfAsset=class{constructor(e,t,r,i=new o.LoadingManager){this.gltf=e,this.glbData=r,this.bufferData=new a(this,t,i),this.imageData=new s(this,t,i)}bufferViewData(e){return i(this,void 0,void 0,function*(){if(!this.gltf.bufferViews)throw new Error("No buffer views found.");const t=this.gltf.bufferViews[e],r=yield this.bufferData.get(t.buffer),i=t.byteLength||0,n=t.byteOffset||0,o=r.buffer,a=r.byteOffset;return new Uint8Array(o,a+n,i)})}accessorData(e){return i(this,void 0,void 0,function*(){if(!this.gltf.accessors)throw new Error("No accessors views found.");const r=this.gltf.accessors[e],i=t.GLTF_ELEMENTS_PER_TYPE[r.type];let n;if(void 0!==r.bufferView)n=yield this.bufferViewData(r.bufferView);else{const e=t.GLTF_COMPONENT_TYPE_ARRAYS[r.componentType].BYTES_PER_ELEMENT*i*r.count;n=new Uint8Array(e)}if(r.sparse){const{count:e,indices:o,values:a}=r.sparse;let s=t.GLTF_COMPONENT_TYPE_ARRAYS[o.componentType],u=yield this.bufferViewData(o.bufferView);const c=new s(u.buffer,u.byteOffset+(o.byteOffset||0),e);s=t.GLTF_COMPONENT_TYPE_ARRAYS[r.componentType],u=yield this.bufferViewData(a.bufferView);const l=new s((yield this.bufferViewData(a.bufferView)).buffer,u.byteOffset+(a.byteOffset||0),e*i);r.bufferView&&(n=new Uint8Array(n));const f=new t.GLTF_COMPONENT_TYPE_ARRAYS[r.componentType](n.buffer);for(let t=0;t<e;t++)for(let e=0;e<i;e++)f[i*c[t]+e]=l[i*t+e]}return n})}preFetchAll(){return i(this,void 0,void 0,function*(){return Promise.all([this.bufferData.preFetchAll(),this.imageData.preFetchAll()])})}};class a{constructor(e,t,r){this.bufferCache=[],this.asset=e,this.baseUri=t,this.manager=r,this.loader=new n.FileLoader(r),this.loader.responseType="arraybuffer"}get(e){return i(this,void 0,void 0,function*(){if(void 0!==this.bufferCache[e])return this.bufferCache[e];const t=this.asset.gltf;if(!t.buffers)throw new Error("No buffers found.");const r=t.buffers[e];if(void 0===r.uri){if(0!==e)throw new Error("GLB container is required to be the first buffer");if(void 0===this.asset.glbData)throw new Error("invalid gltf: buffer has no uri nor is there a GLB buffer");return this.asset.glbData.binaryChunk}const i=u(r.uri,this.baseUri),n=yield this.loader.load(i),o=new Uint8Array(n);return this.bufferCache[e]=o,o})}preFetchAll(){return i(this,void 0,void 0,function*(){const e=this.asset.gltf.buffers;return e?Promise.all(e.map((e,t)=>this.get(t))):[]})}}t.BufferData=a;class s{constructor(e,t,r){this.crossOrigin="anonymous",this.imageCache=[],this.asset=e,this.baseUri=t,this.manager=r}get(e){return i(this,void 0,void 0,function*(){if(void 0!==this.imageCache[e])return this.imageCache[e];const t=this.asset.gltf;if(!t.images)throw new Error("No images found.");const r=t.images[e];let i,n=!1;if(void 0!==r.bufferView){const e=yield this.asset.bufferViewData(r.bufferView);n=!0;const t=new Blob([e],{type:r.mimeType});i=URL.createObjectURL(t)}else{if(void 0===r.uri)throw new Error("Invalid glTF: image must either have a `uri` or a `bufferView`");i=this.manager.resolveURL(u(r.uri,this.baseUri))}const o=new Image;return o.crossOrigin=this.crossOrigin,new Promise((t,r)=>{o.onerror=(()=>{r("Failed to load "+i),this.manager.itemEnd(i),this.manager.itemError(i)}),o.onload=(()=>{n&&URL.revokeObjectURL(i),this.imageCache[e]=o,t(o),this.manager.itemEnd(i)}),o.src=i,this.manager.itemStart(i)})})}preFetchAll(){return i(this,void 0,void 0,function*(){const e=this.asset.gltf.images;return e?Promise.all(e.map((e,t)=>this.get(t))):[]})}}function u(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e}t.ImageData=s,t.resolveURL=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoaderUtils=class{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(const r of e)t+=String.fromCharCode(r);return decodeURIComponent(escape(t))}static extractUrlBase(e){const t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileLoader=class{constructor(e){this.runningRequests={},this.manager=e}load(e,t){if(void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e),this.runningRequests[e])return this.runningRequests[e];const r=new Promise((r,i)=>{const n=new XMLHttpRequest;n.open("GET",e,!0);const o=this;n.onload=function(t){const a=this.response;0===this.status?(console.warn("FileLoader: HTTP Status 0 received."),r(a),o.manager.itemEnd(e)):200===this.status?(r(a),o.manager.itemEnd(e)):(i({url:e,status:this.status,statusText:n.statusText}),o.manager.itemEnd(e),o.manager.itemError(e)),delete o.runningRequests[e]},n.onprogress=(e=>{t&&t(e)}),n.onerror=function(t){i({url:e,status:this.status,statusText:n.statusText}),o.manager.itemEnd(e),o.manager.itemError(e),delete o.runningRequests[e]},this.responseType&&(n.responseType=this.responseType),this.withCredentials&&(n.withCredentials=this.withCredentials),this.mimeType&&n.overrideMimeType&&n.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeaders)n.setRequestHeader(e,this.requestHeaders[e]);n.send(null),this.manager.itemStart(e)});return this.runningRequests[e]=r,r}setRequestHeader(e,t){return this.requestHeaders[e]=t,this}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2);t.BINARY_HEADER_MAGIC="glTF";t.GLTFBinaryData=class{constructor(e){const r=new DataView(e,0,12),n=i.LoaderUtils.decodeText(new Uint8Array(e,0,4)),o=r.getUint32(4,!0);if(r.getUint32(8,!0),n!==t.BINARY_HEADER_MAGIC)throw new Error("Unsupported glTF-Binary header.");if(o<2)throw new Error("Unsupported legacy binary file detected.");const a=new DataView(e,12);let s=0;for(;s<a.byteLength;){const t=a.getUint32(s,!0);s+=4;const r=a.getUint32(s,!0);if(s+=4,1313821514===r){const r=new Uint8Array(e,12+s,t);this.json=i.LoaderUtils.decodeText(r)}else if(5130562===r){const r=12+s;this.binaryChunk=new Uint8Array(e,r,t)}s+=t}if(null===this.json)throw new Error("glTF-Binary: JSON content not found.")}}},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(e){o(e)}}function s(e){try{u(i.throw(e))}catch(e){o(e)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(a,s)}u((i=i.apply(e,t||[])).next())})};function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});const o=r(3),a=r(5),s=r(1),u=r(2),c=r(0),l=r(4);t.gltf=l,n(r(1)),n(r(0)),t.GltfLoader=class{constructor(e){this.manager=e||new c.LoadingManager}load(e,t){return i(this,void 0,void 0,function*(){const r=u.LoaderUtils.extractUrlBase(e),i=new o.FileLoader(this.manager);i.responseType="arraybuffer";const n=yield i.load(e,t);return yield this.parse(n,r)})}loadFromFiles(e){return i(this,void 0,void 0,function*(){let t,r;for(const[i,n]of e)n.name.match(/\.(gltf|glb)$/)&&(t=n,r=i.replace(n.name,""));if(!t)throw new Error("No .gltf or .glb asset found.");const i="string"==typeof t?t:URL.createObjectURL(t),n=u.LoaderUtils.extractUrlBase(i),o=[];this.manager.urlModifier=(t=>{const i=r+t.replace(n,"").replace(/^(\.?\/)/,"");if(e.has(i)){const t=e.get(i),r=URL.createObjectURL(t);return o.push(r),r}return t});const a=yield this.load(i);return yield a.preFetchAll(),URL.revokeObjectURL(i),o.forEach(URL.revokeObjectURL),a})}parse(e,t){return i(this,void 0,void 0,function*(){let r,i=void 0;r="string"==typeof e?e:u.LoaderUtils.decodeText(new Uint8Array(e,0,4))===a.BINARY_HEADER_MAGIC?(i=new a.GLTFBinaryData(e)).json:u.LoaderUtils.decodeText(new Uint8Array(e));const n=JSON.parse(r);if(void 0===n.asset||n.asset.version[0]<2)throw new Error("Unsupported asset. glTF versions >=2.0 are supported.");return new s.GltfAsset(n,t,i,this.manager)})}}},function(e,t,r){e.exports=r(6)}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),n=function(){function e(){}return e.modeToEnum=function(e,t){return(t<0||t>6)&&i.log(i.LogLevel.Error,"Specified draw mode is "+t+" but is required to be between 0 and 6"),0===t?e.POINTS:1===t?e.LINES:2===t?e.LINE_LOOP:3===t?e.LINE_STRIP:4===t?e.TRIANGLES:5===t?e.TRIANGLE_STRIP:6===t?e.TRIANGLE_FAN:e.TRIANGLES},e.nameToAttributeIndex=function(e){return"POSITION"===e?0:"NORMAL"===e?1:"TANGENT"===e?2:"TEXCOORD_0"===e?3:"TEXCOORD_1"===e?4:"TEXCOORD_2"===e?5:"JOINTS_0"===e?6:"WEIGHTS_0"===e?7:"COLOR_0"===e?8:(i.log(i.LogLevel.Warning,"Unknown attribute name '"+e+"' encountered.             Possibly this model uses an unsupported extension."),-1)},e}();t.GLTFHelper=n},function(e,t){e.exports="precision highp float;\r\n\r\n// Adapted from https://github.com/KhronosGroup/glTF-WebGL-PBR\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\nconst int HAS_NORMALS           = 1;\r\nconst int HAS_TANGENTS          = 1 << 1;\r\nconst int HAS_UV                = 1 << 2;\r\nconst int HAS_COLORS            = 1 << 3;\r\n\r\n#if __VERSION__ == 100\r\n    attribute vec4 a_position;\r\n    attribute vec4 a_normal;\r\n    attribute vec4 a_tangent;\r\n    attribute vec2 a_texcoord_0;\r\n    attribute vec2 a_texcoord_1;\r\n    attribute vec2 a_texcoord_2;\r\n    attribute vec4 a_joints;\r\n    attribute vec4 a_weights;\r\n    attribute vec4 a_color;\r\n#else\r\n    layout (location = 0) in vec4 a_position;\r\n    layout (location = 1) in vec3 a_normal;\r\n    layout (location = 2) in vec4 a_tangent;\r\n    layout (location = 3) in vec2 a_texcoord_0;\r\n    layout (location = 4) in vec2 a_texcoord_1;\r\n    layout (location = 5) in vec2 a_texcoord_2;\r\n    layout (location = 6) in vec4 a_joints;\r\n    layout (location = 7) in vec4 a_weights;\r\n    layout (location = 8) in vec4 a_color;\r\n#endif\r\n\r\nuniform mat4 u_model;\r\nuniform mat4 u_viewProjection;\r\nuniform mat3 u_normalMatrix;\r\n\r\nuniform mediump int u_geometryFlags;\r\n\r\nvarying vec2 v_uv[3];\r\nvarying vec4 v_color;\r\nvarying vec3 v_position;\r\n\r\nvarying mat3 v_TBN;\r\nvarying vec3 v_normal;\r\n\r\nbool checkFlag(int flag) {\r\n    return (u_geometryFlags & flag) == flag;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    vec4 pos = u_model * a_position;\r\n    v_position = vec3(pos.xyz) / pos.w;\r\n\r\n    if (checkFlag(HAS_NORMALS)) {\r\n        if (checkFlag(HAS_TANGENTS)) {\r\n            vec3 normalW = normalize(vec3(u_normalMatrix * a_normal));\r\n            vec3 tangentW = normalize(vec3(u_model * vec4(a_tangent.xyz, 0.0)));\r\n            vec3 bitangentW = cross(normalW, tangentW) * a_tangent.w;\r\n            v_TBN = mat3(tangentW, bitangentW, normalW);\r\n        } else { // HAS_TANGENTS != 1\r\n            v_normal = normalize(vec3(u_model * vec4(a_normal.xyz, 0.0)));\r\n        }\r\n    }\r\n\r\n    if (checkFlag(HAS_UV)) {\r\n        v_uv[0] = a_texcoord_0;\r\n        v_uv[1] = a_texcoord_1;\r\n        v_uv[2] = a_texcoord_2;\r\n    } else {\r\n        v_uv[0] = vec2(0., 0.);\r\n        v_uv[1] = vec2(0., 0.);\r\n        v_uv[2] = vec2(0., 0.);\r\n    }\r\n\r\n    if (checkFlag(HAS_COLORS)) {\r\n        v_color = a_color;\r\n    } else {\r\n        v_color = vec4(1.0);\r\n    }\r\n\r\n    gl_Position = u_viewProjection * u_model * a_position;\r\n}\r\n"},function(e,t){e.exports="precision highp float;\r\n\r\n// Adapted from https://github.com/KhronosGroup/glTF-WebGL-PBR\r\n// References:\r\n// [1] Real Shading in Unreal Engine 4\r\n//     http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\r\n// [2] Physically Based Shading at Disney\r\n//     http://blog.selfshadow.com/publications/s2012-shading-course/burley/s2012_pbs_disney_brdf_notes_v3.pdf\r\n// [3] README.md - Environment Maps\r\n//     https://github.com/KhronosGroup/glTF-WebGL-PBR/#environment-maps\r\n// [4] \"An Inexpensive BRDF Model for Physically based Rendering\" by Christophe Schlick\r\n//     https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\nconst int HAS_NORMALS           = 1;\r\nconst int HAS_TANGENTS          = 1 << 1;\r\nconst int HAS_UV                = 1 << 2;\r\nconst int HAS_COLORS            = 1 << 3;\r\nconst int USE_IBL               = 1 << 4;\r\nconst int HAS_BASECOLORMAP      = 1 << 5;\r\nconst int HAS_NORMALMAP         = 1 << 6;\r\nconst int HAS_EMISSIVEMAP       = 1 << 7;\r\nconst int HAS_METALROUGHNESSMAP = 1 << 8;\r\nconst int HAS_OCCLUSIONMAP      = 1 << 9;\r\nconst int USE_TEX_LOD           = 1 << 10;\r\n\r\nconst vec3 u_LightDirection = vec3(0.2, 1.0, 0.2);\r\nconst vec3 u_LightColor = vec3(1, 1, 1);\r\n\r\nconst float M_PI = 3.141592653589793;\r\nconst float c_MinRoughness = 0.04;\r\n\r\nuniform sampler2D u_baseColor;\r\nuniform sampler2D u_metallicRoughness;\r\nuniform sampler2D u_normal;\r\nuniform sampler2D u_emissive;\r\nuniform sampler2D u_occlusion;\r\n\r\nuniform samplerCube u_specularEnvironment;\r\nuniform sampler2D u_brdfLUT;\r\n\r\nuniform int u_baseColorTexCoord;\r\nuniform int u_normalTexCoord;\r\nuniform int u_metallicRoughnessTexCoord;\r\nuniform int u_occlusionTexCoord;\r\nuniform int u_emissiveTexCoord;\r\n\r\nuniform vec4 u_baseColorFactor;\r\nuniform float u_metallicFactor;\r\nuniform float u_roughnessFactor;\r\nuniform vec3 u_emissiveFactor;\r\nuniform float u_normalScale;\r\nuniform int u_blendMode;\r\nuniform float u_blendCutoff;\r\n\r\nuniform mediump int u_geometryFlags;\r\nuniform mediump int u_pbrFlags;\r\nuniform vec3 u_eye;\r\n\r\nvarying vec2 v_uv[3];\r\nvarying vec4 v_color;\r\nvarying vec3 v_position;\r\n\r\nvarying mat3 v_TBN;\r\nvarying vec3 v_normal;\r\n\r\n// Encapsulate the various inputs used by the various functions in the shading equation\r\n// We store values in this struct to simplify the integration of alternative implementations\r\n// of the shading terms, outlined in the Readme.MD Appendix.\r\nstruct PBRInfo\r\n{\r\n    float NdotL;                  // cos angle between normal and light direction\r\n    float NdotV;                  // cos angle between normal and view direction\r\n    float NdotH;                  // cos angle between normal and half vector\r\n    float LdotH;                  // cos angle between light direction and half vector\r\n    float VdotH;                  // cos angle between view direction and half vector\r\n    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\r\n    float metalness;              // metallic value at the surface\r\n    vec3 reflectance0;            // full reflectance color (normal incidence angle)\r\n    vec3 reflectance90;           // reflectance color at grazing angle\r\n    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\r\n    vec3 diffuseColor;            // color contribution from diffuse lighting\r\n    vec3 specularColor;           // color contribution from specular lighting\r\n};\r\n\r\nbool checkGeometryFlag(int flag) {\r\n    return (u_geometryFlags & flag) == flag;\r\n}\r\n\r\nbool checkFlag(int flag) {\r\n    return (u_pbrFlags & flag) == flag;\r\n}\r\n\r\nvec4 SRGBtoLINEAR(vec4 srgbIn)\r\n{\r\n    #ifdef MANUAL_SRGB\r\n    #ifdef SRGB_FAST_APPROXIMATION\r\n    vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\r\n    #else //SRGB_FAST_APPROXIMATION\r\n    vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\r\n    vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\r\n    #endif //SRGB_FAST_APPROXIMATION\r\n    return vec4(linOut,srgbIn.w);;\r\n    #else //MANUAL_SRGB\r\n    return srgbIn;\r\n    #endif //MANUAL_SRGB\r\n}\r\n\r\n// Find the normal for this fragment, pulling either from a predefined normal map\r\n// or from the interpolated mesh normal and tangent attributes.\r\nvec3 getNormal()\r\n{\r\n    // Retrieve the tangent space matrix\r\n    mat3 tbn;\r\n    if (!checkGeometryFlag(HAS_TANGENTS)) {\r\n        vec3 pos_dx = dFdx(v_position);\r\n        vec3 pos_dy = dFdy(v_position);\r\n        vec3 tex_dx = dFdx(vec3(v_uv[0], 0.0));\r\n        vec3 tex_dy = dFdy(vec3(v_uv[0], 0.0));\r\n        vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\r\n\r\n        vec3 ng;\r\n        if (checkGeometryFlag(HAS_NORMALS))\r\n            ng = normalize(v_normal);\r\n        else\r\n            ng = cross(pos_dx, pos_dy);\r\n\r\n            t = normalize(t - ng * dot(ng, t));\r\n            vec3 b = normalize(cross(ng, t));\r\n            tbn = mat3(t, b, ng);\r\n        }\r\n    else { // HAS_TANGENTS\r\n        tbn = v_TBN;\r\n    }\r\n\r\n    vec3 n;\r\n    if (checkFlag(HAS_NORMALMAP)) {\r\n        n = texture(u_normal, v_uv[u_normalTexCoord]).rgb;\r\n        n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_normalScale, u_normalScale, 1.0)));\r\n    } else {\r\n        // The tbn matrix is linearly interpolated, so we need to re-normalize\r\n        n = normalize(tbn[2].xyz);\r\n    }\r\n\r\n    // reverse backface normals\r\n    n *= (2.0 * float(gl_FrontFacing) - 1.0);\r\n\r\n    return n;\r\n}\r\n\r\n// Basic Lambertian diffuse\r\n// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog\r\n// See also [1], Equation 1\r\nvec3 diffuse(PBRInfo pbrInputs)\r\n{\r\n    return pbrInputs.diffuseColor / M_PI;\r\n}\r\n\r\n // The following equation models the Fresnel reflectance term of the spec equation (aka F())\r\n// Implementation of fresnel from [4], Equation 15\r\nvec3 specularReflection(PBRInfo pbrInputs)\r\n{\r\n    return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\r\n}\r\n\r\n // This calculates the specular geometric attenuation (aka G()),\r\n// where rougher material will reflect less light back to the viewer.\r\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\r\n// alphaRoughness as input as originally proposed in [2].\r\nfloat geometricOcclusion(PBRInfo pbrInputs)\r\n{\r\n    float NdotL = pbrInputs.NdotL;\r\n    float NdotV = pbrInputs.NdotV;\r\n    float r = pbrInputs.alphaRoughness;\r\n\r\n    float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\r\n    float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\r\n    return attenuationL * attenuationV;\r\n}\r\n\r\n // The following equation(s) model the distribution of microfacet normals across the area being drawn (aka D())\r\n// Implementation from \"Average Irregularity Representation of a Roughened Surface for Ray Reflection\" by T. S. Trowbridge, and K. P. Reitz\r\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes from EPIC Games [1], Equation 3.\r\nfloat microfacetDistribution(PBRInfo pbrInputs)\r\n{\r\n    float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\r\n    float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\r\n    return roughnessSq / (M_PI * f * f);\r\n}\r\n\r\nvec3 getIBLContribution(vec3 n, vec3 v, PBRInfo pbrInfo)\r\n{\r\n    float NdotV = clamp(dot(n, v), 0.0, 1.0);\r\n\r\n    // TODO: pass uniform for mip count\r\n    const float MIP_COUNT = 8.0;\r\n    float lod = clamp(pbrInfo.perceptualRoughness * MIP_COUNT, 0.0, MIP_COUNT);\r\n    vec3 reflection = normalize(reflect(-v, n));\r\n\r\n    vec2 brdfSamplePoint = vec2(NdotV, pbrInfo.perceptualRoughness);\r\n    vec2 brdf = texture(u_brdfLUT, brdfSamplePoint).rg;\r\n\r\n    // vec4 diffuseSample = textureCube(u_DiffuseEnvSampler, n);\r\n    vec4 specularSample = textureLod(u_specularEnvironment, reflection, lod);\r\n\r\n    // vec3 diffuseLight = SRGBtoLINEAR(diffuseSample).rgb;\r\n    vec3 specularLight = SRGBtoLINEAR(specularSample).rgb;\r\n\r\n    // vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;\r\n    vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);\r\n\r\n    return specular;\r\n    // return diffuse + specular;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    float perceptualRoughness = u_roughnessFactor;\r\n    float metallic = u_metallicFactor;\r\n    if (checkFlag(HAS_METALROUGHNESSMAP)) {\r\n        // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\r\n        // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\r\n        vec4 mrSample = texture(u_metallicRoughness, v_uv[u_metallicRoughnessTexCoord]);\r\n        perceptualRoughness = mrSample.g * perceptualRoughness;\r\n        metallic = mrSample.b * metallic;\r\n    }\r\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\r\n    metallic = clamp(metallic, 0.0, 1.0);\r\n    // Roughness is authored as perceptual roughness; as is convention,\r\n    // convert to material roughness by squaring the perceptual roughness [2].\r\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\r\n\r\n     // The albedo may be defined from a base texture or a flat color\r\n    vec4 baseColor;\r\n    if (checkFlag(HAS_BASECOLORMAP)) {\r\n        baseColor = SRGBtoLINEAR(texture(u_baseColor, v_uv[u_baseColorTexCoord])) * u_baseColorFactor;\r\n    } else {\r\n        baseColor = u_baseColorFactor;\r\n    }\r\n\r\n    // spec: COLOR_0 ... acts as an additional linear multiplier to baseColor\r\n    // TODO!: distinguish vec3/vec4 colors...\r\n    baseColor *= vec4(v_color.rgb, 1.0);\r\n\r\n    vec3 f0 = vec3(0.04);\r\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\r\n    diffuseColor *= 1.0 - metallic;\r\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\r\n\r\n    // Compute reflectance.\r\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\r\n\r\n    // For typical incident reflectance range (between 4% to 100%) set the grazing reflectance to 100% for typical fresnel effect.\r\n    // For very low reflectance range on highly diffuse objects (below 4%), incrementally reduce grazing reflecance to 0%.\r\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\r\n    vec3 specularEnvironmentR0 = specularColor.rgb;\r\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\r\n\r\n    vec3 n = getNormal();                         // normal at surface point\r\n    vec3 v = normalize(u_eye - v_position);        // Vector from surface point to camera\r\n    vec3 l = normalize(u_LightDirection);          // Vector from surface point to light\r\n    vec3 h = normalize(l+v);                       // Half vector between both l and v\r\n    vec3 reflection = -normalize(reflect(v, n));\r\n\r\n    float NdotL = clamp(dot(n, l), 0.001, 1.0);\r\n    float NdotV = abs(dot(n, v)) + 0.001;\r\n    float NdotH = clamp(dot(n, h), 0.0, 1.0);\r\n    float LdotH = clamp(dot(l, h), 0.0, 1.0);\r\n    float VdotH = clamp(dot(v, h), 0.0, 1.0);\r\n\r\n    PBRInfo pbrInputs = PBRInfo(\r\n        NdotL,\r\n        NdotV,\r\n        NdotH,\r\n        LdotH,\r\n        VdotH,\r\n        perceptualRoughness,\r\n        metallic,\r\n        specularEnvironmentR0,\r\n        specularEnvironmentR90,\r\n        alphaRoughness,\r\n        diffuseColor,\r\n        specularColor\r\n    );\r\n\r\n     // Calculate the shading terms for the microfacet specular shading model\r\n    vec3 F = specularReflection(pbrInputs);\r\n    float G = geometricOcclusion(pbrInputs);\r\n    float D = microfacetDistribution(pbrInputs);\r\n\r\n     // Calculation of analytical lighting contribution\r\n    vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\r\n    vec3 specContrib = F * G * D / (4.0 * NdotL * NdotV);\r\n    // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\r\n    vec3 color = NdotL * u_LightColor * (diffuseContrib + specContrib);\r\n\r\n    vec3 environmentLight = getIBLContribution(n, v, pbrInputs);\r\n    color += environmentLight;\r\n\r\n    if (checkFlag(HAS_EMISSIVEMAP)) {\r\n        vec3 emissive = SRGBtoLINEAR(texture(u_emissive, v_uv[u_emissiveTexCoord])).rgb * u_emissiveFactor;\r\n        color += emissive;\r\n    }\r\n\r\n    // NOTE: the spec mandates to ignore any alpha value in 'OPAQUE' mode\r\n    float alpha = 1.0;\r\n    if (u_blendMode == 1) {\r\n        if (baseColor.a < u_blendCutoff) {\r\n            discard;\r\n        }\r\n    }\r\n    else if (u_blendMode == 2) {\r\n        alpha = baseColor.a;\r\n    }\r\n\r\n    fragColor = vec4(pow(color, vec3(1.0/2.2)), alpha);\r\n}\r\n"},function(e,t,r){"use strict";var i,n=r(1),o=r(3),a=r(0);!function(e){function t(e,t,r){void 0===r&&(r=1);var i=n.vec2.subtract(o.v2(),t,e);if(!n.vec2.equals(i,n.vec2.fromValues(0,0))){var a=n.vec2.squaredLength(i),s=2*n.vec2.dot(i,e),u=s*s-4*a*(n.vec2.squaredLength(e)-r*r);if(!(u<0)){var c=Math.sqrt(u),l=Math.min((-s+c)/(2*a),(-s-c)/(2*a)),f=n.vec2.scale(o.v2(),i,l);return n.vec2.add(f,f,e)}}}function r(e,t,r,i){var a=e,s=n.vec2.sub(o.v2(),t,e),u=r,c=n.vec2.sub(o.v2(),i,r),l=n.vec2.cross(o.v3(),s,c)[2];if(0!==l){var f=n.vec2.sub(o.v2(),u,a),h=n.vec2.cross(o.v3(),f,n.vec2.scale(o.v2(),s,1/l))[2],d=n.vec2.cross(o.v3(),f,n.vec2.scale(o.v2(),c,1/l))[2];if(!(h<0||h>1||d<0))return[n.vec2.add(o.v2(),u,n.vec2.scale(o.v2(),c,h)),d]}}function i(e,t,r,i){void 0===r&&(r=n.vec3.fromValues(0,0,0)),void 0===i&&(i=n.vec3.fromValues(0,1,0));var a=n.vec3.normalize(o.v3(),n.vec3.subtract(o.v3(),t,e)),s=n.vec3.dot(a,i);if(!(n.vec3.equals(a,[0,0,0])||s>=0)){var u=n.vec3.dot(n.vec3.subtract(o.v3(),r,e),i)/s;return n.vec3.add(o.v3(),n.vec3.scale(o.v3(),a,u),e)}}function s(e,t,r){var i=n.vec3.subtract(o.v3(),t,e),a=n.vec3.squaredLength(i);if(0===a)return 0;var s=n.vec3.subtract(o.v3(),r,e);return n.vec3.dot(s,i)/a}e.rayCircleIntersection=t,e.pointSquareIntersection=function(e,t){void 0===t&&(t=1);var r=o.abs2(o.v2(),e);return r[0]>=r[1]?n.vec2.fromValues(o.sign(e[0])*t,e[1]/r[0]*t):n.vec2.fromValues(e[0]/r[1]*t,o.sign(e[1])*t)},e.raySquareIntersection=function(e,t,i){void 0===i&&(i=1);for(var o=[n.vec2.fromValues(-i,+i),n.vec2.fromValues(-i,-i),n.vec2.fromValues(+i,-i),n.vec2.fromValues(+i,+i)],a=new Array,s=0;s<4;++s){var u=r(e,t,o[s],o[(s+1)%4]);u&&a.push(u[1])}return a},e.rayLineIntersection=r,e.rayPlaneIntersection=i,e.raySphereIntersection=function(e,t,r,i){void 0===r&&(r=n.vec3.fromValues(0,0,0)),void 0===i&&(i=1);var a=n.vec3.subtract(o.v3(),e,r),s=n.vec3.normalize(o.v3(),n.vec3.subtract(o.v3(),t,e)),u=n.vec3.dot(s,a),c=u*u-n.vec3.squaredLength(a)+i*i;if(!(c<=0))return n.vec3.add(o.v3(),e,n.vec3.scale(o.v3(),s,-u-Math.sqrt(c)))},e.rayPlaneIntersection_tube=function(e,r,o){void 0===o&&(o=1);var a=i(e,r);if(void 0!==a&&n.vec3.length(a)<o)return a;var s=t(n.vec2.fromValues(e[0],e[2]),n.vec2.fromValues(r[0],r[2]),o);return s?n.vec3.fromValues(s[0],0,s[1]):void 0},e.isPointWithinSquare=function(e,t){void 0===t&&(t=1);var r=o.abs2(o.v2(),e);return r[0]<=t&&r[1]<=t},e.isPointWithinNDC=function(e,t){var r=n.vec3.transformMat4(o.v3(),t,e),i=o.abs3(o.v3(),r);return i[0]<=1&&i[1]<=1&&r[2]>=0&&r[2]<=1},e.distancePointToRay=s,e.eyeWithPointInView=function(e,t){var r=n.vec3.subtract(o.v3(),e.center,e.eye),i=n.vec3.normalize(o.v3(),r),u=n.vec3.normalize(o.v3(),n.vec3.cross(o.v3(),i,e.up)),c=n.vec3.normalize(o.v3(),n.vec3.cross(o.v3(),u,i)),l=s(e.eye,e.center,t),f=n.vec3.add(o.v3(),e.eye,n.vec3.scale(o.v3(),r,l)),h=n.vec3.subtract(o.v3(),t,f),d=Math.abs(n.vec3.dot(h,u))/e.aspect,p=Math.abs(n.vec3.dot(h,c)),_=Math.max(d,p)/Math.tan(e.fovy*a.DEG2RAD*.5);return n.vec3.subtract(o.v3(),f,n.vec3.scale(o.v3(),i,_))}}(i||(i={})),e.exports=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(78),n=r(141);!function(e){e.TestRenderer=n.TestRenderer,e.TestNavigation=i.TestNavigation}(t.debug||(t.debug={}))},function(e,t,r){"use strict";var i,n,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=r(0),s=r(61),u=r(59),c=r(38),l=r(48),f=r(17),h=r(12),d=r(6),p=r(23),_=r(50),v=r(7),m=r(4),b=r(78);!function(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._extensions=!1,t}return o(t,e),t.prototype.onInitialize=function(e,t,i){var n=this,o=this._context.gl,_=this._context.gl2facade;!1===this._extensions&&this._context.isWebGL1&&(a.assert(this._context.supportsStandardDerivatives,"expected OES_standard_derivatives support"),this._context.standardDerivatives,this._extensions=!0);var g=new v.Shader(this._context,o.VERTEX_SHADER,"testrenderer.vert");g.initialize(r(142));var y=new v.Shader(this._context,o.FRAGMENT_SHADER,"testrenderer.frag");y.initialize(r(143)),this._program=new d.Program(this._context),this._program.initialize([g,y]),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uFrameNumber=this._program.uniform("u_frameNumber"),this._ndcTriangle=new h.NdcFillingTriangle(this._context);var E=this._program.attribute("a_vertex",0);return this._ndcTriangle.initialize(E),this._ndcOffsetKernel=new u.AntiAliasingKernel(this._multiFrameNumber),this._defaultFBO=new l.DefaultFramebuffer(this._context,"DefaultFBO"),this._defaultFBO.initialize(),this._colorRenderTexture=new m.Texture2D(this._context,"ColorRenderTexture"),this._depthRenderbuffer=new p.Renderbuffer(this._context,"DepthRenderbuffer"),this._intermediateFBO=new f.Framebuffer(this._context,"IntermediateFBO"),this._accumulate=new s.AccumulatePass(this._context),this._accumulate.initialize(this._ndcTriangle),this._accumulate.precision=this._framePrecision,this._accumulate.texture=this._colorRenderTexture,this._blit=new c.BlitPass(this._context),this._blit.initialize(this._ndcTriangle),this._blit.readBuffer=_.COLOR_ATTACHMENT0,this._blit.drawBuffer=o.BACK,this._blit.target=this._defaultFBO,this._testNavigation=new b.TestNavigation(function(){return n.invalidate()},i),!0},t.prototype.onUninitialize=function(){e.prototype.uninitialize.call(this),this._uNdcOffset=-1,this._uFrameNumber=-1,this._program.uninitialize(),this._ndcTriangle.uninitialize(),this._intermediateFBO.uninitialize(),this._defaultFBO.uninitialize(),this._colorRenderTexture.uninitialize(),this._depthRenderbuffer.uninitialize(),this._blit.uninitialize(),this._accumulate.uninitialize()},t.prototype.onDiscarded=function(){this._altered.alter("frameSize"),this._altered.alter("multiFrameNumber"),this._altered.alter("framePrecision"),this._altered.alter("clearColor")},t.prototype.onUpdate=function(){this._testNavigation.update();var e=this._testNavigation.altered;return this._testNavigation.reset(),!(!e&&!this._altered.any)&&e},t.prototype.onPrepare=function(){var e=this._context.gl,t=this._context.gl2facade;this._intermediateFBO.initialized?this._altered.frameSize&&this._intermediateFBO.resize(this._frameSize[0],this._frameSize[1]):(this._colorRenderTexture.initialize(this._frameSize[0],this._frameSize[1],this._context.isWebGL2?e.RGBA8:e.RGBA,e.RGBA,e.UNSIGNED_BYTE),this._depthRenderbuffer.initialize(this._frameSize[0],this._frameSize[1],e.DEPTH_COMPONENT16),this._intermediateFBO.initialize([[t.COLOR_ATTACHMENT0,this._colorRenderTexture],[e.DEPTH_ATTACHMENT,this._depthRenderbuffer]])),this._altered.multiFrameNumber&&(this._ndcOffsetKernel.width=this._multiFrameNumber),this._altered.framePrecision&&(this._accumulate.precision=this._framePrecision),this._altered.clearColor&&this._intermediateFBO.clearColor(this._clearColor),this._accumulate.update(),this._altered.reset()},t.prototype.onFrame=function(e){var t=this._context.gl;t.viewport(0,0,this._frameSize[0],this._frameSize[1]),this._program.bind();var r=this._ndcOffsetKernel.get(e);r[0]=2*r[0]/this._frameSize[0],r[1]=2*r[1]/this._frameSize[1],t.uniform2fv(this._uNdcOffset,r),t.uniform1i(this._uFrameNumber,e),this._intermediateFBO.clear(t.COLOR_BUFFER_BIT,!0,!1),this._ndcTriangle.bind(),this._ndcTriangle.draw(),this._intermediateFBO.unbind(),this._accumulate.frame(e)},t.prototype.onSwap=function(){this._blit.framebuffer=this._accumulate.framebuffer?this._accumulate.framebuffer:this._blit.framebuffer=this._intermediateFBO,this._blit.frame()},t}(_.Renderer);e.TestRenderer=t}(n||(n={})),e.exports=n},function(e,t){e.exports="\r\nprecision lowp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying out\r\n#endif\r\n\r\n\r\nvoid ndcOffset(inout vec4 vertex, in vec2 offset) {\r\n    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    attribute vec2 a_vertex;\r\n#else \r\n    layout(location = 0) in vec2 a_vertex;\r\n#endif\r\n\r\nuniform vec2 u_ndcOffset;\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    v_uv = a_vertex.xy * 0.5 + 0.5;\r\n\r\n    vec4 vertex = vec4(a_vertex, 0.0, 1.0);\r\n    ndcOffset(vertex, u_ndcOffset);\r\n\r\n    gl_Position = vertex;\r\n}\r\n"},function(e,t){e.exports="\r\nprecision lowp float;\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else \r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n    #extension GL_OES_standard_derivatives : enable\r\n#else \r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\nuniform int u_frameNumber;\r\n\r\nvarying vec2 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec3 color = vec3(28.0 / 255.0, 117.0 / 255.0, 188.0 / 255.0);\r\n    color += (vec3(0.0, v_uv) - 0.5) * 0.125;\r\n\r\n    vec2 awidth = fwidth(v_uv) * (sin(float(u_frameNumber) * 0.1) * 7.0 + 8.0);\r\n    vec2 cstep = abs(step(awidth, v_uv) - step(awidth, 1.0 - v_uv));\r\n    if(!any(bvec2(cstep))) {\r\n        discard;\r\n    }\r\n    fragColor = vec4(color, 1.0); \r\n}\r\n"},function(e,t,r){"use strict";var i;!function(e){var t=function(){function e(e,t){if(this._blockListenerByEvent=new Map,this._element=e,void 0!==t)for(var r=0,i=t;r<i.length;r++){var n=i[r];this.block(n)}}return e.prototype.block=function(e){this._blockListenerByEvent.has(e)||(this._blockListenerByEvent.set(e,function(e){return e.preventDefault(),e.stopPropagation(),!1}),this._element.addEventListener(e,this._blockListenerByEvent.get(e)))},e.prototype.unblock=function(e){this._blockListenerByEvent.has(e)&&(this._element.removeEventListener(e,this._blockListenerByEvent.get(e)),this._blockListenerByEvent.delete(e))},e}();e.EventBlocker=t}(i||(i={})),e.exports=i},function(e,t,r){"use strict";var i,n=r(0);!function(e){var t=function(){function e(){}return e.queryAndCacheAPI=function(){if(void 0===e._exit){for(var t=window.document,r=[t.exitFullScreen,t.msExitFullscreen,t.mozCancelFullScreen,t.webkitExitFullscreen,void 0],i=0;i<r.length&&void 0===r[i];++i);switch(i){case 0:e._exit=function(){return t.exitFullScreen()},e._request=function(e){return e.requestFullscreen()},e._element=function(){return t.fullscreenElement},e._event="fullscreenchange";break;case 1:e._exit=function(){return t.msExitFullscreen()},e._request=function(e){return e.msRequestFullscreen()},e._element=function(){return t.msFullscreenElement},e._event="msfullscreenchange";break;case 2:e._exit=function(){return t.mozCancelFullScreen()},e._request=function(e){return e.mozRequestFullScreen()},e._element=function(){return t.mozFullScreenElement},e._event="mozfullscreenchange";break;case 3:e._exit=function(){return t.webkitExitFullscreen()},e._request=function(e){return e.webkitRequestFullscreen()},e._element=function(){return t.webkitFullscreenElement},e._event="webkitfullscreenchange";break;default:n.assert(!1,"none of the following fullscreen apis was found: native, ms, moz, or webkit")}}},e.active=function(){return void 0!==e._element()&&null!==e._element()},e.toggle=function(t,r){if(void 0!==t){e.queryAndCacheAPI();var i=e.active();if(!i){var n=getComputedStyle(t);e._size[0]=n.width,e._size[1]=n.height}r&&r(),i?(e._callback=void 0,window.removeEventListener(e._event,e.removeEventListener),t.style.width=e._size[0],t.style.height=e._size[1]):(e._callback=r,window.addEventListener(e._event,e.addEventListener)),i?e._exit():e._request(t)}},e._size=["0","0"],e.addEventListener=function(){window.removeEventListener(e._event,e.addEventListener),window.addEventListener(e._event,e.removeEventListener)},e.removeEventListener=function(){e._callback&&(e._callback(),e._callback=void 0),window.removeEventListener(e._event,e.removeEventListener)},e}();e.Fullscreen=t}(i||(i={})),e.exports=i}])},"./adaptivelabelplacement.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r("../node_modules/webgl-operate/lib/webgl-operate.js"),o=n.auxiliaries.assert,a=n.gl_matrix_extensions.v2,s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=r("./index2d.ts"),c=r("./labelarea.ts"),l=r("./labelmanagement.ts"),f=r("./relativelabelposition.ts");!function(e){e.leafLabelsTreemap=function(e,t,r,i){var n=0;switch(r){case f.RelativeLabelPosition.Type.UpperRight:n=0*i;break;case f.RelativeLabelPosition.Type.LowerRight:case f.RelativeLabelPosition.Type.UpperLeft:n=1*i;break;case f.RelativeLabelPosition.Type.LowerLeft:n=3*i;break;case f.RelativeLabelPosition.Type.Hidden:n=60*i;break;default:o(!1,"No valid relative position type, given "+r)}return 15*t+.3*n}}(i=t.PenaltyFunction||(t.PenaltyFunction={}));var h=function(){function e(){}return e.getNDCExtentForLeafLabel=function(e,t){o(0!==t.width&&0!==t.height,"camera viewport is invalid: "+t.width+" "+t.height);var r=e.label.extent[0]/t.width,i=e.label.extent[1]/t.height;return n.vec2.fromValues(r,i)},e.placementFor=function(e,t){var r=n.vec2.sub(a(),e.origin,t),i=!0,u=s.Label.Alignment.Left,c=s.Label.LineAnchor.Bottom;switch(e.position){case f.RelativeLabelPosition.Type.UpperRight:break;case f.RelativeLabelPosition.Type.LowerRight:c=s.Label.LineAnchor.Top;break;case f.RelativeLabelPosition.Type.UpperLeft:u=s.Label.Alignment.Right;break;case f.RelativeLabelPosition.Type.LowerLeft:c=s.Label.LineAnchor.Top,u=s.Label.Alignment.Right;break;case f.RelativeLabelPosition.Type.Hidden:i=!1;break;default:o(!1,"No valid type for relative label position, given"+r)}return{offset:r,alignment:u,lineAnchor:c,display:i}},e.createCollisionGraph=function(e,t){t||(t=n.vec2.fromValues(1,1));for(var r=[],i=0;i<e.length;i++){r.push([]);for(var a=0,s=e[i];a<s.length;a++){s[a];r[i].push([])}}for(var c=new u.Index2D;!c.end(e);c.next(e))for(var l=c.element(r),f=c.element(e),h=new u.Index2D;!h.end(e);h.next(e))if(c.outer!==h.outer){var d=h.element(e);if(f.paddedOverlaps(d,t)){var p=f.paddedOverlapArea(d,t);l.push({index:h.outer,position:h.inner,overlapArea:p});var _=c.element(r).length;o(_>0,"Size expected to be greater than zero, given "+_.length)}}return r},e.computeLabelAreas=function(e,t,r){for(var i=[],n=0,o=e;n<o.length;n++){var a=o[n];i.push([]);for(var s=this.getNDCExtentForLeafLabel(a,r),u=0,l=t;u<l.length;u++){var h=l[u],d=f.RelativeLabelPosition.labelOrigin(h,a.pointLocation,s);i[i.length-1].push(new c.LabelArea(d,s,h))}}return i},e.getRandomInt=function(e){return Math.floor(Math.random()*Math.floor(e))},e.randomIndexExcept=function(e,t){var r=this.getRandomInt(t-1);return r===e?t-1:r},e.randomStartLabelAreas=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r];t.push(this.getRandomInt(n.length))}return t},e.computePenalty=function(e,t,r,i,n){if(0===e.extent[0]||0===e.extent[1])return 0;for(var o=0,a=0,s=0,u=t;s<u.length;s++){var c=u[s];n[c.index]===c.position&&(o+=c.overlapArea,++a)}return i(a,o/=e.area(),e.position,r)},e.simulatedAnnealing=function(e,t,r,i){for(var n=[f.RelativeLabelPosition.Type.UpperRight,f.RelativeLabelPosition.Type.UpperLeft,f.RelativeLabelPosition.Type.LowerLeft,f.RelativeLabelPosition.Type.LowerRight,f.RelativeLabelPosition.Type.Hidden],o=this.computeLabelAreas(e,n,i),a=this.randomStartLabelAreas(o),s=this.createCollisionGraph(o,r),u=5*e.length,c=20*e.length,l=.91023922662,h=0,d=0,p=0;;){var _=this.getRandomInt(e.length),v=a[_],m=this.randomIndexExcept(v,o[_].length),b=this.computePenalty(o[_][v],s[_][v],e[_].priority,t,a)-this.computePenalty(o[_][m],s[_][m],e[_].priority,t,a),g=Math.exp(b/l),y=Math.max(0,Math.min(g,1)),E=Math.random()<y;if((b>0||E)&&(a[_]=m,++d),++p,d>u||p>c){if(0===d||50===h)break;l*=.9,d=0,p=0,++h}}for(var x=0;x<e.length;++x)e[x].placement=this.placementFor(o[x][a[x]],e[x].pointLocation)},e.greedy=function(e,t,r,i){for(var o=[],a=[f.RelativeLabelPosition.Type.UpperRight,f.RelativeLabelPosition.Type.UpperLeft,f.RelativeLabelPosition.Type.LowerLeft,f.RelativeLabelPosition.Type.LowerRight,f.RelativeLabelPosition.Type.Hidden],s=0,u=e;s<u.length;s++){for(var l=u[s],h=this.getNDCExtentForLeafLabel(l,i),d=Number.POSITIVE_INFINITY,p=new c.LabelArea(n.vec2.create(),n.vec2.create(),f.RelativeLabelPosition.Type.LowerLeft),_=0,v=a;_<v.length;_++){for(var m=v[_],b=f.RelativeLabelPosition.labelOrigin(m,l.pointLocation,h),g=new c.LabelArea(b,h,m),y=0,E=0,x=0,T=o;x<T.length;x++){var O=T[x];y+=g.paddedOverlapArea(O,r),E+=g.paddedOverlaps(O,r)?1:0}var P=t(E,y/=g.area(),m,l.priority);P<d&&(d=P,p=g)}l.placement=this.placementFor(p,l.pointLocation),o.push(p)}},e.prepareLeafLabels=function(e,t){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i];if(a){var s=n.vec4.fromValues(a.position[0],a.position[1],a.position[2],1);n.vec4.transformMat4(s,s,t.viewProjection);var u=s[3],c=n.vec2.fromValues(s[0]/u,s[1]/u);r.push({label:a,pointLocation:c,priority:9*a.position[1]+1,placement:{offset:n.vec2.create(),alignment:a.alignment,lineAnchor:a.lineAnchor,display:!0}})}}return r},e.applyNewPlacements=function(e){for(var t=!1,r=!1,i=0,n=e;i<n.length;i++){var o=n[i],a=o.label.alignment!==o.placement.alignment,s=o.label.lineAnchor!==o.placement.lineAnchor;o.label.alignment=o.placement.alignment,o.label.lineAnchor=o.placement.lineAnchor;var u=o.placement.display?l.LabelManagement.leafLabelColor[3]:0;o.label.color.fromRGB(o.label.color.r,o.label.color.g,o.label.color.b,u),t=!!t||o.label.color.altered,r=!!r||(a||s)}return{visibility:t,positioning:r}},e.adaptPositionToPreventOverlapGreedy=function(e,t){var r=this.prepareLeafLabels(e,t);r.sort(function(e,t){return t.priority-e.priority});var o=n.vec2.fromValues(1,1);return this.greedy(r,i.leafLabelsTreemap,o,t),this.applyNewPlacements(r)},e.adaptPositionToPreventOverlapSimulatedAnnealing=function(e,t){var r=this.prepareLeafLabels(e,t),o=n.vec2.fromValues(1,1);return this.simulatedAnnealing(r,i.leafLabelsTreemap,o,t),this.applyNewPlacements(r)},e}();t.AdaptiveLabelPlacement=h},"./aggregation.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.createAggregationMask=function(e,t,r,i,n,o){var a=new Uint8Array(e.numberOfNodes),s=new Uint8Array(e.numberOfNodes);return e.forEachInnerNode(function(e){var t=n<e.depth;o&&(t=t&&!o[e.index]),s[e.index]=t?1:0}),e.forEachLeafNode(function(e){var n=t[e.index]>0&&(void 0===r||r[e.index]<i);s[e.index]=n?0:1}),e.reverseNodesDo(function(e){e.isRoot||(s[e.parent]&=s[e.index])}),e.nodesDo(function(e){e.isRoot?a[e.index]=0:a[e.index]=s[e.parent]}),a},e.createEmptyAggregationMask=function(e){var t=new Uint8Array(e.numberOfNodes);return t.fill(0,0,e.numberOfNodes),t}}(t.Aggregation||(t.Aggregation={}))},"./attributebuffer.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=i.auxiliaries.assert,o=i.auxiliaries.log,a=i.auxiliaries.LogLevel,s=r("./attributetransformations.ts");!function(e){!function(e){e.String="string",e.Numbers="numbers",e.Uint8="uint8",e.Int8="int8",e.Uint16="uint16",e.Int16="int16",e.Uint32="uint32",e.Int32="int32",e.Float32="float32",e.Float64="float64"}(e.DataType||(e.DataType={})),function(e){e.Native="native"}(e.Encoding||(e.Encoding={})),function(e){e.Topology="topology",e.Identity="identity"}(e.Linearization||(e.Linearization={})),e.create=function(t,r,i){var n=r.indexOf(":");if(void 0===n||n<0)o(a.Error,"Buffer type not recognized.");else switch(r.substr(0,n)){case"buffer":return e.createSourceBuffer(t,r.substr(n+1),i);case"bufferView":return e.createView(t,r.substr(n+1),i);default:o(a.Error,"Buffer type not recognized.")}},e.range=function(e){if(0!==e.length)return Array.prototype.reduce.apply(e,[function(e,t){return[Math.min(t,e[0]),Math.max(t,e[1])]},[1/0,-1/0]])},e.createSourceBuffer=function(t,r,i){var o=i.buffers.find(function(e){return e.identifier===r});if(o&&o.encoding===e.Encoding.Native)return o.linearization===e.Linearization.Identity?o.data:(n(o.linearization===e.Linearization.Topology,"Expect linearization to be of type topology or identity."),s.AttributeTransformations.renormalize(t,o.data,i))},e.createView=function(t,r,i){var n=i.bufferViews.find(function(e){return e.identifier===r});if(void 0!==n){var o=e.create(t,n.source,i);if(void 0!==o)return void 0===n.transformations||0===n.transformations.length?o:s.AttributeTransformations.applyTransformations(t,o,n.transformations,i)}}}(t.AttributeBuffer||(t.AttributeBuffer={}))},"./attributetransformations.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=i.auxiliaries.assert,o=i.auxiliaries.log,a=i.auxiliaries.logIf,s=i.auxiliaries.LogLevel,u=r("./attributebuffer.ts"),c=r("./node.ts"),l=r("./topology.ts");!function(e){e.renormalize=function(e,t,r){var i,o=new Float32Array(e.numberOfNodes);if(r.topology.format===l.Topology.InputFormat.Interleaved){var u=r.topology.edges,f=2*(e.numberOfNodes-1);a(u.length!==f,s.Warning,"expected an edgelist of size "+f+" instead of "+u.length),i=function(e){var t=2*(e-1);return n(t<u.length,"expected an index within the ranges of edges but got "+e),t<u.length?[u[t+0],u[t+1]]:[c.Node.INVALID_INDEX,c.Node.INVALID_INDEX]}}else{var h=r.topology.edges;f=e.numberOfNodes-1,a(h.length!==f,s.Warning,"expected an edgelist of size "+f+" instead of "+h.length),i=function(e){return n(e-1<h.length,"expected an index within the ranges of edges but got"+e),e-1<h.length?h[e-1]:[c.Node.INVALID_INDEX,c.Node.INVALID_INDEX]}}a(e.numberOfNodes!==t.length,s.Warning,"expected value buffer to be sized with the number of nodes but got "+t.length+" instead of "+e.numberOfNodes),o[0]=t[0];for(var d=1;d<e.numberOfNodes;d++){var p=void 0,_=i(d);p=d+1<e.numberOfNodes&&i(d+1)[0]===_[1]?e.innerNodeIndexById(_[1]):e.leafNodeIndexById(_[1]),n(void 0!==p,"expected a valid index, given "+p+" for "+_[1]),o[p]=t[d]}return o},e.applyTransformations=function(t,r,i,n){for(var o=0,a=i;o<a.length;o++){var s=a[o];switch(s.type){case"normalize":e.applyNormalization(t,r,s);break;case"range-transform":e.applyRangeTransform(t,r,s);break;case"propagate-up":e.applyPropagation(t,r,s);break;case"fill-invalid":e.applyFill(t,r,s);break;case"mask":e.applyMask(t,r,s);break;case"clamp":e.applyClamp(t,r,s);break;case"threshold":e.applyThreshold(t,r,s);break;case"compare":e.applyCompare(t,r,s);break;case"transform":e.applyTransform(t,r,s,n);break;case"discretize":e.applyDiscretization(t,r,s);break;case"callback":e.applyCallback(t,r,s)}}return r},e.applyNormalization=function(e,t,r){if(0!==e.numberOfLeafNodes){var i=0,o=1;switch(r.operation){case"zero-to-max":var a;e.forEachLeafNode(function(e){var r=t[e.index];a=void 0===a?r:Math.max(a,r)}),n(void 0!==a,"Valid max expected"),void 0===a&&(a=1),i=0,o=1/a;break;case"min-to-max":var s,u;e.forEachLeafNode(function(e){var r=t[e.index];s=void 0===s?r:Math.max(s,r),u=void 0===u?r:Math.min(u,r)}),n(void 0!==s,"Valid max expected"),n(void 0!==u,"Valid min expected"),void 0===u&&(u=0),void 0===s&&(s=1),i=-u,o=1/(s-u);break;case"sign-agnostic-max":var c;e.forEachLeafNode(function(e){var r=Math.abs(t[e.index]);c=void 0===c?r:Math.max(c,r)}),n(void 0!==c,"Valid max expected"),void 0===c&&(c=1),i=0,o=1/c}t.forEach(function(e,r){t[r]=(t[r]+i)*o})}},e.applyRangeTransform=function(e,t,r){if(0!==e.numberOfLeafNodes&&void 0!==r.sourceRange&&void 0!==r.targetRange)for(var i=r.sourceRange,n=r.targetRange,o=-i[0],a=n[0],s=i[1]===i[0]?0:(n[1]-n[0])/(i[1]-i[0]),u=0;u<t.length;u++)t[u]<i[0]?t[u]=-1:t[u]=a+(t[u]+o)*s},e.applyPropagation=function(e,t,r){if(0!==e.numberOfLeafNodes)switch(r.operation){case"average":e.reverseParentsDo(function(r){var i=0,n=0;e.childrenDo(r,function(e){var r=t[e.index];i+=r,++n}),t[r.index]=0===n?0:i/n});break;case"sum":e.reverseParentsDo(function(r){var i=0;e.childrenDo(r,function(e){var r=t[e.index];i+=r}),t[r.index]=i});break;case"min":e.reverseParentsDo(function(r){var i;e.childrenDo(r,function(e){var r=t[e.index];i=void 0===i?r:Math.min(r,i)}),void 0===i&&(i=0),t[r.index]=i});break;case"max":e.reverseParentsDo(function(r){var i;e.childrenDo(r,function(e){var r=t[e.index];i=void 0===i?r:Math.max(r,i)}),void 0===i&&(i=0),t[r.index]=i});break;case"median":e.reverseParentsDo(function(r){var i=new Array;e.childrenDo(r,function(e){var r=t[e.index];i.push(r)}),i.sort(),i.length%2==0?t[r.index]=(i[i.length/2]+i[i.length/2])/2:t[r.index]=i[i.length/2]});break;case"closest-to-zero":e.reverseParentsDo(function(r){var i;e.childrenDo(r,function(e){var r=t[e.index];(void 0===i||Math.abs(r)<Math.abs(i))&&(i=r)}),void 0===i&&(i=0),t[r.index]=i});break;case"closest-to-infinity":e.reverseParentsDo(function(r){var i;e.childrenDo(r,function(e){var r=t[e.index];(void 0===i||Math.abs(r)>Math.abs(i))&&(i=r)}),void 0===i&&(i=0),t[r.index]=i});break;default:o(s.Warning,"Transformation type not recognized.")}},e.applyFill=function(e,t,r){var i=r.value,n="invalidValue"in r?r.invalidValue:void 0;e.nodesDo(function(e){t[e.index]===n&&(t[e.index]=i)})},e.applyClamp=function(e,t,r){var i,o;"range"in r?(i=r.range[0],o=r.range[0]):(i=r.min,o=r.max),n(i<=o,"Require valid min-max range."),e.nodesDo(function(e){var r=t[e.index];void 0!==r&&(t[e.index]=Math.min(o,Math.max(i,r)))})},e.applyMask=function(e,t,r){var i=r.value;e.nodesDo(function(e){t[e.index]=t[e.index]===i?1:0})},e.applyThreshold=function(e,t,r){var i=r.value;e.nodesDo(function(e){t[e.index]=t[e.index]>=i?1:0})},e.applyCompare=function(e,t,r){var i=r.value;e.nodesDo(function(e){t[e.index]=t[e.index]>i?1:t[e.index]<i?-1:0})},e.applyTransform=function(e,t,r,i){var n=r.operation,o=r.parameter,a=r.buffer,s=function(e){return o};if(void 0!==a){var c=u.AttributeBuffer.create(e,a,i);void 0!==c&&(s=function(e){return c[e.index]})}switch(n){case"min":e.nodesDo(function(e){t[e.index]=Math.min(t[e.index],s(e))});break;case"max":e.nodesDo(function(e){t[e.index]=Math.max(t[e.index],s(e))});break;case"add":e.nodesDo(function(e){t[e.index]=t[e.index]+s(e)});break;case"subtract":e.nodesDo(function(e){t[e.index]=t[e.index]-s(e)});break;case"multiply":e.nodesDo(function(e){t[e.index]=t[e.index]*s(e)});break;case"divide":e.nodesDo(function(e){t[e.index]=t[e.index]/s(e)});break;case"inverse":e.nodesDo(function(e){t[e.index]=1/t[e.index]});break;case"pow":e.nodesDo(function(e){t[e.index]=Math.pow(t[e.index],s(e))});break;case"nth-root":e.nodesDo(function(e){var r=1/s(e);t[e.index]=Math.pow(t[e.index],r)});break;case"log":void 0!==o&&0!==o?e.nodesDo(function(e){var r=Math.log(s(e));t[e.index]=Math.log(t[e.index])/r}):e.nodesDo(function(e){t[e.index]=Math.log(t[e.index])});break;case"square":e.nodesDo(function(e){t[e.index]=Math.pow(t[e.index],2)});break;case"square-root":e.nodesDo(function(e){t[e.index]=Math.sqrt(t[e.index])});break;case"as-multiplier":e.nodesDo(function(e){t[e.index]=Math.abs(t[e.index])});break;case"as-remainder":e.nodesDo(function(e){t[e.index]=1-Math.abs(t[e.index])});break;case"abs":e.nodesDo(function(e){t[e.index]=Math.abs(t[e.index])});break;case"compare":e.nodesDo(function(e){var r=t[e.index],i=s(e);t[e.index]=r<i?-1:r>i?1:0});break;default:return}},e.applyDiscretization=function(e,t,r){n(!1,"Implementation missing")},e.applyCallback=function(e,t,r){var i=r.operation;switch(r.iteration){case l.Topology.IterationDirection.TopDown:e.nodesDo(function(r){t[r.index]=i(t[r.index],r,t,e)});break;case l.Topology.IterationDirection.DepthFirst:e.reverseNodesDo(function(r){t[r.index]=i(t[r.index],r,t,e)});break;case l.Topology.IterationDirection.BottomUp:default:e.depthFirstDo(function(r){t[r.index]=i(t[r.index],r,t,e)})}}}(t.AttributeTransformations||(t.AttributeTransformations={}))},"./base64.ts":function(e,t,r){"use strict";var i,n=r("../node_modules/base64-arraybuffer/lib/base64-arraybuffer.js");!function(e){(i||(i={})).decode=function(e){return n.decode(e)}}(),e.exports=i},"./codecitylayout.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./rect.ts"),n=function(){function e(){}return e.compute=function(t,r,n,o,a,s,u,c){var l=r[t.root.index];t.nodesDo(function(e){var t=r[e.index],a=Math.sqrt(t/l);o[e.index]=new i.Rect(0,0,a*n,a)});var f=new Array;f[t.root.index]=[0,0],t.reverseParentsDo(function(r){var n=0,l=0,h=n,d=l,p=e.Direction.Y;t.childrenDo(r,function(t){var i=o[t.index]=a.siblingMarginAfterCallback(o[t.index],o[r.index],o[r.index],t);switch(p){case e.Direction.X:n+i.width>=h&&(n=h,l=0,p=e.Direction.Y);break;default:case e.Direction.Y:l+i.height>=d&&(n=0,l=d,p=e.Direction.X)}switch(f[t.index]=[n,l],p){case e.Direction.X:n+=i.width,h=Math.max(h,n),d=Math.max(d,Math.max(l+i.height,i.top));break;default:case e.Direction.Y:l+=i.height,h=Math.max(h,Math.max(n+i.width,i.right)),d=Math.max(d,l)}});var _=a.parentPaddingCallback(new i.Rect(0,0,h,d),r,t,o,u,c);o[r.index]=a.accessoryPaddingCallback(_,r,t,o,s)}),t.nodesDo(function(e){var r=o[e.index],i=f[e.index];r.applyOffset(i[0],i[1]),t.childrenDo(e,function(e){var t=f[e.index];t[0]+=i[0],t[1]+=i[1]})});var h=o[t.root.index],d=new i.Rect(0,0,h.aspectRatio,1);d.centerAround([.5,.5]),t.reverseNodesDo(function(e){o[e.index]=o[e.index].map(h,d)})},e}();t.CodeCityLayout=n,function(e){!function(e){e[e.X=0]="X",e[e.Y=1]="Y"}(e.Direction||(e.Direction={}))}(n=t.CodeCityLayout||(t.CodeCityLayout={})),t.CodeCityLayout=n},"./colortable.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,r,i){this._emphasis=e.rgbaF32,this._auxiliary=new Float32Array(4*t.length);for(var n=0;n<t.length;++n)this._auxiliary.set(t[n].rgbaF32,4*n);this._inner=new Float32Array(4*r.length);for(n=0;n<r.length;++n)this._inner.set(r[n].rgbaF32,4*n);this._leaf=new Float32Array(4*i.length);for(n=0;n<i.length;++n)this._leaf.set(i[n].rgbaF32,4*n)}return Object.defineProperty(e.prototype,"innerNodeColorOffset",{get:function(){return this.auxiliaryColorCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerNodeColorCount",{get:function(){return this._inner.length/4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leafColorOffset",{get:function(){return this.innerNodeColorOffset+this.innerNodeColorCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leafColorCount",{get:function(){return this._leaf.length/4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auxiliaryColorOffset",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"auxiliaryColorCount",{get:function(){return this._auxiliary.length/4+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unmodifiedColorIndex",{get:function(){return this.innerNodeColorOffset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionColorIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bits",{get:function(){var e=new Float32Array(4*(this.auxiliaryColorCount+this.innerNodeColorCount+this.leafColorCount));return e.set(this._emphasis,0),e.set(this._auxiliary,4),e.set(this._inner,4*this.innerNodeColorOffset),e.set(this._leaf,4*this.leafColorOffset),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.auxiliaryColorCount+this.leafColorCount+this.innerNodeColorCount},enumerable:!0,configurable:!0}),e}();t.ColorTable=i},"./configuration.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=function(){function e(){this._altered=Object.assign(new i.ChangeLookup,{any:!1,topology:!1,buffers:!1,bufferViews:!1,colors:!1,layout:{any:!1,weight:!1,sort:!1,algorithm:!1,siblingMargin:!1,parentPadding:!1,accessoryPadding:!1},geometry:{any:!1,aggregation:!1,outlineWidth:!1,emphasis:{any:!1,outline:!1,highlight:!1,outlineWidth:!1},heights:!1,heightScale:!1,levitate:!1,colors:!1,parentLayer:!1},labels:!1}),this._buffers=[],this._bufferViews=[],this._colors=[]}return Object.defineProperty(e.prototype,"altered",{get:function(){return this._altered},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topology",{get:function(){return this._topology},set:function(t){var r=e.TREEMAP_SCHEMA.properties.topology;i.properties.complement(t,r),i.properties.compare(t,this._topology,this._altered,"topology"),this._topology=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffers",{get:function(){return this._buffers},set:function(t){var r=e.TREEMAP_SCHEMA.properties.buffers;i.properties.validate(t,r,[])&&(i.properties.complement(t,r),i.properties.compare(t,this._buffers,this._altered,"buffers"),this._buffers=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferViews",{get:function(){return this._bufferViews},set:function(t){var r=e.TREEMAP_SCHEMA.properties.bufferViews;i.properties.validate(t,r,[[e.BUFFER_REFERENCE_SCHEMA,"/BufferReference"]])&&(i.properties.complement(t,r),i.properties.compare(t,this._bufferViews,this._altered,"bufferViews"),this._bufferViews=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"colors",{get:function(){return this._colors},set:function(t){var r=e.TREEMAP_SCHEMA.properties.colors;i.properties.validate(t,r,[[e.COLOR_REFERENCE_SCHEMA,"/ColorReference"]])&&(i.properties.complement(t,r),i.properties.compare(t,this._colors,this._altered,"colors"),this._colors=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},set:function(t){var r=e.TREEMAP_SCHEMA.properties.layout;i.properties.validate(t,r,[[e.BUFFER_REFERENCE_SCHEMA,"/BufferReference"]])&&(i.properties.complement(t,r),i.properties.compare(t,this._layout,this._altered,"layout"),this._layout=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},set:function(t){var r=e.TREEMAP_SCHEMA.properties.geometry;i.properties.validate(t,r,[[e.BUFFER_REFERENCE_SCHEMA,"/BufferReference"],[e.COLOR_REFERENCE_SCHEMA,"/ColorReference"],[e.COLOR_SCHEMA_SCHEMA,"/ColorScheme"]])&&(i.properties.complement(t,r),i.properties.compare(t,this._geometry,this._altered,"geometry"),this._geometry=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"labels",{get:function(){return this._labels},set:function(t){var r=e.TREEMAP_SCHEMA.properties.labels;i.properties.validate(t,r,[[e.BUFFER_REFERENCE_SCHEMA,"/BufferReference"]])&&(i.properties.complement(t,r),i.properties.compare(t,this._labels,this._altered,"labels"),this._labels=t)},enumerable:!0,configurable:!0}),e.TREEMAP_SCHEMA=r("./data/treemap.schema.json"),e.BUFFER_REFERENCE_SCHEMA=r("./data/bufferreference.schema.json"),e.COLOR_REFERENCE_SCHEMA=r("./data/colorreference.schema.json"),e.COLOR_SCHEMA_SCHEMA=r("./data/colorscheme.schema.json"),e}();t.Configuration=n},"./configurationaids.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js");!function(e){var t,r;e.heightScale=function(e,r){switch(void 0===r&&(r=t.SomethingInverseSqrt),r){default:case t.SomethingInverseSqrt:return i.gl_matrix_extensions.clamp(100/Math.sqrt(e.numberOfNodes)+.0125,.0625,.3333)}},function(e){e.SomethingInverseSqrt="SomethingInverseSqrt"}(t=e.HeightScaleApproach||(e.HeightScaleApproach={})),e.parentMargin=function(e,t){switch(void 0===t&&(t=r.SomethingLog10),t){default:case r.SomethingLog10:return.04+.12*(1-Math.log10(e.numberOfNodes+1)/6)}},e.siblingMargin=function(e,t){switch(void 0===t&&(t=r.SomethingLog10),t){default:case r.SomethingLog10:return.01+.12*(1-Math.log10(e.numberOfNodes+1)/6)}},function(e){e.SomethingLog10="SomethingLog10"}(r=e.MarginApproach||(e.MarginApproach={}))}(t.ConfigurationAids||(t.ConfigurationAids={}))},"./cuboidgeometry.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=function(e){function t(r,i,n){var o=e.call(this,r,n)||this;o._colorOffsets=new Array,o._heightOffsets=new Array,o._layers=Math.max(1,i),n=void 0!==n&&""!==n?n:"CuboidGeometry",o._vertices=t.referenceVerticesVBO(r),o._buffers.push(o._vertices),o._layout=new s.Buffer(r,n+"LayoutVBO"),o._buffers.push(o._layout),o._ids=new s.Buffer(r,n+"IdVBO"),o._buffers.push(o._ids),o._emphases=new s.Buffer(r,n+"EmphasisVBO"),o._buffers.push(o._emphases),o._colors=new s.Buffer(r,n+"ColorVBO"),o._buffers.push(o._colors),o._colorOffsets.length=i,o._heights=new s.Buffer(r,n+"HeightVBO"),o._buffers.push(o._heights),o._heightOffsets.length=i;for(var a=0;a<i;++a)o._colorOffsets[a]=0,o._heightOffsets[a]=0;return o}return n(t,e),t.referenceVerticesVBO=function(e){var r;t.VERTICES_BY_CONTEXT.has(e)?r=t.VERTICES_BY_CONTEXT.get(e):(r=new s.Buffer(e,"CuboidVertexVBO"),t.VERTICES_BY_CONTEXT.set(e,r),t.REFCOUNT_BY_TEMPLATE.set(r,0));var i=t.REFCOUNT_BY_TEMPLATE.get(r)+1;return t.REFCOUNT_BY_TEMPLATE.set(r,i),r},t.unreferenceTemplateVBO=function(e){if(t.VERTICES_BY_CONTEXT.has(e)){var r=t.VERTICES_BY_CONTEXT.get(e),i=t.REFCOUNT_BY_TEMPLATE.get(r)-1;t.REFCOUNT_BY_TEMPLATE.set(r,i),i>0||(r.uninitialize(),t.VERTICES_BY_CONTEXT.delete(e),t.REFCOUNT_BY_TEMPLATE.delete(r))}},t.prototype.bindBuffers=function(e){var t=this.context.gl,r=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,3,t.FLOAT,!1,20,0,!0,!1),r.vertexAttribDivisor(this._vertexLocation,0),this._vertices.attribEnable(this._texCoordLocation,2,t.FLOAT,!1,20,12,!0,!1),r.vertexAttribDivisor(this._texCoordLocation,0),this._layout.attribEnable(this._layoutLocation,4,t.FLOAT,!1,0,0,!0,!1),r.vertexAttribDivisor(this._layoutLocation,1),this._ids.attribEnable(this._idLocation,4,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._idLocation,1),this._emphases.attribEnable(this._emphasisLocation,1,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._emphasisLocation,1),this._colors.attribEnable(this._colorLocation,1,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._colorLocation,1),this._heights.attribEnable(this._heightLocation,2,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._heightLocation,1)},t.prototype.unbindBuffers=function(e){this._vertices.attribDisable(this._vertexLocation,!1,!1),this._vertices.attribDisable(this._texCoordLocation,!1,!1),this._layout.attribDisable(this._layoutLocation,!1,!1),this._ids.attribDisable(this._idLocation,!1,!1),this._emphases.attribDisable(this._emphasisLocation,!1,!1),this._colors.attribDisable(this._colorLocation,!1,!1),this._heights.attribDisable(this._heightLocation,!1,!1)},t.prototype.initialize=function(r,i,n,o,a,s,u){void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=2),void 0===o&&(o=3),void 0===a&&(a=4),void 0===s&&(s=5),void 0===u&&(u=6),this._vertexLocation=r,this._texCoordLocation=i,this._idLocation=o,this._layoutLocation=n,this._emphasisLocation=a,this._colorLocation=s,this._heightLocation=u;var c=this.context.gl,l=e.prototype.initialize.call(this,[c.ARRAY_BUFFER,c.ARRAY_BUFFER,c.ARRAY_BUFFER,c.ARRAY_BUFFER,c.ARRAY_BUFFER,c.ARRAY_BUFFER]);return this._vertices.data(t.DATA,c.STATIC_DRAW),l&&this._vertices.valid},t.prototype.uninitialize=function(){t.unreferenceTemplateVBO(this.context),this._layout.uninitialize(),this._ids.uninitialize(),this._emphases.uninitialize(),this._colors.uninitialize(),this._heights.uninitialize(),e.prototype.uninitialize.call(this)},t.prototype.update=function(){this.bind()},t.prototype.draw=function(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0);var n=this.context.gl,o=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,3,n.FLOAT,!1,20,r,!0,!1),this._vertices.attribEnable(this._texCoordLocation,2,n.FLOAT,!1,20,12+r,!0,!1),this._ids.attribEnable(this._idLocation,4,n.UNSIGNED_BYTE,!1,4,4*t,!0,!1),this._layout.attribEnable(this._layoutLocation,4,n.FLOAT,!1,16,16*t,!0,!1),this._emphases.attribEnable(this._emphasisLocation,1,n.UNSIGNED_BYTE,!1,1,1*t,!0,!1),this._colors.attribEnable(this._colorLocation,1,n.UNSIGNED_BYTE,!1,1,1*t+this._colorOffsets[e],!0,!1),this._heights.attribEnable(this._heightLocation,2,n.UNSIGNED_BYTE,!1,2,2*t+this._heightOffsets[e],!0,!1),o.drawArraysInstanced(n.TRIANGLE_STRIP,0,4,i)},Object.defineProperty(t.prototype,"layout",{set:function(e){this._layout.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ids",{set:function(e){this._ids.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),t.prototype.colors=function(e,t,r){a.auxiliaries.assert(void 0===t||t>=0&&t<=this._layers,"expected layers to be within [0, "+this._layers+"], given "+t),a.auxiliaries.assert(void 0===r||r<=this._layers,"expected layers to be within [0, "+this._layers+"], given "+t);var i=this.context.gl,n=e.byteLength*(r||this._layers);0!==this._colors.bytes&&this._colors.bytes===n||void 0===t||this._colors.data(n,i.STATIC_DRAW),void 0!==t?(this._colors.subData(e.byteLength*t,e),this._colorOffsets[t]=e.byteLength*t):this._colors.data(e,this.context.gl.STATIC_DRAW)},Object.defineProperty(t.prototype,"emphases",{set:function(e){this._emphases.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),t.prototype.heights=function(e,t){a.auxiliaries.assert(void 0===t||t>=0&&t<=this._layers,"expected layers to be within [0, "+this._layers+"], given "+t);var r=this.context.gl,i=e.byteLength*this._layers;0!==this._heights.bytes&&this._heights.bytes===i||void 0===t||this._heights.data(i,r.STATIC_DRAW),void 0!==t?(this._heights.subData(e.byteLength*t,e),this._heightOffsets[t]=e.byteLength*t):this._heights.data(e,this.context.gl.STATIC_DRAW)},Object.defineProperty(t.prototype,"layers",{get:function(){return this._layers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){var e=this._layout&&this._layout.valid,t=this._ids&&this._ids.valid,r=this._colors&&this._colors.valid,i=this._emphases&&this._emphases.valid,n=this._heights&&this._heights.valid;return this.initialized&&this._vertices.valid&&e&&t&&r&&i&&n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texCoordLocation",{get:function(){return this._texCoordLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutLocation",{get:function(){return this._layoutLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idLocation",{get:function(){return this._idLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphasisLocation",{get:function(){return this._emphasisLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorLocation",{get:function(){return this._colorLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightLocation",{get:function(){return this._heightLocation},enumerable:!0,configurable:!0}),t.VERTICES_BY_CONTEXT=new Map,t.REFCOUNT_BY_TEMPLATE=new Map,t.DATA=new Float32Array([0,0,0,0,0,0,0,1,0,1,1,0,0,1,0,1,0,1,1,1,0,0,0,0,0,1,0,0,1,0,0,0,1,0,1,1,0,1,1,1,0,0,1,0,0,1,0,1,1,0,0,1,1,0,1,1,1,1,1,1,0,0,0,0,0,0,1,0,0,1,1,0,0,1,0,1,1,0,1,1,1,0,0,0,0,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,0,0,1,0,0,1,0,1,1,1,1]),o([s.Initializable.assert_initialized()],t.prototype,"draw",null),t}(s.Geometry);t.CuboidGeometry=u},"./cuboidrenderpass.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=r("./cuboidgeometry.ts"),c=r("./multirendertarget.ts"),l=function(e){function t(r,i){var n=e.call(this)||this;return n._standardDerivatives=void 0,n._altered=Object.assign(new s.ChangeLookup,{any:!0,camera:!0,geometry:!0,colorTable:!0,colorTableLength:!0,emphases:!0,layerIndex:!0,heightScale:!0,levitate:!0,outlineWidth:!0,emphasisOutlineWidth:!0}),n._arrows=!1,n._outlineWidth=t.OUTLINE_WIDTH_DEFAULT,n._emphasisOutlineWidth=t.EMPHASIS_OUTLINE_WIDTH_DEFAULT,n._attachment=c.MultiRenderTarget.Attachment.Undefined,n._faceSequence=new Array,n._faceData=new Map,n._context=r,a.auxiliaries.assert(i>=0&&i<=t.CUBOID_LAYERS,"expected layer index to be in range [0, "+t.MINIMUM_CUBOID_HEIGHT+"], given "+i),n._layerIndex=i,n._drawRestricted=!n._context.isWebGL2&&!n._context.supportsDrawBuffers,n._program=new s.Program(r,"CuboidRenderProgram"),n._geometry=t.referenceGeometry(r),n}return n(t,e),t.referenceGeometry=function(e){var r;t.GEOMETRY_BY_CONTEXT.has(e)?r=t.GEOMETRY_BY_CONTEXT.get(e):((r=new u.CuboidGeometry(e,t.CUBOID_LAYERS,"CuboidGeometry")).initialize(),t.GEOMETRY_BY_CONTEXT.set(e,r),t.REFCOUNT_BY_GEOMETRY.set(r,0));var i=t.REFCOUNT_BY_GEOMETRY.get(r)+1;return t.REFCOUNT_BY_GEOMETRY.set(r,i),r},t.unreferenceGeometry=function(e){if(t.GEOMETRY_BY_CONTEXT.has(e)){var r=t.GEOMETRY_BY_CONTEXT.get(e),i=t.REFCOUNT_BY_GEOMETRY.get(r)-1;t.REFCOUNT_BY_GEOMETRY.set(r,i),i>0||(r.uninitialize(),t.GEOMETRY_BY_CONTEXT.delete(e),t.REFCOUNT_BY_GEOMETRY.delete(r))}},t.prototype.relink=function(){if(void 0!==this._colorTable){for(var e=0,t=this._program.shaders;e<t.length;e++){var r=t[e];r.replace("$ColorTableLength",String(this._colorTable.length/4)),r.compile()}this._program.attribute("a_vertex",this._geometry.vertexLocation),this._program.attribute("a_layout",this._geometry.layoutLocation),this._program.attribute("a_id",this._geometry.idLocation),this._program.attribute("a_color",this._geometry.colorLocation),this._program.attribute("a_emphasis",this._geometry.emphasisLocation),this._program.attribute("a_heights",this._geometry.heightLocation),this._program.attribute("a_texCoord",this._geometry.texCoordLocation),this._program.link(),this._program.linked&&(this._drawRestricted&&(this._uAttachment=this._program.uniform("u_attachment")),this._uViewProjection=this._program.uniform("u_viewProjection"),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uColorTable=this._program.uniform("u_colorTable"),this._uLayer=this._program.uniform("u_layer"),this._uArrows=this._program.uniform("u_arrows"),this._uFace=this._program.uniform("u_face"),this._uNormalAndLambert=this._program.uniform("u_normalAndLambert"),this._uHeightScale=this._program.uniform("u_heightScale"),this._uFloatingGap=this._program.uniform("u_floatingGap"),this._uOutlineWidth=this._program.uniform("u_outlineWidth"),this._uEmphasisOutlineWidth=this._program.uniform("u_emphasisOutlineWidth"))}},t.prototype.optimizeFaceSequence=function(){var e=this._camera.eye,r=this._camera.center,i=new Array,n=a.vec3.create();a.vec3.sub(n,e,r),a.vec3.normalize(n,n),e[1]>0&&i.push([t.Face.Top,Math.abs(a.vec3.dot(a.vec3.fromValues(0,1,0),n))]),e[2]>-1&&i.push([t.Face.Front,Math.abs(a.vec3.dot(a.vec3.fromValues(0,0,1),n))]),e[2]<1&&i.push([t.Face.Back,Math.abs(a.vec3.dot(a.vec3.fromValues(0,0,-1),n))]),e[0]>-1&&i.push([t.Face.Left,Math.abs(a.vec3.dot(a.vec3.fromValues(1,0,0),n))]),e[0]<1&&i.push([t.Face.Right,Math.abs(a.vec3.dot(a.vec3.fromValues(-1,0,0),n))]),i=i.sort(function(e,t){return t[1]-e[1]}),this._faceSequence=i.map(function(e){return e[0]})},t.prototype.initialize=function(){var e=this._context.gl;this._context.isWebGL1&&void 0===this._standardDerivatives&&(this._context.enable(["OES_standard_derivatives"]),this._standardDerivatives=this._context.standardDerivatives);var i=new s.Shader(this._context,e.VERTEX_SHADER,"cuboid.vert");i.initialize(r("./shaders/cuboid.vert"),!1);var n=new s.Shader(this._context,e.FRAGMENT_SHADER,"cuboid.frag");return n.initialize(r("./shaders/cuboid.frag"),!1),this._program.initialize([i,n],!1),this._faceData.set(t.Face.Top,[0,1,0,1]),this._faceData.set(t.Face.Bottom,[0,-1,0,.68]),this._faceData.set(t.Face.Front,[0,0,1,.88]),this._faceData.set(t.Face.Back,[0,0,-1,.88]),this._faceData.set(t.Face.Left,[1,0,0,.84]),this._faceData.set(t.Face.Right,[-1,0,0,.84]),!0},t.prototype.uninitialize=function(){t.unreferenceGeometry(this._context),this._program.uninitialize(),this._uAttachment=void 0,this._uViewProjection=void 0,this._uNdcOffset=void 0,this._uColorTable=void 0,this._uLayer=void 0,this._uArrows=void 0,this._uFace=void 0,this._uNormalAndLambert=void 0,this._uHeightScale=void 0,this._uFloatingGap=void 0,this._uOutlineWidth=void 0,this._uEmphasisOutlineWidth=void 0},t.prototype.update=function(){var e=this._context.gl,r=!1;if(!this._program.initialized||!this._program.linked||this._altered.colorTableLength){if(this.relink(),!this._program.linked)return;r=!0}if(this._program.bind(),(r||this._altered.camera||this._camera.altered)&&(e.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),this.optimizeFaceSequence()),(r||this._colorTable)&&e.uniform4fv(this._uColorTable,this._colorTable),this._altered.geometry&&this._geometry.valid&&this._geometry.update(),(r||this._altered.heightScale)&&e.uniform1f(this._uHeightScale,this._heightScale/255),(r||this._altered.outlineWidth)&&e.uniform1f(this._uOutlineWidth,this._outlineWidth),r||this._altered.emphasisOutlineWidth){var i=window.devicePixelRatio;e.uniform1f(this._uEmphasisOutlineWidth,this._emphasisOutlineWidth*i)}if(this._target&&this._target.valid){i=window.devicePixelRatio;e.uniform2f(this._uFloatingGap,this._levitate*i/this._target.height,t.MINIMUM_CUBOID_HEIGHT*i/this._target.height)}this._altered.reset()},t.prototype.frame=function(){if(a.auxiliaries.assert(this._target&&this._target.valid,"valid target expected"),void 0!==this._dispatch){var e=this._context.gl,t=this._target.size;e.viewport(0,0,t[0],t[1]),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,2,255),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),!1===this._depthMask&&(e.depthFunc(e.LEQUAL),e.depthMask(!1)),this._program.bind(),this._drawRestricted&&e.uniform1i(this._uAttachment,this._attachment),e.uniform2fv(this._uNdcOffset,this._ndcOffset),e.uniform1i(this._uLayer,this._layerIndex),e.uniform1i(this._uArrows,this._arrows?1:0),this._geometry.bind(),this._target.bind();for(var r=0,i=this._faceSequence;r<i.length;r++){var n=i[r];if(e.uniform1i(this._uFace,n),e.uniform4fv(this._uNormalAndLambert,this._faceData.get(n)),this._geometry.valid)for(var o=0;o<this._dispatch.length;o+=2){var s=20*(n-1)*4,u=this._dispatch[o+0],c=this._dispatch[o+1];this._geometry.draw(this._layerIndex,u,s,c)}}!1===this._depthMask&&(e.depthFunc(e.LESS),e.depthMask(!0)),e.disable(e.STENCIL_TEST),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}},t.prototype.colorTableLengthAltered=function(){this._altered.alter("colorTableLength")},Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffset",{set:function(e){this.assertInitialized(),this._ndcOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this.assertInitialized(),this._camera!==e&&(this._camera=e,this._altered.alter("camera"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispatch",{set:function(e){this.assertInitialized(),this._dispatch=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutData",{set:function(e){this.assertInitialized(),this._layerIndex>0||(this._geometry.layout=e,this._altered.alter("geometry"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ids",{set:function(e){this.assertInitialized(),this._layerIndex>0||(this._geometry.ids=e,this._altered.alter("geometry"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colors",{set:function(e){this.assertInitialized(),this._layerIndex>0||(this._geometry.colors(e,void 0,1),this._altered.alter("geometry"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphases",{set:function(e){this.assertInitialized(),this._layerIndex>0||(this._geometry.emphases=e,this._altered.alter("emphases"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heights",{set:function(e){this.assertInitialized(),this._geometry.heights(e,this._layerIndex),this._altered.alter("geometry")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTable",{set:function(e){this.assertInitialized(),this._colorTable=e,this._altered.alter("colorTable")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidth",{set:function(e){this.assertInitialized(),this._outlineWidth!==e&&(this._outlineWidth=void 0===e?t.OUTLINE_WIDTH_DEFAULT:Math.max(0,e),this._altered.alter("outlineWidth"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphasisOutlineWidth",{set:function(e){this.assertInitialized(),this._emphasisOutlineWidth!==e&&(this._emphasisOutlineWidth=void 0===e?t.EMPHASIS_OUTLINE_WIDTH_DEFAULT:Math.max(0,e),this._altered.alter("emphasisOutlineWidth"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightScale",{set:function(e){this.assertInitialized(),this._heightScale!==e&&(this._heightScale=void 0===e?0:a.gl_matrix_extensions.clamp(e,0,1),this._altered.alter("heightScale"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levitate",{set:function(e){this.assertInitialized(),this._levitate!==e&&(this._levitate=void 0===e?0:Math.max(0,e),this._altered.alter("levitate"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attachment",{set:function(e){a.auxiliaries.logIf(e!==c.MultiRenderTarget.Attachment.Undefined&&!this._drawRestricted,a.auxiliaries.LogLevel.Debug,"expected WEBGL_draw_buffers to be unsupported"),this._attachment=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{set:function(e){this._depthMask=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"arrows",{set:function(e){this._arrows=e},enumerable:!0,configurable:!0}),t.GEOMETRY_BY_CONTEXT=new Map,t.CUBOID_LAYERS=2,t.REFCOUNT_BY_GEOMETRY=new Map,t.MINIMUM_CUBOID_HEIGHT=4,t.OUTLINE_WIDTH_DEFAULT=.8,t.EMPHASIS_OUTLINE_WIDTH_DEFAULT=1.6,o([s.Initializable.assert_initialized()],t.prototype,"relink",null),o([s.Initializable.assert_initialized()],t.prototype,"optimizeFaceSequence",null),o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([s.Initializable.assert_initialized()],t.prototype,"update",null),o([s.Initializable.assert_initialized()],t.prototype,"frame",null),t}(s.Initializable);t.CuboidRenderPass=l,function(e){!function(e){e[e.Top=1]="Top",e[e.Bottom=2]="Bottom",e[e.Front=3]="Front",e[e.Back=4]="Back",e[e.Left=5]="Left",e[e.Right=6]="Right"}(e.Face||(e.Face={}))}(l=t.CuboidRenderPass||(t.CuboidRenderPass={})),t.CuboidRenderPass=l},"./data/bufferreference.schema.json":function(e){e.exports=JSON.parse('{"id":"/BufferReference","type":"string","pattern":"^(buffer|bufferView):[_a-zA-Z][_a-zA-Z0-9\\\\-]*[_a-zA-Z0-9]+$","description":"Named identifier used to reference a buffer or buffer view throughout the treemap configuration."}')},"./data/colorreference.schema.json":function(e){e.exports=JSON.parse('{"id":"/ColorReference","type":"string","pattern":"^(color):[_a-zA-Z][_a-zA-Z0-9\\\\-]*[_a-zA-Z0-9]+$","description":"Named identifier used to reference a color throughout the treemap configuration."}')},"./data/colorscheme.schema.json":function(e){e.exports=JSON.parse('{"id":"/ColorScheme","type":"object","properties":{"inverted":{"type":"boolean","default":false},"classBounds":{"type":"array","items":{"type":"number"}}}}')},"./data/testdata.schema.json":function(e){e.exports=JSON.parse('{"title":"Treemap Test Data Schema","description":"JSON schema for a softwaremap test data, as used in the treemap typescript module.","type":"object","properties":{"api":{"type":"string","enum":["v2"]},"topic":{"type":"number"},"analyses":{"type":"number"},"apps":{"type":"number"},"tags":{"type":"object","properties":{"selection_mode":{"type":"number"},"untagged_selected":{"type":"boolean"},"bitmask":{"type":"number"}}},"values":{"type":"array","items":{"type":"object","properties":{"metric":{"type":"number"},"response":{"type":"string"}},"required":["metric","response"],"additionalProperties":false}},"heights":{"type":"object","properties":{"metric":{"type":"number"},"include_hierarchy":{"type":"boolean"},"mark_unmodified_items":{"type":"boolean"},"compare":{"type":"boolean"},"response":{"type":"string"}},"required":["metric","include_hierarchy","mark_unmodified_items","compare","response"],"additionalProperties":false},"labels":{"type":"array","items":{"type":"object","properties":{"type":{"type":"string"},"ids":{"type":"array","items":{"type":"number"}},"response":{"type":"object"}},"required":["metric","ids","response"],"additionalProperties":false}}},"required":["api","values","heights","labels"],"additionalProperties":false}')},"./data/treemap.schema.json":function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-06/schema#","title":"Treemap Configuration Schema","description":"JSON schema for a treemap configuration object, targeting the treemap typescript module.","type":"object","properties":{"topology":{"type":"object","properties":{"format":{"type":"string","enum":["interleaved","tupled"],"default":"interleaved"},"edges":{"type":"array","items":{"anyOf":[{"type":"integer","minimum":0},{"type":"array","items":{"type":"integer","minimum":0},"minItems":2,"maxItems":2,"uniqueItems":true}]}}},"required":["edges"],"additionalProperties":false},"buffers":{"type":"array","items":{"type":"object","properties":{"identifier":{"type":"string"},"type":{"type":"string","enum":["numbers","uint8","uint16","int16","uint32","int32","float32","float64"]},"encoding":{"type":"string","enum":["base64","native"],"default":"native"},"data":{"anyOf":[{"type":"array","items":{"type":"string"}},{"type":"array","items":{"type":"number"}},{"type":"Uint8Array"},{"type":"Uint16Array"},{"type":"Int16Array"},{"type":"Uint32Array"},{"type":"Int32Array"},{"type":"Float32Array"},{"type":"Float64Array"}]},"linearization":{"anyOf":[{"type":"string","enum":["topology","identity","depth-first","breadth-first","breadth-first-leaf-bucket"]},{"type":"array","items":{"type":"integer"}}],"default":"topology"}},"required":["identifier","type","data"],"additionalProperties":false}},"bufferViews":{"type":"array","items":{"type":"object","properties":{"identifier":{"type":"string"},"source":{"$ref":"/BufferReference"},"transformations":{"type":"array","items":{"anyOf":[{"type":"object","properties":{"type":{"type":"string","enum":["propagate-up"]},"operation":{"type":"string","enum":["average","sum","min","max","median","closest-to-zero","closest-to-infinity"]},"weight":{"$ref":"/BufferReference"}},"required":["type","operation"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["fill-invalid"]},"value":{"type":"number"},"invalidValue":{"anyOf":[{"type":"number"},{"type":"null"}]}},"required":["type","value"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["mask"]},"value":{"type":"number"}},"required":["type","value"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["clamp"]},"min":{"type":"number"},"max":{"type":"number"}},"required":["type","min","max"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["clamp"]},"range":{"type":"array","items":{"type":"number"},"minItems":2,"maxItems":2}},"required":["type","range"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["range-transform"]},"sourceRange":{"type":"array","items":{"type":"number"},"minItems":2,"maxItems":2},"targetRange":{"type":"array","items":{"type":"number"},"minItems":2,"maxItems":2}},"required":["type","sourceRange","targetRange"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["normalize"]},"operation":{"type":"string","enum":["zero-to-max","min-to-max","sign-agnostic-max"]}},"required":["type","operation"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["threshold"]},"value":{"type":"number"}},"required":["type","value"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["compare"]},"value":{"type":"number"}},"required":["type","value"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["transform"]},"operation":{"type":"string","enum":["add","subtract","multiply","divide","inverse","pow","nth-root","log","square","square-root","as-multiplier","as-remainder","abs"]},"parameter":{"type":"number","default":0},"buffer":{"$ref":"/BufferReference"}},"required":["type","operation"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["discretize"]},"operation":{"type":"string","enum":["quantiles","quartiles"]}},"required":["type","operation"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["discretize"]},"percentiles":{"type":"array","items":{"type":"number"}}},"required":["type","percentiles"],"additionalProperties":false},{"type":"object","properties":{"type":{"type":"string","enum":["callback"]}},"required":["type","operation"],"additionalProperties":true}]}}},"required":["identifier","source"],"additionalProperties":false}},"colors":{"type":"array","items":{"type":"object","properties":{"identifier":{"type":"string"},"space":{"type":"string","enum":["rgb","hsl","lab","cmyk","hex"],"description":"The color space is based on supported webgl-operate color spaces.","default":"hex"},"value":{"oneOf":[{"type":"array","minItems":3,"maxItems":5,"items":{"type":"number","minimum":0,"maximum":1}},{"type":"string","pattern":"^(#|0x)?(([0-9a-f]{3}){1,2}|([0-9a-f]{4}){1,2})$"}]},"values":{"type":"array","minItems":2,"items":{"oneOf":[{"type":"array","minItems":3,"maxItems":5,"items":{"type":"number","minimum":0,"maximum":1}},{"type":"string","pattern":"^(#|0x)?(([0-9a-f]{3}){1,2}|([0-9a-f]{4}){1,2})$"}]}}},"required":["identifier","space"],"oneOf":[{"type":"object","required":["value"]},{"type":"object","required":["values"]}],"additionalProperties":false}},"layout":{"type":"object","properties":{"algorithm":{"type":"string","enum":["strip","snake","codecity"]},"weight":{"$ref":"/BufferReference"},"aspectRatio":{"type":"number","minimum":0,"exclusiveMinimum":true,"default":1},"sort":{"type":"object","properties":{"algorithm":{"type":"string","enum":["ascending","descending","keep"],"default":"keep"},"key":{"anyOf":[{"type":"string","enum":["identity","weight"]},{"$ref":"/BufferReference"}],"default":"identity"}},"required":["algorithm"],"additionalProperties":false},"siblingMargin":{"type":"object","properties":{"type":{"type":"string","enum":["relative","absolute"],"default":"relative"},"value":{"anyOf":[{"$ref":"/BufferReference"},{"type":"number","minimum":0}],"default":0}},"required":["type","value"],"additionalProperties":false},"parentPadding":{"type":"object","properties":{"type":{"type":"string","enum":["relative","absolute","mixed"],"default":"relative"},"value":{"anyOf":[{"$ref":"/BufferReference"},{"type":"number","minimum":0},{"type":"array","items":{"type":"number","minimum":0},"minItems":1}],"default":0}},"required":["type","value"],"additionalProperties":false},"accessoryPadding":{"type":"object","properties":{"type":{"type":"string","enum":["relative","absolute"],"default":"absolute"},"direction":{"type":"string","enum":["top","left","bottom","right"],"default":"bottom"},"value":{"anyOf":[{"type":"number","minimum":0},{"type":"array","items":{"type":"number","minimum":0},"minItems":1}]},"relativeAreaThreshold":{"anyOf":[{"type":"number","minimum":0},{"type":"array","items":{"type":"number","minimum":0},"minItems":1}],"default":0},"targetAspectRatio":{"anyOf":[{"type":"number","minimum":0},{"type":"null"}],"default":null}},"required":["value"],"additionalProperties":false},"cascade":{"type":"boolean","default":false},"flattenDirectories":{"type":"boolean","description":"Flatten directories while computing the layout. Also known as \'directory pruning\'.","default":false}},"required":["algorithm","weight"],"additionalProperties":false},"geometry":{"type":"object","properties":{"parentLayer":{"type":"object","properties":{"colorMap":{"$ref":"/ColorReference","default":"color:inner"},"showRoot":{"type":"boolean","default":false}},"additionalProperties":false},"leafLayers":{"type":"array","items":{"type":"object","properties":{"colorMap":{"$ref":"/ColorReference","default":"color:leaf"},"colorScheme":{"$ref":"/ColorScheme"},"height":{"$ref":"/BufferReference"},"colors":{"$ref":"/BufferReference"}},"additionalProperties":false}},"aggregation":{"type":"object","properties":{"buffer":{"$ref":"/BufferReference"},"depthThreshold":{"type":"number","minimum":0,"default":1},"valueThreshold":{"type":"number","default":0}},"required":["buffer"],"additionalProperties":false},"auxiliary":{"$ref":"/ColorReference","default":"color:auxiliary"},"emphasis":{"type":"object","properties":{"outline":{"type":"array","items":{"type":"integer","minimum":0},"uniqueItems":true},"highlight":{"type":"array","items":{"type":"integer","minimum":0},"uniqueItems":true},"color":{"$ref":"/ColorReference","default":"color:emphasis"},"outlineWidth":{"type":"number","minimum":0,"description":"unit: device-independent pixel","default":1.6}},"additionalProperties":false},"heightScale":{"anyOf":[{"type":"string","enum":["SomethingInverseSqrt"]},{"type":"number"}],"default":0.125},"levitate":{"type":"number","minimum":0,"default":0,"description":"unit: device-independent pixel"},"outlineWidth":{"type":"number","minimum":0,"description":"unit: native pixel","default":0.8}},"required":["parentLayer"],"additionalProperties":false},"labels":{"type":"object","properties":{"names":{"$ref":"/BufferReference"},"additionallyLabelSet":{"type":"array","items":{"type":"number","minimum":0}},"innerNodeLayerRange":{"type":"array","items":{"type":"number","minimum":0},"minItems":2,"maxItems":2,"default":[1,2]},"numTopInnerNodes":{"type":"number","minimum":0,"default":0},"numTopWeightNodes":{"type":"number","minimum":0,"default":0},"numTopHeightNodes":{"type":"number","minimum":0,"default":0},"numTopColorNodes":{"type":"number","minimum":0,"default":0}},"required":[]}},"required":["topology","layout"],"additionalProperties":false}')},"./directionalrow.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r("../node_modules/webgl-operate/lib/webgl-operate.js").auxiliaries.assert,a=r("./rect.ts"),s=function(e){function t(t,r,i,n,o,a,s){var u=e.call(this,t,r,i,n,o)||this;return u._reverse=a,u._parentReverse=s,u}return n(t,e),Object.defineProperty(t.prototype,"reverse",{get:function(){return this._reverse},set:function(e){this._reverse=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentReverse",{get:function(){return this._parentReverse},set:function(e){this._parentReverse=e},enumerable:!0,configurable:!0}),t.prototype.layoutNodes=function(e){var t=this;if(void 0!==this._firstChild)if(this.isDisabled)this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(r){e[r.index]=new a.Rect(t._availableSpace.left,t._availableSpace.bottom,t._availableSpace.left,t._availableSpace.bottom)});else{var r=this.currentSpace,i=this._reverse?a.Rect.Orientation.DC:a.Rect.Orientation.CD;if(this._horizontal)if(this._parentReverse){var n=r.right;this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(s){var u=t._weights[s.index],c=r.width*u/t._childrenWeight,l=Math.max(n-c,r.left);e[s.index]=new a.Rect(l,r.bottom,n,r.top,i),o(t._availableSpace.comprises(e[s.index]),"Expect that child rect is within parent rect"),n=l})}else{var s=r.left;this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(n){var u=t._weights[n.index],c=r.width*u/t._childrenWeight,l=Math.min(s+c,r.right);e[n.index]=new a.Rect(s,r.bottom,l,r.top,i),o(t._availableSpace.comprises(e[n.index]),"Expect that child rect is within parent rect"),s=l})}else if(this._parentReverse){var u=r.top;this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(n){var s=t._weights[n.index],c=r.height*s/t._childrenWeight,l=Math.max(u-c,r.bottom);e[n.index]=new a.Rect(r.left,l,r.right,u,i),o(t._availableSpace.comprises(e[n.index]),"Expect that child rect is within parent rect"),u=l})}else{var c=r.bottom;this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(n){var s=t._weights[n.index],u=r.height*s/t._childrenWeight,l=Math.min(c+u,r.top);e[n.index]=new a.Rect(r.left,c,r.right,l,i),o(t._availableSpace.comprises(e[n.index]),"Expect that child rect is within parent rect"),c=l})}}},Object.defineProperty(t.prototype,"currentSpace",{get:function(){if(this.isDisabled)return this._availableSpace.truncateBottom(this._availableSpace.top);if(this._childrenWeight>=this._availableWeight||void 0===this._lastChild)return a.Rect.clone(this.availableSpace);var e=this._childrenWeight/this._availableWeight;if(this._horizontal){if(this._parentReverse){var t=this._availableSpace.top-e*this._availableSpace.height;return this._availableSpace.truncateBottom(t)}t=this._availableSpace.bottom+e*this._availableSpace.height;return this._availableSpace.truncateTop(t)}if(this._parentReverse){t=this._availableSpace.right-e*this._availableSpace.width;return this._availableSpace.truncateLeft(t)}t=this._availableSpace.left+e*this._availableSpace.width;return this._availableSpace.truncateRight(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remainingSpace",{get:function(){if(this.isDisabled)return this._availableSpace.truncateBottom(this._availableSpace.top);var e=Math.min(this._childrenWeight/this._availableWeight,1);if(this._horizontal){if(this._parentReverse){var t=this._availableSpace.top-e*this._availableSpace.height;return this._availableSpace.truncateTop(t)}t=this._availableSpace.bottom+e*this._availableSpace.height;return this._availableSpace.truncateBottom(t)}if(this._parentReverse){t=this._availableSpace.right-e*this._availableSpace.width;return this._availableSpace.truncateRight(t)}t=this._availableSpace.left+e*this._availableSpace.width;return this._availableSpace.truncateLeft(t)},enumerable:!0,configurable:!0}),t.prototype.next=function(t){e.prototype.next.call(this,t),this._reverse=!this._reverse},t}(r("./row.ts").Row);t.DirectionalRow=s},"./drawdispatch.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=r("./msagent.ts"),o=r("./perflogindent.ts"),a=function(){function e(){this._ids=void 0,this._mask=void 0,this._slices=void 0,this._filters=new Map,this._unfiltered=void 0,this._sequences=new Map,this._complements=new Map}return Object.defineProperty(e,"debug",{set:function(t){t&&i.auxiliaries.logVerbosity()<i.auxiliaries.LogLevel.Debug&&(i.auxiliaries.logVerbosity(i.auxiliaries.LogLevel.Debug),i.auxiliaries.log(i.auxiliaries.LogLevel.Debug,"changed log verbosity to "+i.auxiliaries.LogLevel.Debug+" (debug)")),e._debug=t},enumerable:!0,configurable:!0}),e.encode=function(t){var r="draw dispatch encode";i.auxiliaries.logPerformanceStartIf(e._debug,r);var n=new Array;if(0===t.length)return i.auxiliaries.logPerformanceStopIf(e._debug,r,"empty",o.PERF_LOG_INDENT),n;t.sort(function(e,t){return e-t});var a=t[0],s=t[0];n.push(a);for(var u=1;u<t.length;++u){var c=t[u];s+1!==c?(n.push(s-a+1),a=s=c,n.push(a)):s=c}return n.push(s-a+1),i.auxiliaries.logPerformanceStopIf(e._debug,r,void 0,o.PERF_LOG_INDENT),n},e.prototype.slice=function(t){var r="draw dispatch slice";if(i.auxiliaries.logPerformanceStartIf(e._debug,r),void 0===this._slices)return i.auxiliaries.logPerformanceStopIf(e._debug,r,"undefined",o.PERF_LOG_INDENT),t;for(var n=new Array,a=0;a<this._slices.length;a+=2)for(var s=this._slices[a+0],u=this._slices[a+1],c=0;c<t.length;c+=2){var l=t[c+0],f=l+t[c+1]-1;if(!(f<s||l>u)){var h=Math.max(s,l),d=Math.min(u,f)-h+1;n.push(h),n.push(d)}}return i.auxiliaries.logPerformanceStopIf(e._debug,r,void 0,o.PERF_LOG_INDENT),n},e.prototype.compute_unfiltered=function(){var t=this,r="draw dispatch unfiltered";if(i.auxiliaries.logPerformanceStartIf(e._debug,r),void 0===this._ids)return this._unfiltered=void 0,void i.auxiliaries.logPerformanceStopIf(e._debug,r,"undefined",o.PERF_LOG_INDENT);var n=this._ids.map(function(e,t){return t}).filter(function(e){return void 0===t._mask||t._mask[e]>0});this._unfiltered=this.slice(e.encode(n)),i.auxiliaries.logPerformanceStopIf(e._debug,r,void 0,o.PERF_LOG_INDENT)},e.prototype.compute_filtered=function(t){var r=this,n="draw dispatch filtered";i.auxiliaries.logPerformanceStartIf(e._debug,n);var a=this._filters.get(t);if(void 0===a||void 0===this._ids)return this._sequences.set(t,[]),void i.auxiliaries.logPerformanceStopIf(e._debug,n,"undefined",o.PERF_LOG_INDENT);var s=a.map(function(e){return r._ids.indexOf(e)}).filter(function(e){return void 0===r._mask||r._mask[e]>0}),u=this.slice(e.encode(s));this._sequences.set(t,u),i.auxiliaries.logPerformanceStopIf(e._debug,n,void 0,o.PERF_LOG_INDENT)},e.prototype.compute_complement=function(t){var r=this,n="draw dispatch complement";i.auxiliaries.logPerformanceStartIf(e._debug,n);var a=this._filters.get(t);if(void 0===a||void 0===this._ids)return this._sequences.set(t,[]),void i.auxiliaries.logPerformanceStopIf(e._debug,n,"undefined",o.PERF_LOG_INDENT);var s=this._ids.map(function(e,t){return t}).filter(function(e){return-1===a.indexOf(r._ids[e])&&(void 0===r._mask||r._mask[e]>0)}),u=this.slice(e.encode(s));this._complements.set(t,u),i.auxiliaries.logPerformanceStopIf(e._debug,n,void 0,o.PERF_LOG_INDENT)},e.prototype.count=function(e){return e.reduce(function(e,t,r){return r%2==1?e+t:e},0)},e.prototype.invalidate=function(e){if(e)return this._sequences.delete(e),void this._complements.delete(e);this._sequences.clear(),this._complements.clear(),this._unfiltered=void 0},e.prototype.filter=function(e,t){this.invalidate(e),this._filters.set(e,t instanceof Uint32Array?Array.from(t):t)},e.prototype.unfiltered=function(){return void 0===this._ids?new Array:(void 0===this._unfiltered&&this.compute_unfiltered(),this._unfiltered)},e.prototype.filtered=function(e){return this._filters.has(e)?(this._sequences.has(e)||this.compute_filtered(e),this._sequences.get(e)):(i.auxiliaries.log(i.auxiliaries.LogLevel.Warning,"unknown draw dispatch sequence handle, given "+e),new Array(0))},e.prototype.complemented=function(e){return this._filters.has(e)?(this._complements.has(e)||this.compute_complement(e),this._complements.get(e)):(i.auxiliaries.log(i.auxiliaries.LogLevel.Warning,"unknown draw dispatch sequence handle, given "+e),new Array(0))},e.prototype.unfilteredCount=function(){var e=this.unfiltered();return this.count(e)},e.prototype.filteredCount=function(e){var t=this.filtered(e);return this.count(t)},e.prototype.complementedCount=function(e){var t=this.complemented(e);return this.count(t)},Object.defineProperty(e.prototype,"mask",{set:function(e){this.invalidate(),void 0!==e?n.IS_EDGE?this._mask=e instanceof Uint8Array?Array.from(e):e:this._mask=e instanceof Uint8Array?e:Uint8Array.from(e):this._mask=void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slices",{get:function(){return this._slices},set:function(e){this.invalidate(),this._slices=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ids",{set:function(e){this.invalidate(),n.IS_EDGE||n.IS_IE11?this._ids=e instanceof Uint32Array?Array.from(e):e:this._ids=e instanceof Uint32Array?e:Uint32Array.from(e),this._filters.clear(),this._mask=void 0},enumerable:!0,configurable:!0}),e._debug=!1,e}();t.DrawDispatch=a},"./drawdispatchcomputation.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./drawdispatch.ts"),n=function(){function e(){}return e.computeParentDrawDispatch=function(e,t,r){var n=new i.DrawDispatch,o=new Uint32Array(e.numberOfInnerNodes);e.forEachInnerNode(function(e){return o[e.index]=e.id});for(var a=o.filter(function(e,r){return!t[r]}),s=e.linearization.slices,u=new Array,c=!1===r?1:0,l=s.length-2;l>=c;--l)u.push(s[l][0]),u.push(s[l][1]);return n.ids=o,n.slices=u,n.filter(0,a),n},e.computeLeafDrawDispatch=function(e,t){var r=new i.DrawDispatch,n=new Uint32Array(e.numberOfLeafNodes);e.forEachLeafNode(function(t){return n[t.index-e.numberOfInnerNodes]=t.id});var o=n.filter(function(r,i){return!t[i+e.numberOfInnerNodes]});return r.ids=n,r.filter(0,o),r},e}();t.DrawDispatchComputation=n},"./geometry.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("./geometryexport.ts"),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._altered=Object.assign(new a.ChangeLookup,{any:!1,colorTableLength:!1,colorTable:!1,innerNodeIndices:!1,innerNodeLayouts:!1,innerNodeEmphases:!1,innerNodeColors:!1,innerNodeDrawDispatch:!1,layers:!1,leafNodeIndices:!1,leafNodeLayouts:!1,leafNodeEmphases:!1,leafNodeColors:!1,leafNodeHeights:!1,leafNodeDrawDispatch:!1,outlineWidth:!1,emphasisOutlineWidth:!1,heightScale:!1,levitate:!1,labels:!1}),t._leafNodeColors=new Array,t._leafNodeHeights=new Array,t}return n(t,e),t.prototype.initialize=function(e){return this._topology=e,this._altered.alter("any"),this._topology.numberOfInnerNodes>0||this._topology.numberOfLeafNodes>0},t.prototype.uninitialize=function(){this._topology=void 0,this._colorTable=void 0,this._leafNodeColors.length=0,this._leafNodeHeights.length=0,this._innerNodeIndices=void 0,this._innerNodeLayouts=void 0,this._innerNodeEmphases=void 0,this._innerNodeColors=void 0,this._innerNodeDrawDispatch=void 0,this._leafNodeIndices=void 0,this._leafNodeLayouts=void 0,this._leafNodeEmphases=void 0,this._leafNodeDrawDispatch=void 0},t.prototype.asObjBlob=function(e,t){return s.ObjExport.blob(this,e,t)},t.prototype.downloadObjBlob=function(e,t,r){void 0===e&&(e="treemap.obj");var i=this.asObjBlob(t,r),n=window.URL.createObjectURL(i),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download",e),o.click()},Object.defineProperty(t.prototype,"altered",{get:function(){return this._altered},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topology",{get:function(){return this.assertInitialized(),this._topology},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerNodeIndices",{get:function(){return this._innerNodeIndices},set:function(e){this.assertInitialized(),this._innerNodeIndices=e,this._altered.alter("innerNodeIndices")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerNodeLayouts",{get:function(){return this._innerNodeLayouts},set:function(e){this.assertInitialized(),this._innerNodeLayouts=e,this._altered.alter("innerNodeLayouts")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerNodeEmphases",{get:function(){return this._innerNodeEmphases},set:function(e){this.assertInitialized(),this._innerNodeEmphases=e,this._altered.alter("innerNodeEmphases")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerNodeColors",{get:function(){return this._innerNodeColors},set:function(e){this.assertInitialized(),this._innerNodeColors=e,this._altered.alter("innerNodeColors")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerNodeDrawDispatch",{get:function(){return this._innerNodeDrawDispatch},set:function(e){this.assertInitialized(),this._innerNodeDrawDispatch=e,this._altered.alter("innerNodeDrawDispatch")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeIndices",{get:function(){return this._leafNodeIndices},set:function(e){this.assertInitialized(),this._leafNodeIndices=e,this._altered.alter("leafNodeIndices")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeLayouts",{get:function(){return this._leafNodeLayouts},set:function(e){this.assertInitialized(),this._leafNodeLayouts=e,this._altered.alter("leafNodeLayouts")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeEmphases",{get:function(){return this._leafNodeEmphases},set:function(e){this.assertInitialized(),this._leafNodeEmphases=e,this._altered.alter("leafNodeEmphases")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeColors",{get:function(){return this._leafNodeColors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTable",{get:function(){return this._colorTable},set:function(e){this.assertInitialized(),this._colorTable=e,this._altered.alter("colorTable")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeHeights",{get:function(){return this._leafNodeHeights},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeDrawDispatch",{get:function(){return this._leafNodeDrawDispatch},set:function(e){this.assertInitialized(),this._leafNodeDrawDispatch=e,this._altered.alter("leafNodeDrawDispatch")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"innerNodeCount",{get:function(){return this.assertInitialized(),this._topology.numberOfInnerNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafNodeCount",{get:function(){return this.assertInitialized(),this._topology.numberOfLeafNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heightScale",{get:function(){return this._heightScale},set:function(e){this.assertInitialized(),this._heightScale=e,this._altered.alter("heightScale")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levitate",{get:function(){return this._levitate},set:function(e){this.assertInitialized(),this._levitate=e,this._altered.alter("levitate")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this.assertInitialized(),this._outlineWidth=e,this._altered.alter("outlineWidth")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphasisOutlineWidth",{get:function(){return this._emphasisOutlineWidth},set:function(e){this.assertInitialized(),this._emphasisOutlineWidth=e,this._altered.alter("emphasisOutlineWidth")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leafLayerCount",{get:function(){return this.assertInitialized(),this._leafNodeHeights.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){return this.initialized},enumerable:!0,configurable:!0}),o([a.Initializable.initialize()],t.prototype,"initialize",null),o([a.Initializable.uninitialize()],t.prototype,"uninitialize",null),t}(a.Initializable);t.Geometry=u,function(e){!function(e){e[e.None=0]="None",e[e.Outline=1]="Outline",e[e.Highlight=2]="Highlight"}(e.Emphasis||(e.Emphasis={}))}(u=t.Geometry||(t.Geometry={})),t.Geometry=u},"./geometry/nodecolors.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.innerNodes=function(e,t,r){var i=new Uint8Array(e.numberOfInnerNodes);return e.forEachInnerNode(function(e){i[e.index]=t+e.depth%r}),i},e}();t.NodeColors=i},"./geometry/nodeemphases.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./geometry.ts"),n=function(){function e(){}return e.innerNodes=function(e,t,r){var n=new Uint8Array(e.numberOfInnerNodes);return e.forEachInnerNode(function(e){r&&r.has(e.id)?n[e.index]=i.Geometry.Emphasis.Highlight:t&&t.has(e.id)?n[e.index]=i.Geometry.Emphasis.Outline:n[e.index]=i.Geometry.Emphasis.None}),n},e.leafNodes=function(e,t,r){var n=new Uint8Array(e.numberOfLeafNodes);return e.forEachLeafNode(function(o){var a=o.index-e.numberOfInnerNodes;r&&r.has(o.id)?n[a]=i.Geometry.Emphasis.Highlight:t&&t.has(o.id)?n[a]=i.Geometry.Emphasis.Outline:n[a]=i.Geometry.Emphasis.None}),n},e}();t.NodeEmphases=n},"./geometry/nodeindices.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=function(){function e(){}return e.innerNodes=function(e){var t=new Uint8Array(4*e.numberOfInnerNodes);return e.forEachInnerNode(function(e){var r=e.index,n=i.vec4.create();i.gl_matrix_extensions.encode_uint32_to_rgba8(n,e.index),t[4*r+0]=n[0],t[4*r+1]=n[1],t[4*r+2]=n[2],t[4*r+3]=n[3]}),t},e.leafNodes=function(e){var t=new Uint8Array(4*e.numberOfLeafNodes),r=e.numberOfInnerNodes;return e.forEachLeafNode(function(e){var n=e.index-r,o=i.vec4.create();i.gl_matrix_extensions.encode_uint32_to_rgba8(o,e.index),t[4*n+0]=o[0],t[4*n+1]=o[1],t[4*n+2]=o[2],t[4*n+3]=o[3]}),t},e}();t.NodeIndices=n},"./geometrycreation.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.getColorIndexByEdges=function(e,t,r,i){for(var n=0;n<r.length&&e>r[n];)++n;return Math.min(n,t-1)},e.getColorIndexByEdgesInverted=function(e,t,r,i){for(var n=0;n<r.length;n++)if(e<=r[n])return t-1-n;return 0},e.getColorIndex=function(e,t,r){var i=(e-r[0])/(r[1]-r[0]);return Math.min(t-1,Math.floor(Math.max(0,t*i-1e-4)))},e.getColorIndexInverted=function(e,t,r){var i=(e-r[0])/(r[1]-r[0]);return t-1-Math.min(t-1,Math.floor(Math.max(0,t*i-1e-4)))},e.getColorIndexComputation=function(e,t,r,i){var n=this;return void 0===t?r?function(t){return n.getColorIndexInverted(t,e,i)}:function(t){return n.getColorIndex(t,e,i)}:r?function(r){return n.getColorIndexByEdgesInverted(r,e,t,i)}:function(r){return n.getColorIndexByEdges(r,e,t,i)}},e.insertLayoutIntoBuffer=function(e,t,r){var i=4*t;e[i+0]=2*r.left-1,e[i+1]=1-2*r.bottom-2*r.height,e[i+2]=2*r.width,e[i+3]=2*r.height},e.createLeafLayoutBuffer=function(t,r,i){var n=new Float32Array(4*t.numberOfLeafNodes),o=t.numberOfInnerNodes;return t.forEachLeafNode(function(t){var i=t.index-o,a=r[t.index];e.insertLayoutIntoBuffer(n,i,a)}),n},e.createLeafUnmodifiedBuffer=function(e,t){var r=new Uint8Array(e.numberOfLeafNodes),i=e.numberOfInnerNodes;return e.forEachLeafNode(function(e){var t=e.index-i;r[t]=e.unmodified?1:0}),r},e.createLayerHeightBuffer=function(e,t,r,i){var n=new Uint8Array(2*e.numberOfLeafNodes),o=e.numberOfInnerNodes,a=!1;return e.forEachLeafNode(function(e){var i=e.index-o,s=void 0!==r?Math.max(r[2*i+1],0):0,u=Math.max(t[e.index],0),c=s+255*u;s>0&&u>0&&(c=Math.ceil(c)),c>255&&(a=!0,c=255),n[2*i+0]=s,n[2*i+1]=c}),a&&console.error("Height value overflow"),n},e.createEmptyLayerHeightBuffer=function(e){return new Uint8Array(2*e.numberOfLeafNodes)},e.createParentLayoutBuffer=function(t,r,i){var n=new Float32Array(4*t.numberOfInnerNodes);return t.forEachInnerNode(function(t){var i=t.index,o=r[t.index];e.insertLayoutIntoBuffer(n,i,o)}),n},e.defaultLeafNodeColors=function(e,t){var r=new Uint8Array(e.numberOfLeafNodes);return r.fill(t),r},e.createLeafNodeColors=function(e,t,r,i,n,o,a,s,u){var c=new Uint8Array(e.numberOfLeafNodes),l=e.numberOfInnerNodes,f=this.getColorIndexComputation(i,a,s,n);return e.forEachLeafNode(function(e){var i=e.index-l,n=t[e.index];if(n>-1){var a=u&&0===u[e.index]?-1:1;c[i]=a*(r+f(n))+32}else c[i]=o+32}),c},e.createLeafNodeHeights=function(){return new Uint8Array(0)},e}();t.GeometryCreation=i,function(e){!function(e){e.Plain="plain"}(e.ParentShading||(e.ParentShading={})),function(e){e.Plain="plain",e.Diff="diff"}(e.LeafShading||(e.LeafShading={}))}(i=t.GeometryCreation||(t.GeometryCreation={})),t.GeometryCreation=i},"./geometryexport.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=i.gl_matrix_extensions.v3,o=function(){function e(){}return e.inner=function(t,r,o,a){var s=t.innerNodeLayouts,u=e.SLICE_STENCIL_COMPENSATION*a,c=i.vec3.fromValues(s[4*r+0],u,s[4*r+1]),l=i.vec3.fromValues(s[4*r+2],0,s[4*r+3]),f=Array(c,i.vec3.add(n(),c,i.vec3.fromValues(l[0],l[1],0)),i.vec3.add(n(),c,l),i.vec3.add(n(),c,i.vec3.fromValues(0,l[1],l[2]))),h=e.VERTEX_PRECISION,d="g inner-"+r+" slice-"+a+"\n";return d+="v "+f[0][0].toFixed(h)+" "+f[0][1].toFixed(h)+" "+f[0][2].toFixed(h)+"\n",d+="v "+f[1][0].toFixed(h)+" "+f[1][1].toFixed(h)+" "+f[1][2].toFixed(h)+"\n",d+="v "+f[2][0].toFixed(h)+" "+f[2][1].toFixed(h)+" "+f[2][2].toFixed(h)+"\n",d+="v "+f[3][0].toFixed(h)+" "+f[3][1].toFixed(h)+" "+f[3][2].toFixed(h)+"\n",d+="f "+(o+0)+" "+(o+1)+" "+(o+2)+"\n",d+="f "+(o+2)+" "+(o+3)+" "+(o+0)+"\n"},e.leaf=function(t,r,o,a){var s=t.leafNodeLayouts,u=t.leafNodeHeights[a],c=t.heightScale/255,l=i.vec3.fromValues(s[4*r+0],u[2*r+0]*c,s[4*r+1]),f=i.vec3.fromValues(s[4*r+2],(u[2*r+1]-u[2*r+0])*c,s[4*r+3]),h=Array(i.vec3.add(n(),l,i.vec3.fromValues(0,0,0)),i.vec3.add(n(),l,i.vec3.fromValues(f[0],0,0)),i.vec3.add(n(),l,i.vec3.fromValues(f[0],0,f[2])),i.vec3.add(n(),l,i.vec3.fromValues(0,0,f[2])),i.vec3.add(n(),l,i.vec3.fromValues(0,f[1],0)),i.vec3.add(n(),l,i.vec3.fromValues(f[0],f[1],0)),i.vec3.add(n(),l,i.vec3.fromValues(f[0],f[1],f[2])),i.vec3.add(n(),l,i.vec3.fromValues(0,f[1],f[2]))),d=e.VERTEX_PRECISION;if(f[1]<=0)return["",0];var p="g leaf-"+r+" layer-"+a+"\n";p+="v "+h[0][0].toFixed(d)+" "+h[0][1].toFixed(d)+" "+h[0][2].toFixed(d)+"\n",p+="v "+h[1][0].toFixed(d)+" "+h[1][1].toFixed(d)+" "+h[1][2].toFixed(d)+"\n",p+="v "+h[2][0].toFixed(d)+" "+h[2][1].toFixed(d)+" "+h[2][2].toFixed(d)+"\n",p+="v "+h[3][0].toFixed(d)+" "+h[3][1].toFixed(d)+" "+h[3][2].toFixed(d)+"\n",p+="v "+h[4][0].toFixed(d)+" "+h[4][1].toFixed(d)+" "+h[4][2].toFixed(d)+"\n",p+="v "+h[5][0].toFixed(d)+" "+h[5][1].toFixed(d)+" "+h[5][2].toFixed(d)+"\n",p+="v "+h[6][0].toFixed(d)+" "+h[6][1].toFixed(d)+" "+h[6][2].toFixed(d)+"\n",p+="v "+h[7][0].toFixed(d)+" "+h[7][1].toFixed(d)+" "+h[7][2].toFixed(d)+"\n";for(var _=o,v=0,m=[[5,6,4],[4,6,7],[1,5,0],[0,5,4],[3,7,2],[2,7,6],[2,6,1],[1,6,5],[0,4,3],[3,4,7]];v<m.length;v++){var b=m[v];p+="f "+(_+b[0])+" "+(_+b[1])+" "+(_+b[2])+"\n"}return[p,e.VERTICES_PER_LEAF_NODE]},e.blob=function(t,r,n){i.auxiliaries.assert(t.valid,"expected geometry to be valid"),i.auxiliaries.assert(void 0!==t.innerNodeDrawDispatch,"expected geometry to have valid inner node draw dispatch"),i.auxiliaries.assert(void 0!==t.leafNodeDrawDispatch,"expected geometry to have valid leaf node draw dispatch");var o=t.innerNodeDrawDispatch,a=t.leafNodeDrawDispatch,s=void 0!==r&&r.length>0,u=new Array,c=0;if(s)for(var l=0,f=r;l<f.length;l++){var h=f[l];c=o.filteredCount(h),u=u.concat(o.filtered(h))}else c=o.unfilteredCount(),u=u.concat(o.unfiltered());var d=void 0!==n&&n.length>0,p=new Array(0),_=0;if(d)for(var v=0,m=n;v<m.length;v++){h=m[v];_+=a.filteredCount(h),p=p.concat(a.filtered(h))}else _=a.unfilteredCount(),p=p.concat(a.unfiltered());for(var b=e.VERTICES_PER_INNER_NODE*c,g=e.VERTICES_PER_LEAF_NODE*t.leafLayerCount*_,y="# vertices "+b+"\n# faces "+2*c+"\n# objects "+c+"\n",E="# vertices "+g+"\n# faces "+10*_+"\n# objects "+_+"\n",x=1,T=void 0!==o.slices?o.slices:[0,0],O=T.length/2,P=function(r){for(var i=O-T.findIndex(function(e,t){return e<=u[r]&&t%2==0})/2,n=u[r];n<u[r]+u[r+1];++n)y+=A.inner(t,n,x,i),x+=e.VERTICES_PER_INNER_NODE},A=this,L=0;L<u.length;L+=2)P(L);for(L=0;L<p.length;L+=2)for(var w=p[L];w<p[L]+p[L+1];++w)for(var S=0;S<t.leafLayerCount;++S){var R=this.leaf(t,w,x,S);E+=R[0],x+=R[1]}return new Blob(["# seerene(tm) treemap\n\n# inner nodes "+c+(s?" (filtered)":"")+"\n# leaf nodes "+_+(d?" (filtered)":"")+"\n# vertices "+b+" (inner) + "+g+" (leaf)\n\n"+y+"\n"+E],{type:"text/plain"})},e.VERTICES_PER_INNER_NODE=4,e.VERTICES_PER_LEAF_NODE=8,e.SLICE_STENCIL_COMPENSATION=1e-4,e.VERTEX_PRECISION=8,e}();t.ObjExport=o},"./index2d.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.outer=0,this.inner=0}return e.prototype.next=function(e){++this.inner,this.inner===e[this.outer].length&&(++this.outer,this.inner=0)},e.prototype.end=function(e){return this.outer===e.length},e.prototype.element=function(e){return e[this.outer][this.inner]},e}();t.Index2D=i},"./initialize.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=r("../node_modules/webgl-operate/lib/webgl-operate.js");t.initialize=function(e,t,r){void 0===r&&(r=(new n.Color).fromHex("fafafa"));var o=e instanceof HTMLCanvasElement?e:document.getElementById(e),a=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime);-1!==navigator.appVersion.indexOf("Mac")&&a&&(o.dataset.msqrdP="no-WEBGL_draw_buffers",console.warn("detected Chrome on MacOS, disabling WEBGL_draw_buffers"));var s=new n.Canvas(o,t||{alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1});return new i.viewer.EventBlocker(s.element).block("contextmenu"),s.clearColor=r,s.framePrecision=n.Wizard.Precision.byte,s.controller.multiFrameNumber=64,s.context.gl.clearColor(r.r,r.g,r.b,r.a),s.context.gl.clear(s.context.gl.COLOR_BUFFER_BIT),s}},"./intermediateresults.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./topology.ts"),n=function(){return function(){this.topology=new i.Topology}}();t.IntermediateResults=n},"./labelarea.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=i.gl_matrix_extensions.v2,o=r("./relativelabelposition.ts"),a=function(){function e(e,t,r){this.origin=e,this.extent=t,this.position=r}return e.prototype.areBothPositionsHidden=function(e){return this.position===o.RelativeLabelPosition.Type.Hidden||e===o.RelativeLabelPosition.Type.Hidden},e.prototype.overlaps=function(e){if(this.areBothPositionsHidden(e.position))return!1;var t=i.vec2.add(n(),this.origin,this.extent),r=i.vec2.add(n(),e.origin,e.extent);return this.origin[0]<r[0]&&t[0]>e.origin[0]&&this.origin[1]<r[1]&&t[1]>e.origin[1]},e.prototype.paddedOverlaps=function(e,t){if(this.areBothPositionsHidden(e.position))return!1;var r=i.vec2.fromValues(t[0]+1,t[1]+1),o=i.vec2.sub(n(),this.origin,i.vec2.mul(n(),this.extent,t)),a=i.vec2.sub(n(),e.origin,i.vec2.mul(n(),e.extent,t)),s=i.vec2.add(n(),this.origin,i.vec2.mul(n(),this.extent,r)),u=i.vec2.add(n(),e.origin,i.vec2.mul(n(),e.extent,r));return o[0]<u[0]&&s[0]>a[0]&&o[1]<u[1]&&s[1]>a[1]},e.prototype.overlapArea=function(e){if(this.areBothPositionsHidden(e.position))return 0;var t=i.vec2.max(n(),this.origin,e.origin),r=i.vec2.min(n(),i.vec2.add(n(),this.origin,this.extent),i.vec2.add(n(),e.origin,e.extent));return Math.max(0,r[0]-t[0])*Math.max(0,r[1]-t[1])},e.prototype.paddedOverlapArea=function(e,t){if(this.areBothPositionsHidden(e.position))return 0;var r=i.vec2.max(n(),i.vec2.sub(n(),this.origin,i.vec2.mul(n(),this.extent,t)),i.vec2.sub(n(),e.origin,i.vec2.mul(n(),e.extent,t))),o=i.vec2.fromValues(t[0]+1,t[1]+1),a=i.vec2.min(n(),i.vec2.add(n(),this.origin,i.vec2.mul(n(),this.extent,o)),i.vec2.add(n(),e.origin,i.vec2.mul(n(),e.extent,o)));return Math.max(0,a[0]-r[0])*Math.max(0,a[1]-r[1])},e.prototype.area=function(){return this.extent[0]*this.extent[1]},e}();t.LabelArea=a},"./labelmanagement.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=r("../node_modules/webgl-operate/lib/webgl-operate.js"),o=n.auxiliaries.assert,a=n.auxiliaries.log,s=n.auxiliaries.LogLevel;function u(e,t,r){e.length>0&&e[e.length-1].value<t&&(e[e.length-1]={nodeId:r,value:t},e.sort(function(e,t){return t.value-e.value}))}function c(e,t){t.filter(function(e){return void 0!==e.nodeId}).map(function(t){e.add(t.nodeId)})}!function(e){e[e.Bottom=0]="Bottom",e[e.Top=1]="Top",e[e.Left=2]="Left",e[e.Right=3]="Right"}(i=t.LabelPaddingSide||(t.LabelPaddingSide={}));var l=function(){function e(){}return e.createLeafLabel=function(t,r){var i,a=new n.Projected3DLabel(new n.Text("  "+t+"  "),n.Label.Type.Dynamic);return(i=a.color).fromF32.apply(i,e.leafLabelColor),a.lineAnchor=n.Label.LineAnchor.Bottom,a.fontSize=20,o(3===r.length,"Expected a 3D position for leaf label anchor, got "+r),a.position=r,a},e.createInnerNodeLabel=function(t,r,o){var u,c=new n.Position3DLabel(new n.Text(t),n.Label.Type.Static);(u=c.color).fromF32.apply(u,e.innerLabelColor),c.alignment=n.Label.Alignment.Center,c.lineAnchor=n.Label.LineAnchor.Bottom;var l=i.Bottom,f=0,h=0;switch(c.fontSize=2*o,c.elide=n.Label.Elide.Middle,+l){case i.Bottom:f=r.left+r.right-1,h=2*(r.bottom-o)-1,c.lineWidth=2*r.width,c.direction=[1,0,0],c.up=[0,0,-1];break;case i.Top:f=r.left+r.right-1,h=2*(r.top+o)-1,c.lineWidth=2*r.width,c.direction=[-1,0,0],c.up=[0,0,1];break;case i.Left:f=2*(r.left-o)-1,h=r.top+r.bottom-1,c.lineWidth=2*r.height,c.direction=[0,0,1],c.up=[1,0,0];break;case i.Right:f=2*(r.right+o)-1,h=r.top+r.bottom-1,c.lineWidth=2*r.height,c.direction=[0,0,-1],c.up=[-1,0,0];break;default:c.fontSize=0,a(s.Warning,l+" is not a valid value of LabelPaddingSide, skip label '"+t+"'")}return c.position=[f,0,-h],c},e.createInnerNodeLabelOnAccessory=function(t,r){var i,o=new n.Position3DLabel(new n.Text(t),n.Label.Type.Static);(i=o.color).fromF32.apply(i,e.innerLabelColor),o.alignment=n.Label.Alignment.Center,o.lineAnchor=n.Label.LineAnchor.Bottom;var a=r.left+r.right-1,s=2*r.bottom-1;return o.fontSize=2*r.height,o.elide=n.Label.Elide.Middle,o.lineWidth=2*r.width,o.position=[a,0,-s],o.direction=[1,0,0],o.up=[0,0,-1],o},e.fillLeafLabelArray=function(t,r,i,n,o,a){var s=new Array(t.numberOfInnerNodes);return i.forEach(function(i){var u=t.leafNodeById(i),c=r.get(i);if(void 0!==u&&void 0!==c&&0!==c.length){var l=u.index-t.numberOfInnerNodes,f=4*l,h=o[f+0],d=o[f+1],p=o[f+2],_=o[f+3],v=a[2*l+1];if(p>0&&_>0){var m=h+.5*p,b=v*n/255,g=d+.5*_;s[u.index]=e.createLeafLabel(c,[m,b,g])}}}),s},e.fillInnerNodeLabelArrayOnAccessory=function(t,r,i,n){var o=new Array(t.numberOfInnerNodes);return i.forEach(function(i){var a=t.innerNodeById(i);if(void 0!==a&&void 0!==n[a.index]&&n[a.index].area>0){var s=r.get(i);if(void 0===s||0===s.length)return;o[a.index]=e.createInnerNodeLabelOnAccessory(s,n[a.index])}}),o},e.fillInnerNodeLabelArray=function(t,r,i,n,o){var a=new Array(t.numberOfInnerNodes);return i.forEach(function(i){var s=t.innerNodeById(i);if(void 0!==s&&void 0!==n[s.index]){var u=r.get(i);if(void 0===u||0===u.length)return;!s.isLeaf&&n[s.index].area>0&&(a[s.index]=e.createInnerNodeLabel(u,n[s.index],o[s.index]))}}),a},e.createLabelSelection=function(e,t,r,i,n,o,a,s,l,f,h){var d=new Set,p=new Array(s),_=new Array(l),v=new Array(f),m=new Array(h);return p.fill({nodeId:void 0,value:-1}),_.fill({nodeId:void 0,value:-1}),v.fill({nodeId:void 0,value:-1}),m.fill({nodeId:void 0,value:-1}),e.parentsDoUntilDepth(a[1],function(e){e.depth<a[0]||n[e.index]||(u(p,t[e.index],e.id),o.has(e.id)&&d.add(e.id))}),e.forEachLeafNode(function(e){n[e.index]||void 0===e.id||(u(_,t[e.index],e.id),u(v,r[e.index],e.id),u(m,i[e.index],e.id),o.has(e.id)&&d.add(e.id))}),c(d,p),c(d,_),c(d,v),c(d,m),d},e.fillLeafLabelArrayByExplicitNames=function(t,r,i,n,o){var a=new Map,s=new Set;return Object.keys(r).forEach(function(e){var t=parseInt(e,10);a.set(t,r[t]),s.add(t)}),e.fillLeafLabelArray(t,a,s,i,n,o)},e.fillInnerNodeLabelArrayOnAccessoryByExplicitNames=function(t,r,i){var n=new Map,o=new Set;return Object.keys(r).forEach(function(e){var t=parseInt(e,10);n.set(t,r[t]),o.add(t)}),e.fillInnerNodeLabelArrayOnAccessory(t,n,o,i)},e}();t.LabelManagement=l,function(e){e.leafLabelColor=[0,0,0,.8],e.innerLabelColor=[0,0,0,.54]}(l=t.LabelManagement||(t.LabelManagement={})),t.LabelManagement=l},"./layout.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=i.auxiliaries.assert,o=r("./rect.ts"),a=r("./codecitylayout.ts"),s=r("./snakelayout.ts"),u=r("./striplayout.ts");!function(e){e[e.ParentPadding=0]="ParentPadding",e[e.SiblingMargin=1]="SiblingMargin",e[e.AccessorPadding=2]="AccessorPadding"}(t.LayoutOperation||(t.LayoutOperation={}));var c=function(){function e(){}return e.createLayout=function(t,r,o,c,l,f,h){var d=new Array(t.numberOfNodes);if(n(void 0!==r,"Valid weights expected"),void 0===r)return d;var p=r[0];if(i.auxiliaries.assertions&&t.numberOfNodes>1){var _=0;t.forEachLeafNode(function(e){_+=r[e.index]}),n(void 0!==p&&(0===_||p>0),"Accumulated leaf weights as root weight expected")}var v=o.aspectRatio,m=!!o.flattenDirectories;switch(o.algorithm){case e.LayoutAlgorithm.Strip:u.StripLayout.compute(t,r,v,d,e.splittingLayoutPostprocessing(o),c,l,f,h,m);break;case e.LayoutAlgorithm.Snake:s.SnakeLayout.compute(t,r,v,d,e.splittingLayoutPostprocessing(o),c,l,f,h,m);break;case e.LayoutAlgorithm.CodeCity:a.CodeCityLayout.compute(t,r,v,d,e.packingLayoutPostprocessing(o),c,l,f)}return d},e.splittingLayoutPostprocessing=function(t){var r={parentPaddingCallback:e.emptyParentCallback,siblingMarginBeforeCallback:e.emptyParentCallback,siblingMarginAfterCallback:e.emptySiblingCallback,accessoryPaddingCallback:e.emptyAccessoryParentCallback},i=[0],n=0;if(void 0!==t.siblingMargin&&(n=t.siblingMargin.value)>=0)switch(t.siblingMargin.type){case e.SiblingMarginType.Absolute:r.siblingMarginAfterCallback=function(e,t,r,i){if(i.isRoot)return e;var o=n;return e.map(t,r).paddedWithMinArea(.5*o,0)};break;case e.SiblingMarginType.Relative:r.siblingMarginAfterCallback=function(e,t,r,i){if(i.isRoot)return e;var o=e.equalizedRelativeMargin(n);return e.map(t,r).paddedWithMinArea(.5*o,0)}}if(void 0!==t.parentPadding&&(i=t.parentPadding.value instanceof Array?t.parentPadding.value:[t.parentPadding.value])[0]>=0)switch(t.parentPadding.type){case e.ParentPaddingType.Mixed:r.parentPaddingCallback=function(e,t,r,n,o,a){var s,u;if(i.length-1>t.depth){var c=i[t.depth];s=e.equalizedMargin(c,.5,.9),u=e.padded(s),void 0!==o&&void 0!==a&&(o[t.index]=u,a[t.index]=s)}else s=e.equalizedRelativeMargin(i[i.length-1]),u=e.padded(s);return u},r.siblingMarginBeforeCallback=function(e,t,r,o){var a;return a=i.length>t.depth?n:e.equalizedRelativeMargin(n),e.padded(.5*-a)};break;case e.ParentPaddingType.Absolute:r.parentPaddingCallback=function(e,t,r,n){var o=e.equalizedMargin(i[0],.5,.6);return e.padded(o)},r.siblingMarginBeforeCallback=function(e,t,r,i){var o=n;return e.padded(.5*-o)};break;case e.ParentPaddingType.Relative:r.parentPaddingCallback=function(e,t,r,n){var o=e.equalizedRelativeMargin(i[0]);return e.padded(o)},r.siblingMarginBeforeCallback=function(e,t,r,i){var o=e.equalizedRelativeMargin(n);return e.padded(.5*-o)}}if(void 0!==t.accessoryPadding){var a=t.accessoryPadding.type,s=t.accessoryPadding.value,u=t.accessoryPadding.direction,c=void 0!==t.accessoryPadding.relativeAreaThreshold?t.accessoryPadding.relativeAreaThreshold:0,l=void 0!==t.accessoryPadding.targetAspectRatio?t.accessoryPadding.targetAspectRatio:Number.NaN;if(void 0!==s)switch(a){case e.AccessoryPaddingType.Absolute:switch(u){case e.AccessoryPaddingDirection.Bottom:r.accessoryPaddingCallback=function(e,t,r,i,n){var a,u;if((a=s instanceof Array?s.length>t.depth?s[t.depth]:0:s)>e.height)return n[t.index]=new o.Rect(0,0,0,0),e;u=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var f=e.truncateBottom(e.bottom+a),h=e.truncateTop(f.bottom);return f.area/e.area<=u||h.aspectRatio<l?(n[t.index]=new o.Rect(0,0,0,0),e):(n[t.index]=h,f)};break;case e.AccessoryPaddingDirection.Top:r.accessoryPaddingCallback=function(e,t,r,i,n){var a,u;if((a=s instanceof Array?s.length>t.depth?s[t.depth]:0:s)>e.height)return n[t.index]=new o.Rect(0,0,0,0),e;u=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var f=e.truncateTop(e.top-a),h=e.truncateBottom(f.top);return f.area/e.area<=u||h.aspectRatio<l?(n[t.index]=new o.Rect(0,0,0,0),e):(n[t.index]=h,f)};break;case e.AccessoryPaddingDirection.Left:r.accessoryPaddingCallback=function(e,t,r,i,n){var a,u;if((a=s instanceof Array?s.length>t.depth?s[t.depth]:0:s)>e.width)return n[t.index]=new o.Rect(0,0,0,0),e;u=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var f=e.truncateLeft(e.left+a),h=e.truncateRight(f.left);return f.area/e.area<=u||h.aspectRatio<l?(n[t.index]=new o.Rect(0,0,0,0),e):(n[t.index]=h,f)};break;case e.AccessoryPaddingDirection.Right:r.accessoryPaddingCallback=function(e,t,r,i,n){var a,u;if((a=s instanceof Array?s.length>t.depth?s[t.depth]:0:s)>e.width)return n[t.index]=new o.Rect(0,0,0,0),e;u=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var f=e.truncateRight(e.right+a),h=e.truncateLeft(f.right);return f.area/e.area<=u||h.aspectRatio<l?(n[t.index]=new o.Rect(0,0,0,0),e):(n[t.index]=h,f)}}break;case e.AccessoryPaddingType.Relative:switch(u){case e.AccessoryPaddingDirection.Bottom:r.accessoryPaddingCallback=function(e,t,r,i,n){var o,a;o=s instanceof Array?s.length>t.depth?s[t.depth]:0:s,a=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var u=e.relativeTop(1-o);return u.area/e.area>a?u:e};break;case e.AccessoryPaddingDirection.Top:r.accessoryPaddingCallback=function(e,t,r,i,n){var o,a;o=s instanceof Array?s.length>t.depth?s[t.depth]:0:s,a=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var u=e.relativeBottom(1-o);return u.area/e.area>a?u:e};break;case e.AccessoryPaddingDirection.Left:r.accessoryPaddingCallback=function(e,t,r,i,n){var o,a;o=s instanceof Array?s.length>t.depth?s[t.depth]:0:s,a=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var u=e.relativeRight(1-o);return u.area/e.area>a?u:e};break;case e.AccessoryPaddingDirection.Right:r.accessoryPaddingCallback=function(e,t,r,i,n){var o,a;o=s instanceof Array?s.length>t.depth?s[t.depth]:0:s,a=c instanceof Array?c.length>t.depth?c[t.depth]:1:c;var u=e.relativeLeft(1-o);return u.area/e.area>a?u:e}}}}return r},e.packingLayoutPostprocessing=function(t){return{parentPaddingCallback:e.emptyParentCallback,siblingMarginBeforeCallback:e.emptyParentCallback,siblingMarginAfterCallback:e.emptySiblingCallback,accessoryPaddingCallback:e.emptyAccessoryParentCallback}},e.emptyParentCallback=function(e,t,r,i){return e},e.emptyAccessoryParentCallback=function(e,t,r,i,n){return e},e.emptySiblingCallback=function(e,t,r,i){return e},e}();t.Layout=c,function(e){!function(e){e.Strip="strip",e.Snake="snake",e.CodeCity="codecity"}(e.LayoutAlgorithm||(e.LayoutAlgorithm={})),function(e){e.Relative="relative",e.Absolute="absolute"}(e.SiblingMarginType||(e.SiblingMarginType={})),function(e){e.Relative="relative",e.Absolute="absolute",e.Mixed="mixed"}(e.ParentPaddingType||(e.ParentPaddingType={})),function(e){e.Relative="relative",e.Absolute="absolute"}(e.AccessoryPaddingType||(e.AccessoryPaddingType={})),function(e){e.Top="top",e.Bottom="bottom",e.Left="left",e.Right="right"}(e.AccessoryPaddingDirection||(e.AccessoryPaddingDirection={}))}(c=t.Layout||(t.Layout={})),t.Layout=c},"./layoutcascade.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./rect.ts"),n=function(){function e(){}return e.applyCascade=function(e,t){var r=new Array;return r.length=e.numberOfNodes,e.forEachLeafNode(function(e){r[e.index]=i.Rect.clone(t[e.index])}),e.reverseParentsDo(function(n){var o,a=t[n.index];if(e.childrenDo(n,function(e){var t=r[e.index];void 0===o?o=i.Rect.clone(t):o.enclose(t)}),void 0!==o){o.applyOffset(a.left-o.left,a.top-o.top);var s=o.left,u=o.bottom,c=s+o.width,l=u+o.height;r[n.index]=new i.Rect(s,u,c,l)}else r[n.index]=new i.Rect(0,0,0,0)}),r},e}();t.LayoutCascade=n},"./linearization.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._slices=[]}return e.prototype.clear=function(){this._slices=[]},e.prototype.slice=function(e){if(!(e<0||e>=this._slices.length))return this._slices[e]},e.prototype.startSlice=function(e){this._slices.push([e,e])},e.prototype.endSlice=function(e){this._slices[this._slices.length-1][1]=e},e.prototype.nextSlice=function(e){this.endSlice(e-1),this.startSlice(e)},e.prototype.addSliceByRange=function(e,t){this._slices.push([e,t])},e.prototype.addSliceByLength=function(e){if(0!==this.length){var t=this._slices[this._slices.length-1][1];this._slices.push([t+1,t+e])}else this._slices.push([0,e-1])},e.prototype.sliceDo=function(e,t){if(!(e<0||e>=this._slices.length)){var r=this._slices[e];t(r[0],r[1])}},e.prototype.slicesDo=function(e){for(var t=0,r=this._slices;t<r.length;t++){var i=r[t];e(i[0],i[1])}},Object.defineProperty(e.prototype,"slices",{get:function(){return this._slices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfInnerNodes",{get:function(){return this._slices[this._slices.length-1][0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfLeafNodes",{get:function(){return this.numberOfNodes-this.numberOfInnerNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfNodes",{get:function(){return this._slices[this._slices.length-1][1]+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._slices.length},enumerable:!0,configurable:!0}),e}();t.Linearization=i},"./msagent.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IS_IE11="undefined"==typeof navigator?void 0:/MSIE 11/i.test(navigator.userAgent),t.IS_EDGE="undefined"==typeof navigator?void 0:/Edge\/\d./i.test(navigator.userAgent)},"./multirendertarget.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=a.auxiliaries.assert,c=function(e){function t(t){var r=e.call(this)||this;return r._debuggableTargets=new Array,r._debuggableTargetNames=new Array,r._context=t,r}return n(t,e),t.prototype.initializeES2_basic=function(e,t){var r=this._context.gl,i=this._context.gl2facade;this._drawRestricted=!0,this._colorRenderTexture.initialize(e,t,r.RGBA,r.RGBA,r.UNSIGNED_BYTE),this._idRenderTexture.initialize(e,t,r.RGBA,r.RGBA,r.UNSIGNED_BYTE),this._depthStencilRenderTexture.initialize(e,t,r.RGB,r.RGB,r.UNSIGNED_BYTE),this._depthStencilRenderbuffer.initialize(e,t,r.DEPTH_STENCIL),this._depthFBO=new s.Framebuffer(this._context,"DepthFBO"),this._idFBO=new s.Framebuffer(this._context,"IdFBO"),this._primaryFBO.initialize([[i.COLOR_ATTACHMENT0,this._colorRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderbuffer]]),this._secondaryFBO.initialize([[i.COLOR_ATTACHMENT0,this._colorRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderbuffer]]),this._idFBO.initialize([[i.COLOR_ATTACHMENT0,this._idRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderbuffer]]),this._idFBO.clearColor([1,1,1,1],0),this._depthFBO.initialize([[i.COLOR_ATTACHMENT0,this._depthStencilRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderbuffer]]),this._depthFBO.clearColor([1,1,1,1],0)},t.prototype.initializeES2_extensions=function(e,t){var r=this._context.gl,i=this._context.gl2facade;this._drawRestricted=!1,this._context.isWebGL1&&(u(this._context.supportsDrawBuffers,"expected WEBGL_draw_buffers to be supported"),u(this._context.supportsDepthTexture,"expected WEBGL_depth_texture to be supported")),this._colorRenderTexture.initialize(e,t,r.RGBA,r.RGBA,r.UNSIGNED_BYTE),this._idRenderTexture.initialize(e,t,r.RGBA,r.RGBA,r.UNSIGNED_BYTE),this._depthStencilRenderTexture.initialize(e,t,r.DEPTH_STENCIL,r.DEPTH_STENCIL,this._context.depthTexture.UNSIGNED_INT_24_8_WEBGL),this._depthStencilRenderbuffer.initialize(e,t,r.DEPTH_STENCIL),this._primaryFBO.initialize([[i.COLOR_ATTACHMENT0,this._colorRenderTexture],[i.COLOR_ATTACHMENT1,this._idRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderTexture]]),this._primaryFBO.clearColor([1,1,1,1],1),this._secondaryFBO.initialize([[i.COLOR_ATTACHMENT0,this._colorRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderbuffer]]),this._idFBO=new s.Framebuffer(this._context,"IdFBO"),this._idFBO.initialize([[i.COLOR_ATTACHMENT0,this._idRenderTexture]])},t.prototype.initializeES3=function(e,t){var r=this._context.gl,i=this._context.gl2facade;this._drawRestricted=!1,u(this._context.isWebGL2,"expected a webgl2 context"),this._colorRenderTexture.initialize(e,t,r.RGBA8,r.RGBA,r.UNSIGNED_BYTE),this._idRenderTexture.initialize(e,t,r.RGBA8,r.RGBA,r.UNSIGNED_BYTE),this._depthStencilRenderTexture.initialize(e,t,r.DEPTH24_STENCIL8,r.DEPTH_STENCIL,r.UNSIGNED_INT_24_8),this._depthStencilRenderbuffer.initialize(e,t,r.DEPTH_STENCIL),this._primaryFBO.initialize([[i.COLOR_ATTACHMENT0,this._colorRenderTexture],[i.COLOR_ATTACHMENT1,this._idRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderTexture]]),this._primaryFBO.clearColor([1,1,1,1],1),this._secondaryFBO.initialize([[i.COLOR_ATTACHMENT0,this._colorRenderTexture],[r.DEPTH_STENCIL_ATTACHMENT,this._depthStencilRenderbuffer]])},t.prototype.initialize=function(){var e=this._context.gl,t=this._context.gl2facade;this._defaultFBO=new s.DefaultFramebuffer(this._context,"DefaultFBO"),this._defaultFBO.initialize(),this._colorRenderTexture=new s.Texture2D(this._context,"ColorRenderTexture"),this._idRenderTexture=new s.Texture2D(this._context,"IdRenderTexture"),this._depthStencilRenderTexture=new s.Texture2D(this._context,"DepthStencilRenderTexture"),this._depthStencilRenderbuffer=new s.Renderbuffer(this._context,"DepthStencilRenderbuffer"),this._primaryFBO=new s.Framebuffer(this._context,"PrimaryFBO"),this._secondaryFBO=new s.Framebuffer(this._context,"SecondaryFBO");var r=this._defaultFBO.width,i=this._defaultFBO.height;return this._context.isWebGL2?this.initializeES3(r,i):this._context.supportsDepthTexture&&this._context.supportsDrawBuffers&&this._context.gl.getParameter(this._context.drawBuffers.MAX_DRAW_BUFFERS_WEBGL)>=2?this.initializeES2_extensions(r,i):this.initializeES2_basic(r,i),this._primaryFBO.clearColor([0,0,0,1],0),this._secondaryFBO.clearColor([0,0,0,1],0),this._primaryFBO.clearDepth(s.ReadbackPass.maxClearDepth()),this._primaryFBO.clearStencil(0),this._secondaryFBO.clearDepth(s.ReadbackPass.maxClearDepth()),this._secondaryFBO.clearStencil(0),this._debuggableTargets.push([this._primaryFBO,t.COLOR_ATTACHMENT0]),this._debuggableTargetNames.push("Color"),this._idFBO?this._debuggableTargets.push([this._idFBO,t.COLOR_ATTACHMENT0]):this._debuggableTargets.push([this._primaryFBO,t.COLOR_ATTACHMENT1]),this._debuggableTargetNames.push("Id"),this._depthFBO?this._debuggableTargets.push([this._depthFBO,t.COLOR_ATTACHMENT0]):this._debuggableTargets.push([this._primaryFBO,e.DEPTH_STENCIL_ATTACHMENT]),this._debuggableTargetNames.push("DepthStencil"),u(this._primaryFBO.valid,this._primaryFBO.identifier+" expected to be valid for rendering"),u(this._secondaryFBO.valid,this._secondaryFBO.identifier+" expected to be valid for rendering"),u(void 0===this._idFBO||this._idFBO.valid,(this._idFBO?this._idFBO.identifier:"")+" expected to be valid for rendering"),u(void 0===this._depthFBO||this._depthFBO.valid,(this._depthFBO?this._depthFBO.identifier:"")+" expected to be valid for rendering"),!0},t.prototype.uninitialize=function(){this._defaultFBO.uninitialize(),this._primaryFBO.uninitialize(),this._idFBO&&this._idFBO.uninitialize(),this._depthFBO&&this._depthFBO.uninitialize(),this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.uninitialize(),this._colorRenderTexture.uninitialize(),this._idRenderTexture.uninitialize(),this._depthStencilRenderTexture.uninitialize()},t.prototype.debuggableTargets=function(){return this._debuggableTargetNames},t.prototype.debuggableTarget=function(e){if(!(void 0===e||e>=this._debuggableTargets.length||e<0))return this._debuggableTargets[e]},t.prototype.setClearColor=function(e){this._primaryFBO.clearColor(e,0),this._secondaryFBO.clearColor(e,0)},t.prototype.resize=function(e,t){this._primaryFBO.resize(e,t),this._secondaryFBO.resize(e,t),this._idFBO&&this._idFBO.resize(e,t),this._depthFBO&&this._depthFBO.resize(e,t)},Object.defineProperty(t.prototype,"drawRestricted",{get:function(){return this._drawRestricted},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"primaryFBO",{get:function(){return this._primaryFBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondaryFBO",{get:function(){return this._secondaryFBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultFBO",{get:function(){return this._defaultFBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthFBO",{get:function(){return this._drawRestricted?this._depthFBO:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idFBO",{get:function(){return this._drawRestricted?this._idFBO:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readBackIdFBO",{get:function(){return this._idFBO},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorRenderTexture",{get:function(){return this._colorRenderTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idRenderTexture",{get:function(){return this._idRenderTexture},enumerable:!0,configurable:!0}),o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),t}(s.Initializable);t.MultiRenderTarget=c,function(e){!function(e){e[e.Undefined=-1]="Undefined",e[e.Color=0]="Color",e[e.Id=1]="Id",e[e.Depth=2]="Depth"}(e.Attachment||(e.Attachment={}))}(c=t.MultiRenderTarget||(t.MultiRenderTarget={})),t.MultiRenderTarget=c},"./navigation.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("rxjs"),n=r("../node_modules/webgl-operate/lib/webgl-operate.js"),o=n.auxiliaries.assert,a=n.gl_matrix_extensions.v2,s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=r("./seerenemodifier.ts"),c=function(){function e(e,t){var r=this;this._mouseMovedSinceDown=!1,this._seereneModifier=new u.SeereneModifier,this._nodeEnterSubject=new i.ReplaySubject(1),this._nodeMoveSubject=new i.ReplaySubject(1),this._nodeLeaveSubject=new i.ReplaySubject(1),this._nodeSelectSubject=new i.ReplaySubject(1),this._navigationStartSubject=new i.ReplaySubject(1),this._invalidate=e;this._touchSupported=document.documentElement&&"ontouchstart"in document.documentElement||"ontouchstart"in document.body,t.mouseEventProvider.preventDefault(s.MouseEventProvider.Type.Wheel,s.MouseEventProvider.Type.Click),t.pointerEventProvider.preventDefault(s.PointerEventProvider.Type.Down,s.PointerEventProvider.Type.Move,s.PointerEventProvider.Type.Up),this._eventHandler=new s.EventHandler(e,t),this._eventHandler.pushMouseDownHandler(function(e,t){return r.onMouseDown(e,t)}),this._eventHandler.pushMouseUpHandler(function(e,t){return r.onMouseUp(e,t)}),this._eventHandler.pushMouseMoveHandler(function(e,t){return r.onMouseMove(e,t)}),this._eventHandler.pushMouseWheelHandler(function(e,t){return r.onMouseWheel(e,t)}),this._eventHandler.pushClickHandler(function(e,t){return r.onClick(e,t)}),this._touchSupported&&(this._eventHandler.pushTouchStartHandler(function(e,t){return r.onTouchStart(e,t)}),this._eventHandler.pushTouchEndHandler(function(e,t){return r.onTouchEnd(e,t)}),this._eventHandler.pushTouchMoveHandler(function(e,t){return r.onTouchMove(e,t)}),this._eventHandler.pushTouchCancelHandler(function(e,t){return r.onTouchCancel(e,t)}))}return e.prototype.mode=function(t){var r="mousedown"===t.type||"mousemove"===t.type,i="wheel"===t.type;return r&&this.isPrimaryButtonDown(t)?e.Mode.Rotate:r&&this.isSecondaryButtonDown(t)?e.Mode.Pan:r&&this.isAuxiliaryButtonDown(t)?e.Mode.Zoom:i?e.Mode.ZoomStep:this._touchSupported&&t instanceof TouchEvent&&1===t.touches.length?e.Mode.Pan:void 0},e.prototype.rotate=function(e,t){var r=n.vec2.fromValues(e.clientX,e.clientY);t?this._seereneModifier.initiate(r,void 0,[!1,!1,!0],e.shiftKey):(this._seereneModifier.update_positions(r),this._seereneModifier.rotate())},e.prototype.pan=function(e,t){var r=this._eventHandler.offsets(e)[0];t?this._seereneModifier.initiate(r,void 0,[!0,!1,!1],e.shiftKey):(this._seereneModifier.update_positions(r),this._seereneModifier.translate())},e.prototype.zoom=function(e,t){var r=this._eventHandler.offsets(e)[0];t?this._seereneModifier.initiate(r,void 0,[!1,!0,!1],e.shiftKey):(this._seereneModifier.update_positions(r),this._seereneModifier.scale())},e.prototype.emitNodeMovementEvents=function(e){if(void 0!==this._idAccess){var t=this._eventHandler.offsets(e,!1)[0],r=n.vec2.scale(a(),t,window.devicePixelRatio),i=this._idAccess.idAt(r[0],r[1]);this._lastNode===i&&void 0!==i&&this._nodeMoveSubject.next({node:i,point:t}),this._lastNode!==i&&void 0!==this._lastNode&&this._nodeLeaveSubject.next({node:this._lastNode,point:t}),this._lastNode!==i&&void 0!==i&&this._nodeEnterSubject.next({node:i,point:t}),this._lastNode=i}},e.prototype.emitNodeClick=function(e){if(void 0!==this._idAccess){var t=this._eventHandler.offsets(e,!1)[0],r=n.vec2.scale(a(),t,window.devicePixelRatio),i=this._idAccess.idAt(r[0],r[1]);void 0!==i&&this._nodeSelectSubject.next({node:i,point:t})}},e.prototype.applyZoomStep=function(e){var t=this._eventHandler.offsets(e)[0];this._seereneModifier.initiate(t,void 0,[!1,!0,!1],e.shiftKey),e.preventDefault(),this._seereneModifier.scale(e.deltaY)},e.prototype.onMouseDown=function(e,t){this._mouseMovedSinceDown=!1},e.prototype.onMouseUp=function(e,t){},e.prototype.onMouseMove=function(t,r){var i=t[t.length-1];this._mouseMovedSinceDown=!0;var n=void 0===this._mode;switch(this._mode=this.mode(i),this._mode){case e.Mode.Rotate:return this.rotate(i,n),void(n&&this._navigationStartSubject.next());case e.Mode.Pan:return this.pan(i,n),void(n&&this._navigationStartSubject.next());case e.Mode.Zoom:return this.zoom(i,n),void(n&&this._navigationStartSubject.next());default:this.emitNodeMovementEvents(i)}},e.prototype.onClick=function(t,r){var i=t[t.length-1];switch(this._mode){case e.Mode.Rotate:case e.Mode.Pan:case e.Mode.Zoom:return;default:this.emitNodeClick(i)}},e.prototype.onMouseWheel=function(t,r){var i=t[t.length-1];switch(this._mode=this.mode(i),this._mode){case e.Mode.ZoomStep:this.applyZoomStep(i),this._navigationStartSubject.next()}},e.prototype.onTouchStart=function(t,r){var i=t[t.length-1];this._mode=this.mode(i),this._mode!==e.Mode.Pan?o(void 0===this._mode,"Interactions other than pan are not implemented for touch events."):this.pan(i,!0)},e.prototype.onTouchMove=function(t,r){var i=t[t.length-1],n=void 0===this._mode;this._mode=this.mode(i),this._mode!==e.Mode.Pan?o(void 0===this._mode,"Interactions other than pan are not implemented for touch events."):this.pan(i,n)},e.prototype.onTouchEnd=function(e,t){},e.prototype.onTouchCancel=function(e,t){},e.prototype.isPrimaryButtonDown=function(e){return 1===(void 0===e.buttons?e.which:e.buttons)},e.prototype.isSecondaryButtonDown=function(e){return void 0===e.buttons?3===e.which:2===e.buttons},e.prototype.isAuxiliaryButtonDown=function(e){return void 0===e.buttons?2===e.which:4===e.buttons},e.prototype.update=function(){this._eventHandler.update()},Object.defineProperty(e.prototype,"camera",{set:function(e){this._camera=e,this._seereneModifier.camera=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coordsAccess",{set:function(e){this._coordsAccess=e,this._seereneModifier.coordsAccess=this._coordsAccess.coordsAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idAccess",{set:function(e){this._idAccess=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodeEnter$",{get:function(){return this._nodeEnterSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodeMove$",{get:function(){return this._nodeMoveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodeLeave$",{get:function(){return this._nodeLeaveSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodeSelect$",{get:function(){return this._nodeSelectSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navigationStart$",{get:function(){return this._navigationStartSubject.asObservable()},enumerable:!0,configurable:!0}),e}();t.Navigation=c,function(e){!function(e){e[e.Move=0]="Move",e[e.Pan=1]="Pan",e[e.Rotate=2]="Rotate",e[e.Zoom=3]="Zoom",e[e.ZoomStep=4]="ZoomStep"}(e.Mode||(e.Mode={}))}(c=t.Navigation||(t.Navigation={})),t.Navigation=c},"./node.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t,r,i){this._lastChild=e.INVALID_INDEX,this.index=e.INVALID_INDEX,this.id=e.INVALID_ID,this.unmodified=!1,this.depth=e.INVALID_DEPTH,this.height=e.INVALID_HEIGHT,this.parent=e.INVALID_INDEX,this.firstChild=e.INVALID_INDEX,this.initialFirstChild=e.INVALID_INDEX,this.nextSibling=e.INVALID_INDEX,this.initialNextSibling=e.INVALID_INDEX,this.id=t,this.index=r,void 0!==i?(this.depth=i.depth+1,this.parent=i.index,i.initialFirstChild===e.INVALID_INDEX&&(i.initialFirstChild=r,i.firstChild=r),i._lastChild=r):this.depth=0}return Object.defineProperty(e.prototype,"lastChild",{get:function(){return this._lastChild},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLeaf",{get:function(){return this.firstChild===e.INVALID_INDEX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return this.parent===e.INVALID_INDEX},enumerable:!0,configurable:!0}),e.INVALID_ID=-1,e.INVALID_INDEX=-1,e.INVALID_DEPTH=-1,e.INVALID_HEIGHT=-1,e}();t.Node=i},"./nodesort.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./attributebuffer.ts"),n=r("./node.ts"),o=function(){function e(){}return e.byValue=function(e,t,r){if(!(t.length<2)){t.sort(r);for(var i=0;i<t.length-1;++i)t[i][0].nextSibling=t[i+1][0].index;t[t.length-1][0].nextSibling=n.Node.INVALID_INDEX,e.firstChild=t[0][0].index}},e.byValues=function(t,r,i,n){var o=new Array,a=t.node(r.firstChild);do{o.push([a,i[a.index]]),a=t.node(a.nextSibling)}while(void 0!==a);e.byValue(r,o,n)},e.byIdentifier=function(t,r,i){for(var n=new Array,o=t.node(r.firstChild);void 0!==o;)n.push([o,o.id]),o=t.node(o.nextSibling);e.byValue(r,n,i)},e.restoreOriginalSortOrder=function(e,t){t.firstChild=t.initialFirstChild;for(var r=e.node(t.initialFirstChild);void 0!==r;r=e.node(r.initialNextSibling))r.nextSibling=r.initialNextSibling},e.sortNodes=function(t,r,n){var o,a=n.layout.sort;if(void 0===a||a.algorithm===e.Algorithm.Keep)return t.forEachInnerNode(function(r){return e.restoreOriginalSortOrder(t,r)}),!0;switch(a.algorithm){case e.Algorithm.Ascending:o=e.ASCENDING_COMPARATOR;break;case e.Algorithm.Descending:default:o=e.DESCENDING_COMPARATOR}switch(a.key){case e.Key.Weight:var s=i.AttributeBuffer.create(t,n.layout.weight,n);s&&t.forEachInnerNode(function(r){return e.byValues(t,r,s,o)});break;case e.Key.Identity:t.forEachInnerNode(function(r){return e.byIdentifier(t,r,o)});break;default:void 0!==r&&t.forEachInnerNode(function(i){return e.byValues(t,i,r,o)})}return!0},e.ASCENDING_COMPARATOR=function(e,t){return e[1]-t[1]},e.DESCENDING_COMPARATOR=function(e,t){return t[1]-e[1]},e}();t.NodeSort=o,function(e){!function(e){e.Keep="keep",e.Ascending="ascending",e.Descending="descending"}(e.Algorithm||(e.Algorithm={})),function(e){e.Identity="identity",e.Weight="weight"}(e.Key||(e.Key={}))}(o=t.NodeSort||(t.NodeSort={})),t.NodeSort=o},"./perflogindent.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PERF_LOG_INDENT=24},"./pointgeometry.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=function(e){function t(t,r){var i=e.call(this,t,r)||this;return r=void 0!==r&&""!==r?r:"PointGeometry",i._vertices=new a.Buffer(t,r+"VertexVBO"),i._buffers.push(i._vertices),i._colors=new a.Buffer(t,r+"ColorVBO"),i._buffers.push(i._colors),i}return n(t,e),t.prototype.bindBuffers=function(e){var t=this.context.gl,r=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,3,t.FLOAT,!1,0,0,!0,!1),r.vertexAttribDivisor(this._vertexLocation,0),this._colors.attribEnable(this._colorLocation,4,t.FLOAT,!1,0,0,!0,!1),r.vertexAttribDivisor(this._colorLocation,0)},t.prototype.unbindBuffers=function(e){this._vertices.attribDisable(this._vertexLocation,!1,!1),this._colors.attribDisable(this._colorLocation,!1,!1)},t.prototype.initialize=function(t,r){void 0===t&&(t=0),void 0===r&&(r=1),this._vertexLocation=t,this._colorLocation=r;var i=this.context.gl;return e.prototype.initialize.call(this,[i.ARRAY_BUFFER,i.ARRAY_BUFFER])&&this._vertices.valid},t.prototype.update=function(){this.bind()},t.prototype.draw=function(e){if(void 0===e&&(e=0),this._count){var t=this.context.gl;this._vertices.attribEnable(this._vertexLocation,3,t.FLOAT,!1,0,4*e,!0,!1),this._colors.attribEnable(this._colorLocation,4,t.FLOAT,!1,0,4*e,!0,!1),t.drawArrays(t.POINTS,0,this._count)}},Object.defineProperty(t.prototype,"vertices",{set:function(e){this._count=e.length/3,this._vertices.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colors",{set:function(e){this._colors.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){return this.initialized&&this._vertices.valid&&this._colors&&this._colors.valid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorLocation",{get:function(){return this._colorLocation},enumerable:!0,configurable:!0}),o([a.Initializable.assert_initialized()],t.prototype,"draw",null),t}(a.Geometry);t.PointGeometry=s},"./pointrenderpass.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=r("./pointgeometry.ts"),c=function(e){function t(t){var r=e.call(this)||this;return r._altered=Object.assign(new s.ChangeLookup,{any:!1,camera:!1,geometry:!1}),r._context=t,r._program=new s.Program(t,"PointRenderProgram"),r._geometry=new u.PointGeometry(r._context,"Point"),r}return n(t,e),t.prototype.relink=function(){for(var e=0,t=this._program.shaders;e<t.length;e++){t[e].compile()}this._program.attribute("a_vertex",this._geometry.vertexLocation),this._program.attribute("a_color",this._geometry.colorLocation),this._program.link(),this._program.linked&&(this._uViewProjection=this._program.uniform("u_viewProjection"),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uPointSize=this._program.uniform("u_pointSize"))},t.prototype.initialize=function(){var e=this._context.gl,t=new s.Shader(this._context,e.VERTEX_SHADER,"point.vert");t.initialize(r("./shaders/point.vert"),!1);var i=new s.Shader(this._context,e.FRAGMENT_SHADER,"point.frag");return i.initialize(r("./shaders/point.frag"),!1),this._program.initialize([i,t],!1),this._geometry.initialize(),!0},t.prototype.uninitialize=function(){this._geometry.uninitialize(),this._program.uninitialize(),this._uViewProjection=void 0,this._uNdcOffset=void 0,this._uPointSize=void 0},t.prototype.update=function(){var e=this._context.gl;(this._program.initialized&&this._program.linked||(this.relink(),this._program.linked))&&(this._program.bind(),(this._altered.camera||this._camera.altered)&&e.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),this._altered.geometry&&this._geometry.valid&&this._geometry.update(),this._altered.reset())},t.prototype.frame=function(){a.auxiliaries.assert(this._target&&this._target.valid,"valid target expected");var e=this._context.gl,t=this._target.size;e.viewport(0,0,t[0],t[1]),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),!1===this._depthMask&&(e.depthFunc(e.LEQUAL),e.depthMask(!1)),this._program.bind(),e.uniform2fv(this._uNdcOffset,this._ndcOffset),e.uniform1f(this._uPointSize,this._pointSize*window.devicePixelRatio),this._geometry.bind(),this._target.bind(),this._geometry.valid&&this._geometry.draw(),!1===this._depthMask&&(e.depthFunc(e.LESS),e.depthMask(!0)),e.disable(e.BLEND)},Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffset",{set:function(e){this.assertInitialized(),this._ndcOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointSize",{set:function(e){this._pointSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this.assertInitialized(),this._camera!==e&&(this._camera=e,this._altered.alter("camera"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{set:function(e){this._geometry.vertices=e,this._altered.alter("geometry")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colors",{set:function(e){this.assertInitialized(),this._geometry.colors=e,this._altered.alter("geometry")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{set:function(e){this._depthMask=e},enumerable:!0,configurable:!0}),o([s.Initializable.assert_initialized()],t.prototype,"relink",null),o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([s.Initializable.assert_initialized()],t.prototype,"update",null),o([s.Initializable.assert_initialized()],t.prototype,"frame",null),t}(s.Initializable);t.PointRenderPass=c},"./polyfill.ts":function(e,t,r){"use strict";Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],n=0;n<r;){var o=t[n];if(e.call(i,o,n,t))return o;n++}},configurable:!0,writable:!0}),Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,r;if(null===this)throw new TypeError("this is null or not defined");var i=Object(this),n=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),r=0;r<n;){var o=void 0;r in i&&(o=i[r],e.call(t,o,r,i)),r++}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null===this)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,i=arguments[1]>>0,n=i<0?Math.max(r+i,0):Math.min(i,r),o=arguments[2],a=void 0===o?r:o>>0,s=a<0?Math.max(r+a,0):Math.min(a,r);n<s;)t[n]=e,n++;return t}}),Uint8Array.prototype.fill||(Uint8Array.prototype.fill=Array.prototype.fill),Float32Array.prototype.fill||(Float32Array.prototype.fill=Array.prototype.fill),[Float32Array,Uint8Array,Int8Array,Uint32Array,Int32Array].forEach(function(e){e.prototype.slice||Object.defineProperty(e.prototype,"slice",{value:Array.prototype.slice}),e.prototype.filter||Object.defineProperty(e.prototype,"filter",{value:Array.prototype.filter}),e.prototype.map||Object.defineProperty(e.prototype,"map",{value:Array.prototype.map}),e.prototype.indexOf||Object.defineProperty(e.prototype,"indexOf",{value:Array.prototype.indexOf})})},"./quadgeometry.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=function(e){function t(t,r){var i=e.call(this,t,r)||this;return r=void 0!==r&&""!==r?r:"QuadGeometry",i._vertices=new a.Buffer(t,r+"VertexVBO"),i._buffers.push(i._vertices),i._layout=new a.Buffer(t,r+"LayoutVBO"),i._buffers.push(i._layout),i._ids=new a.Buffer(t,r+"IdVBO"),i._buffers.push(i._ids),i._emphases=new a.Buffer(t,r+"EmphasisVBO"),i._buffers.push(i._emphases),i._colors=new a.Buffer(t,r+"ColorVBO"),i._buffers.push(i._colors),i}return n(t,e),t.prototype.bindBuffers=function(e){var t=this.context.gl,r=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,t.FLOAT,!1,0,0,!0,!1),r.vertexAttribDivisor(this._vertexLocation,0),this._layout.attribEnable(this._layoutLocation,4,t.FLOAT,!1,0,0,!0,!1),r.vertexAttribDivisor(this._layoutLocation,1),this._ids.attribEnable(this._idLocation,4,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._idLocation,1),this._emphases.attribEnable(this._emphasisLocation,1,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._emphasisLocation,1),this._colors.attribEnable(this._colorLocation,1,t.UNSIGNED_BYTE,!1,0,0,!0,!1),r.vertexAttribDivisor(this._colorLocation,1)},t.prototype.unbindBuffers=function(e){this._vertices.attribDisable(this.vertexLocation,!1,!1),this._layout.attribDisable(this._layoutLocation,!1,!1),this._ids.attribDisable(this._idLocation,!1,!1),this._emphases.attribDisable(this._emphasisLocation,!1,!1),this._colors.attribDisable(this._colorLocation,!1,!1)},t.prototype.initialize=function(r,i,n,o,a){void 0===r&&(r=0),void 0===i&&(i=2),void 0===n&&(n=3),void 0===o&&(o=4),void 0===a&&(a=5),this._vertexLocation=r,this._idLocation=n,this._layoutLocation=i,this._colorLocation=a,this._emphasisLocation=o;var s=this.context.gl,u=e.prototype.initialize.call(this,[s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER]);return this._vertices.data(t.DATA,s.STATIC_DRAW),u&&this._vertices.valid},t.prototype.update=function(){this.bind()},t.prototype.draw=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var r=this.context.gl,i=this.context.gl2facade;this._ids.attribEnable(this._idLocation,4,r.UNSIGNED_BYTE,!1,4,4*e,!0,!1),this._layout.attribEnable(this._layoutLocation,4,r.FLOAT,!1,16,16*e,!0,!1),this._colors.attribEnable(this._colorLocation,1,r.UNSIGNED_BYTE,!1,1,1*e,!0,!1),this._emphases.attribEnable(this._emphasisLocation,1,r.UNSIGNED_BYTE,!1,1,1*e,!0,!1),i.drawArraysInstanced(r.TRIANGLE_STRIP,0,4,t)},Object.defineProperty(t.prototype,"layout",{set:function(e){this._layout.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ids",{set:function(e){this._ids.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colors",{set:function(e){this._colors.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphases",{set:function(e){this._emphases.data(e,this.context.gl.STATIC_DRAW)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valid",{get:function(){var e=this._layout&&this._layout.valid,t=this._ids&&this._ids.valid,r=this._colors&&this._colors.valid,i=this._emphases&&this._emphases.valid;return this.initialized&&this._vertices.valid&&e&&t&&r&&i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layoutLocation",{get:function(){return this._layoutLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"idLocation",{get:function(){return this._idLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphasisLocation",{get:function(){return this._emphasisLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorLocation",{get:function(){return this._colorLocation},enumerable:!0,configurable:!0}),t.DATA=new Float32Array([0,0,0,1,1,0,1,1]),o([a.Initializable.assert_initialized()],t.prototype,"draw",null),t}(a.Geometry);t.QuadGeometry=s},"./quadrenderpass.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=r("./cuboidrenderpass.ts"),c=r("./multirendertarget.ts"),l=r("./quadgeometry.ts"),f=function(e){function t(t){var r=e.call(this)||this;return r._standardDerivatives=void 0,r._altered=Object.assign(new s.ChangeLookup,{any:!1,camera:!1,geometry:!1,colorTable:!1,emphases:!1,outlineWidth:!0,emphasisOutlineWidth:!0}),r._outlineWidth=u.CuboidRenderPass.OUTLINE_WIDTH_DEFAULT,r._emphasisOutlineWidth=u.CuboidRenderPass.EMPHASIS_OUTLINE_WIDTH_DEFAULT,r._attachment=c.MultiRenderTarget.Attachment.Undefined,r._context=t,r._program=new s.Program(t,"QuadRenderProgram"),r._geometry=new l.QuadGeometry(r._context,"Quad"),r}return n(t,e),t.prototype.relink=function(){if(void 0!==this._colorTable){for(var e=0,t=this._program.shaders;e<t.length;e++){var r=t[e];r.replace("$ColorTableLength",String(this._colorTable.length/4)),r.compile()}this._program.attribute("a_vertex",this._geometry.vertexLocation),this._program.attribute("a_layout",this._geometry.layoutLocation),this._program.attribute("a_id",this._geometry.idLocation),this._program.attribute("a_color",this._geometry.colorLocation),this._program.attribute("a_emphasis",this._geometry.emphasisLocation),this._program.link(),this._program.linked&&(this._drawRestricted&&(this._uAttachment=this._program.uniform("u_attachment")),this._uViewProjection=this._program.uniform("u_viewProjection"),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uColorTable=this._program.uniform("u_colorTable"),this._uOutlineWidth=this._program.uniform("u_outlineWidth"),this._uEmphasisOutlineWidth=this._program.uniform("u_emphasisOutlineWidth"))}},t.prototype.initialize=function(){var e=this._context.gl;this._drawRestricted=!this._context.isWebGL2&&!this._context.supportsDrawBuffers,this._context.isWebGL1&&void 0===this._standardDerivatives&&(this._context.enable(["OES_standard_derivatives"]),this._standardDerivatives=this._context.standardDerivatives);var t=new s.Shader(this._context,e.VERTEX_SHADER,"quad.vert");t.initialize(r("./shaders/quad.vert"),!1);var i=new s.Shader(this._context,e.FRAGMENT_SHADER,"quad.frag");return i.initialize(r("./shaders/quad.frag"),!1),this._program.initialize([i,t],!1),this._geometry.initialize(),!0},t.prototype.uninitialize=function(){this._geometry.uninitialize(),this._program.uninitialize(),this._uAttachment=void 0,this._uViewProjection=void 0,this._uNdcOffset=void 0,this._uColorTable=void 0,this._uOutlineWidth=void 0,this._uEmphasisOutlineWidth=void 0},t.prototype.update=function(){var e=this._context.gl;(this._program.initialized&&this._program.linked||(this.relink(),this._program.linked))&&(this._program.bind(),(this._altered.camera||this._camera.altered)&&e.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),this._colorTable&&e.uniform4fv(this._uColorTable,this._colorTable),this._altered.geometry&&this._geometry.valid&&this._geometry.update(),this._altered.outlineWidth&&e.uniform1f(this._uOutlineWidth,this._outlineWidth),this._target&&this._target.valid&&e.uniform1f(this._uEmphasisOutlineWidth,this._emphasisOutlineWidth*window.devicePixelRatio),this._altered.reset())},t.prototype.frame=function(){if(a.auxiliaries.assert(this._target&&this._target.valid,"valid target expected"),void 0!==this._dispatch&&void 0!==this._colorTable){var e=this._context.gl,t=this._target.size;if(e.viewport(0,0,t[0],t[1]),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),e.stencilFunc(e.GREATER,1,255),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),!1===this._depthMask&&(e.depthFunc(e.LEQUAL),e.depthMask(!1)),this._program.bind(),this._drawRestricted&&e.uniform1i(this._uAttachment,this._attachment),e.uniform2fv(this._uNdcOffset,this._ndcOffset),this._geometry.bind(),this._target.bind(),this._geometry.valid)for(var r=0;r<this._dispatch.length;r+=2){var i=this._dispatch[r+0],n=this._dispatch[r+1];this._geometry.draw(i,n)}!1===this._depthMask&&(e.depthFunc(e.LESS),e.depthMask(!0)),e.disable(e.STENCIL_TEST),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE)}},Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffset",{set:function(e){this.assertInitialized(),this._ndcOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this.assertInitialized(),this._camera!==e&&(this._camera=e,this._altered.alter("camera"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dispatch",{set:function(e){this.assertInitialized(),this._dispatch=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layout",{set:function(e){this.assertInitialized(),this._geometry.layout=e,this._altered.alter("geometry")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ids",{set:function(e){this.assertInitialized(),this._geometry.ids=e,this._altered.alter("geometry")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colors",{set:function(e){this.assertInitialized(),this._geometry.colors=e,this._altered.alter("geometry")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphases",{set:function(e){this.assertInitialized(),this._geometry.emphases=e,this._altered.alter("emphases")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorTable",{set:function(e){this.assertInitialized(),this._colorTable=e,this._altered.alter("colorTable")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidth",{set:function(e){this.assertInitialized(),this._outlineWidth!==e&&(this._outlineWidth=void 0===e?u.CuboidRenderPass.OUTLINE_WIDTH_DEFAULT:Math.max(0,e),this._altered.alter("outlineWidth"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emphasisOutlineWidth",{set:function(e){this.assertInitialized(),this._emphasisOutlineWidth!==e&&(this._emphasisOutlineWidth=void 0===e?u.CuboidRenderPass.EMPHASIS_OUTLINE_WIDTH_DEFAULT:Math.max(0,e),this._altered.alter("emphasisOutlineWidth"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attachment",{set:function(e){a.auxiliaries.logIf(e!==c.MultiRenderTarget.Attachment.Undefined&&!this._drawRestricted,a.auxiliaries.LogLevel.Debug,"expected WEBGL_draw_buffers to be unsupported"),this._attachment=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{set:function(e){this._depthMask=e},enumerable:!0,configurable:!0}),o([s.Initializable.assert_initialized()],t.prototype,"relink",null),o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([s.Initializable.assert_initialized()],t.prototype,"update",null),o([s.Initializable.assert_initialized()],t.prototype,"frame",null),t}(s.Initializable);t.QuadRenderPass=f},"./rect.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js").auxiliaries.assert,n=function(){function e(e,t,r,i,n){this._left=e,this._right=r,this._top=i,this._bottom=t,this.orientation=n}return e.clone=function(t){return new e(t.left,t.bottom,t.right,t.top)},Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return[(this._left+this._right)/2,(this._bottom+this._top)/2]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shorterSide",{get:function(){return Math.min(this.width,this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"longerSide",{get:function(){return Math.max(this.width,this.height)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReversed",{get:function(){return void 0!==this.orientation&&this.orientation>=e.Orientation.DC},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top},set:function(e){i(e>=this.bottom,"Non-negative height expected"),this._top=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(e){i(e<=this.right,"Non-negative width expected"),this._left=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(e){i(e>=this.left,"Non-negative width expected"),this._right=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._bottom},set:function(e){i(e<=this.top,"Non-negative height expected"),this._bottom=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._right-this._left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._top-this._bottom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHorizontal",{get:function(){return this.width>this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVertical",{get:function(){return this.width<=this.height},enumerable:!0,configurable:!0}),e.prototype.relativeTop=function(e){return this.relativeRect(0,1-e,1,e)},e.prototype.truncateTop=function(t){return i(t<=this._top&&t>=this._bottom,"Expect new top to be within rectangle"),new e(this._left,this._bottom,this._right,t)},e.prototype.relativeLeft=function(e){return this.relativeRect(0,0,e,1)},e.prototype.truncateLeft=function(t){return i(t<=this._right&&t>=this._left,"Expect new top to be within rectangle"),new e(t,this._bottom,this._right,this._top)},e.prototype.relativeRight=function(e){return this.relativeRect(1-e,0,e,1)},e.prototype.truncateRight=function(t){return i(t<=this._right&&t>=this._left,"Expect new top to be within rectangle"),new e(this._left,this._bottom,t,this._top)},e.prototype.relativeBottom=function(e){return this.relativeRect(0,0,1,e)},e.prototype.truncateBottom=function(t){return i(t<=this._top&&t>=this._bottom,"Expect new top to be within rectangle"),new e(this._left,t,this._right,this._top)},e.prototype.applyOffset=function(e,t){this._left+=e,this._right+=e,this._top+=t,this._bottom+=t},e.prototype.relativeRect=function(t,r,n,o,a){i(t>=0&&t<=1,"Expect posX to be in [0, 1]"),i(r>=0&&r<=1,"Expect posY to be in [0, 1]"),i(n>=0&&n<=1,"Expect extX to be in [0, 1]"),i(o>=0&&o<=1,"Expect extY to be in [0, 1]"),i(t+n<=1,"Final width must not exceed given width"),i(r+o<=1,"Final height must not exceed given height");var s=this._left+t*this.width,u=this._bottom+r*this.height;return new e(s,u,Math.min(s+n*this.width,this._right),Math.min(u+o*this.height,this._top),a)},e.prototype.equalizedMargin=function(e,t,r){if(this.area<=0)return 0;var n=e,o=2*this.width*e+2*this.height*e-4*e*e;if(o<0||o/this.area>=t||this.shorterSide<2*e){var a=void 0,s=this.area*t*.99,u=.25*(this.width+this.height),c=u*u-.25*s;if(c<=0)a=u;else{var l=Math.sqrt(c),f=u+l,h=u-l;a=(a=Math.min(f,h))<0?0:a}i(a<n,"expected "+a+" to be smaller than "+n),n=a}return n},e.prototype.equalizedRelativeMargin=function(e){if(this.area<=0)return 0;var t=this.area*(1-e),r=this.width/this.height,i=.5*-(Math.sqrt(t*r)+Math.sqrt(t/r)),n=i*i*.25-.25*(this.area-t),o=n<0?0:Math.sqrt(n),a=.5*-i+o,s=.5*-i-o;return a<0||s<0?Math.max(a,s):Math.min(a,s)},e.prototype.padded=function(t){return i(this.width>=2*t,"Padding exceeds width of rectangle"),i(this.height>=2*t,"Padding exceeds height of rectangle"),new e(this.left+t,this.bottom+t,this.right-t,this.top-t)},e.prototype.paddedWithMinArea=function(e,t){return e<=0?this.padded(e):1-(2*this.width*e+2*this.height*e-4*e*e)/this.area>=t&&this.shorterSide>4*e?this.padded(e):this.padded(this.shorterSide/4).relativePadded(Math.max(0,1-e/(4*this.shorterSide)))},e.prototype.relativePadded=function(e){var t=e/2;return this.relativeRect(t,t,1-e,1-e)},e.prototype.map=function(t,r){var i=(this.left-t.left)/t.width*r.width+r.left,n=r.right-(t.right-this.right)/t.width*r.width,o=r.top-(t.top-this.top)/t.height*r.height;return new e(i,(this.bottom-t.bottom)/t.height*r.height+r.bottom,n,o)},e.prototype.enclose=function(e){var t=Math.min(this.left,e.left),r=Math.max(this.top,e.top),i=Math.max(this.right,e.right),n=Math.min(this.bottom,e.bottom);this._left=t,this._right=i,this._top=r,this._bottom=n},e.prototype.intersects=function(e){return!(e.left+Number.EPSILON>=this.right)&&(!(e.right<=this.left+Number.EPSILON)&&(!(e.top<=this.bottom+Number.EPSILON)&&!(e.bottom+Number.EPSILON>=this.top)))},e.prototype.comprises=function(e){return this.left-Number.EPSILON<=e.left+Number.EPSILON&&this.right+Number.EPSILON>=e.right-Number.EPSILON&&this.bottom-Number.EPSILON<=e.bottom+Number.EPSILON&&this.top+Number.EPSILON>=e.top-Number.EPSILON},Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0}),e.prototype.centerAround=function(e){var t=this.center,r=[e[0]-t[0],e[1]-t[1]];this.applyOffset(r[0],r[1])},e}();t.Rect=n,function(e){!function(e){e[e.CD=0]="CD",e[e.AC=1]="AC",e[e.BA=2]="BA",e[e.DB=3]="DB",e[e.DC=4]="DC",e[e.CA=5]="CA",e[e.AB=6]="AB",e[e.BD=7]="BD"}(e.Orientation||(e.Orientation={}))}(n=t.Rect||(t.Rect={})),t.Rect=n},"./relativelabelposition.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=i.auxiliaries.assert,o=i.gl_matrix_extensions.v2;!function(e){var t;!function(e){e.UpperRight="upper-right",e.UpperLeft="upper-left",e.LowerRight="lower-right",e.LowerLeft="lower-left",e.Hidden="hidden"}(t=e.Type||(e.Type={})),e.labelOrigin=function(e,r,a){switch(e){case t.UpperRight:return r;case t.UpperLeft:return i.vec2.sub(o(),r,[a[0],0]);case t.LowerLeft:return i.vec2.sub(o(),r,a);case t.LowerRight:return i.vec2.sub(o(),r,[0,a[1]]);case t.Hidden:return r;default:n(!1,"No valid type for relative label position, given"+e)}return i.vec2.create()},e.isVisible=function(e){return e!==t.Hidden},e.relativeLabelPosition=function(e,r){var a=i.vec2.add(o(),e,[r[0]/2,r[1]/2]);return a[0]>0&&a[1]>0?t.UpperRight:a[0]<0&&a[1]>0?t.UpperLeft:a[0]<0&&a[1]<0?t.LowerLeft:a[0]>0&&a[1]<0?t.LowerRight:(n(!1,"midpointOffset is "+a+", given offset "+e+" and extent "+r),t.Hidden)}}(t.RelativeLabelPosition||(t.RelativeLabelPosition={}))},"./renderer.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r("../node_modules/webgl-operate/lib/webgl-operate.js"),a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("./cuboidrenderpass.ts"),u=r("./multirendertarget.ts"),c=r("./navigation.ts"),l=r("./pointrenderpass.ts"),f=r("./quadrenderpass.ts"),h=r("./screenalignedquadrenderpass.ts"),d=o.auxiliaries.assert,p=function(e){function t(t){var r=e.call(this)||this;return r._ndcOffsetScale=1,r._skipInnerNodePasses=!1,r._skipLeafNodePasses=!1,r._skipLabelPass=!1,r._skipInnerLabelPass=!1,r._skipLeafLabelPass=!1,r._skipAggregation=!1,r.coordsAt=function(e,t,i,n){return r._readbackPass.coordsAt(e,t,i,void 0===n?r._camera.viewProjectionInverse:n)},r.idAt=function(e,t){if(r._geometry.initialized){var i=r._readbackPass.idAt(e,t);if(void 0!==i&&0!==i){var n=r._geometry.topology.node(i);return void 0===n?void 0:n.id}}},r._visualization=t,r}return n(t,e),Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"navigation",{get:function(){return this._navigation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffsetScale",{get:function(){return this._ndcOffsetScale},set:function(e){this._ndcOffsetScale!==e&&(this._ndcOffsetScale=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blitTargets",{get:function(){return this._multiRenderTarget.debuggableTargets()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blitTarget",{set:function(e){this._blitTarget!==e&&(this._blitTarget=e,2===this._blitTarget&&(this._debugPass.debug=a.DebugPass.Mode.DepthLinear),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipInnerNodePasses",{get:function(){return this._skipInnerNodePasses},set:function(e){this._skipInnerNodePasses!==e&&(this._skipInnerNodePasses=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipLeafNodePasses",{get:function(){return this._skipLeafNodePasses},set:function(e){this._skipLeafNodePasses!==e&&(this._skipLeafNodePasses=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipLabelPass",{get:function(){return this._skipLabelPass},set:function(e){this._skipLabelPass!==e&&(this._skipLabelPass=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipInnerLabelPass",{get:function(){return this._skipInnerLabelPass},set:function(e){this._skipInnerLabelPass!==e&&(this._skipInnerLabelPass=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipLeafLabelPass",{get:function(){return this._skipLeafLabelPass},set:function(e){this._skipLeafLabelPass!==e&&(this._skipLeafLabelPass=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipAggregation",{get:function(){return this._skipAggregation},set:function(e){this._skipAggregation!==e&&(this._skipAggregation=e,this._geometry.altered.alter("innerNodeDrawDispatch"),this._geometry.altered.alter("leafNodeDrawDispatch"),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"arrows",{set:function(e){this._leafPass1.arrows=e,this.invalidate()},enumerable:!0,configurable:!0}),t.verifyMinimumContextRequirements=function(e){return e.enable(["ANGLE_instanced_arrays","OES_standard_derivatives"]),!0},t.prototype.renderInnerNodes=function(e,t,r){!this._skipInnerNodePasses&&this._geometry.valid&&(this._innerPass.target=e,this._innerPass.attachment=t,this._innerPass.depthMask=r,this._innerPass.frame())},t.prototype.renderLeafNodes=function(e,t,r){!this._skipLeafNodePasses&&this._geometry.valid&&(this._leafPass1.target=e,this._leafPass1.attachment=t,this._leafPass1.depthMask=r,this._leafPass1.frame(),this._leafPass0.target=e,this._leafPass0.attachment=t,this._leafPass0.depthMask=r,this._leafPass0.frame())},t.prototype.renderLeafLabelBackgrounds=function(e,t){this._skipLeafLabelPass||this._skipLabelPass||(this._labelBackgroundPass.target=e,this._labelBackgroundPass.depthMask=t,this._labelBackgroundPass.frame())},t.prototype.renderPoints=function(e,t){this._skipLeafLabelPass||this._skipLabelPass||(this._pointPass.target=e,this._pointPass.depthMask=t,this._pointPass.frame())},t.prototype.renderInnerLabels=function(e,t,r){if(!this._skipInnerLabelPass&&!this._skipLabelPass&&this._geometry.valid){this._innerLabelPass.target=e,this._innerLabelPass.depthMask=r;var i=this._context.gl;i.enable(i.STENCIL_TEST),i.enable(i.DEPTH_TEST),i.stencilFunc(i.EQUAL,1,255),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),this._innerLabelPass.frame(),i.disable(i.STENCIL_TEST)}},t.prototype.renderLeafLabels=function(e,t,r){this._skipLeafLabelPass||this._skipLabelPass||!this._geometry.valid||(this._leafLabelPass.target=e,this._leafLabelPass.depthMask=r,this._leafLabelPass.frame())},t.prototype.initializeMultiRenderTarget=function(e){this.assertUninitialized(),this._multiRenderTarget=new u.MultiRenderTarget(e),this._multiRenderTarget.initialize(),this._multiRenderTarget.primaryFBO.clearStencil(0),this._multiRenderTarget.secondaryFBO.clearStencil(0)},t.prototype.initializeLeafPasses=function(e){this._leafPass0=new s.CuboidRenderPass(e,0),this._leafPass0.initialize(),this._leafPass0.camera=this._camera,this._leafPass1=new s.CuboidRenderPass(e,1),this._leafPass1.initialize(),this._leafPass1.camera=this._camera},t.prototype.initializeInnerPass=function(e){this.assertUninitialized(),this._innerPass=new f.QuadRenderPass(e),this._innerPass.initialize(),this._innerPass.camera=this._camera},t.prototype.initializePointPass=function(e){this._pointPass=new l.PointRenderPass(e),this._pointPass.initialize(),this._pointPass.camera=this.camera,this._pointPass.pointSize=3.5},t.prototype.initializeLeafLabelBackgroundPass=function(e){this._labelBackgroundPass=new h.ScreenAlignedQuadRenderPass(e),this._labelBackgroundPass.initialize(),this._labelBackgroundPass.camera=this.camera},t.prototype.initializeLabelPasses=function(e){var t=this;this.assertUninitialized(),this._innerLabelPass=new a.LabelRenderPass(e),this._innerLabelPass.initialize(),this._innerLabelPass.camera=this.camera,this._innerLabelPass.target=this._multiRenderTarget.defaultFBO,this._innerLabelPass.depthFunc=e.gl.ALWAYS,this._innerLabelPass.aaStepScale=.3,this._innerLabelPass.aaSampling=a.LabelRenderPass.Sampling.Grid3x3,this._leafLabelPass=new a.LabelRenderPass(e),this._leafLabelPass.initialize(),this._leafLabelPass.camera=this.camera,this._leafLabelPass.target=this._multiRenderTarget.defaultFBO,this._leafLabelPass.aaStepScale=.3,this._leafLabelPass.aaSampling=a.LabelRenderPass.Sampling.Grid3x3,this._leafLabelPass.depthFunc=e.gl.ALWAYS;var r=window.SeereneConstants?window.SeereneConstants.STATIC_DIRECTORY:"assets";a.FontFace.fromFile(r+"/roboto.fnt",e).then(function(e){for(var r=0,i=t._innerLabelPass.labels;r<i.length;r++){i[r].fontFace=e}for(var n=0,o=t._leafLabelPass.labels;n<o.length;n++){o[n].fontFace=e}t._fontFace=e,t._innerLabelPass.update(!0),t._leafLabelPass.update(!0),t._visualization.configuration&&(t._visualization.configuration.altered.alter("geometry"),t._visualization.configuration.altered.alter("labels")),t.invalidate()}).catch(function(e){return o.auxiliaries.log(o.auxiliaries.LogLevel.Error,e)})},t.prototype.initializeAccumulationPass=function(e){this.assertUninitialized(),d(this._multiRenderTarget.initialized,"expected multi-render target to be initialized"),d(void 0!==this._ndcTriangle,"expected NDC triangle to be defined"),this._accumulationPass=new a.AccumulatePass(e),this._accumulationPass.initialize(this._ndcTriangle),this._accumulationPass.precision=this._framePrecision,this._accumulationPass.texture=this._multiRenderTarget.colorRenderTexture},t.prototype.initializeBlitPass=function(e){this.assertUninitialized(),d(this._multiRenderTarget.initialized,"expected multi-render target to be initialized"),d(void 0!==this._ndcTriangle,"expected NDC triangle to be defined");var t=this._context.gl,r=this._context.gl2facade;this._blitPass=new a.BlitPass(e),this._blitPass.initialize(this._ndcTriangle),this._blitPass.readBuffer=r.COLOR_ATTACHMENT0,this._blitPass.drawBuffer=t.BACK,this._blitPass.target=this._multiRenderTarget.defaultFBO,this._debugPass=new a.DebugPass(e),this._debugPass.initialize(this._ndcTriangle),this._debugPass.readBuffer=r.COLOR_ATTACHMENT0,this._debugPass.drawBuffer=t.BACK,this._debugPass.target=this._multiRenderTarget.defaultFBO},t.prototype.initializeReadbackPass=function(e){this.assertUninitialized(),d(this._multiRenderTarget.initialized,"expected multi-render target to be initialized"),d(void 0!==this._ndcTriangle,"expected NDC triangle to be defined"),this._readbackPass=new a.ReadbackPass(e),this._readbackPass.initialize(this._ndcTriangle,void 0!==this._multiRenderTarget.depthFBO),this._readbackPass.cache=!0;var t=this._context.gl,r=this._context.gl2facade;this._multiRenderTarget.depthFBO?(this._readbackPass.depthFBO=this._multiRenderTarget.depthFBO,this._readbackPass.depthAttachment=r.COLOR_ATTACHMENT0):(this._readbackPass.depthFBO=this._multiRenderTarget.primaryFBO,this._readbackPass.depthAttachment=t.DEPTH_STENCIL_ATTACHMENT),this._multiRenderTarget.readBackIdFBO?(this._readbackPass.idFBO=this._multiRenderTarget.readBackIdFBO,this._readbackPass.idAttachment=r.COLOR_ATTACHMENT0):(this._readbackPass.idFBO=this._multiRenderTarget.primaryFBO,this._readbackPass.idAttachment=r.COLOR_ATTACHMENT1)},t.prototype.initializeCamera=function(){this.assertUninitialized(),this._camera=new a.Camera,this._camera.near=t.CAMERA_NEAR_DEFAULT,this._camera.far=t.CAMERA_FAR_DEFAULT,this._camera.eye=o.vec3.fromValues(0,1.5,2.2),this._camera.center=o.vec3.fromValues(0,0,.2),this._camera.up=o.vec3.fromValues(0,1,0),this._camera.fovy=2*a.Camera.calculateFovY(20,60)*o.auxiliaries.RAD2DEG},t.prototype.initializeNavigation=function(e,t){this.assertUninitialized(),this._navigation=new c.Navigation(e,t),this._navigation.camera=this._camera,this._navigation.idAccess=this,this._navigation.coordsAccess=this},t.prototype.onInitialize=function(e,r,i){return!!t.verifyMinimumContextRequirements(e)&&(this._ndcOffsetKernel=new a.AntiAliasingKernel(this._multiFrameNumber),this._ndcOffsetKernel.sort(a.AbstractKernel.SortApproach.BySquaredLength),this._ndcTriangle=new a.NdcFillingTriangle(e,"NdcTriangle"),this._ndcTriangle.initialize(0),this.initializeMultiRenderTarget(e),this.initializeAccumulationPass(e),this.initializeBlitPass(e),this.initializeReadbackPass(e),this.initializeCamera(),this.initializeNavigation(r,i),this.initializeInnerPass(e),this.initializeLeafPasses(e),this.initializePointPass(e),this.initializeLeafLabelBackgroundPass(e),this.initializeLabelPasses(e),!0)},t.prototype.onUninitialize=function(){this._ndcTriangle.uninitialize(),this._multiRenderTarget.uninitialize(),this._accumulationPass.uninitialize(),this._blitPass.uninitialize(),this._debugPass.uninitialize(),this._readbackPass.uninitialize(),this._innerPass.uninitialize(),this._pointPass.uninitialize(),this._innerLabelPass.uninitialize(),this._leafLabelPass.uninitialize(),this._labelBackgroundPass.uninitialize()},t.prototype.onDiscarded=function(){},t.prototype.onUpdate=function(){this._navigation.update();for(var e=this._visualization.update(),t=!1,r=0,i=this._innerLabelPass.labels;r<i.length;r++){if((a=i[r]).altered||a.color.altered){t=!0;break}}for(var n=0,o=this._leafLabelPass.labels;n<o.length;n++){var a;if((a=o[n]).altered||a.color.altered){t=!0;break}}return e||t||this._altered.any||this._camera.altered},t.prototype.onPrepare=function(){this._geometry.altered.any&&this._geometry.valid&&(this._innerPass.ids=this._geometry.innerNodeIndices,this._innerPass.layout=this._geometry.innerNodeLayouts,this._innerPass.colors=this._geometry.innerNodeColors,this._innerPass.emphases=this._geometry.innerNodeEmphases,this._innerPass.colorTable=this._geometry.colorTable,this._leafPass0.ids=this._geometry.leafNodeIndices,this._leafPass0.layoutData=this._geometry.leafNodeLayouts,this._leafPass0.colors=this._geometry.leafNodeColors[0],this._leafPass0.heights=this._geometry.leafNodeHeights[0],this._leafPass0.colorTable=this._geometry.colorTable,this._leafPass1.colors=this._geometry.leafNodeColors[1],this._leafPass1.heights=this._geometry.leafNodeHeights[1],this._leafPass1.colorTable=this._geometry.colorTable),this._geometry.altered.colorTableLength&&(this._leafPass0.colorTableLengthAltered(),this._leafPass1.colorTableLengthAltered());var e=this._geometry.altered;this._geometry.valid&&e.any&&(e.innerNodeEmphases&&(this._innerPass.emphases=this._geometry.innerNodeEmphases),e.innerNodeDrawDispatch&&!this._skipAggregation&&(this._innerPass.dispatch=this._geometry.innerNodeDrawDispatch.filtered(0)),this._skipAggregation&&(this._innerPass.dispatch=this._geometry.innerNodeDrawDispatch.unfiltered()),e.outlineWidth&&(this._innerPass.outlineWidth=this._geometry.outlineWidth),e.emphasisOutlineWidth&&(this._innerPass.emphasisOutlineWidth=this._geometry.emphasisOutlineWidth),e.leafNodeEmphases&&(this._leafPass0.emphases=this._geometry.leafNodeEmphases),e.leafNodeDrawDispatch&&!this._skipAggregation&&(this._leafPass0.dispatch=this._geometry.leafNodeDrawDispatch.filtered(0),this._leafPass1.dispatch=this._geometry.leafNodeDrawDispatch.filtered(0)),this._skipAggregation&&(this._leafPass0.dispatch=this._geometry.leafNodeDrawDispatch.unfiltered(),this._leafPass1.dispatch=this._geometry.leafNodeDrawDispatch.unfiltered()),e.outlineWidth&&(this._leafPass0.outlineWidth=this._geometry.outlineWidth,this._leafPass1.outlineWidth=this._geometry.outlineWidth),e.emphasisOutlineWidth&&(this._leafPass0.emphasisOutlineWidth=this._geometry.emphasisOutlineWidth,this._leafPass1.emphasisOutlineWidth=this._geometry.emphasisOutlineWidth),e.heightScale&&(this._leafPass0.heightScale=this._geometry.heightScale,this._leafPass1.heightScale=this._geometry.heightScale),e.levitate&&(this._leafPass1.levitate=this._geometry.levitate)),this._altered.frameSize&&(this._multiRenderTarget.resize(this._frameSize[0],this._frameSize[1]),this._camera.viewport=[this._frameSize[0],this._frameSize[1]],this.invalidate()),this._altered.canvasSize&&(this._camera.aspect=this._canvasSize[0]/this._canvasSize[1],this._readbackPass.coordinateReferenceSize=this._canvasSize),this._altered.multiFrameNumber&&(this._ndcOffsetKernel.width=this._multiFrameNumber,this._ndcOffsetKernel.sort(a.AbstractKernel.SortApproach.BySquaredLength)),this._altered.framePrecision&&(this._accumulationPass.precision=this._framePrecision),this._altered.clearColor&&this._multiRenderTarget.setClearColor(this._clearColor),this._innerPass.update(),this._leafPass0.update(),this._leafPass1.update(),this._pointPass.update(),this._labelBackgroundPass.update(),this._innerLabelPass.update(),this._leafLabelPass.update(),this._accumulationPass.update(),this._readbackPass.frame(),this._camera.altered&&(this._debugPass.near=this._camera.near,this._debugPass.far=this._camera.far),this._visualization.prepare(),this._camera.altered=!1,this._geometry.altered.reset(),this._altered.reset()},t.prototype.onFrame=function(e){var t=this._context.gl,r=this._context.gl2facade,i=this._ndcOffsetKernel.get(e);i[0]=2*this._ndcOffsetScale*i[0]/this._frameSize[0],i[1]=2*this._ndcOffsetScale*i[1]/this._frameSize[1],this._leafPass0.ndcOffset=i,this._leafPass1.ndcOffset=i,this._innerPass.ndcOffset=i,this._innerLabelPass.ndcOffset=i,this._leafLabelPass.ndcOffset=i,this._pointPass.ndcOffset=i,this._labelBackgroundPass.ndcOffset=i;var n=0===e,o=this._multiRenderTarget,a=n?o.primaryFBO:o.secondaryFBO;a.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT,!0,!1),t.viewport(0,0,this._camera.viewport[0],this._camera.viewport[1]),t.depthFunc(t.LESS);var s=u.MultiRenderTarget.Attachment;o.drawRestricted||r.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1]),this.renderLeafNodes(a,o.drawRestricted?s.Color:s.Undefined,!0),this.renderInnerNodes(a,o.drawRestricted?s.Color:s.Undefined,!0),o.drawRestricted||r.drawBuffers([r.COLOR_ATTACHMENT0,t.NONE]),this.renderInnerLabels(a,o.drawRestricted?s.Color:s.Undefined,!1),this.renderLeafLabelBackgrounds(a,!1),this.renderLeafLabels(a,o.drawRestricted?s.Color:s.Undefined,!1),this.renderPoints(a,!1),o.drawRestricted||r.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1]),n&&o.idFBO&&(o.idFBO.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this.renderLeafNodes(o.idFBO,s.Id,!1),this.renderInnerNodes(o.idFBO,s.Id,!1)),n&&o.depthFBO&&(o.depthFBO.clear(t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this.renderLeafNodes(o.depthFBO,s.Depth,!1),this.renderInnerNodes(o.depthFBO,s.Depth,!1)),this._accumulationPass.frame(e)},t.prototype.onSwap=function(){var e=this._multiRenderTarget.debuggableTarget(this._blitTarget);if(this._accumulationPass.initialized&&this._blitPass.initialized&&(!e||e[0].initialized)){var t=2===this._blitTarget?this._debugPass:this._blitPass;t.framebuffer=e?e[0]:this._accumulationPass.framebuffer,t.readBuffer=e?e[1]:this._context.gl2facade.COLOR_ATTACHMENT0,t.frame()}},t.prototype.updateLabelsForPass=function(e,t){for(var r=[],i=0,n=e;i<n.length;i++){var o=n[i];void 0!==o&&(o.fontFace=this._fontFace,r.push(o))}t.labels=r,t.update()},t.prototype.updateLabels=function(e,t){this.updateLabelsForPass(e,this._innerLabelPass),this.updateLabelsForPass(t,this._leafLabelPass)},t.prototype.updateLeafLabelPass=function(){this._leafLabelPass.update()},t.prototype.updateLeafLabelBackgrounds=function(e){for(var t=[],r=[],i=[],n=[],o=0,s=0,u=e;s<u.length;s++){if((h=u[s])&&0!==h.color.a){var c=2*h.extent[1]/this._frameSize[1];o=Math.max(o,c)}}for(var l=0,f=e;l<f.length;l++){var h;if((h=f[l])&&0!==h.color.a){t.push(h.position[0],h.position[1],h.position[2]);var d=(2*h.extent[0]+1.75)/this._frameSize[0];r.push(d,o);var p=1.75/this._frameSize[1],_=h.alignment===a.Label.Alignment.Right?-p-d:p,v=1.75/this._frameSize[1],m=h.lineAnchor===a.Label.LineAnchor.Top?v-o:-v;i.push(_,m);var b=0;h.alignment===a.Label.Alignment.Left?h.lineAnchor===a.Label.LineAnchor.Bottom?b=1:h.lineAnchor===a.Label.LineAnchor.Top&&(b=2):h.alignment===a.Label.Alignment.Right&&(h.lineAnchor===a.Label.LineAnchor.Bottom?b=3:h.lineAnchor===a.Label.LineAnchor.Top&&(b=4)),n.push(b)}}this._labelBackgroundPass.updateData(new Float32Array(t),new Float32Array(r),new Float32Array(i),new Uint8Array(n))},t.prototype.updatePoints=function(e){for(var t=[],r=[],i=0,n=e;i<n.length;i++){var o=n[i];o&&(t.push(o.position[0],o.position[1],o.position[2]),r.push(o.color.r,o.color.g,o.color.b,o.color.a))}this._pointPass.positions=new Float32Array(t),this._pointPass.colors=new Float32Array(r)},t.prototype.frameSizeAltered=function(){return this._altered.frameSize},t.prototype.setCameraEye=function(e,t,r){this._camera.eye=o.vec3.fromValues(e,t,r)},t.prototype.invalidate=function(){this.initialized&&e.prototype.invalidate.call(this,!0)},t.CAMERA_NEAR_DEFAULT=.01,t.CAMERA_FAR_DEFAULT=10,t}(a.Renderer);t.Renderer=p},"./row.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js").auxiliaries.assert,n=r("./rect.ts"),o=function(){function e(e,t,r,i,n){this._tree=e,this._weights=t,this._availableSpace=r,this._availableWeight=i,this._horizontal=n,this._insertedChildrenCount=0,this._overallChildrenCount=0,this._parentWeight=i,this._childrenWeight=0,this._overallChildrenWeight=0}return e.aspectRatio=function(e,t,r){var i=e*t;return i>r?i/r:r/i},e.prototype.optimizedAverageAspectRatio=function(t){if(t){var r=Math.min(this._childrenWeight+t,this._availableWeight),i=Math.min(r/this._availableWeight,1),n=this._horizontal?this._availableSpace.width:this._availableSpace.height,o=(this._horizontal?this._availableSpace.height:this._availableSpace.width)*i;return e.aspectRatio(1/(this._insertedChildrenCount+1),n,o)}r=this._childrenWeight,i=Math.min(r/this._availableWeight,1),n=this._horizontal?this._availableSpace.width:this._availableSpace.height,o=(this._horizontal?this._availableSpace.height:this._availableSpace.width)*i;return e.aspectRatio(1/this._insertedChildrenCount,n,o)},e.prototype.insert=function(e,t){this._firstChild||(this._firstChild=e),i(void 0===this._lastChild||this._lastChild===e,"Next node invariant not held."),this._lastChild=this._tree.node(e.nextSibling),t>Number.EPSILON&&(this._childrenWeight=Math.min(this._childrenWeight+t,this._availableWeight),this._overallChildrenWeight=Math.min(this._overallChildrenWeight+t,this._parentWeight),this._insertedChildrenCount+=1)},e.prototype.layoutNodes=function(e){var t=this;if(void 0!==this._firstChild)if(this.isDisabled)this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(r){e[r.index]=new n.Rect(t._availableSpace.left,t._availableSpace.bottom,t._availableSpace.left,t._availableSpace.bottom)});else{var r=this.currentSpace;if(this._horizontal){var o=r.left;this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(a){var s=t._weights[a.index],u=r.width*s/t._childrenWeight,c=Math.min(o+u,r.right);e[a.index]=new n.Rect(o,r.bottom,c,r.top),i(t._availableSpace.comprises(e[a.index]),"Expect that child rect is within parent rect"),o=c})}else{var a=r.bottom;this._tree.siblingsRangeDo(this._firstChild,this._lastChild,function(o){var s=t._weights[o.index],u=r.height*s/t._childrenWeight,c=Math.min(a+u,r.top);e[o.index]=new n.Rect(r.left,a,r.right,c),i(t._availableSpace.comprises(e[o.index]),"Expect that child rect is within parent rect"),a=c})}}},Object.defineProperty(e.prototype,"isDisabled",{get:function(){return this._availableWeight<=0||this._availableSpace.width<=0||this._availableSpace.height<=0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableWeight",{get:function(){return this._availableWeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remainingWeight",{get:function(){return this.isDisabled?0:Math.max(this._parentWeight-this._overallChildrenWeight,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"availableSpace",{get:function(){return this._availableSpace},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentSpace",{get:function(){if(this.isDisabled)return this._availableSpace.truncateBottom(this._availableSpace.top);if(this._childrenWeight>=this._availableWeight||void 0===this._lastChild)return n.Rect.clone(this.availableSpace);var e=this._childrenWeight/this._availableWeight;if(this._horizontal){var t=this._availableSpace.bottom+e*this._availableSpace.height;return this._availableSpace.truncateTop(t)}t=this._availableSpace.left+e*this._availableSpace.width;return this._availableSpace.truncateRight(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remainingSpace",{get:function(){if(this.isDisabled)return this._availableSpace.truncateBottom(this._availableSpace.top);var e=Math.min(this._childrenWeight/this._availableWeight,1);if(this._horizontal){var t=this._availableSpace.bottom+e*this._availableSpace.height;return this._availableSpace.truncateBottom(t)}t=this._availableSpace.left+e*this._availableSpace.width;return this._availableSpace.truncateLeft(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHorizontal",{get:function(){return this._horizontal},enumerable:!0,configurable:!0}),e.prototype.increasesAverageAspectRatio=function(e){return!(this.isDisabled||void 0===this._firstChild||e<=Number.EPSILON)&&this.optimizedAverageAspectRatio(e)>this.optimizedAverageAspectRatio()+Number.EPSILON},e.prototype.next=function(e){var t=this.remainingSpace;i(this._availableSpace.comprises(t),"Remaining Space should not exceed available space"),this._availableSpace=t,this._availableWeight=this.remainingWeight,this._horizontal=e,this._firstChild=void 0,this._lastChild=void 0,this._insertedChildrenCount=0,this._childrenWeight=0},e}();t.Row=o},"./screenalignedquadgeometry.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js").auxiliaries.assert,u=function(e){function t(t,r){var i=e.call(this,t,r)||this;return s(t.isWebGL2||t.supportsInstancedArrays,"expected extension 'ANGLE_instanced_arrays' to be supported"),r=void 0!==r&&""!==r?r:"ScreenAlignedQuadGeometry",i._vertices=new a.Buffer(t,r+"VertexVBO"),i._buffers.push(i._vertices),i._origins=new a.Buffer(t,r+"OriginVBO"),i._buffers.push(i._origins),i._extents=new a.Buffer(t,r+"ExtentVBO"),i._buffers.push(i._extents),i._offsets=new a.Buffer(t,r+"OffsetVBO"),i._buffers.push(i._offsets),i._pointyCorners=new a.Buffer(t,r+"PointyCornerVBO"),i._buffers.push(i._pointyCorners),i}return n(t,e),t.prototype.bindBuffers=function(e){var t=this.context.gl,r=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,t.FLOAT,!1,8,0,!0,!1),r.vertexAttribDivisor(this._vertexLocation,0),this._origins.attribEnable(this._originLocation,3,t.FLOAT,!1,12,0,!0,!1),r.vertexAttribDivisor(this._originLocation,1),this._extents.attribEnable(this._extentLocation,2,t.FLOAT,!1,8,0,!0,!1),r.vertexAttribDivisor(this._extentLocation,1),this._offsets.attribEnable(this._offsetLocation,2,t.FLOAT,!1,8,0,!0,!1),r.vertexAttribDivisor(this._offsetLocation,1),this._pointyCorners.attribEnable(this._pointyCornerLocation,1,t.UNSIGNED_BYTE,!1,1,0,!0,!1),r.vertexAttribDivisor(this._pointyCornerLocation,1)},t.prototype.unbindBuffers=function(e){this._vertices.attribDisable(this._vertexLocation,!1,!1),this._origins.attribDisable(this._originLocation,!1,!1),this._extents.attribDisable(this._extentLocation,!1,!1),this._offsets.attribDisable(this._offsetLocation,!1,!1),this._pointyCorners.attribDisable(this._pointyCornerLocation,!1,!1)},t.prototype.initialize=function(r,i,n,o,a){void 0===r&&(r=0),void 0===i&&(i=1),void 0===n&&(n=2),void 0===o&&(o=3),void 0===a&&(a=4),this._vertexLocation=r,this._originLocation=i,this._extentLocation=n,this._offsetLocation=o,this._pointyCornerLocation=a;var s=this.context.gl,u=e.prototype.initialize.call(this,[s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER,s.ARRAY_BUFFER]);return this._vertices.data(t.VERTICES,s.STATIC_DRAW),u&&this._vertices.valid},t.prototype.updateData=function(e,t,r,i){this.bind(),this._count=e.length/3,this._origins.data(e,this.context.gl.STATIC_DRAW),this._extents.data(t,this.context.gl.STATIC_DRAW),this._offsets.data(r,this.context.gl.STATIC_DRAW),this._pointyCorners.data(i,this.context.gl.STATIC_DRAW)},t.prototype.update=function(){this.bind()},t.prototype.draw=function(e){if(void 0===e&&(e=0),this._count){var t=this.context.gl,r=this.context.gl2facade;this._vertices.attribEnable(this._vertexLocation,2,t.FLOAT,!1,8,0,!0,!1),this._origins.attribEnable(this._originLocation,3,t.FLOAT,!1,12,12*e,!0,!1),this._extents.attribEnable(this._extentLocation,2,t.FLOAT,!1,8,8*e,!0,!1),this._offsets.attribEnable(this._offsetLocation,2,t.FLOAT,!1,8,8*e,!0,!1),this._pointyCorners.attribEnable(this._pointyCornerLocation,1,t.UNSIGNED_BYTE,!1,1,1*e,!0,!1),r.drawArraysInstanced(t.TRIANGLE_STRIP,0,4,this._count)}},Object.defineProperty(t.prototype,"valid",{get:function(){return this.initialized&&this._vertices.valid&&this._origins&&this._origins.valid&&this._offsets&&this._offsets.valid&&this._extents&&this._extents.valid&&this._pointyCorners&&this._pointyCorners.valid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vertexLocation",{get:function(){return this._vertexLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originLocation",{get:function(){return this._originLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extentLocation",{get:function(){return this._extentLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offsetLocation",{get:function(){return this._offsetLocation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointyCornerLocation",{get:function(){return this._pointyCornerLocation},enumerable:!0,configurable:!0}),t.VERTICES=new Float32Array([0,0,0,1,1,0,1,1]),o([a.Initializable.assert_initialized()],t.prototype,"draw",null),t}(a.Geometry);t.ScreenAlignedQuadGeometry=u},"./screenalignedquadrenderpass.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__decorate||function(e,t,r,i){var n,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,i);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(o<3?n(a):o>3?n(t,r,a):n(t,r))||a);return o>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=r("../node_modules/webgl-operate/lib/webgl-operate.js"),u=r("./screenalignedquadgeometry.ts"),c=function(e){function t(t){var r=e.call(this)||this;return r._altered=Object.assign(new s.ChangeLookup,{any:!1,camera:!1,geometry:!1}),r._context=t,r._program=new s.Program(t,"ScreenAlignedQuadRenderProgram"),r._geometry=new u.ScreenAlignedQuadGeometry(r._context,"ScreenAlignedQuad"),r}return n(t,e),t.prototype.relink=function(){for(var e=0,t=this._program.shaders;e<t.length;e++){t[e].compile()}this._program.attribute("a_vertex",this._geometry.vertexLocation),this._program.attribute("a_origin",this._geometry.originLocation),this._program.attribute("a_extent",this._geometry.extentLocation),this._program.attribute("a_offset",this._geometry.offsetLocation),this._program.attribute("a_pointyCorner",this._geometry.pointyCornerLocation),this._program.link(),this._program.linked&&(this._uViewProjection=this._program.uniform("u_viewProjection"),this._uNdcOffset=this._program.uniform("u_ndcOffset"),this._uAspectRatio=this._program.uniform("u_aspectRatio"))},t.prototype.initialize=function(){var e=this._context.gl,t=new s.Shader(this._context,e.VERTEX_SHADER,"screenalignedquad.vert");t.initialize(r("./shaders/screenalignedquad.vert"),!1);var i=new s.Shader(this._context,e.FRAGMENT_SHADER,"screenalignedquad.frag");return i.initialize(r("./shaders/screenalignedquad.frag"),!1),this._program.initialize([i,t],!1),this._geometry.initialize(),!0},t.prototype.uninitialize=function(){this._geometry.uninitialize(),this._program.uninitialize(),this._uViewProjection=void 0,this._uNdcOffset=void 0,this._uAspectRatio=void 0},t.prototype.update=function(){var e=this._context.gl;(this._program.initialized&&this._program.linked||(this.relink(),this._program.linked))&&(this._program.bind(),(this._altered.camera||this._camera.altered)&&(e.uniformMatrix4fv(this._uViewProjection,!1,this._camera.viewProjection),e.uniform1f(this._uAspectRatio,1/this._camera.aspect)),this._altered.geometry&&this._geometry.valid&&this._geometry.update(),this._altered.reset())},t.prototype.frame=function(){a.auxiliaries.assert(this._target&&this._target.valid,"valid target expected");var e=this._context.gl,t=this._target.size;e.viewport(0,0,t[0],t[1]),e.disable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),!1===this._depthMask&&(e.depthFunc(e.LEQUAL),e.depthMask(!1)),this._program.bind(),e.uniform2fv(this._uNdcOffset,this._ndcOffset),this._geometry.bind(),this._target.bind(),this._geometry.valid&&this._geometry.draw(),!1===this._depthMask&&(e.depthFunc(e.LESS),e.depthMask(!0)),e.disable(e.BLEND)},Object.defineProperty(t.prototype,"target",{set:function(e){this.assertInitialized(),this._target=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ndcOffset",{set:function(e){this.assertInitialized(),this._ndcOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this.assertInitialized(),this._camera!==e&&(this._camera=e,this._altered.alter("camera"))},enumerable:!0,configurable:!0}),t.prototype.updateData=function(e,t,r,i){this._geometry.updateData(e,t,r,i),this._altered.alter("geometry")},Object.defineProperty(t.prototype,"depthMask",{set:function(e){this._depthMask=e},enumerable:!0,configurable:!0}),o([s.Initializable.assert_initialized()],t.prototype,"relink",null),o([s.Initializable.initialize()],t.prototype,"initialize",null),o([s.Initializable.uninitialize()],t.prototype,"uninitialize",null),o([s.Initializable.assert_initialized()],t.prototype,"update",null),o([s.Initializable.assert_initialized()],t.prototype,"frame",null),t}(s.Initializable);t.ScreenAlignedQuadRenderPass=c},"./seerenemodifier.ts":function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r("../node_modules/webgl-operate/lib/webgl-operate.js"),a=r("../node_modules/webgl-operate/lib/webgl-operate.js"),s=o.gl_matrix_extensions.v2,u=o.gl_matrix_extensions.v3,c=o.gl_matrix_extensions.sign,l=o.gl_matrix_extensions.clamp,f=o.gl_matrix_extensions.clamp3,h=o.auxiliaries.DEG2RAD,d=o.auxiliaries.assert,p=function(){return function(){this.screen=o.vec2.create(),this.world=o.vec3.create()}}(),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.initialPoints=[new p,new p],t.currentPoints=[new p,new p],t.initialEye=o.vec3.create(),t.initialCenter=o.vec3.create(),t.initialViewProjectionInverse=o.mat4.create(),t._xAxisScreenSpace=o.vec3.create(),t.referencePlane=[o.vec3.create(),o.vec3.create(),0],t}return n(t,e),Object.defineProperty(t.prototype,"valid",{get:function(){return void 0!==this.initialPoints[0].world},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{set:function(e){this._camera=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coordsAccess",{set:function(e){this._coordsAccess=e},enumerable:!0,configurable:!0}),t.rayY0SquareIntersection=function(e,r){var i=o.ray_math.rayPlaneIntersection(e,r);if(void 0!==i){var n=o.vec2.fromValues(i[0],i[2]);return o.ray_math.isPointWithinSquare(n,t.HALF_SQUARE_LENGTH)?i:void 0}},t.prototype.assert_valid=function(){},t.prototype.invalidate=function(){this.initialPoints[0].world=void 0,this.currentPoints[0].world=void 0,this.initialPoints[1].world=void 0,this.currentPoints[1].world=void 0},t.prototype.initiateTranslateConstraints=function(e){if(e)return this._maxNegativeTranslate=void 0,void(this._maxPositiveTranslate=void 0);var t=o.vec3.fromValues(-1,0,-1),r=o.vec3.fromValues(1,0,1);this._maxNegativeTranslate=o.vec3.sub(u(),t,this.initialCenter),this._maxPositiveTranslate=o.vec3.sub(u(),r,this.initialCenter)},t.prototype.initiateScaleConstraints=function(e){var r=o.vec3.sub(u(),this.initialEye,this.initialCenter),i=1/o.vec3.length(r);if(e)return this._minScale=this._camera.near*i-1,void(this._maxScale=this._camera.far*i-1);o.ray_math.rayPlaneIntersection(this.initialEye,this.initialCenter,[0,0,0],[0,1,0])&&(this._minScale=this._camera.near*t.MIN_NEAR_PLANE_FACTOR*i-1,this._maxScale=t.MAX_DISTANCE_TO_SQUARE*i-1)},t.prototype.initiateRotateConstraints=function(e){var t=o.vec3.normalize(u(),o.vec3.sub(u(),this.initialEye,this.initialCenter));this._xAxisScreenSpace=o.vec3.cross(u(),[0,1,0],t);var r=Math.acos(o.vec3.dot(t,[0,1,0]));if(this._maxAngles=[void 0,89.99*h-r],this._minAngles=[void 0,.01*h-r],!e){var i=o.vec2.normalize(s(),[t[0],t[2]]),n=Math.asin(o.vec2.dot(i,[1,0]));i[1]<0&&(n=c(n)*Math.PI-n),this._maxAngles=[.6666*+Math.PI-n,60*h-r],this._minAngles=[.6666*-Math.PI-n,1*h-r]}},t.prototype.initiate=function(e,t,r,i){void 0===r&&(r=[!1,!1,!1]),void 0===i&&(i=!1),this._override=i;var n=this._camera.viewProjectionInverse;return!!n&&(o.mat4.copy(this.initialViewProjectionInverse,n),o.vec3.copy(this.initialEye,this._camera.eye),o.vec3.copy(this.initialCenter,this._camera.center),o.vec2.copy(this.initialPoints[0].screen,e),this.initialPoints[0].world=this.coordsAt(e,!1),void 0===this.initialPoints[0].world?(this.invalidate(),!1):(this.initialPoints[1].screen=void 0===t?void 0:o.vec2.copy(s(),t),this.initialPoints[1].world=this.coordsAt(t,!1),this.referencePlane[0]=this.initialPoints[0].world,this.referencePlane[1]=o.vec3.fromValues(0,1,0),this.referencePlane[2]=o.vec3.length(this.initialPoints[0].world),d(0===this.initialCenter[1],"camera center is expected to be on y = 0 (ground plane)"),r[0]&&this.initiateTranslateConstraints(i),r[1]&&this.initiateScaleConstraints(i),r[2]&&this.initiateRotateConstraints(i),!0))},t.prototype.update_positions=function(e,t){return this.assert_valid(),this.currentPoints[0].world=this.coordsAt(e),this._override&&void 0===this.currentPoints[0].world?(this.invalidate(),!1):(o.vec2.copy(this.currentPoints[0].screen,e),void 0===t||(this.currentPoints[1].world=this.coordsAt(t),this._override&&void 0===this.currentPoints[1].world?(this.invalidate(),!1):(this.currentPoints[1].screen=void 0===t?void 0:o.vec2.copy(s(),t),!0)))},t.prototype.translate=function(){this.assert_valid();var e=this.initialPoints[0].world,t=this.currentPoints[0].world;if(e&&t){var r=o.vec3.subtract(u(),e,t);this._maxNegativeTranslate&&this._maxPositiveTranslate&&f(r,r,this._maxNegativeTranslate,this._maxPositiveTranslate),this._camera.eye=o.vec3.add(u(),this.initialEye,r);var i=o.vec3.add(u(),this.initialCenter,r),n=o.ray_math.rayPlaneIntersection(this._camera.eye,i);n&&(this._camera.center=n)}},t.prototype.scale=function(e){var r;if(this.assert_valid(),d(void 0!==this._minScale&&void 0!==this._maxScale,"valid scale constraints expected"),void 0===e){var i=this.currentPoints[0].screen,n=this.initialPoints[0].screen;if(!n||!i)return;r=o.vec2.subtract(s(),n,i)[1]/window.devicePixelRatio}else r=-c(e)*t.SCALE_STEP_FACTOR;r=l(r*t.SCALE_FACTOR,this._minScale,this._maxScale);var a=this.initialPoints[0].world;if(a){var h=o.vec3.sub(u(),this.initialEye,a),p=o.vec3.sub(u(),this.initialCenter,a),_=o.vec3.add(u(),this.initialEye,o.vec3.scale(u(),h,r)),v=o.vec3.add(u(),this.initialCenter,o.vec3.scale(u(),p,r)),m=o.ray_math.rayPlaneIntersection(this._camera.eye,v);m&&(this._camera.center=this._override?m:f(u(),m,[-1,0,-1],[1,0,1]),this._camera.eye=o.vec3.add(u(),_,o.vec3.sub(u(),this._camera.center,m)))}},t.prototype.rotate=function(){this.assert_valid();var e=this.currentPoints[0].screen,r=this.initialPoints[0].screen;if(r&&e){var i=o.vec2.subtract(s(),r,e);o.vec2.scale(i,i,window.devicePixelRatio*t.ROTATE_FACTOR),this._minAngles[1]&&this._maxAngles[1]&&(i[1]=l(i[1],this._minAngles[1],this._maxAngles[1]));var n=this._override?this.initialCenter:f(u(),this.initialCenter,[-1,0,-1],[1,0,1]),a=o.mat4.translate(o.mat4.create(),o.mat4.create(),n);o.mat4.rotateY(a,a,i[0]),o.mat4.rotate(a,a,i[1],this._xAxisScreenSpace),o.mat4.translate(a,a,o.vec3.negate(u(),n)),this._camera.center=n;var c=o.vec3.transformMat4(u(),this.initialEye,a);c&&(this._camera.eye=c)}},t.prototype.coordsAt=function(e,r){if(void 0===r&&(r=!0),void 0!==e){var i=r?this.initialViewProjectionInverse:this._camera.viewProjectionInverse;if(r){d(void 0!==this.referencePlane[0]&&void 0!==this.referencePlane[1],"valid reference plane expected for reference coordinate retrieval");var n=this._coordsAccess(e[0],e[1],0,i),a=this._coordsAccess(e[0],e[1],1,i);return o.ray_math.rayPlaneIntersection(n,a,this.referencePlane[0],this.referencePlane[1])}var s=this._coordsAccess(e[0],e[1],void 0,i);if(void 0!==s)return s;var u=this._coordsAccess(e[0],e[1],0,i),c=this._coordsAccess(e[0],e[1],1,i);return t.rayY0SquareIntersection(u,c)}},t.prototype.update=function(){},t.HALF_SQUARE_LENGTH=2,t.SCALE_FACTOR=.004,t.SCALE_STEP_FACTOR=16,t.ROTATE_FACTOR=.002,t.MAX_DISTANCE_TO_SQUARE=4,t.MIN_NEAR_PLANE_FACTOR=4,t}(a.CameraModifier);t.SeereneModifier=_},"./serviceadapter.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=r("./attributebuffer.ts"),o=r("./configuration.ts"),a=r("./configurationaids.ts"),s=r("./layout.ts"),u=r("./nodesort.ts"),c=r("./servicebuffer.ts"),l=r("./servicebufferheader.ts"),f=r("./topology.ts"),h=function(){function e(){this._config=new o.Configuration,this.setupLayoutAndGeometry()}return e.prototype.loadAll=function(e,t,r,i,n,o){this.loadAndPrepareAreaData(e),this.loadAndPrepareColorData(t),this.loadAndPrepareHeightData(r,n,o),this.loadNames(i)},e.prototype.loadCombinedFormat=function(e,t){void 0===t&&(t=!1);var r,i,n=new c.BufferReader(e),o=new c.ServiceFormatHeader(n);if(o.hasFlag(c.BufferFlags.HIERARCHY)){var a=n.getInt(),s=n.getInt(),u=n.getByteArray(s);n.addPadding(),this.createOrUpdateTopology(u,a)}if(o.hasFlag(c.BufferFlags.HEIGHTS)&&(r=new l.ServiceBufferHeader(e,n.offset),n.offset=r.offset+r.length*Uint16Array.BYTES_PER_ELEMENT,n.addPadding()),o.hasFlag(c.BufferFlags.HEIGHTS_COMPARE)&&(i=new l.ServiceBufferHeader(e,n.offset),n.offset=i.offset+i.length*Uint16Array.BYTES_PER_ELEMENT,n.addPadding()),this.loadAndPrepareHeightDataV2(e,r,i),o.hasFlag(c.BufferFlags.AREAS)){var f=new l.ServiceBufferHeader(e,n.offset);n.offset=f.offset+f.length*Uint16Array.BYTES_PER_ELEMENT,n.addPadding(),this.loadAndPrepareAreaData(e,f)}o.hasFlag(c.BufferFlags.COLORS)?n.addPadding():this.loadAndPrepareColorData(e,r)},e.prototype.loadAndPrepareAreaData=function(t,r){r||(r=new l.ServiceBufferHeader(t)),i.auxiliaries.log(i.auxiliaries.LogLevel.Debug,"area - min: "+r.minimum+", max: "+r.maximum),this.createOrUpdateBuffer({identifier:e.BufferIdentifier.SourceArea,type:n.AttributeBuffer.DataType.Uint16,data:new Uint16Array(t,r.offset,r.length),encoding:n.AttributeBuffer.Encoding.Native,linearization:n.AttributeBuffer.Linearization.Topology}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedArea,source:"buffer:"+e.BufferIdentifier.SourceArea,transformations:[this.metricRangeTransform(r.minimum,r.maximum)]});var o=Math.max(1e-5,r.maximum);0===r.maximum&&console.warn("treemap: max area is 0 - clamping to "+o+" for successful layout"),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.ClampedArea,source:"bufferView:"+e.BufferViewIdentifier.DecodedArea,transformations:[{type:"clamp",min:o*e.MINIMUM_NODE_WEIGHT,max:o}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.Weight,source:"bufferView:"+e.BufferViewIdentifier.ClampedArea,transformations:[{type:"propagate-up",operation:"sum"}]}),this._config.altered.alter("buffers"),this._config.altered.alter("bufferViews")},e.prototype.loadAndPrepareColorData=function(t,r){r||(r=new l.ServiceBufferHeader(t)),i.auxiliaries.log(i.auxiliaries.LogLevel.Debug,"color - min: "+r.minimum+", max: "+r.maximum),this.createOrUpdateBuffer({identifier:e.BufferIdentifier.SourceColor,type:n.AttributeBuffer.DataType.Uint16,data:new Uint16Array(t,r.offset,r.length),encoding:n.AttributeBuffer.Encoding.Native,linearization:n.AttributeBuffer.Linearization.Topology}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedColor,source:"buffer:"+e.BufferIdentifier.SourceColor,transformations:[this.metricRangeTransform(r.minimum,r.maximum)]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.Unmodified,source:"buffer:"+e.BufferIdentifier.SourceColor,transformations:[{type:"mask",value:e.UINT16_ENCODING_UNMODIFIED}]}),this._config.altered.alter("buffers"),this._config.altered.alter("bufferViews")},e.prototype.loadAndPrepareHeightData=function(t,r,o){var a=new l.ServiceBufferHeader(t);i.auxiliaries.log(i.auxiliaries.LogLevel.Debug,"height - min: "+a.minimum+", max: "+a.maximum);var s=a.offset,u=new Uint16Array(t,a.offset,a.length);if(a.minimum>0&&a.minimum===a.maximum)for(var c=0;c<u.length;c++)u[c]===e.UINT16_ENCODING_ZERO&&(u[c]=e.UINT16_ENCODING_MAX);if(this.createOrUpdateBuffer({identifier:e.BufferIdentifier.SourceHeight,type:n.AttributeBuffer.DataType.Uint16,data:u,encoding:n.AttributeBuffer.Encoding.Native,linearization:n.AttributeBuffer.Linearization.Topology}),s+=Uint16Array.BYTES_PER_ELEMENT*a.length,s+=Int32Array.BYTES_PER_ELEMENT,this.createOrUpdateBuffer({identifier:e.BufferIdentifier.SourceCompareThreshold,type:n.AttributeBuffer.DataType.Int8,data:new Int8Array(t,s,a.length),encoding:n.AttributeBuffer.Encoding.Native,linearization:n.AttributeBuffer.Linearization.Topology}),s+=Int8Array.BYTES_PER_ELEMENT*a.length,r){s+=4-s%4;var f=new Uint32Array(t,s,1)[0];s+=Uint32Array.BYTES_PER_ELEMENT;var h=new Uint32Array(t,s,1)[0];s+=Uint32Array.BYTES_PER_ELEMENT,this.createOrUpdateTopology(new Uint8Array(t,s,h),f)}this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedHeight,source:"buffer:"+e.BufferIdentifier.SourceHeight,transformations:[this.metricRangeTransform(a.minimum,a.maximum)]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.NormalizedHeight,source:"buffer:"+e.BufferIdentifier.SourceHeight,transformations:[this.metricRangeTransform(0,1)]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.HeightChange,source:"buffer:"+e.BufferIdentifier.SourceCompareThreshold,transformations:[{type:"threshold",value:0}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.BaseHeight,source:"buffer:"+e.BufferIdentifier.SourceCompareThreshold,transformations:[{type:"transform",operation:"divide",parameter:127},{type:"transform",operation:"as-remainder"},{type:"transform",operation:"multiply",buffer:"bufferView:"+e.BufferViewIdentifier.NormalizedHeight}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedBaseHeight,source:"buffer:"+e.BufferIdentifier.SourceCompareThreshold,transformations:[{type:"transform",operation:"divide",parameter:127},{type:"transform",operation:"as-remainder"},{type:"transform",operation:"multiply",buffer:"bufferView:"+e.BufferViewIdentifier.DecodedHeight}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DeltaHeight,source:"bufferView:"+e.BufferViewIdentifier.NormalizedHeight,transformations:[{type:"transform",operation:"subtract",buffer:"bufferView:"+e.BufferViewIdentifier.BaseHeight},{type:"transform",operation:"abs"}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedDeltaHeight,source:"bufferView:"+e.BufferViewIdentifier.DecodedHeight,transformations:[{type:"transform",operation:"subtract",buffer:"bufferView:"+e.BufferViewIdentifier.DecodedBaseHeight},{type:"transform",operation:"abs"}]}),this._config.altered.alter("buffers"),this._config.altered.alter("bufferViews")},e.prototype.loadAndPrepareHeightDataV2=function(t,r,o){i.auxiliaries.log(i.auxiliaries.LogLevel.Debug,"height - min: "+r.minimum+", max: "+r.maximum),this.createOrUpdateBuffer({identifier:e.BufferIdentifier.SourceHeight,type:n.AttributeBuffer.DataType.Uint16,data:new Uint16Array(t,r.offset,r.length),encoding:n.AttributeBuffer.Encoding.Native,linearization:n.AttributeBuffer.Linearization.Topology}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedHeight,source:"buffer:"+e.BufferIdentifier.SourceHeight,transformations:[this.metricRangeTransform(r.minimum,r.maximum)]}),o?(this.createOrUpdateBuffer({identifier:e.BufferIdentifier.SourceCompareHeight,type:n.AttributeBuffer.DataType.Uint16,data:new Uint16Array(t,o.offset,o.length),encoding:n.AttributeBuffer.Encoding.Native,linearization:n.AttributeBuffer.Linearization.Topology}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedCompareHeight,source:"buffer:"+e.BufferIdentifier.SourceCompareHeight,transformations:[this.metricRangeTransform(o.minimum,o.maximum)]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedBaseHeight,source:"bufferView:"+e.BufferViewIdentifier.DecodedHeight,transformations:[{type:"transform",operation:"min",buffer:"bufferView:"+e.BufferViewIdentifier.DecodedCompareHeight}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DecodedDeltaHeight,source:"bufferView:"+e.BufferViewIdentifier.DecodedHeight,transformations:[{type:"transform",operation:"subtract",buffer:"bufferView:"+e.BufferViewIdentifier.DecodedCompareHeight},{type:"transform",operation:"abs"}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.BaseHeight,source:"bufferView:"+e.BufferViewIdentifier.DecodedBaseHeight,transformations:[{type:"range-transform",sourceRange:[r.minimum,r.maximum],targetRange:[0,1]}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.DeltaHeight,source:"bufferView:"+e.BufferViewIdentifier.DecodedDeltaHeight,transformations:[{type:"range-transform",sourceRange:[o.minimum,o.maximum],targetRange:[0,1]}]}),this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.HeightChange,source:"buffer:"+e.BufferIdentifier.SourceHeight,transformations:[{type:"transform",operation:"compare",buffer:"buffer:"+e.BufferIdentifier.SourceCompareHeight},{type:"threshold",value:0}]})):this.createOrUpdateBufferView({identifier:e.BufferViewIdentifier.BaseHeight,source:"bufferView:"+e.BufferViewIdentifier.DecodedHeight,transformations:[{type:"range-transform",sourceRange:[r.minimum,r.maximum],targetRange:[0,1]}]}),this._config.altered.alter("buffers"),this._config.altered.alter("bufferViews")},e.prototype.metricRangeTransform=function(t,r){return{type:"range-transform",sourceRange:[e.UINT16_ENCODING_ZERO,e.UINT16_ENCODING_MAX],targetRange:[t,r]}},e.prototype.setupLayoutAndGeometry=function(){this._config.colors=[{identifier:"emphasis",space:"hex",value:"#00b0ff"},{identifier:"auxiliary",space:"hex",values:["#00aa5e","#71237c"]},{identifier:"inner",space:"hex",values:["#e8eaee","#eef0f4"]},{identifier:"analysis",space:"hex",values:["#ffffff","#fed500","#fe8500","#e62325"]},{identifier:"segmentation",space:"hex",values:["#ffffff","#5392ff","#71cddd","#34bc6e","#95d13c","#db7c00","#ffb000","#ff509e","#9b82f3"]}],this._config.layout={algorithm:s.Layout.LayoutAlgorithm.Snake,weight:"bufferView:"+e.BufferViewIdentifier.Weight,aspectRatio:1,sort:{key:u.NodeSort.Key.Weight,algorithm:u.NodeSort.Algorithm.Descending},siblingMargin:{type:"relative",value:.1},parentPadding:{type:"relative",value:.02},accessoryPadding:{type:"absolute",direction:"bottom",value:[0,.018,.015],relativeAreaThreshold:.4,targetAspectRatio:2},cascade:!1,flattenDirectories:!1},this._config.altered.alter("geometry"),this._config.geometry={aggregation:{buffer:"bufferView:"+e.BufferViewIdentifier.Unmodified,depthThreshold:2,valueThreshold:1},emphasis:{outline:new Array,highlight:new Array},parentLayer:{showRoot:!1},leafLayers:[{colorScheme:{inverted:!1,classBounds:void 0},colorMap:"color:analysis",height:"bufferView:"+e.BufferViewIdentifier.BaseHeight,colors:"bufferView:"+e.BufferViewIdentifier.DecodedColor},{colorScheme:{inverted:!1,classBounds:void 0},colorMap:"color:analysis",height:"bufferView:"+e.BufferViewIdentifier.DeltaHeight,colors:"bufferView:"+e.BufferViewIdentifier.HeightChange}],heightScale:a.ConfigurationAids.HeightScaleApproach.SomethingInverseSqrt},this._config.labels={innerNodeLayerRange:[1,3],numTopInnerNodes:200,numTopWeightNodes:0,numTopHeightNodes:3,numTopColorNodes:3}},e.prototype.createOrUpdateBuffer=function(e){for(var t=0;t<this._config.buffers.length&&this._config.buffers[t].identifier!==e.identifier;)++t;this._config.buffers.length===t?this._config.buffers.push(e):this._config.buffers.splice(t,1,e)},e.prototype.createOrUpdateBufferView=function(e){for(var t=0;t<this._config.bufferViews.length&&this._config.bufferViews[t].identifier!==e.identifier;)++t;this._config.bufferViews.length===t?this._config.bufferViews.push(e):this._config.bufferViews.splice(t,1,e)},e.prototype.createOrUpdateTopology=function(e,t){for(var r=new Array,n=new Array,o=t+1,a=0;a<e.length;a+=o){for(var s=i.vec4.create(),u=0;u<t;u++)s[u]=e[a+u];var c=i.gl_matrix_extensions.decode_uint32_from_rgba8(s),l=e[a+t];if(l>0){var h=n[l-1];r.push(h),r.push(c)}n[l]=c}this._config.topology={edges:r,format:f.Topology.InputFormat.Interleaved}},e.prototype.loadNames=function(e){var t=new Map;if(e.apps||e.groups){for(var r in e.apps){var i=parseInt(r,10);t.set(i,e.apps[r])}for(var r in e.groups){i=parseInt(r,10);t.set(i,e.groups[r])}}else Object.keys(e).forEach(function(r){var i=parseInt(r,10);t.set(i,e[i])});this._config.labels.callback=function(e,r){return r(t)}},Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.UINT16_ENCODING_DB_NULL=0,e.UINT16_ENCODING_UNMODIFIED=1,e.UINT16_ENCODING_ZERO=2,e.UINT16_ENCODING_MAX=65535,e.MINIMUM_NODE_WEIGHT=.01,e}();t.ServiceAdapter=h,function(e){!function(e){e.SourceArea="SourceArea",e.SourceHeight="SourceHeight",e.SourceColor="SourceColor",e.SourceCompareThreshold="SourceCompareThresholds",e.SourceCompareHeight="SourceCompareHeight"}(e.BufferIdentifier||(e.BufferIdentifier={})),function(e){e.DecodedArea="DecodedArea",e.ClampedArea="ClampedArea",e.Weight="Weight",e.DecodedColor="DecodedColor",e.HeightChange="HeightChange",e.Unmodified="Unmodified",e.DecodedHeight="DecodedHeight",e.DecodedCompareHeight="DecodedCompareHeight",e.NormalizedHeight="NormalizedHeight",e.BaseHeight="BaseHeight",e.DeltaHeight="DeltaHeight",e.DecodedBaseHeight="DecodedBaseHeight",e.DecodedDeltaHeight="DecodedDeltaHeight"}(e.BufferViewIdentifier||(e.BufferViewIdentifier={}))}(h=t.ServiceAdapter||(t.ServiceAdapter={})),t.ServiceAdapter=h},"./servicebuffer.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.HEIGHTS=1]="HEIGHTS",e[e.HEIGHTS_COMPARE=2]="HEIGHTS_COMPARE",e[e.AREAS=4]="AREAS",e[e.COLORS=8]="COLORS",e[e.HIERARCHY=16]="HIERARCHY"}(t.BufferFlags||(t.BufferFlags={}));var i=function(){function e(e){this.data=e,this.offset=0}return e.prototype.getArray=function(e,t){var r=new t(this.data,this.offset,e);return this.offset+=t.BYTES_PER_ELEMENT*e,r},e.prototype.getValue=function(e){return this.getArray(1,e)[0]},e.prototype.addPadding=function(){this.offset+=4-this.offset%4},e.prototype.getByte=function(){return this.getValue(Uint8Array)},e.prototype.getShort=function(){return this.getValue(Uint16Array)},e.prototype.getFloat=function(){return this.getValue(Float32Array)},e.prototype.getInt=function(){return this.getValue(Int32Array)},e.prototype.getShortArray=function(e){return this.getArray(e,Uint16Array)},e.prototype.getByteArray=function(e){return this.getArray(e,Uint8Array)},e}();t.BufferReader=i;var n=function(){function e(e){this.numBuffers=e.getByte(),this.flags=e.getByte(),e.addPadding()}return e.prototype.hasFlag=function(e){return(this.flags&e)===e},e}();t.ServiceFormatHeader=n},"./servicebufferheader.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t=0),this._offset=t,this._minimum=new Float32Array(e,this._offset,1)[0],this._offset+=1*Float32Array.BYTES_PER_ELEMENT,isFinite(this._minimum)||(this._minimum=0),this._maximum=new Float32Array(e,this._offset,1)[0],this._offset+=1*Float32Array.BYTES_PER_ELEMENT,this._length=new Int32Array(e,this._offset,1)[0],this._offset+=1*Int32Array.BYTES_PER_ELEMENT}return Object.defineProperty(e.prototype,"minimum",{get:function(){return this._minimum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this._maximum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),e}();t.ServiceBufferHeader=i},"./servicedata.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./serviceadapter.ts"),n=function(){function e(){}return e.fetchAsync=function(e,t,r,n,o,a){var s=function(e,t){return"fetching '"+e+"' failed ("+t.status+"): "+t.statusText};return new Promise(function(u,c){for(var l=[void 0,void 0,void 0,void 0],f=[new XMLHttpRequest,new XMLHttpRequest,new XMLHttpRequest,new XMLHttpRequest],h=[e,t,r,n],d=function(e){var t=f[e],r=h[e];t.open("GET",r,!0),t.responseType=3===e?"json":"arraybuffer",t.onload=function(){if(t.status<200||t.status>=300)c(s(r,t));else if(l[e]=t.response,3===e&&"string"==typeof t.response&&(l[e]=JSON.parse(t.response)),void 0!==l[0]&&void 0!==l[1]&&void 0!==l[2]&&void 0!==l[3]){var n=new i.ServiceAdapter;n.loadAll(l[0],l[1],l[2],l[3],o,a),u(n.config)}},t.onerror=function(){return c(s(r,t))},t.ontimeout=function(){return c(s(r,t))},t.send()},p=0;p<h.length;p++)d(p)})},e.fetchAsyncCombined=function(e,t){var r=function(e,t){return"fetching '"+e+"' failed ("+t.status+"): "+t.statusText};return new Promise(function(n,o){for(var a=[void 0,void 0],s=[new XMLHttpRequest,new XMLHttpRequest],u=[e,t],c=function(e){var t=s[e],c=u[e];t.open("GET",c,!0),t.responseType=1===e?"json":"arraybuffer",t.onload=function(){if(t.status<200||t.status>=300)o(r(c,t));else if(a[e]=t.response,1===e&&"string"==typeof t.response&&(a[e]=JSON.parse(t.response)),void 0!==a[0]&&void 0!==a[1]){var s=new i.ServiceAdapter;s.loadCombinedFormat(a[0]),s.loadNames(a[1]),n(s.config)}},t.onerror=function(){return o(r(c,t))},t.ontimeout=function(){return o(r(c,t))},t.send()},l=0;l<u.length;l++)c(l)})},e}();t.ServiceData=n},"./shaders/cuboid.frag":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n#if __VERSION__ == 100\r\n\r\n    #ifdef GL_EXT_draw_buffers\r\n        #extension GL_EXT_draw_buffers : enable\r\n        #define fragColor gl_FragData[0].rgba\r\n        #define fragId gl_FragData[1].xyzw\r\n    #else\r\n        #define DRAW_RESTRICTED\r\n        #define fragColor gl_FragColor.rgba\r\n        #define fragId gl_FragColor.xyzw\r\n        #define fragDepth gl_FragColor.xyz\r\n    #endif\r\n\r\n    #ifdef GL_OES_standard_derivatives\r\n        #extension GL_OES_standard_derivatives : enable\r\n        #define ANTIALIASED_CONTOUR\r\n    #endif\r\n\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n    layout(location = 1) out vec4 fragId;\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\nuniform int u_face;\r\nuniform int u_layer;\r\nuniform int u_arrows;\r\n\r\n#ifdef DRAW_RESTRICTED\r\n    \r\n// @todo this file will be included from webgl-operate soon\r\n\r\nconst float one255ths = 1.0 / 255.0;\r\n\r\nvec3 float24x1_to_uint8x3(const in float f) {\r\n    vec3 uint8x3 = vec3(f, fract(f * 256.0), fract(f * 65536.0));\r\n    return floor(uint8x3 * 256.0) * one255ths;\r\n}\r\n\r\nvec4 float24x1_to_uint8x4(const in float f) {\r\n    vec4 uint8x4 = vec4(f, fract(f * 256.0), fract(f * 65536.0), fract(f * 16777216.0));\r\n    return floor(uint8x4 * 256.0) * one255ths;\r\n}\r\n\r\nconst vec3 premultUint8x3 = vec3(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0);\r\nfloat uint8x3_to_float24x1(const in vec3 v) {\r\n    return dot(v, premultUint8x3); // a1 * b1 + a2 * b2 + a3 * b3  ;)\r\n}\r\n\r\nconst vec4 premultUint8x4 = vec4(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0, 255.0 / 4294967296.0);\r\nfloat uint8x4_to_float24x1(const in vec4 v) {\r\n    return dot(v, premultUint8x4); // a1 * b1 + a2 * b2 + a3 * b3 + a4 * b4  ;)\r\n}\r\n\r\n    uniform int u_attachment;\r\n#endif\r\n\r\n\r\nvarying vec4 v_baseColor;\r\nvarying vec4 v_outlineColor;\r\nvarying vec4 v_arrowColor;\r\n\r\nvarying vec4 v_id;\r\nvarying vec4 v_uv;\r\n\r\n\r\nvoid main(void)\r\n{\r\n#ifdef DRAW_RESTRICTED\r\n    if(u_attachment == 0) {\r\n#endif\r\n\r\n    /* Compute the actual outline of a cuboid face based on texture coordinates. */\r\n    vec2 awidth = fwidth(v_uv.st) * v_outlineColor[3];\r\n    vec2 awidth2 = fwidth(v_uv.zw);\r\n\r\n    vec4 ctest; /* Used for countour/ctest testing. */\r\n    ctest.xy = step(v_uv.st - awidth.xy, vec2(0.0));\r\n    ctest.zw = step(vec2(1.0), v_uv.st + awidth.xy);\r\n    float outline = clamp(dot(ctest, vec4(1.0)), 0.0, 1.0);\r\n\r\n    /* @todo optimize all this arrow pattern code. */\r\n    float arrow = 0.0;\r\n    if(u_arrows == 1 && u_face > 2 && u_layer > 0) {\r\n        float d = abs(v_uv[2]) * 4.0;\r\n        //outline = max(outline, step(1.0, mod(v_uv[3] * 4.0 + d, 2.0)));\r\n        arrow = step(1.0, mod(v_uv[3] * 4.0 + d, 2.0));\r\n        //outline = max(outline, step(1.0, mod(v_uv[3] * 250.0, 2.0)));\r\n    } else {\r\n        arrow = 0.0; //step(0.5, float(u_layer));\r\n    }\r\n\r\n    fragColor = mix(mix(v_baseColor, v_arrowColor, arrow), vec4(v_outlineColor.rgb, 1.0), outline);\r\n\r\n#ifdef DRAW_RESTRICTED\r\n    } else if(u_attachment == 1) {\r\n#endif\r\n\r\n    fragId = v_id;\r\n\r\n#ifdef DRAW_RESTRICTED\r\n    } else if(u_attachment == 2) {\r\n        fragDepth = float24x1_to_uint8x3(gl_FragCoord.z);\r\n    }\r\n#endif\r\n}\r\n"},"./shaders/cuboid.vert":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\n#if __VERSION__ == 100\r\n    #extension GL_EXT_draw_buffers : enable\r\n#endif\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n#else \r\n    #define varying out\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\nvoid ndcOffset(inout vec4 vertex, in vec2 offset) {\r\n    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n\r\nattribute vec3  a_vertex;\r\nattribute vec4  a_layout; /* [ position: vec2, extent: vec2 ] */\r\nattribute vec4  a_id; /* encoded uint32 id in byte4 */\r\nattribute float a_color;\r\nattribute float a_emphasis;\r\nattribute vec2  a_heights; /* [ bottom: float, top: float ] */\r\nattribute vec2  a_texCoord;\r\n\r\n#else\r\n\r\n/* Note: do not use layout location specifier, since they take precedence over CPU managed locations. */\r\nin vec3  a_vertex;\r\nin vec4  a_layout; /* [ position: vec2, extent: vec2 ] */\r\nin vec4  a_id; /* encoded uint32 id in byte4 */\r\nin float a_color;\r\nin float a_emphasis; /* [ bottom: float, top: float ] */\r\nin vec2  a_heights; /* [ bottom: float, top: float ] */\r\nin vec2  a_texCoord;\r\n\r\n#endif\r\n\r\n\r\nuniform mat4 u_viewProjection;\r\nuniform vec2 u_ndcOffset;\r\n\r\nuniform vec4 u_colorTable[$ColorTableLength];\r\n\r\nuniform int u_layer;\r\nuniform int u_face;\r\nuniform int u_arrows;\r\n\r\nuniform vec4 u_normalAndLambert;\r\n\r\nuniform float u_heightScale;\r\nuniform vec2 u_floatingGap; /* [ target gap size, minimum remaining cuboid size ] */\r\nuniform float u_outlineWidth;\r\nuniform float u_emphasisOutlineWidth;\r\n\r\n\r\nvarying vec4 v_baseColor;\r\nvarying vec4 v_outlineColor;\r\nvarying vec4 v_id;\r\n\r\nvarying vec4 v_uv;\r\nvarying vec4 v_arrowColor;\r\n\r\n\r\nconst float ONE_OVER_255 = 1.0 / 255.0;\r\nconst int FACE_INDEX_TOP = 1; /* see CuboidRenderPass.FaceIndex.Top */\r\n\r\nconst vec3 AMBIENT = vec3(0.0, 0.0, 0.0); /* @todo expose to API */\r\nconst float OUTLINE_LAMBERT_SCALE = 0.88; /* @todo expose to API */\r\n\r\nconst int EMPHASIS_COLOR_INDEX = 0;\r\n\r\nconst int POSITIVE_COLOR_INDEX = 1;\r\nconst int NEGATIVE_COLOR_INDEX = 2;\r\n\r\n\r\n/**\r\n * Transforms the cuboid vertices based on the associated face and height mapping. An earlier implementation of this\r\n * used the same geometry template and transformed it to either orientation. The current implementation uses a pre-set\r\n * vertex sequence/orientation and has to adjust the height only.\r\n * Appart from that, each cuboid face is moved to its position and adjusted to the provided height values. ID, color,\r\n * and extent along the y-axis are encoded per vertex (or even per face/cuboid) to reduce per-fragment processing.\r\n */\r\nvoid main(void)\r\n{\r\n    vec4 emphasisColor = u_colorTable[EMPHASIS_COLOR_INDEX];\r\n\r\n    float height = (a_heights[1] - a_heights[0]) * u_heightScale;\r\n    /* Assuming that cuboids of no relevant height mapping should still be visible on top of their parent nodes, zero-\r\n       height nodes are rendered when associated to the first cuboid layer. Note that this might be unwanted behavior,\r\n       e.g., when multiple layers are used and tha top-most layer, even if the height is zero, a relevant color mapping\r\n       might be stacked over all other cuboids of lower layers. */\r\n    if (height <= 0.0 && u_layer > 0) {\r\n        return;\r\n    }\r\n\r\n    /* Compute the position and extend of the cuboid based on the face. */\r\n    vec4 pos = vec4(a_layout[0], u_face == FACE_INDEX_TOP ?\r\n        a_heights[1] * u_heightScale : a_heights[0] * u_heightScale, a_layout[1], 0.0);\r\n    vec4 ext = vec4(a_layout[2], height, a_layout[3], 1.0);\r\n\r\n    /* Compute the final vertex position and pass through texture coordinates and layout data. */\r\n    vec4 vertex = vec4(a_vertex, 1.0) * ext + pos;\r\n\r\n    v_uv.st = a_texCoord.st;\r\n    v_id = a_id * ONE_OVER_255;\r\n\r\n    /* The y-extent provides world-space height of the cuboid that can be used for fragment-processing. */\r\n    v_uv[2] = 1.0; //mix(a_layout[2], a_layout[3], step(5.0, float(u_face)));\r\n    v_uv[3] = height / mix(a_layout[2], a_layout[3], step(5.0, float(u_face)));\r\n\r\n\r\n    /* REVIEW AND SIMPLIFY THE FOLLOWING COLOR COMPUTATION (probably to many states) */\r\n\r\n    /* If emphasis is < 2 use the color lookup, else apply outline color. */\r\n    int colorIndex = int(abs(a_color - 32.0));\r\n    v_baseColor = mix(u_colorTable[colorIndex], emphasisColor, step(2.0, a_emphasis));\r\n\r\n\r\n    float gap = 0.0;\r\n    /* Only if floating cuboids enabled, vertices of lower part of lateral faces, and not for first layer. */\r\n    if(u_floatingGap[0] > 0.0 && u_layer > 0 && a_vertex.y == 0.0 && u_face > 2) {\r\n\r\n        /* Compute screen space position for incoming vertex and an offseted one. */\r\n        vec4 pos0 = u_viewProjection * vertex;\r\n        vec4 pos1 = u_viewProjection * vec4(vertex.x, vertex.y + ext.y, vertex.z, vertex.w);\r\n        /* Vector pointing from pos1 to pos0 in NDC. */\r\n        vec3 pos0_dash = (pos1.xyz / pos1.w) - (pos0.xyz / pos0.w);\r\n        /* Length of pos0' in NDC is the basis for gap scale. */\r\n        gap = u_floatingGap[0] / length(pos0_dash);\r\n        vertex = mix(pos0, pos1, min(1.0 - u_floatingGap[1] / length(pos0_dash), gap));\r\n\r\n    } else {\r\n        vertex = u_viewProjection * vertex;\r\n    }\r\n\r\n\r\n    /* Compute color and direction of arrow pattern for fragment processing. Also account for the\r\n    levitation gap, so the arrow pattern does not squish or stretch. */\r\n    float arrow = sign(a_color - 32.0);\r\n    v_uv[2] *= (a_texCoord.x - 0.5);\r\n    v_uv[3] *= (1.0 - a_texCoord.y) * (1.0 - gap);\r\n\r\n    if(arrow > 0.0) {\r\n        v_uv[3] = (1.0 - v_uv[3]);\r\n    }\r\n\r\n\r\n    if(u_arrows == 0 && u_layer > 0) {\r\n        v_baseColor = mix(u_colorTable[POSITIVE_COLOR_INDEX], u_colorTable[NEGATIVE_COLOR_INDEX], arrow * 0.5 + 0.5);\r\n    } else {\r\n        v_baseColor = u_colorTable[colorIndex];\r\n    }\r\n\r\n    v_baseColor = mix(v_baseColor, emphasisColor, step(2.0, a_emphasis));\r\n\r\n    v_outlineColor.rgb = mix(v_baseColor.rgb, emphasisColor.rgb, step(1.0, a_emphasis));\r\n\r\n    /* The default outline (emphasis = 0.0) should be a little bit darker, when in outline mode (emphasis = 1.0) the\r\n    outline should remain unchanged (except for face lambda), and when highlighting (emphasis = 2.0) the outline is\r\n    lightened a little bit (invere darkening lambda). The mix is utilized to create this. */\r\n    v_outlineColor.rgb *= mix(OUTLINE_LAMBERT_SCALE, (1.0 / OUTLINE_LAMBERT_SCALE), a_emphasis * 0.5);\r\n\r\n    /* The outline should be darkened based on the face orientation. */\r\n    v_outlineColor.rgb = mix(AMBIENT, v_outlineColor.rgb, u_normalAndLambert[3]);\r\n    /* The outline width is encoded within the alpha channel of the outline (special if emphasized). */\r\n    v_outlineColor[3] = mix(u_emphasisOutlineWidth, u_outlineWidth, step(0.5, abs(a_emphasis - 1.0)));\r\n\r\n\r\n    v_baseColor = mix(vec4(AMBIENT, 1.0), v_baseColor, u_normalAndLambert[3]);\r\n\r\n\r\n    v_arrowColor = vec4(v_outlineColor.rgb, 1.0);\r\n    v_arrowColor.rgb *= mix(OUTLINE_LAMBERT_SCALE, 1.0, a_emphasis * 0.5);\r\n\r\n\r\n    ndcOffset(vertex, u_ndcOffset);\r\n    gl_Position = vertex;\r\n}\r\n"},"./shaders/point.frag":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n#if __VERSION__ == 100\r\n\r\n    #ifdef GL_EXT_draw_buffers\r\n        #extension GL_EXT_draw_buffers : enable\r\n        #define fragColor gl_FragData[0].rgba\r\n    #else\r\n        #define DRAW_RESTRICTED\r\n        #define fragColor gl_FragColor.rgba\r\n    #endif\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying in\r\n#endif\r\n\r\n\r\nvarying vec4 v_color;\r\n\r\nvoid main(void)\r\n{\r\n    // Make points round (instead of squares).\r\n    // gl_PointCoord.st ranges from 0.0 to 1.0 across the point horizontally from left to right and\r\n    // vertically from top to bottom.\r\n\r\n    float dist = distance(gl_PointCoord, vec2(0.5, 0.5));\r\n    float alpha = v_color.a - step(0.5, dist);\r\n\r\n    fragColor = vec4(v_color.xyz, alpha);\r\n}\r\n"},"./shaders/point.vert":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\n#if __VERSION__ == 100\r\n    #extension GL_EXT_draw_buffers : enable\r\n#endif\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n#else \r\n    #define varying out\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\nvoid ndcOffset(inout vec4 vertex, in vec2 offset) {\r\n    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\nattribute vec3 a_vertex;\r\nattribute vec4 a_color;\r\n#else\r\n/* Note: do not use layout location specifier, since they take precedence over CPU managed locations. */\r\nin vec3 a_vertex;\r\nin vec4 a_color;\r\n#endif\r\n\r\nuniform mat4 u_viewProjection;\r\nuniform vec2 u_ndcOffset;\r\nuniform float u_pointSize;\r\n\r\nvarying vec4 v_color;\r\n\r\nvoid main(void)\r\n{\r\n    vec4 vertex = u_viewProjection * vec4(a_vertex, 1.0);\r\n\r\n    v_color = a_color;\r\n\r\n    ndcOffset(vertex, u_ndcOffset);\r\n    gl_Position = vertex;\r\n    gl_PointSize = u_pointSize;\r\n}\r\n"},"./shaders/quad.frag":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n#if __VERSION__ == 100\r\n\r\n    #ifdef GL_EXT_draw_buffers\r\n        #extension GL_EXT_draw_buffers : enable\r\n        #define fragColor gl_FragData[0].rgba\r\n        #define fragId gl_FragData[1].xyzw\r\n    #else\r\n        #define DRAW_RESTRICTED\r\n        #define fragColor gl_FragColor.rgba\r\n        #define fragId gl_FragColor.xyzw\r\n        #define fragDepth gl_FragColor.xyz\r\n    #endif\r\n\r\n    #ifdef GL_OES_standard_derivatives\r\n        #extension GL_OES_standard_derivatives : enable\r\n        #define ANTIALIASED_CONTOUR\r\n    #endif\r\n\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n    layout(location = 1) out vec4 fragId;\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying in\r\n#endif\r\n\r\n\r\n\r\n#ifdef DRAW_RESTRICTED\r\n    \r\n// @todo this file will be included from webgl-operate soon\r\n\r\nconst float one255ths = 1.0 / 255.0;\r\n\r\nvec3 float24x1_to_uint8x3(const in float f) {\r\n    vec3 uint8x3 = vec3(f, fract(f * 256.0), fract(f * 65536.0));\r\n    return floor(uint8x3 * 256.0) * one255ths;\r\n}\r\n\r\nvec4 float24x1_to_uint8x4(const in float f) {\r\n    vec4 uint8x4 = vec4(f, fract(f * 256.0), fract(f * 65536.0), fract(f * 16777216.0));\r\n    return floor(uint8x4 * 256.0) * one255ths;\r\n}\r\n\r\nconst vec3 premultUint8x3 = vec3(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0);\r\nfloat uint8x3_to_float24x1(const in vec3 v) {\r\n    return dot(v, premultUint8x3); // a1 * b1 + a2 * b2 + a3 * b3  ;)\r\n}\r\n\r\nconst vec4 premultUint8x4 = vec4(255.0 / 256.0, 255.0 / 65536.0, 255.0 / 16777216.0, 255.0 / 4294967296.0);\r\nfloat uint8x4_to_float24x1(const in vec4 v) {\r\n    return dot(v, premultUint8x4); // a1 * b1 + a2 * b2 + a3 * b3 + a4 * b4  ;)\r\n}\r\n\r\n    uniform int u_attachment;\r\n#endif\r\n\r\n\r\nvarying vec4 v_baseColor;\r\nvarying vec4 v_outlineColor;\r\nvarying vec4 v_id;\r\n\r\nvarying mediump vec2 v_uv;\r\nvarying mediump vec4 v_layout;\r\n\r\n\r\nvoid main(void)\r\n{\r\n#ifdef DRAW_RESTRICTED\r\n    if(u_attachment == 0) {\r\n#endif\r\n\r\n    /* Compute the actual outline of a cuboid face based on texture coordinates. */\r\n    vec2 awidth = fwidth(v_uv.st) * v_outlineColor[3];\r\n\r\n    vec4 ctest; /* Used for countour/ctest testing. */\r\n    ctest.xy = step((v_uv.st - v_layout.xy) - awidth.xy, vec2(0.0));\r\n    ctest.zw = step(vec2(0.0), (v_uv.st - v_layout.xy) - v_layout.zw + awidth.xy);\r\n    float outline = clamp(dot(ctest, vec4(1.0)), 0.0, 1.0);\r\n\r\n    fragColor = mix(v_baseColor, vec4(v_outlineColor.rgb, 1.0), outline);\r\n\r\n#ifdef DRAW_RESTRICTED\r\n    } else if(u_attachment == 1) {\r\n#endif\r\n\r\n    fragId = v_id;\r\n\r\n#ifdef DRAW_RESTRICTED\r\n    } else if(u_attachment == 2) {\r\n        fragDepth = float24x1_to_uint8x3(gl_FragCoord.z);\r\n    }\r\n#endif\r\n}\r\n"},"./shaders/quad.vert":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\n#if __VERSION__ == 100\r\n    #extension GL_EXT_draw_buffers : enable\r\n#endif\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n#else \r\n    #define varying out\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\nvoid ndcOffset(inout vec4 vertex, in vec2 offset) {\r\n    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n\r\nattribute vec2 a_vertex;\r\nattribute vec4 a_layout; /* [ position: vec2, extent: vec2 ] */\r\nattribute vec4 a_id; /* encoded uint32 id in byte4 */\r\nattribute float a_color; /* color index as unsigned byte */\r\nattribute float a_emphasis; /* emphasis mode as unsigned byte */\r\n\r\n#else\r\n\r\n/* Note: do not use layout location specifier, since they take precedence over CPU managed locations. */\r\nin vec2 a_vertex;\r\nin vec4 a_layout; /* [ position: vec2, extent: vec2 ] */\r\nin vec4 a_id; /* encoded uint32 id in byte4 */\r\nin float a_color; /* color index as unsigned byte */\r\nin float a_emphasis; /* emphasis mode as unsigned byte */\r\n\r\n#endif\r\n\r\n\r\nuniform mat4 u_viewProjection;\r\nuniform vec2 u_ndcOffset;\r\n\r\nuniform vec4 u_colorTable[$ColorTableLength];\r\n\r\nuniform float u_outlineWidth;\r\nuniform float u_emphasisOutlineWidth;\r\n\r\n\r\nvarying vec4 v_baseColor;\r\nvarying vec4 v_outlineColor;\r\nvarying vec4 v_id;\r\n\r\nvarying vec2 v_uv;\r\nvarying vec4 v_layout;\r\n\r\n\r\nconst float ONE_OVER_255 = 1.0 / 255.0;\r\n\r\nconst float OUTLINE_LAMBERT_SCALE = 0.88; /* @todo expose to API */\r\n\r\nconst int EMPHASIS_COLOR_INDEX = 0;\r\n\r\n\r\nvoid main(void)\r\n{\r\n    vec4 emphasisColor = u_colorTable[EMPHASIS_COLOR_INDEX];\r\n\r\n    vec4 pos = vec4(a_layout[0], 0.0, a_layout[1], 0.0);\r\n    vec4 ext = vec4(a_layout[2], 0.0, a_layout[3], 1.0);\r\n\r\n    vec4 vertex = vec4(a_vertex.x, 0.0, a_vertex.y, 1.0) * ext + pos;\r\n\r\n    v_uv = vertex.xz;\r\n    v_layout = a_layout;\r\n    v_id = a_id * ONE_OVER_255;\r\n\r\n    vertex = u_viewProjection * vertex;\r\n\r\n    /* If emphasis is < 2 use the color lookup, else apply outline color. */\r\n    v_baseColor = mix(u_colorTable[int(a_color)], emphasisColor, step(2.0, a_emphasis));\r\n    v_outlineColor.rgb = mix(v_baseColor.rgb, emphasisColor.rgb, step(1.0, a_emphasis));\r\n\r\n    /* The default outline (emphasis = 0.0) should be a little bit darker, when in outline mode (emphasis = 1.0) the\r\n    outline should remain unchanged (except for face lambda), and when highlighting (emphasis = 2.0) the outline is\r\n    lightened a little bit (invere darkening lambda). The mix is utilized to create this. */\r\n    v_outlineColor.rgb *= mix(OUTLINE_LAMBERT_SCALE, (1.0 / OUTLINE_LAMBERT_SCALE), a_emphasis * 0.5);\r\n\r\n    /* The outline width is encoded within the alpha channel of the outline (special if emphasized). */\r\n    v_outlineColor[3] = mix(u_emphasisOutlineWidth, u_outlineWidth, step(0.5, abs(a_emphasis - 1.0)));\r\n\r\n    ndcOffset(vertex, u_ndcOffset);\r\n    gl_Position = vertex;\r\n}\r\n"},"./shaders/screenalignedquad.frag":function(e,t){e.exports='//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n#if __VERSION__ == 100\r\n    #define fragColor gl_FragColor\r\n#else\r\n    layout(location = 0) out vec4 fragColor;\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n    #define texture(sampler, coord) texture2D(sampler, coord)\r\n#else\r\n    #define varying in\r\n#endif\r\n\r\n\r\nvarying float v_radius;\r\nvarying vec2 v_uv; // values in range [0, v_extent]\r\nvarying vec2 v_extent;\r\nvarying float v_pointyCornerLeft; // 0 for right, 1 for left\r\nvarying float v_pointyCornerBottom; // 0 for top, 1 for bottom\r\n\r\nconst float ALPHA = 0.8;\r\nconst vec3 COLOR = vec3(1.0);\r\n\r\nvoid main(void)\r\n{\r\n    /* Instead of rendering normal quads, we want to render each quad with rounded corners, so that the\r\n     * quads have the shape of a 2D "pill". Moreover, there will be one corner that retains its pointy\r\n     * shape (in summary, a quad will look like a very simplified speech bubble.)\r\n     * To get the rounded sides of the pill, we will use 2 circles (one left, one right) with the radius\r\n     * `v_radius`, which is half of the quads\'s vertical extent.\r\n     * This code is optimized to avoid conditioned branching (if-else), and uses * and + instead of\r\n     * && and ||, respectively.\r\n     */\r\n\r\n    // middle points of the circle we use to calculate the rounded corners\r\n    vec2 mLeft =  vec2(v_radius);\r\n    vec2 mRight = vec2(v_extent.x - v_radius, v_radius);\r\n\r\n    // define where the borders start, so that we use the correct half of the circle\r\n    float borderLeft =   step(v_uv.x, mLeft.x);\r\n    float borderBottom = step(v_uv.y, mLeft.y);\r\n    float borderRight =  step(mRight.x, v_uv.x);\r\n    float borderTop =    step(mRight.y, v_uv.y);\r\n\r\n    float alphaLeft =  step(v_radius, distance(v_uv, mLeft))  * borderLeft;\r\n    float alphaRight = step(v_radius, distance(v_uv, mRight)) * borderRight;\r\n\r\n    // If we combine both alphaLeft and alphaRight, we get the pill shape. However, we want one corner\r\n    // to stay pointy, so we separate the alpha by the 4 border areas:\r\n    float alphaLeftBottom =  alphaLeft  * borderBottom;\r\n    float alphaLeftTop =     alphaLeft  * borderTop;\r\n    float alphaRightBottom = alphaRight * borderBottom;\r\n    float alphaRightTop =    alphaRight * borderTop;\r\n\r\n    // don\'t apply the rounded corner where the pointy corner should be\r\n    float pointyLeftBottom =         v_pointyCornerLeft  *        v_pointyCornerBottom;\r\n    float pointyLeftTop =            v_pointyCornerLeft  * (1.0 - v_pointyCornerBottom);\r\n    float pointyRightBottom = (1.0 - v_pointyCornerLeft) *        v_pointyCornerBottom;\r\n    float pointyRightTop =    (1.0 - v_pointyCornerLeft) * (1.0 - v_pointyCornerBottom);\r\n\r\n    // based on where the 3 rounded corners should be, we want to "cut away" certain fragments\r\n    float shouldBeCutAway = sign(\r\n          alphaLeftBottom  * (1.0 - pointyLeftBottom)\r\n        + alphaLeftTop     * (1.0 - pointyLeftTop)\r\n        + alphaRightBottom * (1.0 - pointyRightBottom)\r\n        + alphaRightTop    * (1.0 - pointyRightTop));\r\n\r\n    float alpha = mix(ALPHA, 0.0, shouldBeCutAway);\r\n    fragColor = vec4(COLOR, alpha);\r\n}\r\n'},"./shaders/screenalignedquad.vert":function(e,t){e.exports="//*****************************************************************************\r\n// seerene(tm) - A framework for analyzing and visualizing complex software systems.\r\n// Copyright (C) 2005 - 2019 for all source codes:\r\n// seerene(tm) GmbH, Potsdam, Germany\r\n//*****************************************************************************\r\n\r\nprecision highp float;\r\nprecision lowp int;\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\n#if __VERSION__ == 100\r\n#else \r\n    #define varying out\r\n#endif\r\n\r\n\r\n// @todo this file will be included from webgl-operate soon\r\n\r\nvoid ndcOffset(inout vec4 vertex, in vec2 offset) {\r\n    vertex.xy = offset * vec2(vertex.w) + vertex.xy;\r\n}\r\n\r\n\r\n\r\n#if __VERSION__ == 100\r\n\r\n#extension GL_EXT_draw_buffers : enable\r\nattribute vec2 a_vertex;\r\nattribute vec3 a_origin;\r\nattribute vec2 a_extent;\r\nattribute vec2 a_offset;\r\nattribute float a_pointyCorner;\r\n\r\n#else\r\n\r\nin vec2 a_vertex;\r\nin vec3 a_origin;\r\nin vec2 a_extent;\r\nin vec2 a_offset;\r\nin float a_pointyCorner; // pointy corner number as 1: ll, 2: ul, 3: lr, 4: ur\r\n\r\n#endif\r\n\r\nuniform vec2 u_ndcOffset;\r\nuniform mat4 u_viewProjection;\r\nuniform float u_aspectRatio;\r\n\r\nvarying float v_radius;\r\nvarying vec2 v_uv; // values in range [0, v_extent]\r\nvarying vec2 v_extent;\r\nvarying float v_pointyCornerLeft; // 0 for right, 1 for left\r\nvarying float v_pointyCornerBottom; // 0 for top, 1 for bottom\r\n\r\n/**\r\n * Returns accurate MOD when arguments are approximate integers.\r\n * Source: https://stackoverflow.com/a/36078859\r\n */\r\nfloat modI(float a, float b) {\r\n    float m = a - floor((a + 0.5) / b) * b;\r\n    return floor(m + 0.5);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    v_pointyCornerLeft = step(a_pointyCorner, 2.0);\r\n    v_pointyCornerBottom = modI(a_pointyCorner, 2.0);\r\n\r\n    /* POSITIONING */\r\n    /* quad data as flat array: [0, 0,  0, 1,  1, 0,  1, 1] (a_vertex), which translates to ll, lr, ul, ur corners.\r\n     * 2-------4\r\n     * |  \\    |\r\n     * |    \\  |\r\n     * 1-------3\r\n     * The current vertex is calculated based on the current quad corners and the extent attributes.\r\n     */\r\n\r\n    vec2 extent = a_extent;\r\n    vec2 offset = a_offset;\r\n\r\n    // apply more extent to make space for rounded corners (see fragment shader for more information)\r\n    float radius = extent.y * u_aspectRatio * 0.5;\r\n    extent.x += radius;\r\n    offset.x -= mix(radius, 0.0, step(a_pointyCorner, 2.0));\r\n\r\n    v_extent = vec2(extent.x, extent.y * u_aspectRatio);\r\n    v_uv = a_vertex * vec2(extent.x, extent.y * u_aspectRatio);\r\n    v_radius = radius;\r\n\r\n    vec4 origin = u_viewProjection * vec4(a_origin, 1.0);\r\n    vec2 originNDC = vec2(origin.x / origin.w, origin.y / origin.w);\r\n    vec4 vertex = vec4(originNDC + a_vertex * extent + offset, origin.z/origin.w, 1.0);\r\n\r\n    ndcOffset(vertex, u_ndcOffset);\r\n    gl_Position = vertex;\r\n}\r\n"},"./snakelayout.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./directionalrow.ts"),n=r("./node.ts"),o=r("./rect.ts"),a=function(){function e(){}return e.compute=function(e,t,r,a,s,u,c,l,f,h){a[e.root.index]=new o.Rect(0,0,r,1),a[e.root.index].centerAround([.5,.5]),e.forEachInnerNode(function(r){if(h){var d=e.node(r.firstChild);if(d.nextSibling===n.Node.INVALID_INDEX&&d.firstChild!==n.Node.INVALID_INDEX)return a[d.index]=a[r.index],a[r.index]=new o.Rect(0,0,0,0),void(f[r.index]=!0)}var p=s.accessoryPaddingCallback(a[r.index],r,e,a,u);p=s.parentPaddingCallback(p,r,e,a,c,l);var _=s.siblingMarginBeforeCallback(p,r,e,a,c,l),v=_.isReversed,m=v,b=new i.DirectionalRow(e,t,_,t[r.index],_.isVertical,m,v);e.childrenDo(r,function(e){var r=t[e.index];b.increasesAverageAspectRatio(r)&&(b.layoutNodes(a),b.next(_.isVertical)),b.insert(e,r)}),b.layoutNodes(a),e.childrenDo(r,function(e){a[e.index]=s.siblingMarginAfterCallback(a[e.index],_,p,e)})})},e}();t.SnakeLayout=a},"./striplayout.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("./node.ts"),n=r("./rect.ts"),o=r("./row.ts"),a=function(){function e(){}return e.compute=function(e,t,r,a,s,u,c,l,f,h){a[e.root.index]=new n.Rect(0,0,r,1),a[e.root.index].centerAround([.5,.5]),e.forEachInnerNode(function(r){if(h){var d=e.node(r.firstChild);if(d.nextSibling===i.Node.INVALID_INDEX&&d.firstChild!==i.Node.INVALID_INDEX)return a[d.index]=a[r.index],a[r.index]=new n.Rect(0,0,0,0),void(f[r.index]=!0);f[r.index]=!1}var p=s.accessoryPaddingCallback(a[r.index],r,e,a,u);p=s.parentPaddingCallback(p,r,e,a,c,l);var _=s.siblingMarginBeforeCallback(p,r,e,a,c,l),v=new o.Row(e,t,_,t[r.index],p.isVertical);e.childrenDo(r,function(e){var r=t[e.index];v.increasesAverageAspectRatio(r)&&(v.layoutNodes(a),v.next(_.isVertical)),v.insert(e,r)}),v.layoutNodes(a),e.childrenDo(r,function(e){a[e.index]=s.siblingMarginAfterCallback(a[e.index],_,p,e)})})},e}();t.StripLayout=a},"./testdata.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=r("./base64.ts"),o=r("./serviceadapter.ts"),a=function(){function e(){}return e.config=function(e){var t=new o.ServiceAdapter;return t.loadAll(n.decode(e.values[0].response),n.decode(e.values[1].response),n.decode(e.heights.response),e.labels[0].response,e.heights.include_hierarchy,e.heights.compare),t.config},e.fetchAsync=function(t){var r=function(e,t){return"fetching '"+e+"' failed ("+t.status+"): "+t.statusText};return new Promise(function(n,o){var a=new XMLHttpRequest;a.open("GET",t,!0),a.onload=function(){if(a.status<200||a.status>=300)o(r(t,a));else{var s=a.responseText;if(i.properties.validate(s,e.SCHEMA.properties,[])){var u=JSON.parse(s);n(e.config(u))}}},a.onerror=function(){return o(r(t,a))},a.ontimeout=function(){return o(r(t,a))},a.send()})},e.SCHEMA=r("./data/testdata.schema.json"),e}();t.TestData=a},"./topology.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js").auxiliaries.assert,n=r("./linearization.ts"),o=r("./node.ts"),a=function(){function e(){this._linearization=new n.Linearization,this._nodes=new Array,this._innerNodeIndicesById=new Map,this._leafNodeIndicesById=new Map}return e.prototype.fromInterleavedEdges=function(e){i(e.length%2==0,"expected length of interleaved edges list to be a multiple of 2");var t=new Array,r=new Map,n=new Array;t.push(new o.Node(e[0],0)),r.set(t[0].id,t[0]),n.push(new Array),n[0].push(t[0]);for(var a=t[0],s=0;s<e.length;s+=2){var u=[e[s+0],e[s+1]],c=s+2<e.length?[e[s+2],e[s+3]]:[o.Node.INVALID_INDEX,o.Node.INVALID_INDEX];if(a.lastChild!==o.Node.INVALID_INDEX){var l=t[a.lastChild];i(l.nextSibling===o.Node.INVALID_INDEX,"expected next sibling to be unset for last child of a node"),l.initialNextSibling=t.length,l.nextSibling=t.length}var f=new o.Node(u[1],t.length,a);t.push(f),n.length===f.depth&&n.push(new Array),n[f.depth].push(f),c[0]===u[1]?(i(!1===r.has(f.id),"expected unique ids for inner nodes, given "+u[1]+" of "+u[0]+" (next parent of "+c[1]+")"),r.set(f.id,f),a=f):c[0]!==u[0]&&c[0]!==o.Node.INVALID_ID&&(i(r.has(c[0]),"expected next parent to be already created, given "+c[0]),a=r.get(c[0]))}this.fromNodes(t,n)},e.prototype.fromNodes=function(e,t){this._linearization.clear(),this._innerNodeIndicesById.clear(),this._leafNodeIndicesById.clear();for(var r=new Array,i=new Array,n=0,o=t;n<o.length;n++){for(var a=0,s=(h=o[n]).filter(function(e){return e.isLeaf});a<s.length;a++){var u=s[a];r.push(u)}var c=h.filter(function(e){return!e.isLeaf});c.length>0&&i.push(c)}i.push(r);for(var l=0,f=i;l<f.length;l++){var h=f[l];this._linearization.addSliceByLength(h.length)}var d=new Map;this._nodes.length=e.length,d.set(-1,-1);for(var p=0,_=0,v=i;_<v.length;_++)for(var m=0,b=v[_];m<b.length;m++){u=b[m];this._nodes[p]=u,(u.isLeaf?this._leafNodeIndicesById:this._innerNodeIndicesById).set(u.id,p),d.set(u.index,p),++p}for(var g=0,y=this._nodes;g<y.length;g++){(u=y[g]).index=d.get(u.index),u.parent=d.get(u.parent),u.initialNextSibling=d.get(u.initialNextSibling),u.initialFirstChild=d.get(u.initialFirstChild),u.nextSibling=u.initialNextSibling,u.firstChild=u.initialFirstChild}},e.prototype.sliceDo=function(e,t){var r=this;this._linearization.sliceDo(e,function(e,i){for(var n=e;n<=i;++n)t(r._nodes[n])})},e.prototype.initialize=function(t,r){var n;switch(t){case e.InputFormat.Tupled:this.fromInterleavedEdges((n=[]).concat.apply(n,r));break;case e.InputFormat.Interleaved:default:i(r.length%2==0,"Interleaved edges expect to be a multiple of two ids."),this.fromInterleavedEdges(r)}return!0},e.prototype.node=function(e){if(!(this._nodes.length<=e))return this._nodes[e]},e.prototype.innerNodeIndexById=function(e){return this._innerNodeIndicesById.get(e)},e.prototype.leafNodeIndexById=function(e){return this._leafNodeIndicesById.get(e)},e.prototype.innerNodeById=function(e){var t=this.innerNodeIndexById(e);if(void 0!==t)return this.node(t)},e.prototype.leafNodeById=function(e){var t=this.leafNodeIndexById(e);if(void 0!==t)return this.node(t)},e.prototype.forEachInnerNode=function(e){for(var t=0;t<this.depth-1;++t)this.sliceDo(t,e)},e.prototype.parentsDoUntilDepth=function(e,t){for(var r=Math.min(Math.max(e,0),this.depth-1),i=0;i<r;++i)this.sliceDo(i,t)},e.prototype.forEachLeafNode=function(e){this.sliceDo(this.depth-1,e)},e.prototype.nodesDo=function(e){this.forEachInnerNode(e),this.forEachLeafNode(e)},e.prototype.reverseNodesDo=function(e){this.forEachLeafNode(e),this.reverseParentsDo(e)},e.prototype.depthFirstDo=function(e){e(this.root)},e.prototype.childrenDo=function(e,t){i(void 0!==e,"Parent is expected to be valid."),e.firstChild!==o.Node.INVALID_INDEX&&this.siblingsDo(this.node(e.firstChild),t)},e.prototype.siblingsDo=function(e,t){var r=e;for(t(r);r.nextSibling!==o.Node.INVALID_INDEX;)t(r=this.node(r.nextSibling))},e.prototype.siblingsRangeDo=function(e,t,r){if(void 0===t)return this.siblingsDo(e,r);for(var i=e;void 0!==i&&i!==t;i=this.node(i.nextSibling))r(i)},e.prototype.reverseParentsDo=function(e){for(var t=this.depth-2;t>=0;--t)this.sliceDo(t,e)},Object.defineProperty(e.prototype,"linearization",{get:function(){return this._linearization},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfNodes",{get:function(){return this._linearization.numberOfNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfInnerNodes",{get:function(){return this._linearization.numberOfInnerNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numberOfLeafNodes",{get:function(){return this._linearization.numberOfLeafNodes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._linearization.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._nodes[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),e}();t.Topology=a,function(e){!function(e){e.Interleaved="interleaved",e.Tupled="tupled"}(e.InputFormat||(e.InputFormat={})),function(e){e.TopDown="top-down",e.BottomUp="bottom-up",e.DepthFirst="depth-first"}(e.IterationDirection||(e.IterationDirection={}))}(a=t.Topology||(t.Topology={})),t.Topology=a},"./treemap.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js");i.auxiliaries.logVerbosity(2),i.auxiliaries.assertions(!0),t.gloperate=i;var n=r("./configuration.ts");t.Configuration=n.Configuration;var o=r("./configurationaids.ts");t.ConfigurationAids=o.ConfigurationAids;var a=r("./renderer.ts");t.Renderer=a.Renderer;var s=r("./visualization.ts");t.Visualization=s.Visualization;var u=r("./topology.ts");t.Topology=u.Topology;var c=r("./attributebuffer.ts");t.AttributeBuffer=c.AttributeBuffer;var l=r("./layout.ts");t.Layout=l.Layout;var f=r("./geometrycreation.ts");t.GeometryCreation=f.GeometryCreation;var h=r("./servicedata.ts");t.ServiceData=h.ServiceData;var d=r("./serviceadapter.ts");t.ServiceAdapter=d.ServiceAdapter;var p=r("./testdata.ts");t.TestData=p.TestData;var _=r("./navigation.ts");t.Navigation=_.Navigation,function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r("./initialize.ts"))},"./visualization.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("../node_modules/webgl-operate/lib/webgl-operate.js"),n=r("../node_modules/webgl-operate/lib/webgl-operate.js"),o=i.auxiliaries.assert,a=r("./geometry/nodecolors.ts"),s=r("./geometry/nodeemphases.ts"),u=r("./geometry/nodeindices.ts"),c=r("./adaptivelabelplacement.ts"),l=r("./aggregation.ts"),f=r("./attributebuffer.ts"),h=r("./colortable.ts"),d=r("./configurationaids.ts"),p=r("./drawdispatch.ts"),_=r("./drawdispatchcomputation.ts"),v=r("./geometry.ts"),m=r("./geometrycreation.ts"),b=r("./intermediateresults.ts"),g=r("./labelmanagement.ts"),y=r("./layout.ts"),E=r("./layoutcascade.ts"),x=r("./nodesort.ts"),T=r("./perflogindent.ts"),O=r("./renderer.ts"),P=function(){function e(){this._intermediaries=new b.IntermediateResults,this._labelsChanged=!1,this._geometry=new v.Geometry,this._skipLabeling=!1,this._skipInnerLabeling=!1,this._skipLeafLabeling=!1,this._renderer=new O.Renderer(this),this._renderer.geometry=this._geometry}return Object.defineProperty(e,"debug",{set:function(t){t&&i.auxiliaries.logVerbosity()<i.auxiliaries.LogLevel.Debug&&(i.auxiliaries.logVerbosity(i.auxiliaries.LogLevel.Debug),i.auxiliaries.log(i.auxiliaries.LogLevel.Debug,"changed log verbosity to "+i.auxiliaries.LogLevel.Debug+" (debug)")),p.DrawDispatch.debug=t,e._debug=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"debug",{set:function(t){e.debug=t},enumerable:!0,configurable:!0}),e.prototype.resolveBuffer=function(e,t,r){if(r&&(void 0===e||""===e))return r();var i=f.AttributeBuffer.create(this._intermediaries.topology,e,t);return r&&void 0===i?r():i},e.prototype.getNodeIndexFromId=function(e,t){var r=this._intermediaries.topology;return t?r.leafNodeIndexById(e):r.innerNodeIndexById(e)},e.prototype.resolveMetricBuffers=function(){var e=this._configuration;this._decodedAreas||(this._decodedAreas=this.resolveBuffer("bufferView:DecodedArea",e)),this._decodedBaseHeights&&this._decodedDeltaHeights&&this._heightChange||(this._decodedBaseHeights=this.resolveBuffer("bufferView:DecodedBaseHeight",e)||this.resolveBuffer("bufferView:DecodedHeight",e),this._decodedDeltaHeights=this.resolveBuffer("bufferView:DecodedDeltaHeight",e),this._heightChange=this.resolveBuffer("bufferView:HeightChange",e))},e.prototype.constBufferCallback=function(e){var t=this;return void 0===e&&(e=0),function(){var r=new Float32Array(t._intermediaries.topology.numberOfNodes);return r.fill(e),r}},e.prototype.applyInnerNodeColorMapping=function(t){var r="color-mapping inners";i.auxiliaries.logPerformanceStartIf(e._debug,r);var n=t.geometry,u=t.altered.geometry;if(o(void 0!==this._geometry.innerNodeColors||u.any,"expected any alteration when inner-node color mapping is yet to be defined"),u.any||t.altered.topology){o(void 0!==this._geometry&&void 0!==this._geometry.colorTable,"expected color lookup-table to be specified (cached)");var c=this._intermediaries.topology;(t.altered.topology||u.emphasis.any)&&(this._geometry.innerNodeEmphases=s.NodeEmphases.innerNodes(c,n.emphasis?new Set(n.emphasis.outline):void 0,n.emphasis?new Set(n.emphasis.highlight):void 0)),t.altered.topology&&(this._geometry.innerNodeColors=a.NodeColors.innerNodes(c,this._colorLUT.innerNodeColorOffset,this._colorLUT.innerNodeColorCount)),i.auxiliaries.logPerformanceStopIf(e._debug,r,void 0,T.PERF_LOG_INDENT)}else i.auxiliaries.logPerformanceStopIf(e._debug,r,"skipped",T.PERF_LOG_INDENT)},e.prototype.applyLeafNodeColorMapping=function(t){var r="color-mapping leafs";i.auxiliaries.logPerformanceStartIf(e._debug,r);var n=t.geometry,a=t.altered.geometry;if(a.any||t.altered.topology){if(o(void 0!==this._geometry&&void 0!==this._geometry.colorTable,"expected color lookup-table to be specified (cached)"),0===(void 0===n.leafLayers?0:n.leafLayers.length))return this._intermediaries.aggregatedColors=void 0,this._intermediaries.colors=new Array(0),this._geometry.leafNodeColors[0]=m.GeometryCreation.defaultLeafNodeColors(this._intermediaries.topology,this._colorLUT.leafColorOffset),void i.auxiliaries.logPerformanceStopIf(e._debug,r,"defaulted",T.PERF_LOG_INDENT);if((t.altered.topology||a.emphasis.any)&&(this._geometry.leafNodeEmphases=s.NodeEmphases.leafNodes(this._intermediaries.topology,n.emphasis?new Set(n.emphasis.outline):void 0,n.emphasis?new Set(n.emphasis.highlight):void 0)),!a.colors&&void 0!==this._intermediaries.colors)return void 0===this._intermediaries.aggregatedColors&&(this._intermediaries.aggregatedColors=this._intermediaries.colors[0]),void i.auxiliaries.logPerformanceStopIf(e._debug,r,"skipped",T.PERF_LOG_INDENT);var u=this.resolveBuffer(n.leafLayers[0].colors,t,this.constBufferCallback(0));this._decodedColors=u;for(var c=0;c<1;++c){var l=n.leafLayers[c].colorScheme,h=void 0!==l&&void 0!==l.classBounds?new Float32Array(l.classBounds):void 0,d=void 0!==l&&void 0!==l.inverted&&l.inverted,p=f.AttributeBuffer.range(u),_=this._colorLUT.leafColorCount,v=this._colorLUT.leafColorOffset,b=this.resolveBuffer(n.leafLayers[1].colors,t,this.constBufferCallback(0));this._geometry.leafNodeColors[c]=m.GeometryCreation.createLeafNodeColors(this._intermediaries.topology,u,v,_,p,this._colorLUT.unmodifiedColorIndex,h,d,b),this._geometry.altered.alter("leafNodeColors")}void 0===this._intermediaries.aggregatedColors&&(this._intermediaries.aggregatedColors=u),i.auxiliaries.logPerformanceStopIf(e._debug,r,void 0,T.PERF_LOG_INDENT)}else i.auxiliaries.logPerformanceStopIf(e._debug,r,"skipped",T.PERF_LOG_INDENT)},e.prototype.createLayout=function(e,t,r,i,n,o,a){var s=y.Layout.createLayout(e,t,r.layout,i,n,o,a);return void 0!==r.layout.cascade&&r.layout.cascade?E.LayoutCascade.applyCascade(e,s):s},e.prototype.updateLabels=function(){var e=this._intermediaries.innerNodeLabels,t=this._intermediaries.leafLabels;if(void 0!==this._geometry&&this._geometry.valid&&!this._skipLabeling&&void 0!==t&&void 0!==e){if(this._labelsChanged&&(this._renderer.updateLabels(e,t),this._renderer.updateLeafLabelBackgrounds(t),this._renderer.updatePoints(t)),this._renderer.camera.altered||this._labelsChanged){var r=c.AdaptiveLabelPlacement.adaptPositionToPreventOverlapGreedy(t,this._renderer.camera);r.visibility||r.positioning?(this._renderer.updateLeafLabelBackgrounds(t),this._renderer.updateLeafLabelPass()):this._renderer.frameSizeAltered()&&this._renderer.updateLeafLabelBackgrounds(t),r.visibility&&this._renderer.updatePoints(t)}this._labelsChanged&&(this._labelsChanged=!1)}},e.prototype.update=function(){var t=this;if(void 0===this._configuration||void 0===this._configuration.topology)return this._geometry.initialized&&this._geometry.uninitialize(),!0;var r=this._configuration,a=r.altered,s=e._debug;if(!a.any)return!1;o(void 0!==r.topology,"Valid topology expected");var c=a.layout.sort;i.auxiliaries.logPerformanceStartIf(s,"tree");var p=this._intermediaries.topology;a.topology&&(i.auxiliaries.logIf(s,i.auxiliaries.LogLevel.Debug,"vis topology changed |"),p.initialize(r.topology.format,r.topology.edges),this._intermediaries.aggregatedWeights=void 0,this._intermediaries.accessorySpaces=void 0,this._intermediaries.labelRects=void 0,this._intermediaries.labelPaddingSpaces=void 0,this._intermediaries.layout=void 0,this._intermediaries.prunedNodes=void 0,this._geometry.initialized&&this._geometry.uninitialize(),this._geometry.initialize(p),c=!0),i.auxiliaries.logPerformanceStopIf(s,"tree",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"weights");var v=this._intermediaries.aggregatedWeights;(void 0===v||a.layout.weight)&&(v=this._intermediaries.aggregatedWeights=this.resolveBuffer(r.layout.weight,r),this._intermediaries.layout=void 0,c=!0,this._decodedAreas=void 0),i.auxiliaries.logPerformanceStopIf(s,"weights",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"sort"),c&&(x.NodeSort.sortNodes(p,v,r),this._intermediaries.layout=void 0),i.auxiliaries.logPerformanceStopIf(s,"sort",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"layout");var b=this._intermediaries.layout,y=this._intermediaries.accessorySpaces,E=this._intermediaries.labelRects,O=this._intermediaries.labelPaddingSpaces,P=this._intermediaries.prunedNodes;(void 0===b||a.layout.any)&&(y=this._intermediaries.accessorySpaces=new Array(p.numberOfInnerNodes),E=this._intermediaries.labelRects=new Array(p.numberOfInnerNodes),O=this._intermediaries.labelPaddingSpaces=new Array(p.numberOfInnerNodes),P=this._intermediaries.prunedNodes=new Array(p.numberOfNodes),b=this._intermediaries.layout=this.createLayout(p,v,r,y,E,O,P),this._geometry.innerNodeLayouts=void 0,this._geometry.leafNodeLayouts=void 0),i.auxiliaries.logPerformanceStopIf(s,"layout",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"base geometry"),void 0===this._geometry.innerNodeIndices&&(this._geometry.innerNodeIndices=u.NodeIndices.innerNodes(p)),void 0===this._geometry.leafNodeIndices&&(this._geometry.leafNodeIndices=u.NodeIndices.leafNodes(p)),void 0===this._geometry.innerNodeLayouts&&(this._geometry.innerNodeLayouts=m.GeometryCreation.createParentLayoutBuffer(p,b,this._configuration.geometry)),void 0===this._geometry.leafNodeLayouts&&(this._geometry.leafNodeLayouts=m.GeometryCreation.createLeafLayoutBuffer(p,b,this._configuration.geometry));var A=void 0===r.geometry.leafLayers?0:r.geometry.leafLayers.length;this._geometry.leafNodeHeights.length=Math.max(A,1),this._geometry.leafNodeColors.length=1,i.auxiliaries.logPerformanceStopIf(s,"base geometry",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"color table");var L=function(e,t){switch(t){case n.Color.Space.CMYK:var r=e.fill(1,e.length,5);return(new n.Color).fromCMYK(r[0],r[1],r[2],r[3],r[4]);case n.Color.Space.LAB:r=e.fill(1,e.length,4);return(new n.Color).fromLAB(r[0],r[1],r[2],r[3]);case n.Color.Space.HSL:r=e.fill(1,e.length,4);return(new n.Color).fromHSL(r[0],r[1],r[2],r[3]);case"hex":return(new n.Color).fromHex(e);default:case n.Color.Space.RGB:r=e.fill(1,e.length,4);return(new n.Color).fromRGB(r[0],r[1],r[2],r[3])}},w=function(e,t,r){if(void 0===e||void 0===t)return r;var i=e.find(function(e){return e.identifier===t.split(":")[1]});return void 0===i?r:void 0!==i.value?L(i.value,i.space):function(e,t){for(var r=new Array(e.length),i=0;i<r.length;++i)r[i]=L(e[i],t);return r}(i.values,i.space)};if(r.altered.colors){var S=w(r.colors,r.geometry.emphasis?r.geometry.emphasis.color:void 0,new n.Color),R=w(r.colors,r.geometry.auxiliary,new n.Color),M=w(r.colors,r.geometry.parentLayer.colorMap,[new n.Color,new n.Color]),I=w(r.colors,r.geometry.leafLayers[0].colorMap,[new n.Color,new n.Color]);this._colorLUT=new h.ColorTable(S,R,M,I),this._geometry.colorTable&&this._geometry.colorTable.length===this._colorLUT.bits.length||(this._geometry.altered.alter("colorTableLength"),this._renderer.invalidate()),this._geometry.colorTable=this._colorLUT.bits}i.auxiliaries.logPerformanceStopIf(s,"color table",void 0,T.PERF_LOG_INDENT),this.applyInnerNodeColorMapping(r),this.applyLeafNodeColorMapping(r),i.auxiliaries.logPerformanceStartIf(s,"heights");var N=this._geometry.heightScale;if(void 0===N||a.geometry.heightScale){var C=r.geometry.heightScale;N=void 0!==C&&C in d.ConfigurationAids.HeightScaleApproach?this._geometry.heightScale=d.ConfigurationAids.heightScale(p,C):this._geometry.heightScale=void 0!==C?C:d.ConfigurationAids.heightScale(p,d.ConfigurationAids.HeightScaleApproach.SomethingInverseSqrt),this._geometry.altered.alter("heightScale")}r.altered.geometry.levitate&&(this._geometry.levitate=r.geometry.levitate,this._geometry.altered.alter("levitate")),r.altered.geometry.outlineWidth&&(this._geometry.outlineWidth=r.geometry.outlineWidth,this._geometry.altered.alter("outlineWidth")),r.geometry.emphasis&&r.altered.geometry.emphasis.outlineWidth&&(this._geometry.emphasisOutlineWidth=r.geometry.emphasis.outlineWidth,this._geometry.altered.alter("emphasisOutlineWidth"));var F=this._intermediaries.aggregatedHeights,B=this._intermediaries.heights;if(A>0&&void 0!==r.geometry.leafLayers){if(a.geometry.heights||a.buffers||a.bufferViews||void 0===F||void 0===B){this._intermediaries.aggregatedHeights=new Float32Array(p.numberOfNodes),F=this._intermediaries.aggregatedHeights,this._intermediaries.heights=new Array(A),B=this._intermediaries.heights;for(var j=void 0,D=function(e){var t=r.geometry.leafLayers[e];B[e]=z.resolveBuffer(void 0!==t.height?t.height:"",r,z.constBufferCallback());var i=m.GeometryCreation.createLayerHeightBuffer(p,B[e],j,z._configuration.geometry);j=i,z._geometry.leafNodeHeights[e]=i,p.nodesDo(function(t){F[t.index]+=B[e][t.index]})},z=this,G=0;G<A;++G)D(G);this._decodedBaseHeights=void 0,this._decodedDeltaHeights=void 0,this._geometry.altered.alter("leafNodeHeights")}}else F=this._intermediaries.aggregatedHeights=void 0,B=this._intermediaries.heights=new Array(0),this._geometry.leafNodeHeights[0]=m.GeometryCreation.createEmptyLayerHeightBuffer(p);i.auxiliaries.logPerformanceStopIf(s,"heights",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"filter");var U=r.geometry.aggregation,k=this._intermediaries.aggregationMask;if(a.geometry.aggregation||void 0===k)if(void 0!==U){var V=this.resolveBuffer(U.buffer,r,this.constBufferCallback(1)),H=void 0!==U.valueThreshold?U.valueThreshold:1,W=void 0!==U.depthThreshold?U.depthThreshold:1;this._intermediaries.aggregationMask=l.Aggregation.createAggregationMask(p,v,V,H,W,P),k=this._intermediaries.aggregationMask,this._geometry.innerNodeDrawDispatch=void 0,this._geometry.leafNodeDrawDispatch=void 0}else this._intermediaries.aggregationMask=l.Aggregation.createEmptyAggregationMask(p),k=this._intermediaries.aggregationMask,this._geometry.innerNodeDrawDispatch=void 0,this._geometry.leafNodeDrawDispatch=void 0;if(i.auxiliaries.logPerformanceStopIf(s,"filter",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"draw dispatch setup"),(void 0===this._geometry.innerNodeDrawDispatch||a.geometry.parentLayer)&&(this._geometry.innerNodeDrawDispatch=_.DrawDispatchComputation.computeParentDrawDispatch(p,k,r.geometry.parentLayer.showRoot)),void 0===this._geometry.leafNodeDrawDispatch&&(this._geometry.leafNodeDrawDispatch=_.DrawDispatchComputation.computeLeafDrawDispatch(p,k)),i.auxiliaries.logPerformanceStopIf(s,"draw dispatch setup",void 0,T.PERF_LOG_INDENT),i.auxiliaries.logPerformanceStartIf(s,"label creation"),(void 0===this._intermediaries.leafLabels||void 0===this._intermediaries.innerNodeLabels||r.altered.labels)&&void 0!==r.labels)if(void 0!==r.labels.names){var X=f.AttributeBuffer.create(p,r.labels.names,r);void 0!==X&&(this._intermediaries.leafLabels=g.LabelManagement.fillLeafLabelArrayByExplicitNames(p,X,this._geometry.heightScale,this._geometry.leafNodeLayouts,this._geometry.leafNodeHeights[this._geometry.leafLayerCount-1]),this._intermediaries.innerNodeLabels=g.LabelManagement.fillInnerNodeLabelArrayOnAccessoryByExplicitNames(p,X,this._intermediaries.accessorySpaces),this._labelsChanged=!0,this._renderer.invalidate())}else{var q=g.LabelManagement.createLabelSelection(p,v,F,this._intermediaries.aggregatedColors,new Uint8Array(p.numberOfNodes),new Set,r.labels.innerNodeLayerRange,r.labels.numTopInnerNodes,r.labels.numTopWeightNodes,r.labels.numTopHeightNodes,r.labels.numTopColorNodes),Y=r.labels.callback||this._nameRequestCallback;Y&&Y(q,function(e){e.forEach(function(t,r,i){if(void 0!==t){var n=t.replace(/\uff0f/g,"/");e.set(r,n)}}),t._intermediaries.innerNodeLabels=g.LabelManagement.fillInnerNodeLabelArrayOnAccessory(p,e,q,t._intermediaries.accessorySpaces),t._intermediaries.leafLabels=g.LabelManagement.fillLeafLabelArray(p,e,q,t._geometry.heightScale,t._geometry.leafNodeLayouts,t._geometry.leafNodeHeights[t._geometry.leafLayerCount-1]),t._labelsChanged=!0,t._renderer.initialized&&t._renderer.invalidate()})}return i.auxiliaries.logPerformanceStopIf(s,"label creation",void 0,T.PERF_LOG_INDENT),r.altered.reset(),!0},e.prototype.prepare=function(){i.auxiliaries.logPerformanceStartIf(e._debug,"label placement"),this.updateLabels(),i.auxiliaries.logPerformanceStopIf(e._debug,"label placement",void 0,T.PERF_LOG_INDENT)},e.prototype.decodedMetricDataDelta=function(e,t,r){void 0===r&&(r=!1);var i=this.getNodeIndexFromId(e,t);if(void 0!==i){this.resolveMetricBuffers();var n=this._decodedBaseHeights[i],o=this._decodedDeltaHeights&&this._decodedDeltaHeights[i],a=this._heightChange&&this._heightChange[i];return void 0===a||void 0===o?o=0:r&&a>0||!r&&a<=0?o*=-1:n+=o,{color:{value:this._decodedColors[i]},area:{value:this._decodedAreas[i]},height:{value:n,delta:o}}}},e.prototype.decodedMetricDataCompareValue=function(e,t){var r=this.getNodeIndexFromId(e,t);if(void 0!==r){this.resolveMetricBuffers();var i,n,o=this._decodedBaseHeights[r],a=this._decodedDeltaHeights&&this._decodedDeltaHeights[r],s=this._heightChange&&this._heightChange[r];return void 0===s||void 0===a?(i=o,n=o):s>0?(i=o+a,n=o):(i=o,n=o+a),{color:{value:this._decodedColors[r]},area:{value:this._decodedAreas[r]},height:{value:i,compareValue:n}}}},Object.defineProperty(e.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this._configuration},set:function(e){this._configuration=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skipLabeling",{set:function(e){this._skipLabeling=e,this._renderer.skipInnerLabelPass=e,this._renderer.skipLeafLabelPass=e,this._skipLabeling||(this.updateLabels(),this._renderer.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skipInnerLabeling",{set:function(e){this._skipInnerLabeling=e,this._renderer.skipInnerLabelPass=e,this._skipInnerLabeling||(this.updateLabels(),this._renderer.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skipLeafLabeling",{set:function(e){this._skipLeafLabeling=e,this._renderer.skipLeafLabelPass=e,this._skipLeafLabeling||(this.updateLabels(),this._renderer.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nameRequest",{set:function(e){this._nameRequestCallback=e},enumerable:!0,configurable:!0}),e._debug=!1,e}();t.Visualization=P},0:function(e,t,r){r("./polyfill.ts"),e.exports=r("./treemap.ts")},rxjs:function(t,r){t.exports=e}})});